import{c as Zt,s as U,g as Kt,I as Xt,a as dt,b as Ze,i as jo,B as Eo,d as Mo,M as wo,l as j,e as je,f as Io,h as me,r as a,k as Ke,m as ke,u as De,n as Qt,o as zt,p as It,q as vt,t as bt,v as Ae,w as To,x as $o,y as kt,z as Me,A as Ve,C as tt,D as ze,E as Re,F as eo,G as to,H as xt,J as ut,K as Ro,N as Oo,O as Tt,P as Bt,Q as Je,R as Lo,S as Ao,T as Do,U as it,V as Ge,W as oo,X as Fo,Y as zo,Z as no,j as e,_ as ko,$ as Ct,a0 as nt,a1 as _e,a2 as _,a3 as ee,a4 as Bo,a5 as Po,a6 as Uo,a7 as yt}from"./index-BUsbUyuA.js";const Rt=(t,o,s)=>t>=0&&t<s&&o>=0&&o<s,Ie=(t,o)=>(t=Math.ceil(t),o=Math.floor(o),Math.floor(Math.random()*(o-t))+t),Go=t=>{for(let o=t.length-1;o>0;o--){const s=Math.floor(Math.random()*(o+1));[t[o],t[s]]=[t[s],t[o]]}return t},Vo=(t,o,s,n=300)=>{const l=(o.toUpperCase()==="CLASSIC"?s.CLASSIC:o.toUpperCase()==="TIMED"?s.TIMED:s.SURVIVAL).initialSpawnRate;let d=0;return t<=2?d=0:t<=4?d=.15:d=.25,Math.round(Math.max(n,l*(1-d)))},ct=(t,o,s)=>{if(!t||!Array.isArray(t)||t.length===0||!s||s.length===0||o<=0)return!1;for(let n=0;n<o;n++)for(let i=0;i<o;i++)if(!(!t[n]||t[n][i]!==null)&&_o(t,n,i,o,s))return!0;return!1},_o=(t,o,s,n,i)=>{if(!t||!i||i.length===0||n<=0)return!1;const l=[{dr:-1,dc:0},{dr:0,dc:1},{dr:1,dc:0},{dr:0,dc:-1}];for(const d of i){let r=0;for(const{dr:c,dc:v}of l){let u=o+c,b=s+v;for(;Rt(u,b,n)&&!(!t[u]||t[u][b]===void 0);){if(t[u][b]!==null){if(t[u][b]===d&&(r++,r>=2))return!0;break}u+=c,b+=v}}}return!1},Ho=(t,o,s,n)=>{if(!t[o][s]||typeof t[o][s]!="string")return{hasConvergence:!1,convergingCells:[]};const i=t[o][s];if(i.includes("_removing"))return{hasConvergence:!1,convergingCells:[]};const l=[{dr:-1,dc:0},{dr:0,dc:1},{dr:1,dc:0},{dr:0,dc:-1}],d=[{row:o,col:s}],r={};for(const{dr:v,dc:u}of l){const b=`${v},${u}`;r[b]=[];let S=o+v,E=s+u;for(;Rt(S,E,n);){if(t[S][E]===i){const O={row:S,col:E};r[b].push(O),d.push(O);break}else if(t[S][E]!==null)break;S+=v,E+=u}}const c=d.length>=3;return{hasConvergence:c,convergingCells:c?d:[]}},qo=(t,o,s,n)=>{if(t[o][s]!==null)return[];const i={},l=[{dr:-1,dc:0},{dr:1,dc:0},{dr:0,dc:-1},{dr:0,dc:1}];for(const{dr:r,dc:c}of l){let v=o+r,u=s+c;for(;Rt(v,u,n);){const b=t[v][u];if(b!==null){if(b.includes("_removing"))break;i[b]||(i[b]=[]),i[b].push({row:v,col:u});break}v+=r,u+=c}}const d=[];for(const r in i)i[r].length>=2&&d.push(...i[r]);return d};function Yo(){const t={};let o=null,s=localStorage.getItem("soundEnabled")!=="false",n=localStorage.getItem("musicEnabled")!=="false",i=parseFloat(localStorage.getItem("soundVolume")||"0.5"),l=parseFloat(localStorage.getItem("musicVolume")||"0.3");function d(c,v){try{const u=new Audio;u.src=v,u.preload="auto",u.onerror=()=>{console.warn(`Error al cargar el sonido: ${c} (${v}). Usando sonido alternativo.`)},t[c]=u}catch(u){console.error(`Error al inicializar el sonido: ${c}`,u),t[c]=new Audio}}function r(c){try{o=new Audio,o.src=c,o.loop=!0,o.volume=l,o.preload="auto",o.onerror=()=>{console.warn(`Error al cargar la m√∫sica: ${c}. Usando m√∫sica alternativa.`),o&&(o.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}}catch(v){console.error("Error al inicializar la m√∫sica",v),o=null}}try{d("success","/assets/audio/positives/bleep.wav"),d("error","/assets/audio/negatives/error.wav"),d("levelComplete","/assets/audio/level-completed.wav"),d("gameOver","/assets/audio/negatives/gameover.wav"),d("click","/assets/audio/pops/click.wav"),d("newIcon","/assets/audio/pops/pop-up.wav"),d("removeIcon","/assets/audio/pops/bubble-pop.wav"),d("hint","/assets/audio/pops/hint.wav"),d("speedUp","/assets/audio/speed-up.mp3"),d("penalty","/assets/audio/error.mp3"),d("emptyBoard","/assets/audio/positives/cartoon-sparkle.wav"),d("levelTransition","/assets/audio/positives/cartoon-sparkle.wav"),d("convergingFound","/assets/audio/positives/bell-up.wav"),d("start","/assets/audio/positives/bleep.wav"),d("pause","/assets/audio/pops/pause.wav"),d("resume","/assets/audio/pops/resume.wav"),d("invalid","/assets/audio/negatives/error.wav"),d("invalidMove","/assets/audio/negatives/error.wav"),d("timeBonus","/assets/audio/positives/time-bonus.wav"),r("/assets/audio/level-music-2.mp3")}catch(c){console.error("Error al cargar recursos de audio",c)}return{sounds:t,music:o,enabled:s,musicEnabled:n,volume:i,musicVolume:l,play(c){if(s)try{t[c]||console.warn(`Sonido no encontrado: ${c}, creando uno temporal`);const v=t[c].cloneNode();v.volume=i,v.play().catch(u=>{console.warn(`Error reproduciendo sonido ${c}:`,u)})}catch(v){console.error(`Error al reproducir sonido: ${c}`,v)}},startMusic(){if(!(!n||!o))try{o.volume=l,o.currentTime=0,o.play().catch(c=>{console.warn("Error reproduciendo m√∫sica:",c)})}catch(c){console.error("Error al iniciar m√∫sica:",c)}},stopMusic(){try{o&&(o.pause(),o.currentTime=0)}catch(c){console.error("Error al detener m√∫sica:",c)}},pauseMusic(){try{o&&o.pause()}catch(c){console.error("Error al pausar m√∫sica:",c)}},resumeMusic(){if(!(!n||!o))try{o.play().catch(c=>console.warn("Error al reanudar m√∫sica:",c))}catch(c){console.error("Error al reanudar m√∫sica:",c)}},toggleSound(){return s=!s,localStorage.setItem("soundEnabled",s.toString()),s},toggleMusic(){return n=!n,localStorage.setItem("musicEnabled",n.toString()),n&&o?o.play().catch(c=>console.warn("Error al activar m√∫sica:",c)):o&&o.pause(),n},setVolume(c){i=Math.max(0,Math.min(1,c)),localStorage.setItem("soundVolume",i.toString())},setMusicVolume(c){l=Math.max(0,Math.min(1,c)),localStorage.setItem("musicVolume",l.toString()),o&&(o.volume=l)},loadAll(){console.log("Cargando todos los sonidos del juego...")}}}const se=Yo(),qe=Zt("boardUtils"),Wo=Xt.getInstance(),lt={icons:["üçé","üçá","üçä","üçì"],minCellSize:30,maxCellSize:80,cellMargin:8};function Jo(t){const o=Math.max(Eo,Math.min(Mo,t));return qe.info(`Cambiando tama√±o del tablero a ${o}x${o}`),U.dispatch(dt(o)),o}function Zo(t){return(!t||t.length===0)&&(qe.warn("Intento de establecer un array vac√≠o de iconos, usando iconos por defecto"),t=lt.icons||[]),qe.info(`Estableciendo ${t.length} iconos disponibles`),U.dispatch(Ze(t)),t}function Ko(t){const{currentDifficulty:o,currentPlayMode:s,level:n}=U.getState().game,l=Wo.getIconsForLevel(n,o,s,t).map(d=>d.display);return qe.debug(`Seleccionados ${l.length} iconos aleatorios`),l}function St(t){const{spawnRate:o,currentDifficulty:s,currentPlayMode:n}=U.getState().game,i=Kt(),l=jo(t),d=Ko(l);return Jo(i),Zo(d),qe.info(`Tablero configurado para nivel ${t}`,{tama√±o:i,velocidad:`mantenida (${o}ms)`,iconos:d.length,dificultad:s,modo:n}),{size:i,spawnRate:o,icons:d}}function so(t,o,s){if(!t||!o){qe.warn("No se pueden ajustar los visuales del tablero: elementos no encontrados");return}const{boardSize:n}=U.getState().game,{minCellSize:i=lt.minCellSize,maxCellSize:l=lt.maxCellSize,cellMargin:d=lt.cellMargin}={},r=t.clientWidth,c=t.clientHeight,v=Math.min(r,c)-20,u=v-n*d*2,b=Math.floor(u/n),S=Math.max(i||30,Math.min(l||80,b)),E=S*n+d*2*n;o.style.width=`${E}px`,o.style.height=`${E}px`,document.documentElement.style.setProperty("--cell-size",`${S}px`),document.documentElement.style.setProperty("--board-size",`${n}`),document.documentElement.style.setProperty("--cell-gap",`${d}px`),o.style.position="relative",o.style.margin="auto",qe.debug("Tablero ajustado visualmente",{containerSize:{width:r,height:c},boardSize:E,cellSize:S,cellMargin:d,availableSize:v})}const $t={easy:{spawnRate:1.3,scoreRequirement:.7,timeRequirement:.8},normal:{spawnRate:1,scoreRequirement:1,timeRequirement:1},hard:{spawnRate:.7,scoreRequirement:1.3,timeRequirement:1.2},tutorial:{spawnRate:2,scoreRequirement:.5,timeRequirement:.5}},ot=[{id:1,boardSize:5,icons:["üå∂Ô∏è","üçå","üçä","ü•ë"],spawnRate:2e3,speedMultiplier:1,penaltyIcons:1,requirements:{classic:[{type:"score",value:1500,description:"Alcanza 1500 puntos"},{type:"occupation",value:5,description:"Mant√©n ocupaci√≥n menor al 5%"}],timed:[{type:"time",value:30,description:"Sobrevive 30 segundos"}],survival:[{type:"time",value:120,description:"Sobrevive 2 minutos"}],zen:[{type:"time",value:0,description:"Juega sin presi√≥n"}]},rewards:{classic:[{type:"points",value:500,description:"Bonus de nivel"}],zen:[{type:"points",value:100,description:"Bonus de zen"}]}},{id:2,boardSize:6,icons:["üçé","üçá","üçä","üçì","üçâ"],spawnRate:1800,speedMultiplier:1.1,penaltyIcons:2,requirements:{classic:[{type:"score",value:2e3,description:"Alcanza 2000 puntos"},{type:"occupation",value:15,description:"Mant√©n ocupaci√≥n menor al 15%"}],timed:[{type:"time",value:45,description:"Sobrevive 45 segundos"}],survival:[{type:"time",value:180,description:"Sobrevive 3 minutos"}],zen:[{type:"time",value:0,description:"Juega sin presi√≥n"}]},rewards:{classic:[{type:"points",value:750,description:"Bonus de nivel"}],zen:[{type:"points",value:150,description:"Bonus de zen"}]}},{id:3,boardSize:7,icons:["üçé","üçá","üçä","üçì","üçâ","üçå"],spawnRate:1600,speedMultiplier:1.2,penaltyIcons:3,requirements:{classic:[{type:"score",value:3e3,description:"Alcanza 3000 puntos"},{type:"occupation",value:15,description:"Mant√©n ocupaci√≥n menor al 15%"}],timed:[{type:"time",value:60,description:"Sobrevive 1 minuto"}],survival:[{type:"time",value:240,description:"Sobrevive 4 minutos"}],zen:[{type:"time",value:0,description:"Juega sin presi√≥n"}]},rewards:{classic:[{type:"points",value:1e3,description:"Bonus de nivel"}],zen:[{type:"points",value:200,description:"Bonus de zen"}]},specialFeatures:{specialIcons:{type:"specialIcon",enabled:!0,config:{probability:.05,types:["bomb","star"]}}}},{id:4,boardSize:8,icons:["üçé","üçá","üçä","üçì","üçâ","üçå","üçã"],spawnRate:1400,speedMultiplier:1.3,penaltyIcons:3,requirements:{classic:[{type:"score",value:4e3,description:"Alcanza 4000 puntos"},{type:"occupation",value:15,description:"Mant√©n ocupaci√≥n menor al 15%"}],timed:[{type:"time",value:75,description:"Sobrevive 1 minuto y 15 segundos"}],survival:[{type:"time",value:300,description:"Sobrevive 5 minutos"}],zen:[{type:"time",value:0,description:"Juega sin presi√≥n"}]},rewards:{classic:[{type:"points",value:1500,description:"Bonus de nivel"},{type:"hint",value:1,description:"Pista adicional"}],zen:[{type:"points",value:300,description:"Bonus de zen"},{type:"hint",value:1,description:"Pista adicional"}]},specialFeatures:{specialIcons:{type:"specialIcon",enabled:!0,config:{probability:.07,types:["bomb","star","rainbow"]}},bonusItems:{type:"bonus",enabled:!0,config:{probability:.03,types:["points","time"]}}}},{id:5,boardSize:9,icons:["üçé","üçá","üçä","üçì","üçâ","üçå","üçã","üçç"],spawnRate:1200,speedMultiplier:1.4,penaltyIcons:4,requirements:{classic:[{type:"score",value:5e3,description:"Alcanza 5000 puntos"},{type:"occupation",value:15,description:"Mant√©n ocupaci√≥n menor al 15%"}],timed:[{type:"time",value:90,description:"Sobrevive 1 minuto y 30 segundos"}],survival:[{type:"time",value:360,description:"Sobrevive 6 minutos"}],zen:[{type:"time",value:0,description:"Juega sin presi√≥n"}]},rewards:{classic:[{type:"points",value:2e3,description:"Bonus de nivel"},{type:"hint",value:2,description:"Pistas adicionales"}],zen:[{type:"points",value:400,description:"Bonus de zen"},{type:"hint",value:1,description:"Pista adicional"}]},specialFeatures:{specialIcons:{type:"specialIcon",enabled:!0,config:{probability:.08,types:["bomb","star","rainbow","clock"]}},bonusItems:{type:"bonus",enabled:!0,config:{probability:.05,types:["points","time","hint"]}},powerUps:{type:"powerup",enabled:!0,config:{probability:.03,types:["slowdown","clear"]}}}}];function Xo(t){const n=4+Math.min(6,Math.floor((t-1)/2)),i={id:t,boardSize:Math.min(12,5+Math.floor(t/2)),icons:Array.from({length:n},(d,r)=>{const c=["üçé","üçá","üçä","üçì","üçâ","üçå","üçã","üçç","üçë","üçí"];return c[r%c.length]}),spawnRate:Math.max(500,2e3-t*100),speedMultiplier:1+t*.1,penaltyIcons:Math.min(5,1+Math.floor(t/2)),requirements:{classic:[{type:"score",value:1500*t,description:`Alcanza ${1500*t} puntos`},{type:"occupation",value:5,description:"Mant√©n ocupaci√≥n menor al 5%"}],timed:[{type:"time",value:30+t*15,description:`Sobrevive ${30+t*15} segundos`}],survival:[{type:"time",value:120+t*60,description:`Sobrevive ${(120+t*60)/60} minutos`}],zen:[{type:"time",value:0,description:"Juega sin presi√≥n"}]},rewards:{classic:[{type:"points",value:500*t,description:"Bonus de nivel"}],zen:[{type:"points",value:100*t,description:"Bonus de zen"}]}},l={};return t>=3&&(l.specialIcons={type:"specialIcon",enabled:!0,config:{probability:.7+t*.01,types:["bomb","star"]}},t>=4&&l.specialIcons.config.types.push("rainbow"),t>=5&&l.specialIcons.config.types.push("clock")),t>=4&&(l.bonusItems={type:"bonus",enabled:!0,config:{probability:.03+t*.005,types:["points","time"]}},t>=5&&l.bonusItems.config.types.push("hint")),t>=5&&(l.powerUps={type:"powerup",enabled:!0,config:{probability:.03+(t-5)*.005,types:["slowdown","clear"]}},t>=7&&l.powerUps.config.types.push("freeze"),t>=9&&l.powerUps.config.types.push("double")),t>=6&&(l.obstacles={type:"obstacle",enabled:!0,config:{probability:.02+(t-6)*.003,types:["stone"]}},t>=8&&l.obstacles.config.types.push("ice"),t>=10&&l.obstacles.config.types.push("lock")),Object.keys(l).length>0&&(i.specialFeatures=l),i}function Qo(t,o,s){const i=ot.find(c=>c.id===t)||Xo(t),l=$t[s],d=JSON.parse(JSON.stringify(i));d.spawnRate=Math.round(d.spawnRate*l.spawnRate),(!d.requirements[o]||d.requirements[o].length===0)&&(o==="zen"?d.requirements.zen=[{type:"time",value:0,description:"Juega sin presi√≥n"}]:o==="tutorial"?d.requirements.tutorial=[{type:"score",value:100,description:"Completa el tutorial"}]:d.requirements.classic?d.requirements[o]=[...d.requirements.classic]:d.requirements[o]=[{type:"score",value:1e3*t,description:`Alcanza ${1e3*t} puntos`}]);const r=d.requirements[o];return r&&r.forEach(c=>{c.type==="score"?(c.value=Math.round(c.value*l.scoreRequirement),c.description=`Alcanza ${c.value} puntos`):c.type==="time"&&o!=="zen"&&o!=="tutorial"&&(c.value=Math.round(c.value*l.timeRequirement),c.description=`Sobrevive ${c.value>=60?`${Math.floor(c.value/60)} minuto${c.value>=120?"s":""}`:""}${c.value%60>0?(c.value>=60?" y ":"")+`${c.value%60} segundo${c.value%60!==1?"s":""}`:""}`)}),d}Xt.getInstance();function en(t,o,s,n,i,l,d,r,c){if(o==="zen"||!i||i<=0)return!1;try{const v=Qo(t,o,"normal");if(!v||!v.requirements)return!1;const b=r!==void 0&&r>=wo,S=i*i,E=n/S*100;if(c===!1){if(j.info("LevelAdapter",`No hay movimientos v√°lidos. Ocupaci√≥n: ${E.toFixed(1)}%, Iconos: ${n}`),n<=2)return j.info("LevelAdapter",`Solo quedan ${n} iconos sin movimientos v√°lidos. Nivel completado.`),U.dispatch(je(`¬°Casi has limpiado el tablero! Solo quedan ${n} iconos sin posibilidad de movimientos.`)),!0;if(E<=30)return j.info("LevelAdapter",`Pocos iconos sin movimientos (${E.toFixed(1)}%). Nivel completado.`),U.dispatch(je(`¬°Has despejado gran parte del tablero! Solo queda un ${E.toFixed(1)}% de ocupaci√≥n sin movimientos disponibles.`)),!0;j.info("LevelAdapter",`No hay movimientos pero los iconos son muchos (${E.toFixed(1)}%). Continuando juego.`)}if(o==="classic"){const O=v.requirements.classic;if(!O||!Array.isArray(O))return!1;const $=O.find(k=>k.type==="score");if($&&s>=$.value){j.info("LevelAdapter",`Nivel completado por puntuaci√≥n: ${s}/${$.value}`);const k=(U.getState().game.spawnRate/1e3).toFixed(1);return U.dispatch(je(`¬°Has alcanzado la puntuaci√≥n objetivo de ${$.value} puntos! Velocidad de aparici√≥n: ${k}s por icono.`)),!0}if(b){const k=O.find(I=>I.type==="occupation");if(k&&E<=k.value){j.info("LevelAdapter",`Nivel completado por ocupaci√≥n: ${E.toFixed(1)}%/${k.value}%`);const I=(U.getState().game.spawnRate/1e3).toFixed(1);return U.dispatch(je(`¬°Has despejado el tablero por debajo del ${k.value}% de ocupaci√≥n requerido! Ocupaci√≥n actual: ${E.toFixed(1)}%. Velocidad de aparici√≥n: ${I}s por icono.`)),!0}}return c===!1&&n===0?(j.info("LevelAdapter","Tablero completamente vac√≠o. Nivel completado."),U.dispatch(je("¬°Has limpiado completamente el tablero! Impresionante.")),!0):!1}else if(o==="timed"){if(l!==void 0&&l<=0)return U.dispatch(je(`¬°Se ha agotado el tiempo! Has conseguido ${s} puntos en el tiempo l√≠mite.`)),!0}else if(o==="survival"){if(j.info("LevelAdapter",`Verificaci√≥n de nivel en modo supervivencia. Nivel: ${t}, Iconos: ${n}, ¬øSin movimientos?: ${!c}`),n<=0){j.info("LevelAdapter","Tablero completamente vac√≠o en modo supervivencia. Nivel completado.");const O=(U.getState().game.spawnRate/1e3).toFixed(1);return U.dispatch(je(`¬°Incre√≠ble! Has limpiado completamente el tablero eliminando todos los iconos. Velocidad de aparici√≥n: ${O}s por icono.`)),!0}if(!c&&n<=2){j.info("LevelAdapter",`No hay movimientos y quedan muy pocos iconos (${n}). Nivel supervivencia completado.`);const O=(U.getState().game.spawnRate/1e3).toFixed(1);return U.dispatch(je(`¬°Excelente estrategia! Quedan solo ${n} iconos sin posibilidad de movimientos. Velocidad de aparici√≥n: ${O}s por icono.`)),!0}return!1}return!1}catch(v){return j.error("LevelAdapter","Error verificando completado de nivel:",v),!1}}const Pt=5e3,tn=2,ao=(t,o,s)=>{const n=ct(t,o,s),{iconCount:i,occupationPercentage:l}=on(t,o),d=U.getState().game,{currentPlayMode:r,currentDifficulty:c,spawnRate:v}=d;return j.info("Game",`Evaluaci√≥n de fin de nivel: Modo ${r}, ${i} iconos (${l.toFixed(1)}%)`),i===0?(nn(),!1):n?!0:i<=tn?(sn(i),!1):l>=100?(an(r,c,v),!1):(j.info("Game",`No hay movimientos v√°lidos pero quedan ${i} iconos. El juego contin√∫a.`),!0)},on=(t,o)=>{let s=0;for(let l=0;l<o;l++)for(let d=0;d<o;d++)t[l][d]!==null&&s++;const n=o*o,i=s/n*100;return{iconCount:s,occupationPercentage:i}},nn=()=>{j.info("Game","¬°VICTORIA PERFECTA! Tablero completamente vac√≠o"),He(Io(Pt)),He(je(`¬°VICTORIA PERFECTA! Has limpiado completamente el tablero. ¬°Bonus de ${Pt} puntos!`)),He(me("levelCompleted")),se.play("perfectClear")},sn=t=>{j.info("Game",`Victoria normal: ${t} iconos restantes sin movimientos posibles`),He(je(`¬°Nivel completado! Solo quedan ${t} iconos sin posibilidad de convergencia.`)),He(me("levelCompleted")),se.play("levelComplete")},an=(t,o,s)=>{j.info("Game","Game Over: Tablero completamente lleno sin movimientos posibles");const n=(s/1e3).toFixed(1),i=`El tablero est√° completamente lleno sin movimientos posibles. Modo: ${t}, Dificultad: ${o}, Velocidad: ${n}s/icono.`;He(je(i)),He(me("gameOver")),se.play("gameOver")},He=U.dispatch,cn=()=>performance.now(),ln=t=>{const o=new Date,s=o.getHours().toString().padStart(2,"0"),n=o.getMinutes().toString().padStart(2,"0"),i=o.getSeconds().toString().padStart(2,"0"),l=o.getMilliseconds().toString().padStart(3,"0");return`${s}:${n}:${i}.${l}`},Ut=()=>ln(cn()),rn={minIntervalPercentage:.25,minAbsoluteInterval:25,maxSpawningTimeout:250,maxIcons:100,maxAttempts:10,maxIconsPerRow:3,maxIconsPerColumn:3,maxConsecutiveIcons:2},dn=(t,o,s=rn)=>{const n=a.useRef(!1),i=a.useRef(0),l=a.useRef(null),d=a.useCallback(()=>{n.current=!1,i.current=0,l.current&&(clearTimeout(l.current),l.current=null),j.debug("IconSpawner","Estado de spawning reiniciado")},[]),r=a.useCallback(()=>{l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{n.current&&(j.warn("IconSpawner",`Forzando reinicio de isSpawning despu√©s de ${s.maxSpawningTimeout}ms para prevenir bloqueo`),n.current=!1,l.current=null)},s.maxSpawningTimeout)},[s.maxSpawningTimeout]),c=a.useCallback(()=>{const v=Date.now(),u=new Date(v).toLocaleTimeString("es-ES",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3});console.log(`
**********************************************************`),console.log(`[${u}] INICIO DEL FLUJO: A√ëADIR ICONO ALEATORIO`);const b=U.getState().game,{board:S,boardSize:E,availableIcons:O,level:$,currentPlayMode:k}=b;if(console.log(`[${u}] Nivel: ${$}, Modo: ${k}`),console.log(`[${u}] Contador de iconos actual: ${Gt(S)}`),console.log(`[${u}] Iconos disponibles: ${O.join(", ")}`),console.log(`[${u}] Velocidad configurada: ${b.spawnRate}ms`),console.log("**********************************************************"),console.log(`[${u}] Fase 1: Marcando estado de spawning como activo`),n.current=!0,r(),b.status!=="playing"||!S||!O.length){console.log("Fase 2: Estado o tablero inv√°lidos - Cancelando spawn"),n.current=!1;return}console.log("Fase 2: Estado y tablero verificados (v√°lidos)");const I=t();if(console.log(`[${u}] Verificaci√≥n de movimientos v√°lidos: ${I?"S√ç":"NO"}`),!I&&(console.log(`[${u}] No hay movimientos v√°lidos disponibles`),!ao(S,E,O))){console.log(`[${u}] El juego ha terminado seg√∫n checkGameEndCondition`),n.current=!1;return}console.log(`[${u}] Fase 4: Buscando celdas vac√≠as para colocar nuevo icono`);const z=un(S);if(console.log(`Celdas vac√≠as encontradas: ${z.length}`),z.length===0){console.log("Fase 5: No hay celdas vac√≠as disponibles - Tablero lleno"),console.log("Fase 6: Tablero completamente lleno - Game Over");const P=(U.getState().game.spawnRate/1e3).toFixed(1),le=U.getState().game.currentDifficulty;U.dispatch(je(`El tablero est√° completamente lleno. No hay espacio para m√°s iconos. Dificultad: ${le}, Velocidad: ${P}s/icono.`)),U.dispatch(me("gameOver")),console.log(`**********************************************************
`),n.current=!1;return}console.log("Fase 5: Seleccionando celda aleatoria y colocando icono");const Q=Math.floor(Math.random()*z.length),{row:H,col:K}=z[Q],y=O[Math.floor(Math.random()*O.length)],F=S.map(P=>[...P]);F[H][K]=y,U.dispatch(Ke(F));const B=Gt(F);console.log(`Icono ${y} colocado en [${H},${K}]. Total de iconos: ${B}`),console.log(`**********************************************************
`),n.current=!1,i.current=v},[t,r,o,s.maxSpawningTimeout]);return a.useEffect(()=>()=>{l.current&&clearTimeout(l.current)},[]),{addRandomIcon:c,isSpawningRef:n,lastIconAddedTimeRef:i,resetSpawningState:d}},Gt=t=>{let o=0;for(let s=0;s<t.length;s++)for(let n=0;n<t[s].length;n++)t[s][n]!==null&&o++;return o},un=t=>{const o=[];for(let s=0;s<t.length;s++)for(let n=0;n<t[s].length;n++)t[s][n]===null&&o.push({row:s,col:n});return o},mn=Lo,io=()=>{const t=ke(),{board:o,iconCount:s,status:n,spawnRate:i,boardSize:l,availableIcons:d,currentPlayMode:r,currentDifficulty:c,score:v,level:u,highlightedCells:b,hintsRemaining:S,hintCooldown:E,timeRemaining:O,survivalTime:$}=De(m=>m.game),{addNotification:k}=Qt(),I=a.useRef(null),z=a.useRef(null),Q=a.useRef(!1),H=a.useRef(!1),K=a.useRef(null),y=a.useRef({}),F=a.useRef(!1),B=a.useRef(!1),P=a.useRef(null),le=a.useRef(0),pe=a.useRef(0),q=a.useCallback((m,h,A)=>{const w=`${m}-${h}`;A?y.current[w]=A:delete y.current[w]},[]),ae=a.useCallback(()=>{const m=U.getState().game,{board:h,boardSize:A,availableIcons:w}=m;return ct(h,A,w)},[]),re=(m,h,A)=>{if(m[h][A]!==null)return console.log(`[CONVERGENCE] La celda [${h},${A}] no est√° vac√≠a, saltando verificaci√≥n`),!1;const w={};[{dr:-1,dc:0,name:"arriba"},{dr:1,dc:0,name:"abajo"},{dr:0,dc:-1,name:"izquierda"},{dr:0,dc:1,name:"derecha"}].forEach(({dr:f,dc:Z,name:D})=>{let J=h+f,oe=A+Z;for(;J>=0&&J<l&&oe>=0&&oe<l;){const V=m[J][oe];if(V!==null&&!V.includes("_removing")){w[V]||(w[V]={count:0,positions:[]}),w[V].count++,w[V].positions.push({row:J,col:oe});break}J+=f,oe+=Z}});let C=!1,x=[];for(const f in w)w[f].count>=2&&(C=!0,x.push({icon:f,count:w[f].count,positions:w[f].positions}));return C&&(console.log(`[CONVERGENCE] Convergencia posible en celda [${h},${A}]:`),x.forEach(f=>{console.log(`[CONVERGENCE] - Icono ${f.icon}: ${f.count} ocurrencias en posiciones: ${JSON.stringify(f.positions)}`)})),C},M=a.useCallback((m=l,h=!1,A)=>{const{currentDifficulty:w,currentPlayMode:G,level:C,boardSize:x}=U.getState().game,f=A!==void 0?A:C;console.log(`
**********************************************************`),console.log("INICIO DEL FLUJO: INICIALIZAR TABLERO"),console.log(`Tama√±o: ${m}, Nivel: ${f}, Modo: ${G}`),console.log(`Estado: ${n}, Dificultad: ${w}`);const Z=U.getState().game.availableIcons;if(console.log(`Iconos para nivel ${f}: ${Z.join(", ").substring(0,100)}${Z.length>10?"...":""}`),console.log("**********************************************************"),f<=0||!h&&B.current&&x===m)return console.log("ADVERTENCIA: Tablero ya inicializado o condiciones no v√°lidas para inicializaci√≥n"),o;B.current=!1;const D=m||Kt(),J=Array(D).fill(null).map(()=>Array(D).fill(null)),oe=zt(w);let V;if(oe&&oe.initialIconCount!==void 0)V=oe.initialIconCount,console.log(`Usando initialIconCount de dificultad ${w}: ${V} iconos`);else{const de=Math.floor(D*D*.33);V=Math.max(12,de),console.log(`Calculando iconos iniciales: ${V} (33% del tablero)`)}if(f>=2){const de=1+(f-1)*.1;V=Math.min(Math.floor(V*de),Math.floor(D*D*.5)),console.log(`Nivel ${f}: Ajustando iconos iniciales a ${V} (incremento nivel ${de.toFixed(1)}x)`)}console.log(`Fase 1: Calculados ${V} iconos iniciales para nivel ${f}`);const Se=Math.floor(D*D*.5);V>Se&&(console.log(`Limitando iconos: ${V} > ${Se} (50% del tablero)`),V=Se),j.info(`Inicializando tablero con ${V} iconos iniciales`,`Modo: ${G}, Dificultad: ${w}, Nivel: ${f}`);const ve=Go([...Z]),he=ve[0];console.log("Fase 2: Colocando iconos iniciales garantizados");const ge=Ie(2,D-3),$e=Ie(2,D-3);J[ge][$e]=he;const be=[{dr:-1,dc:0},{dr:0,dc:1},{dr:1,dc:0},{dr:0,dc:-1}],Ye=Ie(0,4);let ht=Ie(0,4);for(;Math.abs(Ye-ht)===2;)ht=Ie(0,4);const Ot=be[Ye];J[ge+Ot.dr][$e+Ot.dc]=he;const Lt=be[ht];J[ge+Lt.dr][$e+Lt.dc]=he;let Xe=3;if(console.log(`Fase 3: Grupo inicial garantizado colocado (${Xe} iconos)`),ve.length>1&&V>=6){const de=ve[1];let fe=!1;for(let xe=0;xe<10&&!fe;xe++){const Ne=Ie(2,D-3),Le=Ie(2,D-3);if(Math.abs(Ne-ge)+Math.abs(Le-$e)>=4){J[Ne][Le]=de;const Fe=Ie(0,4);let We=Ie(0,4);for(;Math.abs(Fe-We)===2;)We=Ie(0,4);const Pe=be[Fe];J[Ne+Pe.dr][Le+Pe.dc]=de;const Ue=be[We];J[Ne+Ue.dr][Le+Ue.dc]=de,Xe+=3,fe=!0}}fe&&console.log(`Fase 4: Segundo grupo garantizado colocado (total: ${Xe} iconos)`)}console.log(`Fase 5: Colocando iconos aleatorios adicionales hasta ${V}`);let At=V*5;for(;Xe<V&&At>0;){At--;const de=Ie(0,D),fe=Ie(0,D);if(J[de][fe]===null){let xe=!1,Ne=0;for(;!xe&&Ne<10;){const Le=Ie(0,Z.length),Fe=Z[Le];J[de][fe]=Fe,re(J,de,fe)?J[de][fe]=null:(xe=!0,Xe++),Ne++}xe||(J[de][fe]=null)}}const Dt=ct(J,D,Z);if(console.log(`Fase 6: Verificaci√≥n de movimientos v√°lidos: ${Dt?"OK":"Sin movimientos"}`),!Dt){console.log("ADVERTENCIA: Tablero inicializado sin movimientos v√°lidos. Corrigiendo...");let de=!1;for(let fe=0;fe<D&&!de;fe++)for(let xe=0;xe<D&&!de;xe++)if(J[fe][xe]===null)for(const Ne of be){const Le=fe+Ne.dr,Fe=xe+Ne.dc;if(Le>=0&&Le<D&&Fe>=0&&Fe<D&&J[Le][Fe]!==null){const We=J[Le][Fe];for(const Pe of be)if(Ne.dr!==Pe.dr||Ne.dc!==Pe.dc){const Ue=fe+Pe.dr,at=xe+Pe.dc;if(Ue>=0&&Ue<D&&at>=0&&at<D&&J[Ue][at]===null){J[Ue][at]=We,de=!0,console.log(`Fase 7: Correcci√≥n aplicada, movimiento v√°lido creado en [${fe},${xe}]`);break}}if(de)break}}}let Qe=0;for(let de=0;de<D;de++)for(let fe=0;fe<D;fe++)J[de][fe]!==null&&Qe++;if(j.info(`Tablero inicializado con ${Qe} iconos`,`Objetivo: ${V}, Tama√±o tablero: ${D}x${D}, Nivel: ${f}`),console.log(`Fase 8: Tablero final con ${Qe}/${V} iconos (${(Qe/(D*D)*100).toFixed(1)}% ocupaci√≥n)`),t(Ke(J)),console.log("Fase 9: Tablero actualizado en el estado global"),t(It(Qe)),G==="classic"){const de=Je.CLASSIC.initialScoreTarget*Math.pow(Je.CLASSIC.scoreTargetMultiplier,f-1),fe=Math.max(30,Je.CLASSIC.initialOccupationTarget-f*Je.CLASSIC.occupationDecreasePerLevel);t(vt({score:Math.round(de),occupation:Math.round(fe)}))}else if(G==="timed"){const de=Je.TIMED.initialTimeLimit-(f-1)*Je.TIMED.timeDecreasePerLevel;t(bt(Math.max(30,de)))}const Ft=Vo(f,G,Ao,mn);return t(Ae(Ft)),console.log(`Fase 10: SpawnRate configurado a ${Ft}ms para nivel ${f}`),B.current=!0,console.log("Fase 11: Tablero marcado como inicializado"),(()=>{const{currentDifficulty:de,currentPlayMode:fe}=U.getState().game,xe=U.getState().game.spawnRate;console.log("[VELOCIDAD] Verificando configuraci√≥n de velocidad:"),console.log(`- SpawnRate actual: ${xe}ms`);const Ne=ce.getInitialSpeed(de,fe);console.log(`- Velocidad inicial calculada: ${Ne}ms`),xe!==Ne?(console.log(`[VELOCIDAD] Actualizando velocidad: ${xe}ms ‚Üí ${Ne}ms`),t(Ae(Ne))):console.log(`[VELOCIDAD] Manteniendo velocidad actual: ${xe}ms`)})(),(()=>{const fe=U.getState().game.currentDifficulty,xe=Re.TIME_WINDOWS[fe]||Re.TIME_WINDOWS.normal;console.log(`[COMBO CONFIG] Actualizando ventana de tiempo de combo para dificultad ${fe}: ${xe}ms`),t({type:"game/setComboTimeWindow",payload:xe}),setTimeout(()=>{const Ne=U.getState().game;console.log(`[COMBO CONFIG] Verificaci√≥n: La ventana de tiempo actual es ${Ne.comboTimeWindow}ms`)},0)})(),console.log(`**********************************************************
`),console.log(`FIN DEL FLUJO: TABLERO INICIALIZADO CORRECTAMENTE PARA NIVEL ${f}`),J},[t]),Y={maxSpawningTimeout:0},{addRandomIcon:p,isSpawningRef:N,lastIconAddedTimeRef:T,resetSpawningState:L}=dn(ae,k,Y),ce=To(),ne=a.useCallback(()=>{const m=Date.now(),h=m-pe.current,{spawnRate:A,currentDifficulty:w}=U.getState().game;if(h>=3e4){const G=ce.calculateIncreasedSpeed(A,w);if(Math.abs(A-G)>=50){const C=((A-G)/A*100).toFixed(1),x=(A/1e3).toFixed(1),f=(G/1e3).toFixed(1);t(Ae(G)),pe.current=m,k({message:"¬°Aumento de velocidad!",type:"warning",icon:"‚ö°",duration:3e3,value:`${x}s ‚Üí ${f}s (${C}% m√°s r√°pido)`}),console.log(`[VELOCIDAD] Aumento autom√°tico: ${A}ms ‚Üí ${G}ms (${C}% m√°s r√°pido)`)}}},[t,k,ce]),ie=a.useCallback(()=>{pe.current=Date.now(),console.log(`[VELOCIDAD] Temporizador de aumento reiniciado en: ${new Date(pe.current).toLocaleTimeString()}`)},[]),X=a.useCallback(()=>{const m=Ut();console.log(`
[${m}] **********************************************************`),console.log(`[${m}] INICIO DEL FLUJO: DETENER TEMPORIZADORES`),console.log(`[${m}] Estado: ${n}, Temporizadores activos: ${F.current?"S√≠":"No"}`),console.log(`[${m}] **********************************************************`),F.current||j.debug("GameLogic","Los temporizadores ya estaban detenidos"),F.current=!1,I.current&&(clearInterval(I.current),I.current=null,console.log(`[${m}] Fase 1: Temporizador de tiempo de juego detenido`)),z.current&&(clearInterval(z.current),z.current=null,console.log(`[${m}] Fase 2: Temporizador de spawn de iconos detenido`)),console.log(`[${m}] Fase 3: Referencias de temporizadores reiniciadas`),console.log(`[${m}] **********************************************************`),console.log(`
[${m}] FIN DEL FLUJO: TEMPORIZADORES DETENIDOS CORRECTAMENTE`)},[n]),te=a.useCallback((m=!1)=>{const h=Ut(),A=U.getState().game,{status:w,currentPlayMode:G,level:C,spawnRate:x}=A;if(console.log(`
[${h}] **********************************************************`),console.log(`[${h}] INICIO DEL FLUJO: INICIAR TEMPORIZADORES`),console.log(`[${h}] Nivel: ${C}, SpawnRate: ${x}ms, Modo: ${G}`),console.log(`[${h}] Forzar inicio: ${m?"S√≠":"No"}, Temporizadores activos: ${F.current?"S√≠":"No"}`),console.log(`[${h}] Estado actual del juego: ${w}`),console.log(`[${h}] **********************************************************`),F.current&&!m){console.log(`[${h}] Los temporizadores ya est√°n activos.`);return}if(w!=="playing"&&!m){console.log(`[${h}] Fase 1: No se inician temporizadores porque el estado es ${w}`);return}I.current&&(console.log(`[${h}] Deteniendo temporizador de tiempo existente`),clearInterval(I.current),I.current=null),z.current&&(console.log(`[${h}] Deteniendo temporizador de √≠conos existente`),clearInterval(z.current),z.current=null),ie(),console.log("[VELOCIDAD] Temporizador de velocidad iniciado. Pr√≥ximo aumento en 30 segundos."),console.log(`[${h}] Fase 2: Referencias de temporizadores establecidas`),L(),I.current=setInterval(()=>{if(U.getState().game.status==="playing"){if(le.current++,t($o()),G==="timed"){const J=U.getState().game.timeRemaining;if(J>0&&(t(kt()),J===1)){t(je("¬°Se acab√≥ el tiempo! Modo contrarreloj finalizado.")),t(me("gameOver"));return}}G==="survival"&&t(kt()),ne()}},1e3),console.log(`[${h}] Fase 3: Temporizador de tiempo de juego iniciado`);const f=x;setTimeout(()=>{U.getState().game.status==="playing"&&p()},0);const Z=()=>{z.current&&clearInterval(z.current),z.current=setInterval(()=>{if(U.getState().game.status==="playing"){if(P.current!==x){P.current=x,Z();return}p(),j.debug("GameLogic",`Intervalo de spawn activado (${x}ms)`)}},f)};Z(),console.log(`[${h}] Fase 4: Temporizador de spawn de iconos iniciado (cada ${f}ms)`),T.current=0,P.current=f,F.current=!0,console.log(`[${h}] **********************************************************`),console.log(`[${h}] FIN DEL FLUJO: TEMPORIZADORES INICIADOS CORRECTAMENTE`)},[t,k,n,r,p,ie,L,ne]);a.useEffect(()=>()=>{X(),L()},[X,L]),a.useCallback(m=>{if(m.length===0)return;const h=o.map(w=>[...w]);t(Me(m));const A=h.map(w=>[...w]);for(const w of m){const G=A[w.row][w.col];G!==null&&(A[w.row][w.col]=`${G}_removing`)}t(Ke(A)),requestAnimationFrame(()=>{setTimeout(()=>{const w=A.map(ge=>[...ge]);let G=0;for(const ge of m)w[ge.row][ge.col]=null,G++;t(Ke(w));const{comboTimestamp:C,comboTimeWindow:x,comboMultiplier:f,comboCount:Z}=U.getState().game,D=Date.now();console.log(`
[COMBO DEBUG] ===== Inicio de an√°lisis de combo =====`),console.log(`[COMBO DEBUG] Iconos eliminados: ${G}`),console.log(`[COMBO DEBUG] Estado actual: Combo: ${Z}, Multiplicador: ${f.toFixed(1)}x`),console.log(`[COMBO DEBUG] Timestamp actual: ${D}`),console.log(`[COMBO DEBUG] Timestamp √∫ltima eliminaci√≥n: ${C}`),console.log(`[COMBO DEBUG] Ventana de tiempo: ${x}ms`);const J=C===0?0:D-C;console.log(`[COMBO DEBUG] Tiempo transcurrido: ${J}ms`),console.log(`[COMBO DEBUG] ¬øDentro de ventana de tiempo?: ${J<=x?"S√ç":"NO"}`),C===0||Z===0?(console.log("[COMBO DEBUG] Primer combo detectado, iniciando secuencia"),t(Ve())):J<=x?(console.log("[COMBO DEBUG] Tiempo dentro de ventana, incrementando combo"),t(Ve())):(console.log("[COMBO DEBUG] Tiempo fuera de ventana, reiniciando combo"),t(tt()),setTimeout(()=>{console.log("[COMBO DEBUG] Iniciando nuevo combo despu√©s del reset"),t(Ve())},0));const oe=U.getState().game,V=oe.comboMultiplier,Se=G*10*u,ve=Math.floor(Se*V);if(t(Ve(Se)),console.log(`[COMBO DEBUG] Puntos base: ${Se} (${G} iconos √ó 10 √ó nivel ${u})`),console.log(`[COMBO DEBUG] Multiplicador aplicado: ${V.toFixed(1)}x`),console.log(`[COMBO DEBUG] Puntos finales con combo: ${ve}`),t(ze(ve)),g(Se,m[0].row,m[0].col),console.log(`[COMBO DEBUG] Combo actual: ${oe.comboCount}, verificando hitos`),oe.comboCount===10){const ge=Re.MILESTONE_BONUSES[10];t(ze(ge)),console.log(`[COMBO DEBUG] ¬°HITO! Combo x10 alcanzado. +${ge} puntos extra`)}else if(oe.comboCount===20){const ge=Re.MILESTONE_BONUSES[20];t(ze(ge)),console.log(`[COMBO DEBUG] ¬°HITO! Combo x20 alcanzado. +${ge} puntos extra`)}else if(oe.comboCount===30){const ge=Re.MILESTONE_BONUSES[30];t(ze(ge)),console.log(`[COMBO DEBUG] ¬°HITO! Combo x30 alcanzado. +${ge} puntos extra`)}V>1&&(console.log(`[COMBO DEBUG] Mostrar notificaci√≥n de combo: x${oe.comboCount} (${V.toFixed(1)}x)`),V>=5?(se.play("comboLarge"),console.log("[COMBO DEBUG] Reproduciendo sonido: comboLarge")):V>=3?(se.play("comboMedium"),console.log("[COMBO DEBUG] Reproduciendo sonido: comboMedium")):V>=1.5&&(se.play("comboSmall"),console.log("[COMBO DEBUG] Reproduciendo sonido: comboSmall"))),console.log(`[COMBO DEBUG] ===== Fin de an√°lisis de combo =====
`);const he=s-G;if(t(It(he)),r==="timed"){const ge=Math.max(5,G*3);t({type:"game/addTimeBonus",payload:ge}),se.play("timeBonus"),console.log(`Bonus de tiempo a√±adido: +${ge} segundos`)}se.play("removeIcon"),g(Se,m[0].row,m[0].col)},50)})},[o,t,s,r,u]);const ue=a.useCallback((m,h)=>{so(m,h)},[]),Ce=a.useCallback(()=>{if(S<=0||E===!0)return!1;let m=!1,h=[];for(let A=0;A<l&&!m;A++)for(let w=0;w<l&&!m;w++)if(o[A][w]!==null){const G=Ho(o,A,w,l);if(G.hasConvergence){m=!0,h=G.convergingCells;break}}return m&&h.length>0?(t(eo()),t(Me(h)),se.play("hint"),K.current&&clearTimeout(K.current),K.current=setTimeout(()=>{t(Me([])),K.current=null},2e3),t(to()),!0):!1},[o,l,S,E,t]),Te=a.useCallback(()=>(X(),setTimeout(()=>{M(),t(xt()),te()},100),!0),[t,X,M,te,u]),ye=a.useCallback(()=>{t(ut(u+1)),X(),M(),t(xt()),t(me("playing"))},[t,u,M,X]);a.useEffect(()=>{if(n!=="playing"||!o||o.length===0||s===0)return;const m=setTimeout(()=>{U.getState().game.status==="playing"&&ao(o,l,d)},100);return()=>clearTimeout(m)},[o,n,l,ae,t,s]);const Ee=a.useCallback(m=>{console.log(`
**********************************************************`),console.log("INICIO DEL FLUJO: CAMBIO DE CONFIGURACI√ìN DEL JUEGO"),console.log(`Cambiando a dificultad: ${m.difficulty}, modo: ${m.mode}`),console.log("**********************************************************"),X(),B.current=!1,t(Ro(m.difficulty)),t(Oo(m.mode)),setTimeout(()=>{const{level:A,status:w}=U.getState().game,G=Tt(A);t(Ze(G));const C=Bt();t(dt(C));const x=zt(m.difficulty);if(x){const D=ce.getInitialSpeed(m.difficulty,r);console.log(`Aplicando configuraci√≥n de dificultad ${m.difficulty}:`),console.log(`- SpawnRate inicial: ${D}ms`),console.log(`- √çconos iniciales: ${x.initialIconCount}`),console.log(`- Penalizaci√≥n: ${x.penaltyIcons} √≠conos`),console.log(`- Nivel m√°ximo: ${x.maxLevel}`),t(Ae(D))}const f=Do(m.difficulty,m.mode);if(m.mode==="classic"){const D=Math.round(f.initialScoreTarget*Math.pow(f.scoreTargetMultiplier||1.5,A-1)),J=it[m.difficulty]||it.normal,oe=Math.round(D*J.scoreRequirement),V=Math.max(30,f.initialOccupationTarget-A*(f.occupationDecreasePerLevel||0));console.log(`Configurando objetivos para nivel ${A}:`),console.log(`- Puntuaci√≥n objetivo: ${oe} puntos`),console.log(`- Ocupaci√≥n objetivo: ${Math.round(V)}%`),t(vt({score:oe,occupation:Math.round(V)}))}else if(m.mode==="timed"){let D=f.initialTimeLimit-(A-1)*(f.timeDecreasePerLevel||10);const J=it[m.difficulty]||it.normal;D=Math.round(D*J.timeRequirement),console.log(`Configurando tiempo l√≠mite para nivel ${A}: ${D} segundos`),t(bt(Math.max(30,D)))}const Z=Re.TIME_WINDOWS[m.difficulty]||Re.TIME_WINDOWS.normal;console.log(`Configurando ventana de tiempo para combos: ${Z}ms`),t({type:"game/setComboTimeWindow",payload:Z}),M(C,!0),setTimeout(()=>{const D=U.getState().game;console.log("Verificaci√≥n de configuraci√≥n aplicada:"),console.log(`- Dificultad: ${D.currentDifficulty}`),console.log(`- Modo: ${D.currentPlayMode}`),console.log(`- SpawnRate: ${D.spawnRate}ms`),console.log(`- Ventana de combo: ${D.comboTimeWindow}ms`)},50),w==="playing"&&te(!0)},50),console.log("**********************************************************"),console.log("FIN DEL FLUJO: CONFIGURACI√ìN DEL JUEGO ACTUALIZADA")},[t,X,M,te,k]);a.useCallback((m,h)=>Ee({difficulty:m,mode:h}),[Ee]);const Be=()=>{if(n!=="playing"||s===0)return!1;const m=ae();return en(u,r,v,s,l,O,$,le.current,m)},we=a.useCallback(()=>{j.info(`Configurando tablero para nivel ${u}`,`Tama√±o: ${l}, Modo: ${r}`);const m=Bt(),h=ce.calculateLevelSpeed(u+1,r,c),A=Tt(u+1);if(t(dt(m)),t(Ae(h)),t(Ze(A)),r==="classic"){const w=Ge.classic.baseScore,G=Ge.classic.scoreMultiplier,C=Math.floor(w*Math.pow(G,u)),x=Ge.classic.baseOccupation,f=Ge.classic.occupationDecrease,Z=Math.max(20,x-u*f);t(vt({score:C,occupation:Z}))}else if(r==="timed"){const w=Ge.timed.baseTime,G=Ge.timed.timeDecreasePerLevel,C=Math.max(30,w-u*G);t(bt(C))}t(xt()),j.debug("Configuraci√≥n de nuevo nivel aplicada",{nivel:u+1,tama√±oTablero:m,velocidad:h,iconos:A.length})},[r,u,t,k,c,ce]),R=a.useCallback(()=>{const{level:m,currentPlayMode:h,spawnRate:A,iconCount:w}=U.getState().game;console.log(`
**********************************************************`),console.log("INICIO DEL FLUJO: REINICIAR SISTEMAS PARA NUEVO NIVEL"),console.log(`Nivel actual: ${m}, Modo: ${h}`),console.log(`SpawnRate: ${A}ms, Iconos en tablero: ${w}`),console.log("**********************************************************"),X(),console.log("Fase 1: Temporizadores detenidos"),Q.current=!1,N.current=!1,H.current=!1,console.log("Fase 2: Referencias de estado reiniciadas"),I.current&&(clearInterval(I.current),I.current=null),z.current&&(clearInterval(z.current),z.current=null),console.log("Fase 3: Intervalos residuales limpiados");const{level:G,spawnRate:C}=U.getState().game;return console.log(`Fase 4: Estado actual obtenido: nivel=${G}, spawnRate=${C}ms`),t(Ae(C)),console.log(`Fase 5: SpawnRate actualizado a ${C}ms`),ie(),console.log("Fase 6: Contador de incremento de velocidad reiniciado"),h==="survival"&&console.log(`Fase 7: Manteniendo tiempo de supervivencia (modo ${h})`),t(Me([])),console.log("Fase 8: Celdas resaltadas limpiadas"),console.log(`**********************************************************
`),console.log("FIN DEL FLUJO: SISTEMAS REINICIADOS CORRECTAMENTE"),!0},[t,X]),g=a.useCallback((m,h,A)=>{const{comboCount:w,comboMultiplier:G,lastComboPoints:C}=U.getState().game;w>=3||k({message:"¬°Puntos!",type:"success",icon:"üí∞",duration:1e3,value:`+${m}`})},[k]),W=a.useCallback((m,h,A)=>{if(!ct(m,h,A)){let G=0;for(let f=0;f<h;f++)for(let Z=0;Z<h;Z++)m[f][Z]!==null&&G++;const C=h*h,x=G/C*100;if(G===0){t(je("¬°VICTORIA PERFECTA! Has limpiado completamente el tablero.")),t(me("levelCompleted")),se.play("perfectClear");return}if(G<=2){t(je(`¬°Nivel completado! Solo quedan ${G} iconos sin posibilidad de convergencia.`)),t(me("levelCompleted")),se.play("levelComplete");const{level:f}=U.getState().game;t(ut(f+1));return}if(x>=100){const{currentPlayMode:f,currentDifficulty:Z,spawnRate:D}=U.getState().game,J=(D/1e3).toFixed(1),oe=`El tablero est√° completamente lleno sin movimientos posibles. Modo: ${f}, Dificultad: ${Z}, Velocidad: ${J}s/icono.`;t(je(oe)),t(me("gameOver")),se.play("gameOver");return}}},[t]);return{board:o,boardSize:l,status:n,iconCount:s,level:u,score:v,highlightedCells:b,initializeBoard:M,adjustBoardSize:ue,stopTimers:X,startTimers:te,registerCellRef:q,showHint:Ce,resetCurrentLevel:Te,advanceToNextLevel:ye,resetSystemsForNewLevel:R,findConvergingIcons:a.useCallback((m,h)=>qo(o,m,h,l),[o,l]),changeGameConfig:Ee,checkLevelCompleted:Be,configureBoardForNewLevel:we,checkGameState:W}},mt=Zt("hintUtils");function pn(t,o){for(let s=0;s<o;s++)for(let n=0;n<o;n++)if(t[s][n]===null){const i=co(t,s,n,o);if(i.length>=2)return mt.debug("Encontrada posici√≥n para pista",{row:s,col:n,iconos:i}),{row:s,col:n,icons:i}}return mt.debug("No se encontr√≥ posici√≥n para pista"),null}function co(t,o,s,n){if(t[o][s]!==null)return mt.debug("findConvergingIcons: la celda no est√° vac√≠a",{row:o,col:s}),[];const i=[{dr:-1,dc:0},{dr:0,dc:1},{dr:1,dc:0},{dr:0,dc:-1}],l={};for(const{dr:r,dc:c}of i){let v=o+r,u=s+c;for(;v>=0&&v<n&&u>=0&&u<n;){if(t[v][u]!==null){const b=t[v][u];l[b]||(l[b]=[]),l[b].push({row:v,col:u,icon:b});break}v+=r,u+=c}}const d=[];for(const r in l)l[r].length>=2&&d.push(...l[r]);return d.length>=2?(mt.debug("Convergencias encontradas",{grupos:Object.keys(l).filter(r=>l[r].length>=2).length,totalIconos:d.length}),d):[]}function fn(t){return t?t.icons.map(({row:o,col:s})=>({row:o,col:s})):[]}function gn(t,o){return t>0&&!o}const Vt=(t,o)=>{if(!t)return;t.classList.add("error"),se.play("invalidMove");const s=setTimeout(()=>{t.classList.remove("error")},500);o(s)},_t=t=>{const o=document.querySelector(".game-board-grid");if(!o)return;o.classList.add("shake");const s=setTimeout(()=>{o.classList.remove("shake")},500);t(s)},hn=(t,o,s)=>{const{currentDifficulty:n}=U.getState().game,i=oo.calculatePenaltyRate(t,n);if(Math.abs(t-i)>=50){const l=((t-i)/t*100).toFixed(1);(t/1e3).toFixed(1),(i/1e3).toFixed(1),o(Ae(i)),j.info("Game",`Penalizaci√≥n de velocidad aplicada: ${t}ms ‚Üí ${i}ms (${l}% m√°s r√°pido)`)}return i},vn=(t,o,s,n,i,l,d)=>{try{se.play("invalidMove");const r=Math.min(4,Math.max(1,Math.floor(t/2)));if(r<=0||!o||!n.length)return 0;j.info("PenaltyManager",`Aplicando penalizaci√≥n: a√±adiendo ${r} iconos`);const c=[];for(let b=0;b<s;b++)for(let S=0;S<s;S++)o[b]&&o[b][S]===null&&c.push({row:b,col:S});if(c.length===0)return 0;for(let b=c.length-1;b>0;b--){const S=Math.floor(Math.random()*(b+1));[c[b],c[S]]=[c[S],c[b]]}const v=Math.min(r,c.length);let u=0;for(let b=0;b<v;b++){const S=c[b],E=n[Math.floor(Math.random()*n.length)];i(Fo({row:S.row,col:S.col,icon:E,isPenalty:!0})),u++,setTimeout(()=>{const O=l(S.row,S.col);if(O){O.classList.add("penalty-icon");const $=setTimeout(()=>{O.classList.remove("penalty-icon"),O.classList.add("penalty-fade-out");const k=setTimeout(()=>{O.classList.remove("penalty-fade-out")},500);d(k),j.info("PenaltyManager",`Animaci√≥n de penalizaci√≥n completada: [${S.row},${S.col}]`)},2e3);d($)}},50*b)}return u}catch(r){const c=r instanceof Error?r.message:String(r);return j.error("PenaltyManager",`Error al aplicar penalizaci√≥n: ${c}`),0}},bn=()=>{const t=ke(),{board:o,status:s,boardSize:n,availableIcons:i,highlightedCells:l,hintsRemaining:d,hintCooldown:r,score:c,spawnRate:v,iconCount:u,comboCount:b,comboMultiplier:S,comboTimestamp:E,comboTimeWindow:O,level:$,lastComboPoints:k}=De(R=>R.game),{addNotification:I}=Qt(),z=a.useRef({}),Q=a.useRef(null),H=a.useRef(null),K=a.useRef([]),[y,F]=a.useState(!1),[B,P]=a.useState(1),[le,pe]=a.useState(!1),q=a.useRef(!1),ae=a.useRef(null),re=a.useCallback(()=>{j.info("Deteniendo todos los temporizadores"," ["+s+"]"),Q.current&&(clearInterval(Q.current),Q.current=null),H.current&&(clearTimeout(H.current),H.current=null),K.current.forEach(R=>clearTimeout(R)),K.current=[],pe(!1),F(!1)},[]),M=a.useCallback(R=>{K.current.push(R)},[]),Y=a.useCallback((R,g)=>z.current[`${R}-${g}`]||null,[]),p=a.useCallback((R,g,W)=>{const{comboCount:m,comboMultiplier:h,lastComboPoints:A}=U.getState().game,w=m>=3,G=h.toFixed(1);if(g===void 0||W===void 0){I({message:"¬°Puntos conseguidos!",type:"success",icon:"üèÜ",duration:1500,value:`+${R}`});return}const C=Y(g,W);if(!C)return;const x=document.createElement("div");x.className="points-popup clean-style";let f="#FFFFFF",Z="";w&&(h>=5?(f="#FFD700",Z="combo-legendary-text"):h>=3?(f="#FF00FF",Z="combo-epic-text"):h>=2?(f="#9932CC",Z="combo-rare-text"):h>=1.5?(f="#1E90FF",Z="combo-uncommon-text"):(f="#FFFFFF",Z="combo-basic-text"));const D=document.documentElement.classList.contains("performance-mode");if(w){const oe=document.createElement("div");oe.className=`combo-display ${Z}`;const V=document.createElement("div");V.className="base-points-display";const Se=document.createElement("span");Se.className="base-points-text",Se.textContent=`+${R}`,Se.style.color=f;const ve=document.createElement("span");ve.className="multiplier-text",ve.textContent=` x${G}`,ve.style.color=f,D?(Se.style.animation="fadeInScaleLite 0.15s ease-out forwards",ve.style.animation="fadeInSlideRightLite 0.15s ease-out forwards",ve.style.animationDelay="0.1s"):(Se.style.animation="fadeInScale 0.2s ease-out forwards",ve.style.animation="fadeInSlideRight 0.2s ease-out forwards",ve.style.animationDelay="0.15s"),V.appendChild(Se),V.appendChild(ve),oe.appendChild(V);const he=document.createElement("div");he.className="result-display",he.style.opacity="0";const ge=Math.floor(R*h),$e=document.createElement("span");$e.className="result-text",$e.textContent=`+${ge}`,$e.style.color=f,D?(he.style.animation="resultAppearLite 0.3s ease-out forwards",he.style.animationDelay="0.6s"):(he.style.animation="resultAppear 0.4s ease-out forwards",he.style.animationDelay="0.7s");const be=document.createElement("span");be.className="combo-count",be.textContent=` (${m})`,be.style.color=f,he.appendChild($e),he.appendChild(be),oe.appendChild(he),setTimeout(()=>{V&&(V.style.animation=D?"resultFadeOutLite 0.2s ease-out forwards":"resultFadeOut 0.3s ease-out forwards")},D?550:650),x.appendChild(oe)}else{const oe=document.createElement("span");oe.className="points-value",oe.textContent=`+${R}`,D?oe.style.animation="fadeInScaleLite 0.2s ease-out forwards":oe.style.animation="fadeInScale 0.3s ease-out forwards",x.appendChild(oe)}if(x.style.top="50%",x.style.left="50%",x.style.transform="translate(-50%, -50%)",!D)for(let oe=0;oe<6;oe++){const V=document.createElement("div");V.className="points-particle",V.style.setProperty("--angle",`${oe*60}deg`),x.appendChild(V)}C.appendChild(x),w?h>=5?se.play("comboLarge"):h>=3?se.play("comboMedium"):h>=1.5?se.play("comboSmall"):se.play("points"):se.play("points");const J=setTimeout(()=>{x&&x.parentNode&&x.parentNode.removeChild(x)},1500);M(J),R>100&&I({message:"¬°Puntos conseguidos!",type:"success",icon:"üèÜ",duration:1500,value:`+${R}`})},[Y,M,I]),N=a.useCallback(()=>{I({message:"¬°Tablero limpio!",type:"success",icon:"üéâ",duration:2e3,value:"Bonificaci√≥n"});const R=document.querySelector(".game-board");if(R){const g=document.createElement("div");g.className="points-popup bonus";const W=document.createElement("span");W.className="points-value",W.textContent="100",g.appendChild(W),g.style.top="50%",g.style.left="50%",g.style.transform="translate(-50%, -50%)",R.appendChild(g),se.play("levelComplete");const m=setTimeout(()=>{g&&g.parentNode&&g.parentNode.removeChild(g)},2e3);M(m)}},[I,M]),T=a.useCallback(()=>{if(!o||o.length===0)return!1;for(let R=0;R<n;R++)for(let g=0;g<n;g++)if(o[R][g]===null&&L(R,g,i)>=2)return!0;return!1},[o,n,i]),L=a.useCallback((R,g,W)=>{if(!o)return 0;const m=[{dr:-1,dc:0},{dr:0,dc:1},{dr:1,dc:0},{dr:0,dc:-1}],h={};for(const A of W){let w=0;for(const{dr:G,dc:C}of m){let x=R+G,f=g+C;for(;x>=0&&x<n&&f>=0&&f<n;){if(o[x][f]===A){w++;break}else if(o[x][f]!==null)break;x+=G,f+=C}}w>=2&&(h[A]=w)}return Math.max(0,...Object.values(h))},[o,n]),ce=a.useCallback((R,g)=>o?co(o,R,g,n):[],[o,n]),ne=a.useCallback((R,g,W)=>new Promise(m=>{if(!R.length||!o){m(0);return}const h=o.map(C=>[...C]),A={};for(const C of R)A[C.icon]||(A[C.icon]=[]),A[C.icon].push(C);let w=[];for(const C in A)A[C].length>=2&&(w=[...w,...A[C]]);if(w.length===0){m(0);return}w.forEach(({row:C,col:x})=>{if(h[C][x]){const f=Y(C,x);h[C][x]=h[C][x]+"_removing",f&&f.classList.contains("new-icon")&&(f.classList.remove("new-icon"),console.log(`[CONVERGENCIA] Eliminar protecci√≥n de icono nuevo en [${C},${x}] para permitir eliminaci√≥n`))}}),t(Ke(h)),setTimeout(()=>se.play("convergingFound"),0);const G=setTimeout(()=>{const C=h.map(be=>be.map(Ye=>Ye&&Ye.includes("_removing")?null:Ye)),x=w.length;t(Ke(C)),t(It(u-x));const{comboTimestamp:f,comboTimeWindow:Z,comboMultiplier:D,comboCount:J,status:oe}=U.getState().game,V=Date.now();if(oe!=="playing"){console.log(`[COMBO DEBUG] Juego no est√° en estado 'playing' (${oe}). No se actualizan combos.`),m(x);return}if(console.log(`
[COMBO DEBUG] ===== Inicio de an√°lisis de combo =====`),console.log(`[COMBO DEBUG] Iconos eliminados: ${x}`),console.log(`[COMBO DEBUG] Estado actual: Combo: ${J}, Multiplicador: ${D.toFixed(1)}x`),console.log(`[COMBO DEBUG] Timestamp actual: ${V}`),console.log(`[COMBO DEBUG] Timestamp √∫ltima eliminaci√≥n: ${f}`),console.log(`[COMBO DEBUG] Ventana de tiempo: ${Z}ms`),x===0){console.log("[COMBO DEBUG] No se eliminaron iconos reales, saltando incremento de combo"),m(0);return}const Se=f===0?0:V-f;console.log(`[COMBO DEBUG] Tiempo transcurrido: ${Se}ms`),console.log(`[COMBO DEBUG] ¬øDentro de ventana de tiempo?: ${Se<=Z?"S√ç":"NO"}`),f===0||J===0?(console.log("[COMBO DEBUG] Primer combo detectado, iniciando secuencia"),t(Ve())):Se<=Z?(console.log("[COMBO DEBUG] Tiempo dentro de ventana, incrementando combo"),t(Ve())):(console.log("[COMBO DEBUG] Tiempo fuera de ventana, reiniciando combo"),t(tt()),setTimeout(()=>{console.log("[COMBO DEBUG] Iniciando nuevo combo despu√©s del reset"),t(Ve())},0));const ve=U.getState().game,he=ve.comboMultiplier,ge=x*10*$,$e=Math.floor(ge*he);if(console.log(`[COMBO DEBUG] Puntos base: ${ge} (${x} iconos √ó 10 √ó nivel ${$})`),console.log(`[COMBO DEBUG] Multiplicador aplicado: ${he.toFixed(1)}x`),console.log(`[COMBO DEBUG] Puntos finales con combo: ${$e}`),t(ze($e)),console.log(`[COMBO DEBUG] Combo actual: ${ve.comboCount}, verificando hitos`),ve.comboCount===10){const be=Re.MILESTONE_BONUSES[10];t(ze(be)),console.log(`[COMBO DEBUG] ¬°HITO! Combo x10 alcanzado. +${be} puntos extra`)}else if(ve.comboCount===20){const be=Re.MILESTONE_BONUSES[20];t(ze(be)),console.log(`[COMBO DEBUG] ¬°HITO! Combo x20 alcanzado. +${be} puntos extra`)}else if(ve.comboCount===30){const be=Re.MILESTONE_BONUSES[30];t(ze(be)),console.log(`[COMBO DEBUG] ¬°HITO! Combo x30 alcanzado. +${be} puntos extra`)}he>1&&(console.log(`[COMBO DEBUG] Combo activo: x${ve.comboCount} (${he.toFixed(1)}x)`),he>=5?(se.play("comboLarge"),console.log("[COMBO DEBUG] Reproduciendo sonido: comboLarge")):he>=3?(se.play("comboMedium"),console.log("[COMBO DEBUG] Reproduciendo sonido: comboMedium")):he>=1.5&&(se.play("comboSmall"),console.log("[COMBO DEBUG] Reproduciendo sonido: comboSmall"))),console.log(`[COMBO DEBUG] ===== Fin de an√°lisis de combo =====
`),m(x)},300);M(G)}),[o,t,u,M,Y,$]),ie=a.useCallback(()=>{I({message:"¬°Penalizaci√≥n!",type:"error",icon:"‚ö†Ô∏è",duration:2e3,value:"Velocidad aumentada"}),pe(!0);const R=setTimeout(()=>{pe(!1)},2e3);M(R)},[I,M]),X=a.useCallback(R=>{I({message:"¬°Velocidad aumentada!",type:"warning",icon:"‚ö°",duration:2500,value:`x${R}`,animateValue:!0}),P(R),F(!0);const g=setTimeout(()=>{F(!1)},2e3);M(g)},[I,M]),te=a.useCallback(()=>{t(Me([])),K.current.forEach(clearTimeout),K.current=[],pe(!1),F(!1)},[t]),ue=a.useCallback((R,g)=>{const W=Y(R,g);Vt(W,M),_t(M);const m=hn(v,t);setTimeout(()=>{X(m)},200);const h=U.getState().game.level;vn(h,o,n,i,t,Y,M)},[t,v,o,n,i,Y,M,X]),Ce=a.useCallback(()=>{se.play("speedUp");const R=no,W=R/3,m=Math.max(W,v*.9);t(Ae(m));const h=Number((R/m).toFixed(1));return setTimeout(()=>{X(h)},50),console.log(`Velocidad aumentada a ${h}x (${m}ms)`),h},[v,t,X]),Te=a.useCallback((R,g)=>{var A;const W=`${R}-${g}`;if(q.current||ae.current===W){j.debug("Interacci√≥n","handleCellClick: ignorando clic porque ya se est√° procesando otro o es un multi-clic en la misma celda");return}if(s!=="playing"){j.debug('handleCellClick: ignorando clic porque el juego no est√° en estado "playing"'," ["+s+"]");return}if(!o||!o[R]||o[R][g]!==null){j.debug("handleCellClick: celda no est√° vac√≠a"," ["+R+", "+g+"] "+((A=o==null?void 0:o[R])==null?void 0:A[g]));return}q.current=!0,ae.current=W;const m=setTimeout(()=>{q.current=!1,ae.current=null},500);M(m),l.length>0&&t(Me([])),setTimeout(()=>se.play("click"),0);const h=ce(R,g);h.length>0?ne(h,R,g).then(()=>{p(h.length*10,R,g),Y(R,g),h.length>0&&t(Me(h.map(w=>({row:w.row,col:w.col})))),t(Me([])),setTimeout(()=>{if(o.flat().every(C=>C===null)){N(),t(ze(100)),j.info("¬°Tablero vac√≠o! Completando nivel..."," ["+s+"]");const x=(v/1e3).toFixed(1);t(je(`¬°Incre√≠ble! Has limpiado completamente el tablero eliminando todos los iconos. Velocidad de aparici√≥n: ${x}s por icono.`)),t(me("levelCompleted")),se.play("levelComplete");return}const G=U.getState().game.iconCount;if(T())j.info("CONVERGENCIA","Hay movimientos v√°lidos despu√©s de eliminar. El juego contin√∫a.");else{const C=n*n,x=G/C*100;if(j.info("CONVERGENCIA",`Verificando fin de juego: ${x.toFixed(1)}% de ocupaci√≥n sin movimientos v√°lidos`),x<=30){j.info(`Pocos iconos sin convergencias (${x.toFixed(1)}%). Nivel completado.`," ["+s+"]");const f=(v/1e3).toFixed(1);t(je(`¬°Has eliminado casi todos los iconos! Solo quedan ${G} iconos sin posibilidad de convergencia. Velocidad de aparici√≥n: ${f}s por icono.`)),t(me("levelCompleted")),se.play("levelComplete")}else{j.info(`No hay movimientos v√°lidos (${x.toFixed(1)}%). Game over.`," ["+s+"]");const f=(v/1e3).toFixed(1);t(je(`El tablero tiene ${G} iconos (${x.toFixed(1)}% de ocupaci√≥n) sin movimientos v√°lidos. Velocidad: ${f}s por icono.`)),t(me("gameOver")),se.play("gameOver")}}},200)}):(se.play("invalidMove"),setTimeout(()=>{q.current=!1,ae.current=null},300),ue(R,g))},[s,o,t,ce,Y,ne,T,pe,v,l,M,n,i,Vt,_t,p,ue]),ye=a.useCallback(()=>{if(!gn(d,r)){r?j.info("showHint: pista en cooldown"," ["+s+"]"):d<=0&&j.info("showHint: no quedan pistas"," ["+s+"]");return}const R=pn(o||[],n);if(R){const g=fn(R);j.info("showHint: mostrando pista"," ["+s+`] posici√≥n: ${JSON.stringify(R)}`),t(Me(g)),se.play("hint"),t(eo()),H.current&&clearTimeout(H.current),H.current=setTimeout(()=>{t(to()),H.current=null},5e3)}else j.warn("showHint: no se encontr√≥ una posici√≥n v√°lida para la pista"," ["+s+"]")},[o,n,d,r,s,t]),Ee=a.useCallback((R,g)=>{if(!R||!g)return;const W=R.offsetWidth,m=R.offsetHeight,h=Math.min(W,m)*.9;g.style.width=`${h}px`,g.style.height=`${h}px`;const A=g.querySelector(".game-board-grid");A&&(A.style.gridTemplateColumns=`repeat(${n}, 1fr)`,A.style.gridTemplateRows=`repeat(${n}, 1fr)`)},[n]),Be=a.useCallback((R,g,W)=>{const m=`${R}-${g}`;W?z.current[m]=W:delete z.current[m]},[]),we=a.useCallback(()=>{const g=U.getState().game.currentDifficulty,W=Re.TIME_WINDOWS[g]||Re.TIME_WINDOWS.normal;console.log(`[COMBO CONFIG] Actualizando ventana de tiempo de combo para dificultad ${g}: ${W}ms`),t(zo(W)),setTimeout(()=>{const m=U.getState().game;console.log(`[COMBO CONFIG] Verificaci√≥n: La ventana de tiempo actual es ${m.comboTimeWindow}ms`)},0)},[t]);return a.useEffect(()=>{console.log("[COMBO CONFIG] Inicializando ventana de tiempo de combo"),we()},[we]),{stopTimers:re,addAnimationTimer:M,registerCellRef:Be,getCellElement:Y,hasValidMoves:T,findAdjacentSameIcons:L,findConvergingIcons:ce,removeConvergingIcons:ne,showPenaltyAlertUI:ie,showSpeedAlertUI:X,penalize:ue,increaseSpeed:Ce,handleCellClick:Te,showHint:ye,adjustBoardSize:Ee,showPointsEarned:p,showEmptyBoardBonus:N,cleanupEffects:te,showSpeedAlert:y,speedMultiplier:B,showPenaltyAlert:le,updateComboTimeWindow:we}},xn=10,lo=(t=30)=>{const[o,s]=a.useState(!1),[n,i]=a.useState(!1),l=a.useRef(!1),d=a.useRef(!1),r=a.useRef(null);a.useEffect(()=>()=>{r.current!==null&&clearTimeout(r.current)},[]);const c=a.useCallback(b=>{if(l.current){n||(j.info("AnimationsLoader","Animaciones ya inicializadas, forzando estado a cargado"),i(!0));return}j.info("AnimationsLoader",`Cargando animaciones en modo: ${b?"lite":"normal"}`);const S=document.head,E=document.getElementById("game-animations-css");E&&E.remove();const O=document.createElement("link");O.id="game-animations-css",O.rel="stylesheet",O.type="text/css";const $=[`./src/components/game/GameBoard/styles/animations${b?"-lite":""}.css`,`/src/components/game/GameBoard/styles/animations${b?"-lite":""}.css`,`${window.location.origin}/src/components/game/GameBoard/styles/animations${b?"-lite":""}.css`,`./animations${b?"-lite":""}.css`,`/animations${b?"-lite":""}.css`];let k=0,I=$.length;const z=()=>{if(k>=I){j.error("AnimationsLoader","No se pudo cargar el archivo CSS de animaciones despu√©s de m√∫ltiples intentos"),i(!0),l.current=!0;return}O.href=$[k],j.info("AnimationsLoader",`Intentando cargar animaciones desde: ${O.href}`),k++};O.onload=()=>{j.info("AnimationsLoader",`Cargado modo de animaciones: ${b?"reducido":"completo"}`),i(!0),l.current=!0,r.current!==null&&(clearTimeout(r.current),r.current=null)},O.onerror=()=>{j.warn("AnimationsLoader",`Error al cargar animaciones desde: ${O.href}, intentando ruta alternativa...`),z()},r.current=window.setTimeout(()=>{n||(j.warn("AnimationsLoader","Timeout al cargar animaciones, marcando como cargado de todos modos"),i(!0),l.current=!0)},2e3),z(),S.appendChild(O),s(b),b?(document.documentElement.classList.add("lite-animations"),t<=xn?document.documentElement.classList.add("performance-mode-high"):document.documentElement.classList.add("performance-mode")):(document.documentElement.classList.remove("lite-animations"),document.documentElement.classList.remove("performance-mode"),document.documentElement.classList.remove("performance-mode-high"))},[t,n]),v=a.useCallback(b=>{c(b),d.current=!0},[c]),u=a.useCallback(()=>l.current,[]);return{useLiteAnimations:o,isLoaded:n,initializeAnimations:v,isInitialized:u}},Cn=()=>{const t=ke(),{board:o,boardSize:s,status:n,highlightedCells:i,currentDifficulty:l,level:d,spawnRate:r}=De(M=>M.game),{handleCellClick:c,registerCellRef:v,showHint:u,showSpeedAlertUI:b}=bn(),S=a.useRef(null),E=a.useRef(new Set),[O,$]=a.useState(!1),[k,I]=a.useState(1),[z,Q]=a.useState(!0),[H,K]=a.useState(!1);a.useRef(!1);const y=a.useCallback((M,Y)=>i.some(p=>p.row===M&&p.col===Y),[i]),F=a.useCallback(M=>M?M.includes("_removing")?{icon:M.replace("_removing",""),isRemoving:!0}:{icon:M,isRemoving:!1}:{icon:null,isRemoving:!1},[]),B=a.useCallback((M,Y)=>{var N;((N=o[M])==null?void 0:N[Y])&&se.play("click"),c(M,Y)},[c,o]),P=a.useMemo(()=>{if(!o||o.length===0||n!=="playing"&&n!=="paused")return[];const M=[],Y=!H||s<=6;for(let p=0;p<s;p++)for(let N=0;N<s;N++){const T=o[p]?o[p][N]:null;if(!T&&!Y){M.push(e.jsx("div",{className:"board-cell empty performance-mode",onClick:()=>B(p,N),"data-row":p,"data-col":N},`cell-${p}-${N}`));continue}const{icon:L,isRemoving:ce}=F(T);let ne="board-cell";y(p,N)&&(ne+=" highlighted"),ce&&(ne+=" removing"),L&&!ce&&(ne+=" has-icon"),L||(ne+=" empty"),H&&(ne+=" performance-mode");const ie=`${p}-${N}`,X=E.current||new Set;L&&!ce&&!X.has(ie)&&L&&(ne+=" new-icon",X.add(ie),setTimeout(()=>{const Ce=document.querySelector(`[data-row="${p}"][data-col="${N}"]`);Ce&&(Ce.classList.remove("new-icon"),console.log(`GameBoard: Eliminada protecci√≥n de icono nuevo en [${p},${N}]`))},H?1500:2e3),E.current=X),M.push(e.jsx("div",{className:ne,onClick:()=>B(p,N),ref:ue=>{v(p,N,ue)},"data-row":p,"data-col":N,children:L&&e.jsx("span",{className:"cell-content",children:L})},`cell-${p}-${N}`))}return M},[o,s,n,F,y,B,v,H]);a.useEffect(()=>{if(S.current){const M=S.current,Y=()=>{M.classList.add("touch-device")};return M.addEventListener("touchstart",Y,{passive:!0}),()=>{M.removeEventListener("touchstart",Y)}}},[]),a.useEffect(()=>(E.current||(E.current=new Set),()=>{E.current&&E.current.clear()}),[]),a.useCallback(M=>{t(dt(M))},[t]),a.useCallback(()=>{u()},[u]);const le=a.useCallback(M=>{const Y=Ct.MEDIUM,p=Math.round(Y/M);I(M),se.play("speedUp"),t(Ae(p)),setTimeout(()=>{b(M)},50),console.log(`Velocidad cambiada a ${M}x (${p}ms)`)},[t,b]);a.useCallback(M=>{const Y=Ct.MEDIUM,p=Number((Y/r).toFixed(1)),N=[.25,.5,.75,1,1.25,1.5,1.75,2,2.5,3,3.5,4];let T=0,L=Math.abs(N[0]-p);for(let ie=1;ie<N.length;ie++){const X=Math.abs(N[ie]-p);X<L&&(L=X,T=ie)}let ce;M==="increase"?ce=Math.min(T+1,N.length-1):ce=Math.max(T-1,0);const ne=N[ce];le(ne)},[r,le]);const[pe,q]=a.useState(!1);a.useCallback(()=>{const M=!pe;if(q(M),M)t(Ae(1e5)),se.play("pause");else{const Y=Ct.MEDIUM,p=Math.round(Y/k);t(Ae(p)),se.play("resume")}console.log(`Generaci√≥n de iconos ${M?"pausada":"reanudada"}`)},[pe,t,k]),a.useCallback(()=>{t(ut(d+1)),n!=="playing"&&t(me("playing")),console.log(`[DEV TOOLS] Avanzando al nivel ${d+1}`)},[t,d,n]),a.useMemo(()=>Number((no/r).toFixed(1)),[r]);const{useLiteAnimations:ae}=lo(15),re=a.useCallback(()=>!o||o.length===0?e.jsx("div",{className:"empty-board-message",children:"Cargando tablero..."}):n!=="playing"&&n!=="paused"?e.jsxs("div",{className:"empty-board-message",children:[n==="startScreen"&&"Selecciona la configuraci√≥n para comenzar",n==="gameOver"&&"Juego terminado",n==="levelCompleted"&&"Nivel completado",n==="idle"&&"Inicializando..."]}):e.jsx("div",{ref:S,className:`game-board-grid grid-${s}`,style:{gridTemplateColumns:`repeat(${s}, 1fr)`,gridTemplateRows:`repeat(${s}, 1fr)`},children:P}),[o,s,P,n]);return e.jsx(ko,{children:e.jsx("div",{className:`game-board-wrapper ${H?"performance-mode":""}`,children:re()})})},yn=()=>{const{comboCount:t,comboMultiplier:o,comboTimestamp:s,comboTimeWindow:n}=De($=>$.game),[i,l]=a.useState(!1),[d,r]=a.useState(100),c=a.useRef(null),v=typeof document<"u"&&document.documentElement.classList.contains("performance-mode"),u=a.useMemo(()=>!o||o<1.5?{class:"combo-basic",icon:"üîÑ"}:o>=5?{class:"combo-legendary",icon:"‚ú®"}:o>=3?{class:"combo-epic",icon:"üî•"}:o>=2?{class:"combo-rare",icon:"üí´"}:{class:"combo-uncommon",icon:"‚ö°"},[o]),b=a.useMemo(()=>({"--angle":`${Math.floor(d/100*360)}deg`}),[d]),S=$=>$<1?"x1.0":$%1===0||$*10%10===0?`x${Math.floor($)}`:`x${$.toFixed(1)}`;if(a.useEffect(()=>{i&&t&&t>=3&&(o&&o>=5?se.play("comboLarge"):o&&o>=3?se.play("comboMedium"):o&&o>=1.5&&se.play("comboSmall"))},[i,t,o]),a.useEffect(()=>{t&&t>=3&&s>0&&l(!0)},[t,s]),a.useEffect(()=>{const $=t&&t>=3&&s>0;if(l(!!$),c.current&&(clearInterval(c.current),c.current=null),$){r(100);const k=v?100:16;c.current=setInterval(()=>{const z=Date.now()-s,H=Math.max(0,n-z)/n*100;r(H),H<=0&&(l(!1),c.current&&(clearInterval(c.current),c.current=null))},k)}return()=>{c.current&&(clearInterval(c.current),c.current=null)}},[t,s,n,v]),!i)return null;const E=t||0,O=o||1;return e.jsx("div",{className:"combo-indicator",children:e.jsxs("div",{className:`combo-orbital ${u.class} ${v?"performance-mode":""}`,children:[e.jsx("div",{className:"combo-icon",children:u.icon}),e.jsx("div",{className:"combo-timer-ring",children:e.jsx("div",{className:"combo-timer-fill",style:b})}),e.jsx("div",{className:"combo-count",children:E}),e.jsx("div",{className:"combo-multiplier",children:S(O)})]})})},Sn={tutorial:"üöÄ",easy:"üåü",normal:"üåó",hard:"üî•"},Nn={classic:"Cl√°sico",timed:"Tiempo",survival:"Superv.",zen:"Zen",tutorial:"Tutorial"},jn={tutorial:"Tutorial",easy:"F√°cil",normal:"Normal",hard:"Dif√≠cil"},En=()=>{const t=ke(),{score:o,level:s,timer:n,timeRemaining:i,survivalTime:l,currentDifficulty:d,currentPlayMode:r,status:c,spawnRate:v,highScore:u,levelScoreTarget:b,levelOccupationTarget:S,iconCount:E,boardSize:O}=De(te=>te.game),[$,k]=a.useState(!1),[I,z]=a.useState(!1),Q=a.useRef(o),H=a.useRef(s),[K,y]=a.useState(!1),[F,B]=a.useState(!1),[P,le]=a.useState(!0),pe=a.useRef(window.innerWidth<=768);a.useEffect(()=>{const te=()=>{pe.current=window.innerWidth<=768};return window.addEventListener("resize",te),()=>window.removeEventListener("resize",te)},[]),a.useEffect(()=>{if(Q.current!==o&&Q.current>0){k(!0);const te=setTimeout(()=>k(!1),300);return()=>clearTimeout(te)}Q.current=o},[o]),a.useEffect(()=>{if(H.current!==s&&H.current>0){z(!0);const te=setTimeout(()=>z(!1),300);return()=>clearTimeout(te)}H.current=s},[s]);const q=te=>{if(typeof te!="number"||isNaN(te))return"0:00";const ue=Math.floor(te/60),Ce=Math.floor(te%60);return`${ue}:${Ce<10?"0":""}${Ce}`},ae=()=>r==="timed"&&typeof i=="number"?q(i):r==="survival"&&typeof l=="number"?q(l):typeof n=="number"?q(n):"0:00",re=()=>typeof v!="number"||v<=0?"x1.0":`x${oo.getCurrentMultiplier(v,d).toFixed(1)}`,M=()=>Nn[r]||"Cl√°sico",Y=a.useCallback(()=>{var te;if(r==="classic"&&b>0)return Math.min(100,Math.round(o/b*100));if(r==="timed"&&i!==void 0&&typeof i=="number"){const ue=(te=Ge.timed)==null?void 0:te.baseTime;return Math.max(0,Math.min(100,i/ue*100))}else if(r==="survival"&&E>0&&O>0){const ue=O*O,Ce=(ue-E)/ue*100;return Math.min(100,Ce)}return 0},[r,o,i,b,E,O]),p=a.useCallback(()=>r==="classic"&&b>0?o>=b:!1,[r,o,b]),N=()=>r==="classic"?"OBJETIVO":r==="timed"?"TIEMPO":"PROGRESO",T=()=>{const te=Sn[d]||"üåó",ue=jn[d]||"Normal";return`${te} ${ue}`},L=()=>{c==="playing"?t(me("paused")):c==="paused"&&t(me("playing"))},ce=()=>{t(tt()),t(me("startScreen"))},ne=()=>{B(!F)},ie=()=>{le(!P)},X=()=>{const te=Y();return e.jsxs("div",{className:"hud-value",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:`progress-fill ${p()?"progress-achieved":""}`,style:{width:`${te}%`}})}),e.jsx("div",{className:"progress-text",children:r==="classic"&&b>0?`${o}/${b}`:`${Math.round(te)}%`})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"top-bar",children:[e.jsxs("div",{className:"max-score-container",children:[e.jsx("div",{className:"max-score-label",children:"M√ÅXIMA"}),e.jsx("div",{className:"max-score-value",children:u||0})]}),e.jsxs("div",{className:"control-buttons",children:[e.jsx("button",{className:"control-button pause-button",onClick:L,"aria-label":c==="playing"?"Pausar juego":"Reanudar juego",children:c==="playing"?"‚è∏Ô∏è":"‚ñ∂Ô∏è"}),e.jsx("button",{className:"control-button restart-button",onClick:ce,"aria-label":"Reiniciar juego",children:"üîÑ"}),e.jsx("button",{className:"control-button settings-button",onClick:()=>y(!K),"aria-label":"Configuraci√≥n",children:"‚öôÔ∏è"})]})]}),e.jsxs("div",{className:"game-hud",children:[e.jsxs("div",{className:"hud-item score",children:[e.jsx("div",{className:"hud-label",children:"PUNTUACI√ìN"}),e.jsx("div",{className:`hud-value ${$?"score-change":""}`,children:o||0})]}),e.jsxs("div",{className:"hud-item level",children:[e.jsx("div",{className:"hud-label",children:"NIVEL"}),e.jsx("div",{className:`hud-value ${I?"score-change":""}`,children:s||1})]}),e.jsxs("div",{className:"hud-item time",children:[e.jsx("div",{className:"hud-label",children:"TIEMPO"}),e.jsx("div",{className:"hud-value",children:ae()})]}),e.jsxs("div",{className:"hud-item speed",children:[e.jsx("div",{className:"hud-label",children:"VELOCIDAD"}),e.jsx("div",{className:"hud-value",children:re()})]}),e.jsxs("div",{className:"hud-item mode",children:[e.jsx("div",{className:"hud-label",children:"MODO"}),e.jsx("div",{className:"hud-value",children:M()})]}),e.jsxs("div",{className:"hud-item difficulty",children:[e.jsx("div",{className:"hud-label",children:"DIFICULTAD"}),e.jsx("div",{className:"hud-value",children:T()})]}),e.jsxs("div",{className:"hud-item progress",children:[e.jsx("div",{className:"hud-label",children:N()}),X()]})]}),e.jsx(yn,{}),K&&e.jsx("div",{className:"config-modal",children:e.jsxs("div",{className:"config-modal-content",children:[e.jsx("h3",{children:"Configuraci√≥n"}),e.jsxs("div",{className:"config-section",children:[e.jsx("h4",{children:"Sonido"}),e.jsxs("div",{className:"config-option",children:[e.jsx("span",{children:"M√∫sica"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",defaultChecked:!0}),e.jsx("span",{className:"toggle-slider"})]})]}),e.jsxs("div",{className:"config-option",children:[e.jsx("span",{children:"Efectos"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",defaultChecked:!0}),e.jsx("span",{className:"toggle-slider"})]})]})]}),e.jsxs("div",{className:"config-section",children:[e.jsx("h4",{children:"Apariencia"}),e.jsxs("div",{className:"config-option",children:[e.jsx("span",{children:"Modo oscuro"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",defaultChecked:!0}),e.jsx("span",{className:"toggle-slider"})]})]})]}),e.jsxs("div",{className:"config-section",children:[e.jsx("h4",{children:"Rendimiento"}),e.jsxs("div",{className:"config-option",children:[e.jsx("span",{children:"Animaciones reducidas"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox"}),e.jsx("span",{className:"toggle-slider"})]})]})]}),e.jsxs("div",{className:"config-section dev-controls-section",children:[e.jsx("h4",{children:"Desarrollador"}),e.jsxs("div",{className:"config-option",children:[e.jsx("span",{children:"Mostrar FPS"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:P,onChange:ie}),e.jsx("span",{className:"toggle-slider"})]})]}),e.jsxs("div",{className:"config-option",children:[e.jsx("span",{children:"Controles Dev"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:F,onChange:ne}),e.jsx("span",{className:"toggle-slider"})]})]})]}),e.jsx("button",{className:"close-modal-btn",onClick:()=>y(!1),children:"Cerrar"})]})})]})},st=()=>{const{isSoundEnabled:t}=nt();return{playSound:a.useCallback(s=>{t&&console.log(`Playing sound: ${s}`)},[t])}},Nt={title:{opacity:0,transform:"translateY(-20px)"},content:{opacity:0,transform:"translateY(20px)"},button:{opacity:0,transform:"scale(0.8)"}},Ht=["ü™ê","üí´","‚ú®","üåü"],Mn=({isVisible:t=!1,onRestart:o,onReturnToMenu:s})=>{const{gameState:n}=nt(),{score:i,level:l,comboCount:d,comboMultiplier:r,highScore:c,gameEndReason:v,currentPlayMode:u,currentDifficulty:b,spawnRate:S}=De(p=>p.game),{playSound:E}=st(),O=a.useRef(null),[$,k]=a.useState(Nt),[I,z]=a.useState(!1),[Q,H]=a.useState(!1),[K,y]=a.useState(!1),[F,B]=a.useState([]);a.useEffect(()=>{const p=()=>{const N=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${N}px`)};return p(),window.addEventListener("resize",p),window.addEventListener("orientationchange",p),window.addEventListener("load",p),()=>{window.removeEventListener("resize",p),window.removeEventListener("orientationchange",p),window.removeEventListener("load",p)}},[]),a.useEffect(()=>{if(t&&I){const p=[],N=window.innerWidth<400||window.innerHeight<700,T=N?3:Math.min(5,Math.floor(window.innerWidth/120));for(let L=0;L<T;L++){const ce=Math.random()*100,ne=Math.random()*100,ie=Math.random()*(N?1:1.5)+.8,X=Math.random()*15+20,te=Math.random()*5,ue=Ht[Math.floor(Math.random()*Ht.length)];p.push({icon:ue,style:{position:"absolute",top:`${ce}%`,left:`${ne}%`,fontSize:`${ie}em`,opacity:N?.3:.5,filter:"blur(0.5px)",animation:`float ${X}s ease-in-out ${te}s infinite`,zIndex:1}})}B(p)}},[t,I]),a.useEffect(()=>{let p;const N=[];return t?(z(!0),H(!1),document.body.classList.add("modal-open"),y(i>c),E("gameOver"),N.push(setTimeout(()=>{k(T=>({...T,title:{opacity:1,transform:"translateY(0)"}})),N.push(setTimeout(()=>{k(T=>({...T,content:{opacity:1,transform:"translateY(0)"}})),N.push(setTimeout(()=>{k(T=>({...T,button:{opacity:1,transform:"scale(1)"}}))},150))},150))},100))):(H(!0),p=setTimeout(()=>{z(!1),k(Nt),document.body.classList.remove("modal-open")},300)),()=>{p&&clearTimeout(p),N.forEach(T=>clearTimeout(T)),document.body.classList.remove("modal-open"),H(!1),k(Nt)}},[t,E,i,c]);const P=()=>{o&&(H(!0),E("uiClick"),setTimeout(()=>{z(!1),o()},300))},le=()=>{s&&(H(!0),E("uiClick"),setTimeout(()=>{z(!1),s()},300))},pe=()=>r>=5?"combo-legendary-text":r>=3?"combo-epic-text":r>=2?"combo-rare-text":r>=1.5?"combo-uncommon-text":"combo-basic-text",q=()=>r>=5?"#FFD700":r>=3?"#FF2D55":r>=2?"#8E2DE2":r>=1.5?"#36D1DC":"#FFFFFF",ae=p=>({classic:"Cl√°sico",timed:"Contrarreloj",survival:"Supervivencia",zen:"Zen",tutorial:"Tutorial"})[p]||p,re=p=>({easy:"F√°cil",normal:"Normal",hard:"Dif√≠cil",tutorial:"Tutorial"})[p]||p,M=p=>(p/1e3).toFixed(1)+"s",Y=()=>`game-session-info ${window.innerWidth<=375?"compact-layout":""}`;return!I&&!t?null:e.jsxs("div",{className:`game-modal fullscreen-modal ${I?"visible":""} ${Q?"closing":""}`,children:[F.map((p,N)=>e.jsx("div",{style:p.style,children:p.icon},`floating-icon-${N}`)),e.jsxs("div",{className:"modal-content game-over-content",ref:O,children:[e.jsxs("div",{className:"game-over-header",style:{transition:"all 0.5s ease",...$.title},children:[e.jsx("h1",{children:"¬°MISI√ìN FALLIDA!"}),e.jsx("h2",{children:K?"¬°Nuevo r√©cord gal√°ctico!":"¬°Has perdido esta batalla espacial!"}),e.jsxs("div",{className:Y(),children:[e.jsxs("div",{className:"info-pill",children:[e.jsx("span",{className:"info-label",children:"üéÆ"}),e.jsx("span",{className:"info-value",children:ae(u)})]}),e.jsxs("div",{className:"info-pill",children:[e.jsx("span",{className:"info-label",children:"üöÄ"}),e.jsx("span",{className:"info-value",children:l})]}),e.jsxs("div",{className:"info-pill",children:[e.jsx("span",{className:"info-label",children:"üî•"}),e.jsx("span",{className:"info-value",children:re(b)})]}),e.jsxs("div",{className:"info-pill",children:[e.jsx("span",{className:"info-label",children:"‚ö°"}),e.jsx("span",{className:"info-value",children:M(S)})]})]}),v&&e.jsx("div",{className:"game-end-reason",children:e.jsx("p",{children:v})})]}),e.jsxs("div",{className:"game-over-body",style:{transition:"all 0.5s ease",transitionDelay:"0.15s",...$.content},children:[e.jsxs("div",{className:"main-stats",children:[e.jsxs("div",{className:"record-score-container",children:[e.jsxs("div",{className:"record-badge",children:[e.jsx("div",{className:"record-icon",children:"üëë"}),e.jsx("div",{className:"record-value",children:c})]}),e.jsxs("div",{className:"current-score",children:[e.jsx("div",{className:"score-label",children:"Puntuaci√≥n"}),e.jsx("div",{className:`score-value ${K?"new-high-score":""}`,children:i})]})]}),e.jsxs("div",{className:"compact-stats-grid",children:[e.jsxs("div",{className:"compact-stat-item",children:[e.jsx("div",{className:"compact-stat-icon",children:"üöÄ"}),e.jsx("div",{className:"compact-stat-value",children:l}),e.jsx("div",{className:"compact-stat-label",children:"Nivel"})]}),e.jsxs("div",{className:"compact-stat-item",children:[e.jsx("div",{className:"compact-stat-icon",children:"üî•"}),e.jsx("div",{className:`compact-stat-value ${pe()}`,style:{color:q()},children:d}),e.jsxs("div",{className:"compact-stat-label",children:["Combo ",r>1?`${r.toFixed(1)}x`:""]})]}),e.jsxs("div",{className:"compact-stat-item",children:[e.jsx("div",{className:"compact-stat-icon",children:"‚≠ê"}),e.jsxs("div",{className:"compact-stat-value",children:["+",Math.floor(i*.1)]}),e.jsx("div",{className:"compact-stat-label",children:"EXP"})]})]})]}),e.jsx("div",{className:"game-over-message",children:e.jsx("p",{children:K?"¬°Has establecido un nuevo r√©cord en la galaxia! ¬øPodr√°s superarlo?":"No te rindas, tu aventura espacial contin√∫a. ¬°Mejora y conquista las estrellas!"})})]}),e.jsxs("div",{className:"game-over-buttons",children:[e.jsx("button",{className:"game-button primary-button",onClick:P,style:{transition:"all 0.5s ease",...$.button},children:"Reintentar"}),s&&e.jsx("button",{className:"game-button secondary-button",onClick:le,style:{transition:"all 0.5s ease",...$.button},children:"Men√∫"})]})]})]})},wn=({isVisible:t,onClose:o,onContinue:s,onMainMenu:n,gameStats:i={score:0,timeFormatted:"00:00",maxCombo:0,moves:0,averageSpeed:0},levelNumber:l=1,nextLevel:d=2,starsEarned:r=0,rewards:c=[],nextLevelPreview:v})=>{const[u,b]=a.useState(!1),[S,E]=a.useState("results"),O=a.useRef(null),$=a.useRef(null),k=()=>{const y=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${y}px`)};a.useEffect(()=>(k(),window.addEventListener("resize",k),()=>{window.removeEventListener("resize",k)}),[]);const I=()=>{b(!0),setTimeout(()=>{o(),b(!1)},300)};a.useEffect(()=>{t&&$.current&&z()},[t]);const z=()=>{if(!$.current)return;const y=window.innerWidth<500?20:35;for(;$.current.firstChild;)$.current.removeChild($.current.firstChild);const F=["#4CAF50","#FFC107","#2196F3","#E91E63","#FFEB3B","#3F51B5"];for(let B=0;B<y;B++){const P=document.createElement("div");P.className="confetti";const le=F[Math.floor(Math.random()*F.length)],pe=Math.random()*100+"%",q=Math.random()*8+5+"px",ae=Math.random()*3+"s",re=Math.random()*2+3+"s";P.style.left=pe,P.style.width=q,P.style.height=q,P.style.backgroundColor=le,P.style.animationDelay=ae,P.style.animationDuration=re;const M=["square","circle","triangle"],Y=M[Math.floor(Math.random()*M.length)];Y==="circle"?P.style.borderRadius="50%":Y==="triangle"&&(P.style.width="0",P.style.height="0",P.style.backgroundColor="transparent",P.style.borderLeft=q+" solid transparent",P.style.borderRight=q+" solid transparent",P.style.borderBottom=q+" solid "+le),$.current.appendChild(P)}},Q=()=>{const y=["üèÜ","‚≠ê","üéâ","üöÄ","üåü"],F=Math.min(7,window.innerWidth<500?3:5),B=[];for(let P=0;P<F;P++){const le=y[Math.floor(Math.random()*y.length)],pe=Math.random()*2,q=Math.random()*2+2,ae=5+Math.random()*20,re=5+Math.random()*90;B.push(e.jsx("div",{className:"floating-icon",style:{position:"absolute",top:`${ae}%`,left:`${re}%`,fontSize:`${Math.random()*1.2+.8}em`,opacity:.4,filter:"blur(0.5px)",animation:`float ${q}s ease-in-out ${pe}s infinite`,zIndex:0},children:le},P))}return e.jsx(e.Fragment,{children:B})},H=y=>y>=20?"combo-legendary-text":y>=15?"combo-epic-text":y>=10?"combo-rare-text":y>=5?"combo-uncommon-text":"combo-basic-text",K=y=>{switch(y){case"score":return"üèÜ";case"time":return"‚è±Ô∏è";case"combo":return"‚ö°";case"moves":return"üë£";case"speed":return"üöÄ";default:return"üìä"}};return!t&&!u?null:e.jsx("div",{className:`game-modal fullscreen-modal ${t?"visible":""} ${u?"closing":""}`,onClick:I,children:e.jsxs("div",{ref:O,className:`level-complete-content ${t&&!u?"animate-in":""}`,onClick:y=>y.stopPropagation(),children:[e.jsx("div",{className:"level-complete-background"}),e.jsx("div",{ref:$,className:"confetti-container"}),Q(),e.jsxs("div",{className:"level-header",children:[e.jsxs("div",{className:"level-transition",children:[e.jsxs("span",{className:"previous-level",children:["N",l]}),e.jsx("span",{className:"level-arrow",children:"‚Üí"}),e.jsxs("span",{className:"next-level pulse-animation",children:["N",d]})]}),e.jsx("div",{className:"stars-container",children:[1,2,3].map(y=>e.jsx("div",{className:`level-star ${y<=r?"earned":""}`,style:{"--delay":`${(y-1)*.2}s`},children:"‚≠ê"},y))})]}),e.jsxs("div",{className:"modal-tabs",children:[e.jsx("button",{className:`tab-button ${S==="results"?"active":""}`,onClick:()=>E("results"),children:"Resultados"}),e.jsx("button",{className:`tab-button ${S==="preview"?"active":""}`,onClick:()=>E("preview"),children:"Siguiente nivel"})]}),e.jsxs("div",{className:"modal-sections",children:[S==="results"&&e.jsxs("div",{className:"results-section",children:[e.jsxs("div",{className:"victory-banner",children:[e.jsx("div",{className:"victory-icon",children:"üèÜ"}),e.jsx("h2",{className:"victory-title",children:"¬°NIVEL COMPLETADO!"})]}),e.jsxs("div",{className:"main-stats",children:[e.jsxs("div",{className:"stat-card score",children:[e.jsx("div",{className:"stat-icon-badge",children:K("score")}),e.jsx("div",{className:"stat-value",children:(i==null?void 0:i.score)||0}),e.jsx("div",{className:"stat-label",children:"PUNTOS"})]}),e.jsxs("div",{className:"stat-card time",children:[e.jsx("div",{className:"stat-icon-badge",children:K("time")}),e.jsx("div",{className:"stat-value",children:(i==null?void 0:i.timeFormatted)||"00:00"}),e.jsx("div",{className:"stat-label",children:"TIEMPO"})]}),e.jsxs("div",{className:"stat-card combo",children:[e.jsx("div",{className:"stat-icon-badge",children:K("combo")}),e.jsxs("div",{className:`stat-value ${H((i==null?void 0:i.maxCombo)||0)}`,children:[(i==null?void 0:i.maxCombo)||0,"x"]}),e.jsx("div",{className:"stat-label",children:"COMBO"})]})]}),e.jsxs("div",{className:"detailed-stats compact",children:[e.jsxs("div",{className:"stat-row",children:[e.jsx("span",{className:"stat-icon",children:K("moves")}),e.jsx("span",{className:"stat-label",children:"MOVIMIENTOS"}),e.jsx("span",{className:"stat-value",children:(i==null?void 0:i.moves)||0})]}),e.jsxs("div",{className:"stat-row",children:[e.jsx("span",{className:"stat-icon",children:K("speed")}),e.jsx("span",{className:"stat-label",children:"VELOCIDAD"}),e.jsxs("span",{className:"stat-value",children:[((i==null?void 0:i.averageSpeed)||0).toFixed(1),"/s"]})]})]}),e.jsxs("div",{className:"rewards-section",children:[e.jsx("h3",{className:"section-title",children:"Recompensas"}),e.jsx("div",{className:"rewards-grid adaptive",children:(c||[]).map((y,F)=>e.jsxs("div",{className:`reward-card ${y.rarity}`,children:[e.jsx("div",{className:"reward-icon",children:y.icon}),e.jsxs("div",{className:"reward-amount",children:["+",y.amount]}),e.jsx("div",{className:"reward-name",children:y.name})]},F))})]})]}),S==="preview"&&v&&e.jsxs("div",{className:"preview-section compact",children:[e.jsxs("h3",{className:"section-title",children:["Nivel ",v.level]}),e.jsxs("div",{className:"difficulty-indicator",children:[e.jsx("span",{children:"Dificultad:"}),e.jsx("div",{className:"difficulty-bars",children:[1,2,3,4,5].map(y=>e.jsx("div",{className:`difficulty-bar ${y<=v.difficulty?"active":""}`},y))})]}),v.newIcons.length>0&&e.jsxs("div",{className:"new-icons-preview compact",children:[e.jsx("div",{className:"preview-subtitle",children:"Nuevos iconos:"}),e.jsx("div",{className:"icons-grid compact",children:v.newIcons.map((y,F)=>e.jsx("div",{className:"new-icon-card",children:y},F))})]}),e.jsxs("div",{className:"level-objectives compact",children:[e.jsx("div",{className:"preview-subtitle",children:"Objetivos:"}),e.jsx("div",{className:"objectives-list",children:v.objectives.map((y,F)=>e.jsxs("div",{className:"objective-item",children:[e.jsx("div",{className:"objective-icon",children:y.icon}),e.jsx("div",{className:"objective-desc",children:y.description}),e.jsx("div",{className:"objective-target",children:y.target})]},F))})]})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"continue-button pulse-animation",onClick:s,children:"Siguiente nivel"}),e.jsx("button",{className:"menu-button",onClick:n,children:"Men√∫"})]})]})]})})},jt={title:{opacity:0,transform:"translateY(-20px)"},options:{opacity:0,transform:"translateY(20px)"},button:{opacity:0,transform:"scale(0.8)"}},In=({isVisible:t=!0,onPlay:o,onOptions:s,onCredits:n})=>{a.useRef(null);const{playSound:i}=st(),{isSoundEnabled:l,setIsSoundEnabled:d,isMusicEnabled:r,setIsMusicEnabled:c}=nt(),[v,u]=a.useState(jt),[b,S]=a.useState(!1),[E,O]=a.useState(!1),[$,k]=a.useState("main");a.useEffect(()=>{let q;const ae=[];return t?(S(!0),O(!1),document.body.classList.add("modal-open"),ae.push(setTimeout(()=>{u(re=>({...re,title:{opacity:1,transform:"translateY(0)"}})),ae.push(setTimeout(()=>{u(re=>({...re,options:{opacity:1,transform:"translateY(0)"}})),ae.push(setTimeout(()=>{u(re=>({...re,button:{opacity:1,transform:"scale(1)"}}))},200))},200))},100))):(O(!0),q=setTimeout(()=>{S(!1),u(jt),document.body.classList.remove("modal-open")},300)),()=>{q&&clearTimeout(q),ae.forEach(re=>clearTimeout(re)),document.body.classList.remove("modal-open"),O(!1),u(jt),console.log("StartGameModal desmontado y recursos liberados")}},[t,i]),a.useEffect(()=>{const q=()=>{const ae=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${ae}px`)};return q(),window.addEventListener("resize",q),window.addEventListener("orientationchange",q),window.addEventListener("load",q),window.addEventListener("touchstart",q),window.addEventListener("touchend",q),()=>{window.removeEventListener("resize",q),window.removeEventListener("orientationchange",q),window.removeEventListener("load",q),window.removeEventListener("touchstart",q),window.removeEventListener("touchend",q)}},[]);const I=q=>{i("uiSelect"),k(q)},z=()=>{const q=[];for(let re=0;re<15;re++){const M=Math.random()*3+1,Y=Math.random()*100,p=Math.random()*100,N=Math.random()*15+10,T=Math.random()*10;q.push(e.jsx("div",{className:"floating-star",style:{width:`${M}px`,height:`${M}px`,top:`${Y}%`,left:`${p}%`,animationDuration:`${N}s`,animationDelay:`${T}s`}},re))}return q},Q=()=>{i("uiSelect"),o&&o()},H=()=>{i("uiSelect"),I("options"),s&&s()},K=()=>{i("uiSelect"),I("credits"),n&&n()},y=()=>{i("uiSelect"),d(!l),localStorage.setItem("soundEnabled",String(!l))},F=()=>{i("uiSelect"),c(!r),localStorage.setItem("musicEnabled",String(!r))},B=()=>e.jsxs("div",{className:"main-screen",children:[e.jsxs("div",{className:"logo-container",style:{transition:"all 0.6s ease",...v.title},children:[e.jsx("h1",{className:"logo-text",children:"Convergencia"}),e.jsx("div",{className:"logo-pulse"})]}),e.jsxs("div",{className:"main-buttons",style:{transition:"all 0.5s ease",transitionDelay:"0.3s",...v.options},children:[e.jsx("button",{className:"main-button play-button",onClick:Q,children:"JUGAR"}),e.jsx("button",{className:"main-button options-button",onClick:H,children:"OPCIONES"}),e.jsx("button",{className:"main-button credits-button",onClick:K,children:"CR√âDITOS"})]})]}),P=()=>e.jsxs("div",{className:"options-screen",children:[e.jsxs("div",{className:"screen-header",children:[e.jsx("h2",{className:"screen-title",children:"Opciones"}),e.jsx("button",{className:"back-button",onClick:()=>I("main"),children:"‚¨ÖÔ∏è Volver"})]}),e.jsxs("div",{className:"settings-content",children:[e.jsxs("div",{className:"settings-option",children:[e.jsx("span",{className:"setting-label",children:"M√∫sica"}),e.jsx("button",{className:`setting-toggle ${r?"active":""}`,onClick:F,children:r?"ON":"OFF"})]}),e.jsxs("div",{className:"settings-option",children:[e.jsx("span",{className:"setting-label",children:"Sonido"}),e.jsx("button",{className:`setting-toggle ${l?"active":""}`,onClick:y,children:l?"ON":"OFF"})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{className:"settings-section-title",children:"Informaci√≥n del Juego"}),e.jsx("div",{className:"settings-info",children:e.jsx("p",{children:"Convergencia es un juego de rompecabezas donde debes combinar iconos del mismo tipo para ganar puntos. Experimenta diferentes modos de juego y dificultades para desafiar tus habilidades."})})]})]})]}),le=()=>e.jsxs("div",{className:"credits-screen",children:[e.jsxs("div",{className:"screen-header",children:[e.jsx("h2",{className:"screen-title",children:"Cr√©ditos"}),e.jsx("button",{className:"back-button",onClick:()=>I("main"),children:"‚¨ÖÔ∏è Volver"})]}),e.jsxs("div",{className:"credits-content",children:[e.jsx("h3",{className:"credits-title",children:"Convergencia"}),e.jsx("p",{className:"credits-subtitle",children:"Dise√±ado y desarrollado por:"}),e.jsx("p",{className:"credits-name",children:"Equipo de Desarrollo"}),e.jsx("h4",{className:"credits-section",children:"Programaci√≥n"}),e.jsx("p",{className:"credits-name",children:"Desarrollador Principal"}),e.jsx("h4",{className:"credits-section",children:"Dise√±o Gr√°fico"}),e.jsx("p",{className:"credits-name",children:"Dise√±ador de UI/UX"}),e.jsx("h4",{className:"credits-section",children:"M√∫sica y Sonido"}),e.jsx("p",{className:"credits-name",children:"Compositor"}),e.jsx("h4",{className:"credits-section",children:"Agradecimientos Especiales"}),e.jsx("p",{className:"credits-text",children:"A todos los que hicieron posible este juego"}),e.jsxs("div",{className:"version-info",children:[e.jsx("p",{children:"Versi√≥n 1.0.0"}),e.jsx("p",{children:"¬© 2023 Todos los derechos reservados"})]})]})]}),pe=()=>{switch($){case"options":return P();case"credits":return le();default:return B()}};return b?e.jsx("div",{className:`start-game ${E?"closing":""}`,children:e.jsxs("div",{className:"start-game-body",children:[z(),pe()]})}):null},ro=()=>{const[t,o]=a.useState(()=>{const n=localStorage.getItem("darkMode");return n!==null?n==="true":window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches});return a.useEffect(()=>{t?document.documentElement.classList.add("dark-mode"):document.documentElement.classList.remove("dark-mode"),localStorage.setItem("darkMode",String(t))},[t]),{darkMode:t,toggleDarkMode:()=>{o(n=>!n)}}};var uo={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},qt=_e.createContext&&_e.createContext(uo),Tn=["attr","size","title"];function $n(t,o){if(t==null)return{};var s=Rn(t,o),n,i;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(i=0;i<l.length;i++)n=l[i],!(o.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function Rn(t,o){if(t==null)return{};var s={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(o.indexOf(n)>=0)continue;s[n]=t[n]}return s}function pt(){return pt=Object.assign?Object.assign.bind():function(t){for(var o=1;o<arguments.length;o++){var s=arguments[o];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},pt.apply(this,arguments)}function Yt(t,o){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);o&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),s.push.apply(s,n)}return s}function ft(t){for(var o=1;o<arguments.length;o++){var s=arguments[o]!=null?arguments[o]:{};o%2?Yt(Object(s),!0).forEach(function(n){On(t,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Yt(Object(s)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(s,n))})}return t}function On(t,o,s){return o=Ln(o),o in t?Object.defineProperty(t,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[o]=s,t}function Ln(t){var o=An(t,"string");return typeof o=="symbol"?o:o+""}function An(t,o){if(typeof t!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var n=s.call(t,o);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(t)}function mo(t){return t&&t.map((o,s)=>_e.createElement(o.tag,ft({key:s},o.attr),mo(o.child)))}function Oe(t){return o=>_e.createElement(Dn,pt({attr:ft({},t.attr)},o),mo(t.child))}function Dn(t){var o=s=>{var{attr:n,size:i,title:l}=t,d=$n(t,Tn),r=i||s.size||"1em",c;return s.className&&(c=s.className),t.className&&(c=(c?c+" ":"")+t.className),_e.createElement("svg",pt({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,n,d,{className:c,style:ft(ft({color:t.color||s.color},s.style),t.style),height:r,width:r,xmlns:"http://www.w3.org/2000/svg"}),l&&_e.createElement("title",null,l),t.children)};return qt!==void 0?_e.createElement(qt.Consumer,null,s=>o(s)):o(uo)}function po(t){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M255.9.2h-64v64h64zM0 64.17v64h64v-64zM128 .2H64v64h64zm64 255.9v64h64v-64zM0 192.12v64h64v-64zM383.85.2h-64v64h64zm128 0h-64v64h64zM128 256.1H64v64h64zM511.8 448v-64h-64v64zm0-128v-64h-64v64zM383.85 512h64v-64h-64zm128-319.88v-64h-64v64zM128 512h64v-64h-64zM0 512h64v-64H0zm255.9 0h64v-64h-64zM0 320.07v64h64v-64zm319.88-191.92v-64h-64v64zm-64 128h64v-64h-64zm-64 128v64h64v-64zm128-64h64v-64h-64zm0-127.95h64v-64h-64zm0 191.93v64h64v-64zM64 384.05v64h64v-64zm128-255.9v-64h-64v64zm191.92 255.9h64v-64h-64zm-128-191.93v-64h-64v64zm128-127.95v64h64v-64zm-128 255.9v64h64v-64zm-64-127.95H128v64h64zm191.92 64h64v-64h-64zM128 128.15H64v64h64zm0 191.92v64h64v-64z"},child:[]}]})(t)}function fo(t){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"},child:[]}]})(t)}function go(t){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M467.14 44.84c-62.55-62.48-161.67-64.78-252.28 25.73-78.61 78.52-60.98 60.92-85.75 85.66-60.46 60.39-70.39 150.83-63.64 211.17l178.44-178.25c6.26-6.25 16.4-6.25 22.65 0s6.25 16.38 0 22.63L7.04 471.03c-9.38 9.37-9.38 24.57 0 33.94 9.38 9.37 24.6 9.37 33.98 0l66.1-66.03C159.42 454.65 279 457.11 353.95 384h-98.19l147.57-49.14c49.99-49.93 36.38-36.18 46.31-46.86h-97.78l131.54-43.8c45.44-74.46 34.31-148.84-16.26-199.36z"},child:[]}]})(t)}function ho(t){return Oe({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M216 23.86c0-23.8-30.65-32.77-44.15-13.04C48 191.85 224 200 224 288c0 35.63-29.11 64.46-64.85 63.99-35.17-.45-63.15-29.77-63.15-64.94v-85.51c0-21.7-26.47-32.23-41.43-16.5C27.8 213.16 0 261.33 0 320c0 105.87 86.13 192 192 192s192-86.13 192-192c0-170.29-168-193-168-296.14z"},child:[]}]})(t)}function vo(t){return Oe({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M622.34 153.2L343.4 67.5c-15.2-4.67-31.6-4.67-46.79 0L17.66 153.2c-23.54 7.23-23.54 38.36 0 45.59l48.63 14.94c-10.67 13.19-17.23 29.28-17.88 46.9C38.78 266.15 32 276.11 32 288c0 10.78 5.68 19.85 13.86 25.65L20.33 428.53C18.11 438.52 25.71 448 35.94 448h56.11c10.24 0 17.84-9.48 15.62-19.47L82.14 313.65C90.32 307.85 96 298.78 96 288c0-11.57-6.47-21.25-15.66-26.87.76-15.02 8.44-28.3 20.69-36.72L296.6 284.5c9.06 2.78 26.44 6.25 46.79 0l278.95-85.7c23.55-7.24 23.55-38.36 0-45.6zM352.79 315.09c-28.53 8.76-52.84 3.92-65.59 0l-145.02-44.55L128 384c0 35.35 85.96 64 192 64s192-28.65 192-64l-14.18-113.47-145.03 44.56z"},child:[]}]})(t)}function bo(t){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M320.2 243.8l-49.7 99.4c-6 12.1-23.4 11.7-28.9-.6l-56.9-126.3-30 71.7H60.6l182.5 186.5c7.1 7.3 18.6 7.3 25.7 0L451.4 288H342.3l-22.1-44.2zM473.7 73.9l-2.4-2.5c-51.5-52.6-135.8-52.6-187.4 0L256 100l-27.9-28.5c-51.5-52.7-135.9-52.7-187.4 0l-2.4 2.4C-10.4 123.7-12.5 203 31 256h102.4l35.9-86.2c5.4-12.9 23.6-13.2 29.4-.4l58.2 129.3 49-97.9c5.9-11.8 22.7-11.8 28.6 0l27.6 55.2H481c43.5-53 41.4-132.3-7.3-182.1z"},child:[]}]})(t)}function Fn(t){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"},child:[]}]})(t)}function xo(t){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 0C114.6 0 0 100.3 0 224c0 70.1 36.9 132.6 94.5 173.7 9.6 6.9 15.2 18.1 13.5 29.9l-9.4 66.2c-1.4 9.6 6 18.2 15.7 18.2H192v-56c0-4.4 3.6-8 8-8h16c4.4 0 8 3.6 8 8v56h64v-56c0-4.4 3.6-8 8-8h16c4.4 0 8 3.6 8 8v56h77.7c9.7 0 17.1-8.6 15.7-18.2l-9.4-66.2c-1.7-11.7 3.8-23 13.5-29.9C475.1 356.6 512 294.1 512 224 512 100.3 397.4 0 256 0zm-96 320c-35.3 0-64-28.7-64-64s28.7-64 64-64 64 28.7 64 64-28.7 64-64 64zm192 0c-35.3 0-64-28.7-64-64s28.7-64 64-64 64 28.7 64 64-28.7 64-64 64z"},child:[]}]})(t)}function Co(t){return Oe({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"},child:[]}]})(t)}function yo(t){return Oe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 304c0 114.9-93.1 208-208 208S16 418.9 16 304c0-104 76.3-190.2 176-205.5V64h-28c-6.6 0-12-5.4-12-12V12c0-6.6 5.4-12 12-12h120c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-28v34.5c37.5 5.8 71.7 21.6 99.7 44.6l27.5-27.5c4.7-4.7 12.3-4.7 17 0l28.3 28.3c4.7 4.7 4.7 12.3 0 17l-29.4 29.4-.6.6C419.7 223.3 432 262.2 432 304zm-176 36V188.5c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12V340c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12z"},child:[]}]})(t)}function zn(t){return Oe({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(t)}function So(t){return Oe({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111.03 8 0 119.03 0 256s111.03 248 248 248 248-111.03 248-248S384.97 8 248 8zm0 376c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32zm0-128c-53.02 0-96 42.98-96 96s42.98 96 96 96c-106.04 0-192-85.96-192-192S141.96 64 248 64c53.02 0 96 42.98 96 96s-42.98 96-96 96zm0-128c-17.67 0-32 14.33-32 32s14.33 32 32 32 32-14.33 32-32-14.33-32-32-32z"},child:[]}]})(t)}_.CLASSIC+"",_.TIME_ATTACK+"",_.SURVIVAL+"",_.ZEN+"",_.TUTORIAL+"";ee.VERY_EASY+"",ee.EASY+"",ee.MEDIUM+"",ee.HARD+"",ee.VERY_HARD+"";const kn={[_.CLASSIC]:"Juega a tu ritmo y completa todos los niveles.",[_.TIME_ATTACK]:"Acumula puntos antes que se acabe el tiempo.",[_.SURVIVAL]:"Sobrevive el mayor tiempo posible con dificultad creciente.",[_.ZEN]:"Modo relajado sin presi√≥n de tiempo ni objetivos espec√≠ficos.",[_.TUTORIAL]:"Aprende los conceptos b√°sicos del juego paso a paso."};ee.VERY_EASY+"",ee.EASY+"",ee.MEDIUM+"",ee.HARD+"",ee.VERY_HARD+"";const Et={title:{opacity:0,transform:"translateY(-20px)"},options:{opacity:0,transform:"translateY(20px)"},button:{opacity:0,transform:"scale(0.8)"}},Bn={[_.CLASSIC]:"Cl√°sico",[_.TIME_ATTACK]:"Contrarreloj",[_.SURVIVAL]:"Supervivencia",[_.ZEN]:"Zen",[_.TUTORIAL]:"Tutorial"},rt=t=>t!==null&&t===_.TUTORIAL,Pn=(t,o)=>{if(!t)return"üëà Selecciona un modo de juego para comenzar";if(rt(t))return"Aprende los conceptos b√°sicos del juego paso a paso. El tutorial te guiar√° con instrucciones simples para dominar las mec√°nicas.";if(t===_.ZEN)return"Modo relajado sin presi√≥n. Juega a tu ritmo, sin l√≠mites de tiempo ni objetivos espec√≠ficos. Perfecto para practicar y disfrutar.";if(!o)return"üëà Selecciona una dificultad para este modo";let s="";switch(t){case _.CLASSIC:s="Modo tradicional donde debes alcanzar objetivos espec√≠ficos para avanzar de nivel.";break;case _.TIME_ATTACK:s="Contrarreloj: acumula la mayor cantidad de puntos antes de que se acabe el tiempo.";break;case _.SURVIVAL:s="Sobrevive el mayor tiempo posible con dificultad creciente.";break;default:s=kn[t]}let n="";switch(o){case ee.VERY_EASY:n="Nivel muy accesible, ideal para principiantes.";break;case ee.EASY:n="Dificultad baja, buen punto de partida.";break;case ee.MEDIUM:n="Dificultad equilibrada, recomendada para la mayor√≠a de jugadores.";break;case ee.HARD:n="Desafiante, para jugadores experimentados.";break;case ee.VERY_HARD:n="Extremadamente dif√≠cil, solo para expertos.";break}return`${s} ${n}`},et=({mode:t})=>{const o=()=>{switch(t){case _.TUTORIAL:return e.jsx(vo,{className:"mode-icon tutorial-icon"});case _.CLASSIC:return e.jsx(po,{className:"mode-icon classic-icon"});case _.TIME_ATTACK:return e.jsx(yo,{className:"mode-icon timed-icon"});case _.SURVIVAL:return e.jsx(bo,{className:"mode-icon survival-icon"});case _.ZEN:return e.jsx(So,{className:"mode-icon zen-icon"});default:return null}};return e.jsx("div",{className:"mode-icon-container",children:o()})},Un=({difficulty:t})=>{const o=()=>{switch(t){case ee.VERY_EASY:return e.jsx(go,{className:"difficulty-icon very-easy-icon"});case ee.EASY:return e.jsx(Co,{className:"difficulty-icon easy-icon"});case ee.MEDIUM:return e.jsx(fo,{className:"difficulty-icon medium-icon"});case ee.HARD:return e.jsx(ho,{className:"difficulty-icon hard-icon"});case ee.VERY_HARD:return e.jsx(xo,{className:"difficulty-icon very-hard-icon"});default:return null}};return e.jsx("div",{className:"difficulty-icon-container",children:o()})},Mt=({difficulty:t,selected:o,onClick:s})=>(ee.VERY_EASY+"",ee.EASY+"",ee.MEDIUM+"",ee.HARD+"",ee.VERY_HARD+"",e.jsxs("div",{className:`difficulty-option ${t.toLowerCase().replace("_","-")} ${o?"active":""}`,onClick:s,children:[e.jsx(Un,{difficulty:t}),e.jsx("div",{className:"difficulty-shine-effect"})]})),Wt=({children:t,title:o,content:s,position:n="bottom"})=>{const[i,l]=a.useState(!1),d=a.useRef(null);return a.useEffect(()=>{const r=c=>{d.current&&!d.current.contains(c.target)&&l(!1)};return i&&document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[i]),e.jsxs("div",{className:"tooltip-container",ref:d,children:[e.jsx("div",{className:"info-icon-container",onClick:()=>l(!i),children:t||e.jsx(Fn,{className:"info-icon"})}),i&&e.jsxs("div",{className:`tooltip tooltip-${n}`,children:[e.jsxs("div",{className:"tooltip-header",children:[e.jsx("span",{className:"tooltip-title",children:o}),e.jsx("button",{className:"tooltip-close-btn",onClick:()=>l(!1),children:e.jsx(zn,{})})]}),e.jsx("div",{className:"tooltip-content",children:s})]})]})},Gn=()=>e.jsxs("div",{className:"tooltip-modes",children:[e.jsxs("div",{className:"tooltip-mode-item",children:[e.jsxs("span",{className:"tooltip-mode-name",children:[e.jsx(vo,{className:"tooltip-icon"})," Tutorial"]}),"Aprende los controles b√°sicos y mec√°nicas del juego paso a paso en un entorno seguro."]}),e.jsxs("div",{className:"tooltip-mode-item",children:[e.jsxs("span",{className:"tooltip-mode-name",children:[e.jsx(po,{className:"tooltip-icon"})," Cl√°sico"]}),"Completa niveles con objetivos espec√≠ficos. El modo tradicional para disfrutar del juego."]}),e.jsxs("div",{className:"tooltip-mode-item",children:[e.jsxs("span",{className:"tooltip-mode-name",children:[e.jsx(yo,{className:"tooltip-icon"})," Contrarreloj"]}),"Consigue la mayor puntuaci√≥n posible antes de que se acabe el tiempo. ¬°Cada segundo cuenta!"]}),e.jsxs("div",{className:"tooltip-mode-item",children:[e.jsxs("span",{className:"tooltip-mode-name",children:[e.jsx(bo,{className:"tooltip-icon"})," Supervivencia"]}),"Sobrevive el mayor tiempo posible mientras la dificultad aumenta gradualmente. El verdadero desaf√≠o."]}),e.jsxs("div",{className:"tooltip-mode-item",children:[e.jsxs("span",{className:"tooltip-mode-name",children:[e.jsx(So,{className:"tooltip-icon"})," Zen"]}),"Juega sin presi√≥n, sin l√≠mites de tiempo ni objetivos espec√≠ficos. Ideal para relajarse."]})]}),Vn=()=>e.jsxs("div",{className:"tooltip-difficulties",children:[e.jsxs("div",{className:"tooltip-difficulty-item",children:[e.jsxs("span",{className:"tooltip-difficulty-name",children:[e.jsx(go,{className:"tooltip-icon"})," Muy F√°cil"]}),"Ritmo lento con pocas piezas en pantalla. Ideal para principiantes y para aprender el juego."]}),e.jsxs("div",{className:"tooltip-difficulty-item",children:[e.jsxs("span",{className:"tooltip-difficulty-name",children:[e.jsx(Co,{className:"tooltip-icon"})," F√°cil"]}),"Un desaf√≠o ligero con movimientos predecibles. Perfecto para jugadores novatos."]}),e.jsxs("div",{className:"tooltip-difficulty-item",children:[e.jsxs("span",{className:"tooltip-difficulty-name",children:[e.jsx(fo,{className:"tooltip-icon"})," Normal"]}),"Dificultad equilibrada para la mayor√≠a de jugadores. El ritmo est√°ndar del juego."]}),e.jsxs("div",{className:"tooltip-difficulty-item",children:[e.jsxs("span",{className:"tooltip-difficulty-name",children:[e.jsx(ho,{className:"tooltip-icon"})," Dif√≠cil"]}),"Ritmo acelerado con m√°s piezas y menos tiempo. Para jugadores experimentados."]}),e.jsxs("div",{className:"tooltip-difficulty-item",children:[e.jsxs("span",{className:"tooltip-difficulty-name",children:[e.jsx(xo,{className:"tooltip-icon"})," Muy Dif√≠cil"]}),"Un verdadero reto incluso para expertos. Requiere reflejos r√°pidos y estrategia avanzada."]})]}),_n=({isVisible:t=!0,onStart:o})=>{const s=a.useRef(null),{playSound:n}=st();ro(),ke();const{gameMode:i,setGameMode:l,gameDifficulty:d,setGameDifficulty:r,isSoundEnabled:c,setIsSoundEnabled:v,isMusicEnabled:u,setIsMusicEnabled:b}=nt(),{highScore:S}=De(C=>C.game),E=!1,[O,$]=a.useState(()=>(localStorage.setItem("tutorialCompleted","true"),localStorage.getItem("tutorialCompleted")==="true")),[k,I]=a.useState(!0),[z,Q]=a.useState(!0),[H,K]=a.useState(!1),[y,F]=a.useState(null),[B,P]=a.useState(d||null),[le,pe]=a.useState([]),[q,ae]=a.useState(!1),[re,M]=a.useState([]);a.useEffect(()=>{(()=>{const x=[];for(let Z=0;Z<6;Z++){const D=Math.random()*2.5+1,J=Math.random()*100,oe=Math.random()*20+20,V=Math.random()*15;x.push(e.jsx("div",{className:"floating-star",style:{width:`${D}px`,height:`${D}px`,left:`${J}%`,opacity:0,animation:`floatStar ${oe}s linear ${V}s infinite`,backgroundColor:"#FFD700",boxShadow:"0 0 4px 1px rgba(255, 215, 0, 0.6)"}},Z))}M(x)})()},[]);const{changeGameConfig:Y}=io(),[p,N]=a.useState(Et),[T,L]=a.useState(!1),[ce,ne]=a.useState(!1),[ie,X]=a.useState("main"),[te,ue]=a.useState(E),[Ce,Te]=a.useState(E);a.useEffect(()=>{const C=()=>{const f=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${f}px`)};C(),window.addEventListener("resize",C),window.addEventListener("orientationchange",C);const x=document.querySelector(".game-selection-container");if(x){const f=Z=>{Z.stopPropagation()};return x.addEventListener("touchstart",f,{passive:!0}),x.addEventListener("touchmove",f,{passive:!0}),()=>{window.removeEventListener("resize",C),window.removeEventListener("orientationchange",C),x.removeEventListener("touchstart",f),x.removeEventListener("touchmove",f)}}return()=>{window.removeEventListener("resize",C),window.removeEventListener("orientationchange",C)}},[]),a.useEffect(()=>{y===_.TUTORIAL||y===_.ZEN||y&&B?ue(!0):ue(!1)},[y,B]),a.useEffect(()=>{let C;const x=[];return t?(L(!0),ne(!1),document.body.classList.add("modal-open"),X("play"),x.push(setTimeout(()=>{N(f=>({...f,title:{opacity:1,transform:"translateY(0)"}})),x.push(setTimeout(()=>{N(f=>({...f,options:{opacity:1,transform:"translateY(0)"}})),x.push(setTimeout(()=>{N(f=>({...f,button:{opacity:1,transform:"scale(1)"}}))},200))},200))},100))):(ne(!0),C=setTimeout(()=>{L(!1),N(Et),document.body.classList.remove("modal-open"),X("main")},300)),()=>{C&&clearTimeout(C),x.forEach(f=>clearTimeout(f)),document.body.classList.remove("modal-open"),ne(!1),N(Et),console.log("ModeSelectionModal desmontado y recursos liberados")}},[t,ie,E,O]);const ye=C=>{n("uiSelect"),X(C)},Ee=C=>{if(s.current&&!s.current.contains(C.target)&&!H){n("uiClose");const x=s.current;x.style.transform="scale(0.98)",setTimeout(()=>{x&&(x.style.transform="scale(1)")},150)}};a.useEffect(()=>(t?document.addEventListener("mousedown",Ee):document.removeEventListener("mousedown",Ee),()=>{document.removeEventListener("mousedown",Ee)}),[t,H]);const Be=()=>{if(!te||!y)return;n("uiSelect");const C=f=>{switch(f){case ee.VERY_EASY:case ee.EASY:return"easy";case ee.MEDIUM:return"normal";case ee.HARD:case ee.VERY_HARD:return"hard";default:return"normal"}},x=f=>{switch(f){case _.CLASSIC:return"classic";case _.TIME_ATTACK:return"timed";case _.SURVIVAL:return"survival";case _.ZEN:return"zen";case _.TUTORIAL:return"tutorial";default:return"classic"}};rt(y)?(console.log("Iniciando tutorial"),l(_.TUTORIAL),P(ee.EASY),Y({difficulty:"tutorial",mode:"tutorial"}),console.log("Modo de juego cambiado a tutorial - GameMode:",_.TUTORIAL),localStorage.setItem("tutorialCompleted","true"),$(!0)):y===_.ZEN?(console.log("Iniciando modo Zen"),l(_.ZEN),P(ee.EASY),Y({difficulty:"easy",mode:"zen"})):(console.log(`Iniciando modo ${y} con dificultad ${B}`),l(y),Y({difficulty:B?C(B):"easy",mode:x(y)})),ne(!0),setTimeout(()=>{o&&o();const f=document.querySelector(".game-page");f&&f.classList.add("modal-active")},500)},we=C=>{n("uiSelect"),F(C),rt(C)&&P(ee.EASY),ue(C!==null&&(rt(C)||C===_.ZEN||B!==null))},R=C=>{q||(P(C),n("uiTap"))},g=()=>{n("uiTap"),v(!c)},W=()=>{n("uiTap"),b(!u)},m=()=>e.jsxs("div",{className:"main-screen",children:[e.jsxs("div",{className:"logo-container",style:{transition:"all 0.6s ease",...p.title},children:[e.jsx("h1",{className:"logo-text",children:"Convergencia"}),e.jsx("div",{className:"logo-pulse"})]}),e.jsxs("div",{className:"main-buttons",style:{transition:"all 0.5s ease",transitionDelay:"0.3s",...p.options},children:[e.jsx("button",{className:"main-button play-button",onClick:()=>ye("play"),children:"JUGAR"}),e.jsx("button",{className:"main-button options-button",onClick:()=>ye("options"),children:"OPCIONES"}),e.jsx("button",{className:"main-button credits-button",onClick:()=>ye("credits"),children:"CR√âDITOS"})]})]}),h=()=>{const C=!O,x=E,f=y?Bn[y]:"",Z=y?Pn(y,B):"";return e.jsxs("div",{className:"play-screen",children:[re,e.jsxs("div",{className:"game-header",children:[e.jsx("button",{className:"back-button",onClick:()=>ye("main"),children:"üè†"}),e.jsx("h2",{className:"header-title",children:"Selecciona el modo de juego"}),e.jsx("div",{className:"header-spacer"})]}),e.jsxs("div",{className:"game-selection-container",children:[E,e.jsxs("div",{className:"modes-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{className:"section-title",children:"Modo de juego"}),e.jsx(Wt,{title:"Modos de Juego",content:e.jsx(Gn,{})})]}),e.jsxs("div",{className:"modes-grid",children:[C&&e.jsxs("div",{className:`game-option tutorial ${y===_.TUTORIAL?"active":""}`,onClick:()=>we(_.TUTORIAL),children:[e.jsx("div",{className:"game-option-image",children:e.jsx(et,{mode:_.TUTORIAL})}),e.jsx("div",{className:"game-option-title",children:"Tutorial"}),e.jsx("span",{className:"recommended-badge",children:"Recomendado"}),e.jsx("div",{className:"mode-shine-effect"})]}),e.jsxs("div",{className:`game-option classic ${y===_.CLASSIC?"active":""} `,onClick:()=>we(_.CLASSIC),children:[e.jsx("div",{className:"game-option-image",children:e.jsx(et,{mode:_.CLASSIC})}),e.jsx("div",{className:"game-option-title",children:"Cl√°sico"}),x,e.jsx("div",{className:"mode-shine-effect"})]}),e.jsxs("div",{className:`game-option timed ${y===_.TIME_ATTACK?"active":""} `,onClick:()=>we(_.TIME_ATTACK),children:[e.jsx("div",{className:"game-option-image",children:e.jsx(et,{mode:_.TIME_ATTACK})}),e.jsx("div",{className:"game-option-title",children:"Contrarreloj"}),x,e.jsx("div",{className:"mode-shine-effect"})]}),e.jsxs("div",{className:`game-option survival ${y===_.SURVIVAL?"active":""} `,onClick:()=>we(_.SURVIVAL),children:[e.jsx("div",{className:"game-option-image",children:e.jsx(et,{mode:_.SURVIVAL})}),e.jsx("div",{className:"game-option-title",children:"Supervivencia"}),x,e.jsx("div",{className:"mode-shine-effect"})]}),e.jsxs("div",{className:`game-option zen ${y===_.ZEN?"active":""} `,onClick:()=>we(_.ZEN),children:[e.jsx("div",{className:"game-option-image",children:e.jsx(et,{mode:_.ZEN})}),e.jsx("div",{className:"game-option-title",children:"Zen"}),x,e.jsx("div",{className:"mode-shine-effect"})]})]})]}),e.jsxs("div",{className:"difficulty-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{className:"section-title",children:"Dificultad"}),e.jsx(Wt,{title:"Niveles de Dificultad",content:e.jsx(Vn,{})})]}),e.jsxs("div",{className:"difficulty-options",children:[e.jsx(Mt,{difficulty:ee.EASY,selected:B===ee.EASY,onClick:()=>R(ee.EASY)}),e.jsx(Mt,{difficulty:ee.MEDIUM,selected:B===ee.MEDIUM,onClick:()=>R(ee.MEDIUM)}),e.jsx(Mt,{difficulty:ee.HARD,selected:B===ee.HARD,onClick:()=>R(ee.HARD)})]})]}),y&&e.jsx("div",{className:"description-section",children:e.jsxs("div",{className:"unified-description-container",children:[e.jsx("h3",{className:"mode-title",children:f?`Modo ${f}`:"Selecciona un modo"}),e.jsx("p",{children:Z})]})})]}),e.jsx("div",{className:"fixed-start-button-container",children:e.jsx("button",{className:`start-button ${y&&B?"active":"disabled"}`,onClick:Be,disabled:!y||!B,children:"¬°EMPEZAR!"})})]})},A=()=>e.jsxs("div",{className:"options-screen",children:[e.jsxs("div",{className:"screen-header",children:[e.jsx("h2",{children:"Opciones"}),e.jsx("button",{className:"back-button",onClick:()=>ye("main"),children:"‚¨ÖÔ∏è Volver"})]}),e.jsxs("div",{className:"settings-content",children:[e.jsxs("div",{className:"settings-option",children:[e.jsx("span",{children:"M√∫sica"}),e.jsx("button",{className:`setting-toggle ${u?"active":""}`,onClick:W,children:u?"ON":"OFF"})]}),e.jsxs("div",{className:"settings-option",children:[e.jsx("span",{children:"Sonido"}),e.jsx("button",{className:`setting-toggle ${c?"active":""}`,onClick:g,children:c?"ON":"OFF"})]}),e.jsxs("div",{className:"settings-option",children:[e.jsx("span",{children:"Notificaciones"}),e.jsx("div",{className:"setting-checkbox",children:"‚úì"})]})]})]}),w=()=>e.jsxs("div",{className:"credits-screen",children:[e.jsxs("div",{className:"screen-header",children:[e.jsx("h2",{children:"Cr√©ditos"}),e.jsx("button",{className:"back-button",onClick:()=>ye("main"),children:"‚¨ÖÔ∏è Volver"})]}),e.jsxs("div",{className:"credits-content",children:[e.jsx("h3",{children:"Convergencia"}),e.jsx("p",{children:"Dise√±ado y desarrollado por:"}),e.jsx("p",{className:"credits-name",children:"Equipo de Desarrollo"}),e.jsx("h4",{children:"Programaci√≥n"}),e.jsx("p",{className:"credits-name",children:"Programador Principal"}),e.jsx("h4",{children:"Dise√±o Gr√°fico"}),e.jsx("p",{className:"credits-name",children:"Artista Principal"}),e.jsx("h4",{children:"M√∫sica y Sonido"}),e.jsx("p",{className:"credits-name",children:"Compositor"}),e.jsx("h4",{children:"Agradecimientos Especiales"}),e.jsx("p",{children:"A todos los que hicieron posible este juego"}),e.jsxs("div",{className:"version-info",children:[e.jsx("p",{children:"Versi√≥n 1.0.0"}),e.jsx("p",{children:"¬© 2023 Todos los derechos reservados"})]})]})]});if(!T&&!t)return null;const G=()=>{switch(ie){case"play":return h();case"options":return A();case"credits":return w();default:return m()}};return e.jsx("div",{className:`game-modal-start start-game ${T?"visible":""} ${ce?"closing":""}`,children:e.jsx("div",{className:"modal-content",ref:s,children:e.jsx("div",{className:`start-game-body ${ie}`,children:G()})})})};var No=(t=>(t.WELCOME="welcome",t.BASIC_MECHANICS="basic_mechanics",t.CONVERGENCE="convergence",t.COMBOS="combos",t.PENALTIES="penalties",t.COMPLETION="completion",t))(No||{});const Hn=({onComplete:t})=>{const o=ke(),[s,n]=a.useState("welcome"),[i,l]=a.useState(!1),[d,r]=a.useState(!0),[c,v]=a.useState(!1),[u,b]=a.useState(!1),[S,E]=a.useState(!1),[O,$]=a.useState(!1),k=a.useRef(null),{board:I,score:z,iconCount:Q,status:H,comboCount:K,currentPlayMode:y}=De(p=>p.game),F=a.useRef(z),B=a.useRef(Q),P=a.useRef(K),le=()=>{v(!0),localStorage.setItem("tutorialCompleted","true")},pe=()=>{v(!1),t()},q=()=>{console.log("Tutorial: Ocultando temporalmente para acci√≥n"),b(!0),E(!0)},ae={welcome:{title:"¬°Bienvenido al Tutorial!",content:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"¬°Hola! Vamos a aprender juntos c√≥mo jugar a Convergence."}),e.jsx("p",{children:"En este tutorial, te ense√±ar√© las mec√°nicas b√°sicas del juego para que puedas empezar a jugar r√°pidamente."}),e.jsx("button",{className:"tutorial-button",onClick:()=>Y(),children:"Empezar"})]})},basic_mechanics:{title:"Mec√°nicas B√°sicas",content:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["El objetivo del juego es ",e.jsx("strong",{children:"eliminar iconos"})," del tablero creando ",e.jsx("strong",{children:"convergencias"}),"."]}),e.jsx("p",{children:"Una convergencia ocurre cuando 3 o m√°s iconos del mismo tipo se alinean en l√≠nea recta (horizontal, vertical o diagonal)."}),e.jsx("p",{children:"Observa el tablero y busca grupos de iconos iguales que est√©n alineados."}),e.jsx("button",{className:"tutorial-button",onClick:()=>Y(),children:"Siguiente"})]})},convergence:{title:"¬°Crea tu primera convergencia!",content:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Ahora es tu turno: ",e.jsx("strong",{children:"encuentra 3 o m√°s iconos iguales"})," que est√©n alineados y haz clic en ellos para eliminarlos."]}),e.jsx("p",{children:"Te he se√±alado un posible grupo. ¬°Prueba a hacer clic!"}),e.jsx("p",{className:"tutorial-note",children:"Debes completar esta acci√≥n para continuar."}),!u&&e.jsx("button",{className:"tutorial-button",onClick:q,children:"Entendido"})]}),waitForAction:!0,actionType:"convergence",highlightCells:re(I)},combos:{title:"¬°Sistema de Combos!",content:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"¬°Excelente! Has creado tu primera convergencia."}),e.jsxs("p",{children:["Un ",e.jsx("strong",{children:"combo"})," ocurre cuando eliminas ",e.jsx("strong",{children:"m√∫ltiples convergencias"})," en un corto periodo de tiempo."]}),e.jsx("p",{children:"Para hacer un combo, necesitas:"}),e.jsxs("ol",{children:[e.jsx("li",{children:"Eliminar una primera convergencia (que ya has hecho)"}),e.jsxs("li",{children:["Encontrar y eliminar ",e.jsx("strong",{children:"otra convergencia diferente"})," antes de que se agote el tiempo"]})]}),e.jsxs("p",{children:["Los combos multiplican tus puntos: ",e.jsx("span",{className:"combo-basic-text",children:"x1.5"}),", ",e.jsx("span",{className:"combo-uncommon-text",children:"x2.0"}),", ",e.jsx("span",{className:"combo-rare-text",children:"x3.0"})," y hasta ",e.jsx("span",{className:"combo-legendary-text",children:"x5.0"}),"."]}),e.jsxs("p",{children:["Ver√°s una ",e.jsx("strong",{children:"barra de tiempo"})," en la parte superior cuando se active un combo. ¬°Elimina otro grupo antes de que se agote!"]}),e.jsx("p",{className:"tutorial-note",children:"Debes eliminar una segunda convergencia para continuar."}),!u&&e.jsx("button",{className:"tutorial-button",onClick:q,children:"Entendido"})]}),waitForAction:!0,actionType:"combo"},penalties:{title:"Cuidado con las Penalizaciones",content:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Ten cuidado: si el tablero se llena demasiado, recibir√°s ",e.jsx("strong",{children:"penalizaciones"}),"."]}),e.jsx("p",{children:"Estas penalizaciones a√±aden m√°s iconos al tablero y dificultan el juego."}),e.jsx("p",{children:"Intenta mantener el tablero lo m√°s despejado posible."}),e.jsx("button",{className:"tutorial-button",onClick:()=>Y(),children:"Entendido"})]})},completion:{title:"¬°Tutorial Completado!",content:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"¬°Felicidades! Has completado el tutorial b√°sico de Convergence."}),e.jsx("p",{children:"Ahora conoces las mec√°nicas fundamentales del juego:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Crear convergencias alineando 3 o m√°s iconos iguales"}),e.jsx("li",{children:"Realizar combos para multiplicar tus puntos"}),e.jsx("li",{children:"Evitar penalizaciones manteniendo el tablero despejado"})]}),e.jsx("button",{className:"tutorial-button-primary",onClick:le,children:"¬°Estoy listo para jugar!"})]})}};function re(p){const N=[{rowStep:1,colStep:0},{rowStep:0,colStep:1},{rowStep:1,colStep:1},{rowStep:1,colStep:-1}],T=p.length;for(let ie=0;ie<T;ie++)for(let X=0;X<T;X++){const te=p[ie][X];if(te)for(const ue of N){const Ce=[];let Te=ie,ye=X;for(let Ee=0;Ee<5&&!(Te<0||Te>=T||ye<0||ye>=T||p[Te][ye]!==te);Ee++)Ce.push({row:Te,col:ye}),Te+=ue.rowStep,ye+=ue.colStep;if(Ce.length>=3)return console.log(`Convergencia encontrada: ${Ce.length} iconos ${te}`),Ce}}console.log("No se encontraron convergencias existentes, buscando oportunidades para crear una");const L=M(p);if(L.length>0)return console.log("Se encontr√≥ una oportunidad para crear convergencia"),L;console.log("No se encontraron convergencias potenciales, seleccionando iconos aleatorios");const ce=[];for(let ie=0;ie<T;ie++)for(let X=0;X<T;X++)p[ie][X]&&ce.push({row:ie,col:X});const ne=ce.slice(0,Math.min(3,ce.length));return console.log(`Seleccionados ${ne.length} iconos aleatorios para destacar`),ne}function M(p){const N=p.length;for(let T=0;T<N;T++)for(let L=0;L<N;L++){if(L<N-2&&p[T][L]&&p[T][L]===p[T][L+1])return[{row:T,col:L},{row:T,col:L+1}];if(T<N-2&&p[T][L]&&p[T][L]===p[T+1][L])return[{row:T,col:L},{row:T+1,col:L}];if(T<N-2&&L<N-2&&p[T][L]&&p[T][L]===p[T+1][L+1])return[{row:T,col:L},{row:T+1,col:L+1}];if(T>1&&L<N-2&&p[T][L]&&p[T][L]===p[T-1][L+1])return[{row:T,col:L},{row:T-1,col:L+1}]}return[]}const Y=()=>{const p=Object.values(No),N=p.indexOf(s);console.log(`Tutorial: Avanzando al paso ${N+1} de ${p.length}`),N<p.length-1?(n(p[N+1]),l(!1),b(!1),E(!1)):(console.log("Tutorial: Finalizando tutorial"),le())};return a.useEffect(()=>{const p=ae[s];if(p.waitForAction&&S)switch(p.actionType){case"convergence":z>F.current&&(console.log("Convergencia detectada: puntuaci√≥n aumentada"),l(!0),b(!1),E(!1));break;case"combo":K>=2?(console.log(`Combo real detectado: ${K} convergencias consecutivas`),l(!0),b(!1),E(!1),$(!1)):z>F.current&&K<2&&(console.log("Se detect√≥ una convergencia, pero no un combo. El combo requiere m√∫ltiples convergencias."),$(!0),b(!1),F.current=z);break}p.actionType==="combo"&&z>F.current&&K<2||(F.current=z),B.current=Q,P.current=K},[z,Q,K,s,ae,S]),a.useEffect(()=>{if(i){const p=setTimeout(()=>{Y()},1500);return()=>clearTimeout(p)}},[i]),a.useEffect(()=>{const p=ae[s].highlightCells;if(p&&p.length>0){const N=document.querySelectorAll(".game-cell"),T=I.length;N.forEach(L=>{L.classList.remove("tutorial-highlight-pulse"),document.querySelectorAll(".cell-click-indicator").forEach(ne=>ne.remove())}),p.forEach(({row:L,col:ce})=>{const ne=L*T+ce;if(N[ne]&&(N[ne].classList.add("tutorial-highlight-pulse"),ae[s].waitForAction)){const ie=document.createElement("div");ie.className="cell-click-indicator",ie.textContent="¬°Clic aqu√≠!",N[ne].appendChild(ie)}}),o(Me(p))}else o(Me([]));return()=>{document.querySelectorAll(".game-cell").forEach(L=>{L.classList.remove("tutorial-highlight-pulse")}),document.querySelectorAll(".cell-click-indicator").forEach(L=>L.remove()),o(Me([]))}},[s,o,I,u]),a.useEffect(()=>{y!=="tutorial"&&H==="playing"&&console.warn("GameTutorial: No estamos en modo tutorial pero el componente est√° activo")},[y,H]),a.useEffect(()=>{if(O){const p=setTimeout(()=>{$(!1)},5e3);return()=>clearTimeout(p)}},[O]),a.useEffect(()=>(console.log("GameTutorial: Componente montado y visible"),()=>{console.log("GameTutorial: Componente desmontado")}),[]),e.jsxs(e.Fragment,{children:[d&&!u&&e.jsx("div",{className:`tutorial-overlay ${ae[s].waitForAction?"interactive":""}`,ref:k,children:e.jsxs("div",{className:"tutorial-card",children:[e.jsx("h2",{className:"tutorial-title",children:ae[s].title}),e.jsx("div",{className:"tutorial-content",children:ae[s].content}),O&&s==="combos"&&e.jsxs("div",{className:"tutorial-help-message",children:[e.jsxs("p",{children:["¬°Bien! Has eliminado una convergencia, pero un combo requiere eliminar ",e.jsx("strong",{children:"varias convergencias seguidas"}),"."]}),e.jsxs("p",{children:["Busca y elimina ",e.jsx("strong",{children:"otro grupo de iconos"})," antes de que se agote el tiempo."]})]}),i&&ae[s].waitForAction&&e.jsx("div",{className:"tutorial-success-message",children:"¬°Perfecto! Avanzando al siguiente paso..."})]})}),u&&e.jsxs("div",{className:"tutorial-mini-button",onClick:()=>b(!1),children:[e.jsx("span",{className:"tutorial-mini-icon",children:"‚ùì"}),e.jsx("span",{children:"Mostrar Tutorial"})]}),c&&e.jsx("div",{className:"tutorial-completion-modal",children:e.jsxs("div",{className:"tutorial-completion-content",children:[e.jsx("h2",{children:"¬°Felicidades!"}),e.jsx("p",{children:"Has completado el tutorial b√°sico de Convergence."}),e.jsx("p",{children:"Ahora tienes los conocimientos necesarios para jugar a todos los modos de juego."}),e.jsx("p",{children:"¬°Divi√©rtete jugando y mejorando tus habilidades!"}),e.jsx("button",{className:"tutorial-completion-button",onClick:pe,children:"¬°Vamos a jugar!"})]})})]})},qn=({performanceThreshold:t=30})=>{const[o,s]=a.useState(null),n=a.useRef({frames:0,lastTime:performance.now(),samples:[]});a.useEffect(()=>{let l,d;const r=()=>{n.current.frames++,l=requestAnimationFrame(r)};return l=requestAnimationFrame(r),d=setInterval(()=>{const c=performance.now(),v=c-n.current.lastTime;if(v<200)return;const u=Math.round(n.current.frames*1e3/v);s(u),n.current.samples.push(u),n.current.samples.length>5&&n.current.samples.shift(),n.current.frames=0,n.current.lastTime=c},1e3),()=>{cancelAnimationFrame(l),clearInterval(d)}},[]);const i=()=>o?o>=t?"var(--color-success)":o>=t/2?"var(--color-warning)":"var(--color-danger)":"var(--color-text-secondary)";return e.jsx("div",{className:"fps-counter",children:e.jsx("span",{style:{color:i()},children:o?`${o} FPS`:"Calculando..."})})},wt={title:{opacity:0,transform:"translateY(-20px)"},content:{opacity:0,transform:"translateY(20px)"},buttons:{opacity:0,transform:"scale(0.8)"}},Yn=({isVisible:t=!1,onResume:o,onRestart:s,onExit:n,onSettings:i})=>{const{level:l,score:d,highScore:r,currentPlayMode:c,currentDifficulty:v}=De(B=>B.game),{playSound:u}=st(),b=a.useRef(null),[S,E]=a.useState(wt),[O,$]=a.useState(!1),[k,I]=a.useState(!1);a.useEffect(()=>{const B=()=>{const P=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${P}px`)};return B(),window.addEventListener("resize",B),window.addEventListener("orientationchange",B),window.addEventListener("load",B),()=>{window.removeEventListener("resize",B),window.removeEventListener("orientationchange",B),window.removeEventListener("load",B)}},[]),a.useEffect(()=>{let B;const P=[];return t?($(!0),I(!1),document.body.classList.add("modal-open"),u("uiOpen"),P.push(setTimeout(()=>{E(le=>({...le,title:{opacity:1,transform:"translateY(0)"}})),P.push(setTimeout(()=>{E(le=>({...le,content:{opacity:1,transform:"translateY(0)"}})),P.push(setTimeout(()=>{E(le=>({...le,buttons:{opacity:1,transform:"scale(1)"}}))},200))},200))},100))):(I(!0),B=setTimeout(()=>{$(!1),E(wt),document.body.classList.remove("modal-open")},300)),()=>{B&&clearTimeout(B),P.forEach(le=>clearTimeout(le)),document.body.classList.remove("modal-open"),I(!1),E(wt),console.log("PauseModal desmontado y recursos liberados")}},[t,u]);const z=()=>{o&&(I(!0),u("uiClick"),setTimeout(()=>{$(!1),o()},300))},Q=()=>{s&&(I(!0),u("uiClick"),setTimeout(()=>{$(!1),s()},300))},H=()=>{n&&(I(!0),u("uiClick"),setTimeout(()=>{$(!1),n()},300))},K=()=>{i&&(u("uiClick"),i())},y=()=>{switch(c){case"classic":return"Cl√°sico";case"timed":return"Contrarreloj";case"survival":return"Supervivencia";case"zen":return"Zen";default:return"Cl√°sico"}},F=()=>{switch(v){case"easy":return"F√°cil";case"normal":return"Normal";case"hard":return"Dif√≠cil";case"tutorial":return"Tutorial";default:return"Normal"}};return!O&&!t?null:e.jsx("div",{className:`game-modal fullscreen-modal ${O?"visible":""} ${k?"closing":""}`,children:e.jsxs("div",{className:"modal-content pause-content",ref:b,children:[e.jsxs("div",{className:"pause-header",style:{transition:"all 0.6s ease",...S.title},children:[e.jsx("h1",{children:"Juego en Pausa"}),e.jsx("h2",{children:"¬°T√≥mate un descanso!"})]}),e.jsx("div",{className:"pause-body",style:{transition:"all 0.5s ease",transitionDelay:"0.2s",...S.content},children:e.jsxs("div",{className:"game-status-info",children:[e.jsxs("div",{className:"info-row",children:[e.jsx("div",{className:"info-label",children:"Nivel"}),e.jsx("div",{className:"info-value",children:l})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("div",{className:"info-label",children:"Puntuaci√≥n"}),e.jsx("div",{className:"info-value",children:d})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("div",{className:"info-label",children:"R√©cord"}),e.jsx("div",{className:"info-value",children:r})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("div",{className:"info-label",children:"Modo"}),e.jsx("div",{className:"info-value",children:y()})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("div",{className:"info-label",children:"Dificultad"}),e.jsx("div",{className:"info-value",children:F()})]})]})}),e.jsxs("div",{className:"pause-buttons",style:{transition:"all 0.4s ease",transitionDelay:"0.4s",...S.buttons},children:[e.jsx("button",{className:"pause-button resume-button",onClick:z,children:"‚ñ∂Ô∏è Reanudar"}),e.jsxs("div",{className:"secondary-buttons",children:[e.jsx("button",{className:"pause-button secondary restart-button",onClick:Q,children:"üîÑ Reiniciar"}),e.jsx("button",{className:"pause-button secondary settings-button",onClick:K,children:"‚öôÔ∏è Ajustes"}),e.jsx("button",{className:"pause-button secondary exit-button",onClick:H,children:"üè† Salir"})]})]})]})})};let gt;try{gt=require("./BASE_MODE_CONFIG").BASE_MODE_CONFIG}catch{gt={classic:{baseSpawnRate:2e3,spawnRateDecrement:100,minSpawnRate:500,scoreMultiplier:1},timed:{baseSpawnRate:1500,spawnRateDecrement:150,minSpawnRate:400,scoreMultiplier:1.2},survival:{baseSpawnRate:1800,spawnRateDecrement:120,minSpawnRate:450,scoreMultiplier:.8},zen:{baseSpawnRate:2500,spawnRateDecrement:50,minSpawnRate:600,scoreMultiplier:.5}},j.warn("LevelSystem","No se pudo importar BASE_MODE_CONFIG, usando valores por defecto")}function Wn(){try{j.info("LevelSystem","Migrando configuraci√≥n existente al nuevo sistema de niveles");const t={};for(let s=1;s<=10;s++)t[s]=Tt(s);const o=Bo;if(ot&&ot.length>0){j.info("LevelSystem","El sistema de niveles ya est√° inicializado");return}j.info("LevelSystem","Migraci√≥n completada correctamente")}catch(t){j.error("LevelSystem",`Error al migrar configuraci√≥n: ${t}`)}}function Jn(){try{return j.info("LevelSystem","Inicializando sistema de niveles"),Wn(),j.info("LevelSystem","Sistema de niveles inicializado correctamente"),{predefinedLevels:ot?ot.length:0,difficulties:$t?Object.keys($t):["easy","normal","hard","tutorial"],modes:gt?Object.keys(gt):["classic","timed","survival","zen"]}}catch(t){return j.error("LevelSystem",`Error al inicializar sistema de niveles: ${t}`),{predefinedLevels:0,difficulties:["easy","normal","hard","tutorial"],modes:["classic","timed","survival","zen"]}}}const Jt=25,Zn=1500,Kn=({stage:t,error:o,onInitComplete:s})=>{const n=ke(),[i,l]=a.useState("not_started"),[d,r]=a.useState(null),[c,v]=a.useState(!1),u=t||i,b=o||d,S=a.useRef({isRunning:!1,frameCount:0,startTime:0,samples:[],hasDecided:!1,useLiteMode:!1}),E=lo(Jt),O=a.useRef(!1),$=a.useCallback(Q=>{Q?(document.documentElement.classList.add("lite-animations"),document.documentElement.classList.add("performance-mode"),j.info("LoadingScreen","Modo de animaciones ligeras activado por FPS bajos")):(document.documentElement.classList.remove("lite-animations"),document.documentElement.classList.remove("performance-mode"),j.info("LoadingScreen","Modo de animaciones completas activado por buenos FPS")),S.current.useLiteMode=Q,E.initializeAnimations(Q)},[E]),k=a.useCallback(()=>{if(S.current.isRunning||S.current.hasDecided)return;S.current.isRunning=!0,S.current.startTime=performance.now(),S.current.frameCount=0,S.current.samples=[],j.info("LoadingScreen","Iniciando detecci√≥n de FPS inicial...");let Q=null;const H=()=>{S.current.frameCount++,Q=requestAnimationFrame(H)};Q=requestAnimationFrame(H);const K=setTimeout(()=>{const F=performance.now()-S.current.startTime;Q!==null&&(cancelAnimationFrame(Q),Q=null);const B=Math.round(S.current.frameCount*1e3/F);j.info("LoadingScreen",`FPS medido: ${B} (${S.current.frameCount} frames en ${F.toFixed(0)}ms)`);const P=B<=Jt;$(P),S.current.hasDecided=!0,S.current.isRunning=!1,v(!0),j.info("LoadingScreen",`Detecci√≥n de FPS completada: ${B} FPS, modo ${P?"ligero":"normal"}`)},300);return()=>{clearTimeout(K),Q!==null&&cancelAnimationFrame(Q)}},[$]);a.useEffect(()=>{if(t||O.current)return;O.current=!0;const Q=(y=!1)=>{y&&!S.current.hasDecided&&(j.warn("LoadingScreen","Usando modo de animaciones por defecto debido a timeout en FPS"),$(!1),S.current.hasDecided=!0,v(!0)),l("assets_loading"),j.info("LoadingScreen","üéµ Cargando recursos de audio y assets");try{j.info("LoadingScreen","Recursos de audio cargados")}catch(F){j.warn("LoadingScreen",`Error al cargar recursos de audio: ${F}`)}if(!E.isInitialized()){const F=S.current.useLiteMode;j.info("LoadingScreen",`Inicializando animaciones en modo: ${F?"lite":"normal"}`),E.initializeAnimations(F)}setTimeout(()=>{H()},200)},H=()=>{l("complete"),j.info("LoadingScreen","‚úÖ Inicializaci√≥n del juego completada exitosamente"),n(me("startScreen")),setTimeout(()=>{s(c,S.current.useLiteMode)},200)};return(async()=>{try{j.info("LoadingScreen","üöÄ Iniciando secuencia de inicializaci√≥n del juego"),l("system_init"),j.info("LoadingScreen","üìã Inicializando sistema de niveles"),Jn(),l("fps_detection"),j.info("LoadingScreen","üìä Comenzando detecci√≥n de FPS"),k();const y=setTimeout(()=>{c||(j.warn("LoadingScreen","Tiempo de espera para detecci√≥n de FPS agotado"),Q(!0))},Zn),F=setInterval(()=>{c&&(clearInterval(F),clearTimeout(y),Q())},100)}catch(y){const F=`Error durante la inicializaci√≥n: ${y}`;j.error("LoadingScreen",F),r(F),S.current.hasDecided||($(!1),S.current.hasDecided=!0),l("complete"),setTimeout(()=>{s(c,S.current.useLiteMode)},500)}})(),()=>{j.info("LoadingScreen","Componente de carga desmontado durante inicializaci√≥n")}},[n,k,c,t,s,$,E]);let I="Cargando...",z=0;switch(u){case"not_started":I="Preparando el juego...",z=0;break;case"system_init":I="Inicializando sistemas...",z=25;break;case"fps_detection":I="Analizando rendimiento...",z=50;break;case"assets_loading":I="Cargando recursos...",z=75;break;case"complete":I="Iniciando juego...",z=100;break}return e.jsx("div",{className:"game-loading-screen",children:e.jsxs("div",{className:"loading-content",children:[e.jsx("h2",{children:"Convergencia"}),e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{className:"loading-message",children:I}),e.jsx("div",{className:"loading-progress-container",children:e.jsx("div",{className:"loading-progress-bar",style:{width:`${z}%`}})}),b&&e.jsxs("div",{className:"loading-error",children:["Error: ",b]})]})})},ts=()=>{const t=ke();Po();const o=a.useRef(null),{playSound:s}=st(),{status:n,level:i,boardSize:l,currentPlayMode:d,currentDifficulty:r,score:c,highScore:v,darkMode:u,timer:b,spawnRate:S}=De(g=>g.game),[E,O]=a.useState(!1),[$,k]=a.useState(!1),[I,z]=a.useState(!1),{gameMode:Q,setGameMode:H,gameDifficulty:K,setGameDifficulty:y,isSoundEnabled:F,setIsSoundEnabled:B,isMusicEnabled:P,setIsMusicEnabled:le,gameState:pe}=nt(),[q,ae]=a.useState(u),[re,M]=a.useState(!0),[Y,p]=a.useState(!1),N=a.useRef(!1),T=a.useRef(!1),{stopTimers:L,startTimers:ce,initializeBoard:ne}=io();a.useRef({isRunning:!1,frameCount:0,startTime:0,samples:[],hasDecided:!1});const{toggleDarkMode:ie}=ro(),X=a.useCallback(g=>{g?(document.documentElement.classList.add("lite-animations"),document.documentElement.classList.add("performance-mode"),j.info("GamePage","Modo de animaciones ligeras activado por FPS bajos")):(document.documentElement.classList.remove("lite-animations"),document.documentElement.classList.remove("performance-mode"),j.info("GamePage","Modo de animaciones completas activado"))},[]);a.useEffect(()=>{const g=()=>{const W=window.innerWidth<=768;p(W)};return g(),window.addEventListener("resize",g),()=>{window.removeEventListener("resize",g)}},[]),a.useEffect(()=>{n==="idle"&&I&&t(me("startScreen"))},[I,t,n]),a.useEffect(()=>{M(n==="startScreen"||n==="paused"||n==="gameOver"||n==="levelCompleted")},[n]),a.useEffect(()=>{const g=()=>{const W=document.getElementById("game-board");if(W&&T.current){const m=W.parentElement;m&&so(m,W)}};return g(),window.addEventListener("resize",g),()=>{window.removeEventListener("resize",g)}},[l,Y]),a.useEffect(()=>{ae(u)},[u]),a.useEffect(()=>{const g=document.createElement("meta");g.name="viewport",g.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no",document.head.appendChild(g);const W=m=>{m.touches.length>1&&m.preventDefault()};return document.addEventListener("touchmove",W,{passive:!1}),()=>{document.removeEventListener("touchmove",W),document.head.removeChild(g)}},[]),a.useEffect(()=>{const g=o.current;if(!g)return;const W=m=>{let h=m.target;for(;h&&h!==g;){if(h.classList.contains("scrollable"))return;h=h.parentElement}m.preventDefault()};return g.addEventListener("touchmove",W,{passive:!1}),()=>{g.removeEventListener("touchmove",W)}},[]);const te=()=>{O(!1),t(me("playing"))},ue=()=>{n==="playing"?(t(me("paused")),L()):n==="paused"&&t(me("playing"))},Ce=()=>{try{T.current=!1,L(),t(yt()),t(tt());const g=St(1);t(Ze(g.icons||[])),t(me("playing")),t(Me([])),console.log("Fase 4: Inicializando tablero para el nuevo juego"),ne(l,!0,1),console.log("Fase 5: Iniciando temporizadores para el nuevo juego"),setTimeout(()=>{ce(!0),console.log("Temporizadores iniciados correctamente")},100),console.log("**********************************************************"),console.log("FIN DEL FLUJO: REINICIO DE PARTIDA COMPLETADO"),console.log(`**********************************************************
`),N.current=!1}catch(g){N.current=!1,j.error("GamePage","Error al reiniciar el juego",g),console.error("Error al reiniciar el juego:",g)}},Te=()=>{try{t(yt()),t(tt()),setTimeout(()=>{try{j.info("GamePage",`Configurando tablero para nivel ${i}`);const g=St(i);t(Ze(g.icons||[])),ne(g.size,!0,i),t(me("playing")),setTimeout(()=>{U.getState().game.status==="playing"&&(j.info("GamePage","Iniciando temporizadores para el juego"),ce())},100),N.current=!1,T.current=!0,j.info("GamePage","FIN DEL FLUJO: JUEGO INICIADO CORRECTAMENTE")}catch(g){j.error("GamePage","Error durante la inicializaci√≥n del juego",g),N.current=!1}},100)}catch(g){j.error("GamePage","Error al iniciar el juego",g),N.current=!1}},ye=()=>{L(),t(yt()),N.current=!1,T.current=!1,t(me("startScreen")),k(!1),j.info("GamePage","Volviendo a la pantalla de inicio")},Ee=()=>{if(N.current){console.warn("Ya hay una inicializaci√≥n en progreso, ignorando paso a siguiente nivel");return}N.current=!0,console.log(`
**********************************************************`),console.log("INICIO DEL FLUJO: AVANZAR AL SIGUIENTE NIVEL"),console.log(`Avanzando del nivel ${i} al nivel ${i+1}`),console.log("**********************************************************");try{L();const g=i+1;t(ut(g));const W=St(g);t(Ze(W.icons||[])),t(me("playing")),t(Me([])),console.log("Fase 4: Inicializando tablero para el nuevo nivel"),ne(l,!0,g),console.log("Fase 5: Iniciando temporizadores para el nuevo nivel"),setTimeout(()=>{ce(!0),console.log("Temporizadores iniciados correctamente")},100),F&&s("levelUp"),console.log("**********************************************************"),console.log("FIN DEL FLUJO: AVANCE AL SIGUIENTE NIVEL COMPLETADO"),console.log(`**********************************************************
`),N.current=!1}catch(g){N.current=!1,j.error("GamePage","Error al avanzar al siguiente nivel",g),console.error("Error al avanzar al siguiente nivel:",g)}},Be=()=>{t(Uo(!u)),ie()},we=()=>{n==="playing"&&t(me("paused"))},R=n==="playing";return a.useEffect(()=>{d==="tutorial"&&n==="playing"&&(console.log("Modo tutorial detectado - Activando componente de tutorial"),O(!0))},[d,n]),e.jsxs("div",{className:"game-page",ref:o,children:[e.jsx(qn,{performanceThreshold:10}),e.jsxs("div",{className:"game-container",children:[!I&&e.jsx(Kn,{onInitComplete:(g,W)=>{j.info("GamePage","Inicializaci√≥n completa detectada: "+g+", Modo Lite: "+W),setTimeout(()=>{z(!0),X(W),n==="idle"&&t(me("startScreen"))},500)}}),I&&e.jsxs(e.Fragment,{children:[R&&e.jsxs("div",{className:"game-board-section",children:[e.jsx(En,{}),e.jsx("div",{className:"game-board-container",children:e.jsx("div",{id:"game-board",children:e.jsx(Cn,{})})})]}),E&&n==="playing"&&e.jsx(Hn,{onComplete:te}),n==="startScreen"&&!$&&e.jsx(In,{isVisible:!0,onPlay:()=>k(!0),onOptions:Be,onCredits:()=>{}}),n==="startScreen"&&$&&e.jsx(_n,{isVisible:!0,onStart:()=>{k(!1),Te()}}),n==="gameOver"&&e.jsx(Mn,{isVisible:!0,onRestart:Ce,onReturnToMenu:ye}),n==="levelCompleted"&&e.jsx(wn,{isVisible:!0,onContinue:Ee,onMainMenu:ye,onClose:()=>U.dispatch(me("playing")),gameStats:{score:c,timeFormatted:"00:30",maxCombo:5,moves:20,averageSpeed:.5},levelNumber:i,nextLevel:i+1,starsEarned:3,rewards:[{type:"coins",amount:100,name:"Monedas",icon:"ü™ô",rarity:"common"},{type:"gems",amount:20,name:"Gemas",icon:"üíé",rarity:"uncommon"},{type:"xp",amount:50,name:"Experiencia",icon:"‚≠ê",rarity:"common"}]}),n==="paused"&&e.jsx(Yn,{isVisible:!0,onResume:ue,onRestart:Ce,onExit:ye,onSettings:we})]})]})]})};export{ts as default};
