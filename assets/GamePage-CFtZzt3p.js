import{c as Zt,s as U,g as Kt,I as Xt,a as dt,b as Ze,i as jo,B as Eo,d as Mo,M as wo,l as j,e as je,f as Io,h as me,r as a,k as Ke,m as ke,u as De,n as Qt,o as zt,p as It,q as vt,t as bt,v as Ae,w as To,x as $o,y as kt,z as Me,A as Ve,C as tt,D as ze,E as Re,F as eo,G as to,H as xt,J as ut,K as Ro,N as Oo,O as Tt,P as Bt,Q as Je,R as Lo,S as Ao,T as Do,U as it,V as Ge,W as oo,X as Fo,Y as zo,Z as no,j as e,_ as ko,$ as Ct,a0 as nt,a1 as _e,a2 as _,a3 as ee,a4 as Bo,a5 as Po,a6 as Uo,a7 as yt}from"./index-BZhU-SGz.js";const Rt=(t,o,s)=>t>=0&&t<s&&o>=0&&o<s,Ie=(t,o)=>(t=Math.ceil(t),o=Math.floor(o),Math.floor(Math.random()*(o-t))+t),Go=t=>{for(let o=t.length-1;o>0;o--){const s=Math.floor(Math.random()*(o+1));[t[o],t[s]]=[t[s],t[o]]}return t},Vo=(t,o,s,n=300)=>{const c=(o.toUpperCase()==="CLASSIC"?s.CLASSIC:o.toUpperCase()==="TIMED"?s.TIMED:s.SURVIVAL).initialSpawnRate;let r=0;return t<=2?r=0:t<=4?r=.15:r=.25,Math.round(Math.max(n,c*(1-r)))},ct=(t,o,s)=>{if(!t||!Array.isArray(t)||t.length===0||!s||s.length===0||o<=0)return!1;for(let n=0;n<o;n++)for(let i=0;i<o;i++)if(!(!t[n]||t[n][i]!==null)&&_o(t,n,i,o,s))return!0;return!1},_o=(t,o,s,n,i)=>{if(!t||!i||i.length===0||n<=0)return!1;const c=[{dr:-1,dc:0},{dr:0,dc:1},{dr:1,dc:0},{dr:0,dc:-1}];for(const r of i){let d=0;for(const{dr:u,dc:y}of c){let l=o+u,m=s+y;for(;Rt(l,m,n)&&!(!t[l]||t[l][m]===void 0);){if(t[l][m]!==null){if(t[l][m]===r&&(d++,d>=2))return!0;break}l+=u,m+=y}}}return!1},Ho=(t,o,s,n)=>{if(!t[o][s]||typeof t[o][s]!="string")return{hasConvergence:!1,convergingCells:[]};const i=t[o][s];if(i.includes("_removing"))return{hasConvergence:!1,convergingCells:[]};const c=[{dr:-1,dc:0},{dr:0,dc:1},{dr:1,dc:0},{dr:0,dc:-1}],r=[{row:o,col:s}],d={};for(const{dr:y,dc:l}of c){const m=`${y},${l}`;d[m]=[];let b=o+y,E=s+l;for(;Rt(b,E,n);){if(t[b][E]===i){const O={row:b,col:E};d[m].push(O),r.push(O);break}else if(t[b][E]!==null)break;b+=y,E+=l}}const u=r.length>=3;return{hasConvergence:u,convergingCells:u?r:[]}},qo=(t,o,s,n)=>{if(t[o][s]!==null)return[];const i={},c=[{dr:-1,dc:0},{dr:1,dc:0},{dr:0,dc:-1},{dr:0,dc:1}];for(const{dr:d,dc:u}of c){let y=o+d,l=s+u;for(;Rt(y,l,n);){const m=t[y][l];if(m!==null){if(m.includes("_removing"))break;i[m]||(i[m]=[]),i[m].push({row:y,col:l});break}y+=d,l+=u}}const r=[];for(const d in i)i[d].length>=2&&r.push(...i[d]);return r};var Yo={};function Wo(){const t={};let o=null,s=localStorage.getItem("soundEnabled")!=="false",n=localStorage.getItem("musicEnabled")!=="false",i=parseFloat(localStorage.getItem("soundVolume")||"0.5"),c=parseFloat(localStorage.getItem("musicVolume")||"0.3");function r(l,m){try{const b=new Audio;b.src=m,b.preload="auto",b.onerror=()=>{console.warn(`Error al cargar el sonido: ${l} (${m}). Usando sonido alternativo.`),b.src=d(l)},t[l]=b}catch(b){console.error(`Error al inicializar el sonido: ${l}`,b),t[l]=new Audio}}function d(l){const m=Yo.PUBLIC_URL||"";return{click:`${m}/public/assets/audio/pops/click.wav`,invalidMove:`${m}/public/assets/audio/negatives/error.wav`,success:`${m}/public/assets/audio/positives/bleep.wav`,levelComplete:`${m}/public/assets/audio/level-completed.wav`,gameOver:`${m}/public/assets/audio/negatives/gameover.wav`,startLevel:`${m}/public/assets/audio/pops/start.wav`,hint:`${m}/public/assets/audio/pops/hint.wav`,newIcon:`${m}/public/assets/audio/pops/pop-up.wav`,removeIcon:`${m}/public/assets/audio/pops/bubble-pop.wav`,timeBonus:`${m}/public/assets/audio/positives/time-bonus.wav`,buttonClick:`${m}/public/assets/audio/pops/click.wav`,comboSmall:`${m}/public/assets/audio/positives/bleep.wav`,comboMedium:`${m}/public/assets/audio/positives/bleep.wav`,comboLarge:`${m}/public/assets/audio/positives/bleep.wav`}[l]||`${m}/public/assets/audio/pops/click.wav`}function u(l){try{o=new Audio,o.src=l,o.loop=!0,o.volume=c,o.preload="auto",o.onerror=()=>{console.warn(`Error al cargar la m√∫sica: ${l}. Usando m√∫sica alternativa.`),o&&(o.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}}catch(m){console.error("Error al inicializar la m√∫sica",m),o=null}}try{r("success","/assets/audio/positives/bleep.wav"),r("error","/assets/audio/negatives/error.wav"),r("levelComplete","/assets/audio/level-completed.wav"),r("gameOver","/assets/audio/negatives/gameover.wav"),r("click","/assets/audio/pops/click.wav"),r("newIcon","/assets/audio/pops/pop-up.wav"),r("removeIcon","/assets/audio/pops/bubble-pop.wav"),r("hint","/assets/audio/pops/hint.wav"),r("speedUp","/assets/audio/speed-up.mp3"),r("penalty","/assets/audio/error.mp3"),r("emptyBoard","/assets/audio/positives/cartoon-sparkle.wav"),r("levelTransition","/assets/audio/positives/cartoon-sparkle.wav"),r("convergingFound","/assets/audio/positives/bell-up.wav"),r("start","/assets/audio/positives/bleep.wav"),r("pause","/assets/audio/pops/pause.wav"),r("resume","/assets/audio/pops/resume.wav"),r("invalid","/assets/audio/negatives/error.wav"),r("invalidMove","/assets/audio/negatives/error.wav"),r("timeBonus","/assets/audio/positives/time-bonus.wav"),u("/assets/audio/level-music-2.mp3")}catch(l){console.error("Error al cargar recursos de audio",l)}function y(){r("click","/sounds/ui/click.mp3"),r("start","/sounds/ui/start.mp3"),r("pause","/sounds/ui/pause.mp3"),r("resume","/sounds/ui/resume.mp3"),r("points","/sounds/game/points.mp3"),r("gameOver","/sounds/game/game_over.mp3"),r("levelComplete","/sounds/game/level_complete.mp3"),r("startLevel","/sounds/game/start_level.mp3"),r("removeIcon","/sounds/game/remove_icon.mp3"),r("newIcon","/sounds/game/new_icon.mp3"),r("invalidMove","/sounds/game/invalid_move.mp3"),r("hint","/sounds/game/hint.mp3"),r("timeBonus","/sounds/game/time_bonus.mp3"),r("speedUp","/sounds/game/speed_up.mp3"),r("convergingFound","/sounds/game/converging_found.mp3"),r("comboSmall","/sounds/game/combo_small.mp3"),r("comboMedium","/sounds/game/combo_medium.mp3"),r("comboLarge","/sounds/game/combo_large.mp3"),u("/sounds/music/game_music.mp3")}return{sounds:t,music:o,enabled:s,musicEnabled:n,volume:i,musicVolume:c,play(l){if(s)try{t[l]||(console.warn(`Sonido no encontrado: ${l}, creando uno temporal`),r(l,d(l)));const m=t[l].cloneNode();m.volume=i,m.play().catch(b=>{console.warn(`Error reproduciendo sonido ${l}:`,b)})}catch(m){console.error(`Error al reproducir sonido: ${l}`,m)}},startMusic(){if(!(!n||!o))try{o.volume=c,o.currentTime=0,o.play().catch(l=>{console.warn("Error reproduciendo m√∫sica:",l)})}catch(l){console.error("Error al iniciar m√∫sica:",l)}},stopMusic(){try{o&&(o.pause(),o.currentTime=0)}catch(l){console.error("Error al detener m√∫sica:",l)}},pauseMusic(){try{o&&o.pause()}catch(l){console.error("Error al pausar m√∫sica:",l)}},resumeMusic(){if(!(!n||!o))try{o.play().catch(l=>console.warn("Error al reanudar m√∫sica:",l))}catch(l){console.error("Error al reanudar m√∫sica:",l)}},toggleSound(){return s=!s,localStorage.setItem("soundEnabled",s.toString()),s},toggleMusic(){return n=!n,localStorage.setItem("musicEnabled",n.toString()),n&&o?o.play().catch(l=>console.warn("Error al activar m√∫sica:",l)):o&&o.pause(),n},setVolume(l){i=Math.max(0,Math.min(1,l)),localStorage.setItem("soundVolume",i.toString())},setMusicVolume(l){c=Math.max(0,Math.min(1,l)),localStorage.setItem("musicVolume",c.toString()),o&&(o.volume=c)},loadAll(){console.log("Cargando todos los sonidos del juego..."),y()}}}const se=Wo(),qe=Zt("boardUtils"),Jo=Xt.getInstance(),lt={icons:["üçé","üçá","üçä","üçì"],minCellSize:30,maxCellSize:80,cellMargin:8};function Zo(t){const o=Math.max(Eo,Math.min(Mo,t));return qe.info(`Cambiando tama√±o del tablero a ${o}x${o}`),U.dispatch(dt(o)),o}function Ko(t){return(!t||t.length===0)&&(qe.warn("Intento de establecer un array vac√≠o de iconos, usando iconos por defecto"),t=lt.icons||[]),qe.info(`Estableciendo ${t.length} iconos disponibles`),U.dispatch(Ze(t)),t}function Xo(t){const{currentDifficulty:o,currentPlayMode:s,level:n}=U.getState().game,c=Jo.getIconsForLevel(n,o,s,t).map(r=>r.display);return qe.debug(`Seleccionados ${c.length} iconos aleatorios`),c}function St(t){const{spawnRate:o,currentDifficulty:s,currentPlayMode:n}=U.getState().game,i=Kt(),c=jo(t),r=Xo(c);return Zo(i),Ko(r),qe.info(`Tablero configurado para nivel ${t}`,{tama√±o:i,velocidad:`mantenida (${o}ms)`,iconos:r.length,dificultad:s,modo:n}),{size:i,spawnRate:o,icons:r}}function so(t,o,s){if(!t||!o){qe.warn("No se pueden ajustar los visuales del tablero: elementos no encontrados");return}const{boardSize:n}=U.getState().game,{minCellSize:i=lt.minCellSize,maxCellSize:c=lt.maxCellSize,cellMargin:r=lt.cellMargin}={},d=t.clientWidth,u=t.clientHeight,y=Math.min(d,u)-20,l=y-n*r*2,m=Math.floor(l/n),b=Math.max(i||30,Math.min(c||80,m)),E=b*n+r*2*n;o.style.width=`${E}px`,o.style.height=`${E}px`,document.documentElement.style.setProperty("--cell-size",`${b}px`),document.documentElement.style.setProperty("--board-size",`${n}`),document.documentElement.style.setProperty("--cell-gap",`${r}px`),o.style.position="relative",o.style.margin="auto",qe.debug("Tablero ajustado visualmente",{containerSize:{width:d,height:u},boardSize:E,cellSize:b,cellMargin:r,availableSize:y})}const $t={easy:{spawnRate:1.3,scoreRequirement:.7,timeRequirement:.8},normal:{spawnRate:1,scoreRequirement:1,timeRequirement:1},hard:{spawnRate:.7,scoreRequirement:1.3,timeRequirement:1.2},tutorial:{spawnRate:2,scoreRequirement:.5,timeRequirement:.5}},ot=[{id:1,boardSize:5,icons:["üå∂Ô∏è","üçå","üçä","ü•ë"],spawnRate:2e3,speedMultiplier:1,penaltyIcons:1,requirements:{classic:[{type:"score",value:1500,description:"Alcanza 1500 puntos"},{type:"occupation",value:5,description:"Mant√©n ocupaci√≥n menor al 5%"}],timed:[{type:"time",value:30,description:"Sobrevive 30 segundos"}],survival:[{type:"time",value:120,description:"Sobrevive 2 minutos"}],zen:[{type:"time",value:0,description:"Juega sin presi√≥n"}]},rewards:{classic:[{type:"points",value:500,description:"Bonus de nivel"}],zen:[{type:"points",value:100,description:"Bonus de zen"}]}},{id:2,boardSize:6,icons:["üçé","üçá","üçä","üçì","üçâ"],spawnRate:1800,speedMultiplier:1.1,penaltyIcons:2,requirements:{classic:[{type:"score",value:2e3,description:"Alcanza 2000 puntos"},{type:"occupation",value:15,description:"Mant√©n ocupaci√≥n menor al 15%"}],timed:[{type:"time",value:45,description:"Sobrevive 45 segundos"}],survival:[{type:"time",value:180,description:"Sobrevive 3 minutos"}],zen:[{type:"time",value:0,description:"Juega sin presi√≥n"}]},rewards:{classic:[{type:"points",value:750,description:"Bonus de nivel"}],zen:[{type:"points",value:150,description:"Bonus de zen"}]}},{id:3,boardSize:7,icons:["üçé","üçá","üçä","üçì","üçâ","üçå"],spawnRate:1600,speedMultiplier:1.2,penaltyIcons:3,requirements:{classic:[{type:"score",value:3e3,description:"Alcanza 3000 puntos"},{type:"occupation",value:15,description:"Mant√©n ocupaci√≥n menor al 15%"}],timed:[{type:"time",value:60,description:"Sobrevive 1 minuto"}],survival:[{type:"time",value:240,description:"Sobrevive 4 minutos"}],zen:[{type:"time",value:0,description:"Juega sin presi√≥n"}]},rewards:{classic:[{type:"points",value:1e3,description:"Bonus de nivel"}],zen:[{type:"points",value:200,description:"Bonus de zen"}]},specialFeatures:{specialIcons:{type:"specialIcon",enabled:!0,config:{probability:.05,types:["bomb","star"]}}}},{id:4,boardSize:8,icons:["üçé","üçá","üçä","üçì","üçâ","üçå","üçã"],spawnRate:1400,speedMultiplier:1.3,penaltyIcons:3,requirements:{classic:[{type:"score",value:4e3,description:"Alcanza 4000 puntos"},{type:"occupation",value:15,description:"Mant√©n ocupaci√≥n menor al 15%"}],timed:[{type:"time",value:75,description:"Sobrevive 1 minuto y 15 segundos"}],survival:[{type:"time",value:300,description:"Sobrevive 5 minutos"}],zen:[{type:"time",value:0,description:"Juega sin presi√≥n"}]},rewards:{classic:[{type:"points",value:1500,description:"Bonus de nivel"},{type:"hint",value:1,description:"Pista adicional"}],zen:[{type:"points",value:300,description:"Bonus de zen"},{type:"hint",value:1,description:"Pista adicional"}]},specialFeatures:{specialIcons:{type:"specialIcon",enabled:!0,config:{probability:.07,types:["bomb","star","rainbow"]}},bonusItems:{type:"bonus",enabled:!0,config:{probability:.03,types:["points","time"]}}}},{id:5,boardSize:9,icons:["üçé","üçá","üçä","üçì","üçâ","üçå","üçã","üçç"],spawnRate:1200,speedMultiplier:1.4,penaltyIcons:4,requirements:{classic:[{type:"score",value:5e3,description:"Alcanza 5000 puntos"},{type:"occupation",value:15,description:"Mant√©n ocupaci√≥n menor al 15%"}],timed:[{type:"time",value:90,description:"Sobrevive 1 minuto y 30 segundos"}],survival:[{type:"time",value:360,description:"Sobrevive 6 minutos"}],zen:[{type:"time",value:0,description:"Juega sin presi√≥n"}]},rewards:{classic:[{type:"points",value:2e3,description:"Bonus de nivel"},{type:"hint",value:2,description:"Pistas adicionales"}],zen:[{type:"points",value:400,description:"Bonus de zen"},{type:"hint",value:1,description:"Pista adicional"}]},specialFeatures:{specialIcons:{type:"specialIcon",enabled:!0,config:{probability:.08,types:["bomb","star","rainbow","clock"]}},bonusItems:{type:"bonus",enabled:!0,config:{probability:.05,types:["points","time","hint"]}},powerUps:{type:"powerup",enabled:!0,config:{probability:.03,types:["slowdown","clear"]}}}}];function Qo(t){const n=4+Math.min(6,Math.floor((t-1)/2)),i={id:t,boardSize:Math.min(12,5+Math.floor(t/2)),icons:Array.from({length:n},(r,d)=>{const u=["üçé","üçá","üçä","üçì","üçâ","üçå","üçã","üçç","üçë","üçí"];return u[d%u.length]}),spawnRate:Math.max(500,2e3-t*100),speedMultiplier:1+t*.1,penaltyIcons:Math.min(5,1+Math.floor(t/2)),requirements:{classic:[{type:"score",value:1500*t,description:`Alcanza ${1500*t} puntos`},{type:"occupation",value:5,description:"Mant√©n ocupaci√≥n menor al 5%"}],timed:[{type:"time",value:30+t*15,description:`Sobrevive ${30+t*15} segundos`}],survival:[{type:"time",value:120+t*60,description:`Sobrevive ${(120+t*60)/60} minutos`}],zen:[{type:"time",value:0,description:"Juega sin presi√≥n"}]},rewards:{classic:[{type:"points",value:500*t,description:"Bonus de nivel"}],zen:[{type:"points",value:100*t,description:"Bonus de zen"}]}},c={};return t>=3&&(c.specialIcons={type:"specialIcon",enabled:!0,config:{probability:.7+t*.01,types:["bomb","star"]}},t>=4&&c.specialIcons.config.types.push("rainbow"),t>=5&&c.specialIcons.config.types.push("clock")),t>=4&&(c.bonusItems={type:"bonus",enabled:!0,config:{probability:.03+t*.005,types:["points","time"]}},t>=5&&c.bonusItems.config.types.push("hint")),t>=5&&(c.powerUps={type:"powerup",enabled:!0,config:{probability:.03+(t-5)*.005,types:["slowdown","clear"]}},t>=7&&c.powerUps.config.types.push("freeze"),t>=9&&c.powerUps.config.types.push("double")),t>=6&&(c.obstacles={type:"obstacle",enabled:!0,config:{probability:.02+(t-6)*.003,types:["stone"]}},t>=8&&c.obstacles.config.types.push("ice"),t>=10&&c.obstacles.config.types.push("lock")),Object.keys(c).length>0&&(i.specialFeatures=c),i}function en(t,o,s){const i=ot.find(u=>u.id===t)||Qo(t),c=$t[s],r=JSON.parse(JSON.stringify(i));r.spawnRate=Math.round(r.spawnRate*c.spawnRate),(!r.requirements[o]||r.requirements[o].length===0)&&(o==="zen"?r.requirements.zen=[{type:"time",value:0,description:"Juega sin presi√≥n"}]:o==="tutorial"?r.requirements.tutorial=[{type:"score",value:100,description:"Completa el tutorial"}]:r.requirements.classic?r.requirements[o]=[...r.requirements.classic]:r.requirements[o]=[{type:"score",value:1e3*t,description:`Alcanza ${1e3*t} puntos`}]);const d=r.requirements[o];return d&&d.forEach(u=>{u.type==="score"?(u.value=Math.round(u.value*c.scoreRequirement),u.description=`Alcanza ${u.value} puntos`):u.type==="time"&&o!=="zen"&&o!=="tutorial"&&(u.value=Math.round(u.value*c.timeRequirement),u.description=`Sobrevive ${u.value>=60?`${Math.floor(u.value/60)} minuto${u.value>=120?"s":""}`:""}${u.value%60>0?(u.value>=60?" y ":"")+`${u.value%60} segundo${u.value%60!==1?"s":""}`:""}`)}),r}Xt.getInstance();function tn(t,o,s,n,i,c,r,d,u){if(o==="zen"||!i||i<=0)return!1;try{const y=en(t,o,"normal");if(!y||!y.requirements)return!1;const m=d!==void 0&&d>=wo,b=i*i,E=n/b*100;if(u===!1){if(j.info("LevelAdapter",`No hay movimientos v√°lidos. Ocupaci√≥n: ${E.toFixed(1)}%, Iconos: ${n}`),n<=2)return j.info("LevelAdapter",`Solo quedan ${n} iconos sin movimientos v√°lidos. Nivel completado.`),U.dispatch(je(`¬°Casi has limpiado el tablero! Solo quedan ${n} iconos sin posibilidad de movimientos.`)),!0;if(E<=30)return j.info("LevelAdapter",`Pocos iconos sin movimientos (${E.toFixed(1)}%). Nivel completado.`),U.dispatch(je(`¬°Has despejado gran parte del tablero! Solo queda un ${E.toFixed(1)}% de ocupaci√≥n sin movimientos disponibles.`)),!0;j.info("LevelAdapter",`No hay movimientos pero los iconos son muchos (${E.toFixed(1)}%). Continuando juego.`)}if(o==="classic"){const O=y.requirements.classic;if(!O||!Array.isArray(O))return!1;const $=O.find(k=>k.type==="score");if($&&s>=$.value){j.info("LevelAdapter",`Nivel completado por puntuaci√≥n: ${s}/${$.value}`);const k=(U.getState().game.spawnRate/1e3).toFixed(1);return U.dispatch(je(`¬°Has alcanzado la puntuaci√≥n objetivo de ${$.value} puntos! Velocidad de aparici√≥n: ${k}s por icono.`)),!0}if(m){const k=O.find(I=>I.type==="occupation");if(k&&E<=k.value){j.info("LevelAdapter",`Nivel completado por ocupaci√≥n: ${E.toFixed(1)}%/${k.value}%`);const I=(U.getState().game.spawnRate/1e3).toFixed(1);return U.dispatch(je(`¬°Has despejado el tablero por debajo del ${k.value}% de ocupaci√≥n requerido! Ocupaci√≥n actual: ${E.toFixed(1)}%. Velocidad de aparici√≥n: ${I}s por icono.`)),!0}}return u===!1&&n===0?(j.info("LevelAdapter","Tablero completamente vac√≠o. Nivel completado."),U.dispatch(je("¬°Has limpiado completamente el tablero! Impresionante.")),!0):!1}else if(o==="timed"){if(c!==void 0&&c<=0)return U.dispatch(je(`¬°Se ha agotado el tiempo! Has conseguido ${s} puntos en el tiempo l√≠mite.`)),!0}else if(o==="survival"){if(j.info("LevelAdapter",`Verificaci√≥n de nivel en modo supervivencia. Nivel: ${t}, Iconos: ${n}, ¬øSin movimientos?: ${!u}`),n<=0){j.info("LevelAdapter","Tablero completamente vac√≠o en modo supervivencia. Nivel completado.");const O=(U.getState().game.spawnRate/1e3).toFixed(1);return U.dispatch(je(`¬°Incre√≠ble! Has limpiado completamente el tablero eliminando todos los iconos. Velocidad de aparici√≥n: ${O}s por icono.`)),!0}if(!u&&n<=2){j.info("LevelAdapter",`No hay movimientos y quedan muy pocos iconos (${n}). Nivel supervivencia completado.`);const O=(U.getState().game.spawnRate/1e3).toFixed(1);return U.dispatch(je(`¬°Excelente estrategia! Quedan solo ${n} iconos sin posibilidad de movimientos. Velocidad de aparici√≥n: ${O}s por icono.`)),!0}return!1}return!1}catch(y){return j.error("LevelAdapter","Error verificando completado de nivel:",y),!1}}const Pt=5e3,on=2,ao=(t,o,s)=>{const n=ct(t,o,s),{iconCount:i,occupationPercentage:c}=nn(t,o),r=U.getState().game,{currentPlayMode:d,currentDifficulty:u,spawnRate:y}=r;return j.info("Game",`Evaluaci√≥n de fin de nivel: Modo ${d}, ${i} iconos (${c.toFixed(1)}%)`),i===0?(sn(),!1):n?!0:i<=on?(an(i),!1):c>=100?(cn(d,u,y),!1):(j.info("Game",`No hay movimientos v√°lidos pero quedan ${i} iconos. El juego contin√∫a.`),!0)},nn=(t,o)=>{let s=0;for(let c=0;c<o;c++)for(let r=0;r<o;r++)t[c][r]!==null&&s++;const n=o*o,i=s/n*100;return{iconCount:s,occupationPercentage:i}},sn=()=>{j.info("Game","¬°VICTORIA PERFECTA! Tablero completamente vac√≠o"),He(Io(Pt)),He(je(`¬°VICTORIA PERFECTA! Has limpiado completamente el tablero. ¬°Bonus de ${Pt} puntos!`)),He(me("levelCompleted")),se.play("perfectClear")},an=t=>{j.info("Game",`Victoria normal: ${t} iconos restantes sin movimientos posibles`),He(je(`¬°Nivel completado! Solo quedan ${t} iconos sin posibilidad de convergencia.`)),He(me("levelCompleted")),se.play("levelComplete")},cn=(t,o,s)=>{j.info("Game","Game Over: Tablero completamente lleno sin movimientos posibles");const n=(s/1e3).toFixed(1),i=`El tablero est√° completamente lleno sin movimientos posibles. Modo: ${t}, Dificultad: ${o}, Velocidad: ${n}s/icono.`;He(je(i)),He(me("gameOver")),se.play("gameOver")},He=U.dispatch,ln=()=>performance.now(),rn=t=>{const o=new Date,s=o.getHours().toString().padStart(2,"0"),n=o.getMinutes().toString().padStart(2,"0"),i=o.getSeconds().toString().padStart(2,"0"),c=o.getMilliseconds().toString().padStart(3,"0");return`${s}:${n}:${i}.${c}`},Ut=()=>rn(ln()),dn={minIntervalPercentage:.25,minAbsoluteInterval:25,maxSpawningTimeout:250,maxIcons:100,maxAttempts:10,maxIconsPerRow:3,maxIconsPerColumn:3,maxConsecutiveIcons:2},un=(t,o,s=dn)=>{const n=a.useRef(!1),i=a.useRef(0),c=a.useRef(null),r=a.useCallback(()=>{n.current=!1,i.current=0,c.current&&(clearTimeout(c.current),c.current=null),j.debug("IconSpawner","Estado de spawning reiniciado")},[]),d=a.useCallback(()=>{c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{n.current&&(j.warn("IconSpawner",`Forzando reinicio de isSpawning despu√©s de ${s.maxSpawningTimeout}ms para prevenir bloqueo`),n.current=!1,c.current=null)},s.maxSpawningTimeout)},[s.maxSpawningTimeout]),u=a.useCallback(()=>{const y=Date.now(),l=new Date(y).toLocaleTimeString("es-ES",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3});console.log(`
**********************************************************`),console.log(`[${l}] INICIO DEL FLUJO: A√ëADIR ICONO ALEATORIO`);const m=U.getState().game,{board:b,boardSize:E,availableIcons:O,level:$,currentPlayMode:k}=m;if(console.log(`[${l}] Nivel: ${$}, Modo: ${k}`),console.log(`[${l}] Contador de iconos actual: ${Gt(b)}`),console.log(`[${l}] Iconos disponibles: ${O.join(", ")}`),console.log(`[${l}] Velocidad configurada: ${m.spawnRate}ms`),console.log("**********************************************************"),console.log(`[${l}] Fase 1: Marcando estado de spawning como activo`),n.current=!0,d(),m.status!=="playing"||!b||!O.length){console.log("Fase 2: Estado o tablero inv√°lidos - Cancelando spawn"),n.current=!1;return}console.log("Fase 2: Estado y tablero verificados (v√°lidos)");const I=t();if(console.log(`[${l}] Verificaci√≥n de movimientos v√°lidos: ${I?"S√ç":"NO"}`),!I&&(console.log(`[${l}] No hay movimientos v√°lidos disponibles`),!ao(b,E,O))){console.log(`[${l}] El juego ha terminado seg√∫n checkGameEndCondition`),n.current=!1;return}console.log(`[${l}] Fase 4: Buscando celdas vac√≠as para colocar nuevo icono`);const z=mn(b);if(console.log(`Celdas vac√≠as encontradas: ${z.length}`),z.length===0){console.log("Fase 5: No hay celdas vac√≠as disponibles - Tablero lleno"),console.log("Fase 6: Tablero completamente lleno - Game Over");const P=(U.getState().game.spawnRate/1e3).toFixed(1),le=U.getState().game.currentDifficulty;U.dispatch(je(`El tablero est√° completamente lleno. No hay espacio para m√°s iconos. Dificultad: ${le}, Velocidad: ${P}s/icono.`)),U.dispatch(me("gameOver")),console.log(`**********************************************************
`),n.current=!1;return}console.log("Fase 5: Seleccionando celda aleatoria y colocando icono");const Q=Math.floor(Math.random()*z.length),{row:H,col:K}=z[Q],S=O[Math.floor(Math.random()*O.length)],F=b.map(P=>[...P]);F[H][K]=S,U.dispatch(Ke(F));const B=Gt(F);console.log(`Icono ${S} colocado en [${H},${K}]. Total de iconos: ${B}`),console.log(`**********************************************************
`),n.current=!1,i.current=y},[t,d,o,s.maxSpawningTimeout]);return a.useEffect(()=>()=>{c.current&&clearTimeout(c.current)},[]),{addRandomIcon:u,isSpawningRef:n,lastIconAddedTimeRef:i,resetSpawningState:r}},Gt=t=>{let o=0;for(let s=0;s<t.length;s++)for(let n=0;n<t[s].length;n++)t[s][n]!==null&&o++;return o},mn=t=>{const o=[];for(let s=0;s<t.length;s++)for(let n=0;n<t[s].length;n++)t[s][n]===null&&o.push({row:s,col:n});return o},pn=Lo,io=()=>{const t=ke(),{board:o,iconCount:s,status:n,spawnRate:i,boardSize:c,availableIcons:r,currentPlayMode:d,currentDifficulty:u,score:y,level:l,highlightedCells:m,hintsRemaining:b,hintCooldown:E,timeRemaining:O,survivalTime:$}=De(p=>p.game),{addNotification:k}=Qt(),I=a.useRef(null),z=a.useRef(null),Q=a.useRef(!1),H=a.useRef(!1),K=a.useRef(null),S=a.useRef({}),F=a.useRef(!1),B=a.useRef(!1),P=a.useRef(null),le=a.useRef(0),pe=a.useRef(0),q=a.useCallback((p,v,A)=>{const w=`${p}-${v}`;A?S.current[w]=A:delete S.current[w]},[]),ae=a.useCallback(()=>{const p=U.getState().game,{board:v,boardSize:A,availableIcons:w}=p;return ct(v,A,w)},[]),re=(p,v,A)=>{if(p[v][A]!==null)return console.log(`[CONVERGENCE] La celda [${v},${A}] no est√° vac√≠a, saltando verificaci√≥n`),!1;const w={};[{dr:-1,dc:0,name:"arriba"},{dr:1,dc:0,name:"abajo"},{dr:0,dc:-1,name:"izquierda"},{dr:0,dc:1,name:"derecha"}].forEach(({dr:g,dc:Z,name:D})=>{let J=v+g,oe=A+Z;for(;J>=0&&J<c&&oe>=0&&oe<c;){const V=p[J][oe];if(V!==null&&!V.includes("_removing")){w[V]||(w[V]={count:0,positions:[]}),w[V].count++,w[V].positions.push({row:J,col:oe});break}J+=g,oe+=Z}});let C=!1,x=[];for(const g in w)w[g].count>=2&&(C=!0,x.push({icon:g,count:w[g].count,positions:w[g].positions}));return C&&(console.log(`[CONVERGENCE] Convergencia posible en celda [${v},${A}]:`),x.forEach(g=>{console.log(`[CONVERGENCE] - Icono ${g.icon}: ${g.count} ocurrencias en posiciones: ${JSON.stringify(g.positions)}`)})),C},M=a.useCallback((p=c,v=!1,A)=>{const{currentDifficulty:w,currentPlayMode:G,level:C,boardSize:x}=U.getState().game,g=A!==void 0?A:C;console.log(`
**********************************************************`),console.log("INICIO DEL FLUJO: INICIALIZAR TABLERO"),console.log(`Tama√±o: ${p}, Nivel: ${g}, Modo: ${G}`),console.log(`Estado: ${n}, Dificultad: ${w}`);const Z=U.getState().game.availableIcons;if(console.log(`Iconos para nivel ${g}: ${Z.join(", ").substring(0,100)}${Z.length>10?"...":""}`),console.log("**********************************************************"),g<=0||!v&&B.current&&x===p)return console.log("ADVERTENCIA: Tablero ya inicializado o condiciones no v√°lidas para inicializaci√≥n"),o;B.current=!1;const D=p||Kt(),J=Array(D).fill(null).map(()=>Array(D).fill(null)),oe=zt(w);let V;if(oe&&oe.initialIconCount!==void 0)V=oe.initialIconCount,console.log(`Usando initialIconCount de dificultad ${w}: ${V} iconos`);else{const de=Math.floor(D*D*.33);V=Math.max(12,de),console.log(`Calculando iconos iniciales: ${V} (33% del tablero)`)}if(g>=2){const de=1+(g-1)*.1;V=Math.min(Math.floor(V*de),Math.floor(D*D*.5)),console.log(`Nivel ${g}: Ajustando iconos iniciales a ${V} (incremento nivel ${de.toFixed(1)}x)`)}console.log(`Fase 1: Calculados ${V} iconos iniciales para nivel ${g}`);const Se=Math.floor(D*D*.5);V>Se&&(console.log(`Limitando iconos: ${V} > ${Se} (50% del tablero)`),V=Se),j.info(`Inicializando tablero con ${V} iconos iniciales`,`Modo: ${G}, Dificultad: ${w}, Nivel: ${g}`);const ve=Go([...Z]),he=ve[0];console.log("Fase 2: Colocando iconos iniciales garantizados");const ge=Ie(2,D-3),$e=Ie(2,D-3);J[ge][$e]=he;const be=[{dr:-1,dc:0},{dr:0,dc:1},{dr:1,dc:0},{dr:0,dc:-1}],Ye=Ie(0,4);let ht=Ie(0,4);for(;Math.abs(Ye-ht)===2;)ht=Ie(0,4);const Ot=be[Ye];J[ge+Ot.dr][$e+Ot.dc]=he;const Lt=be[ht];J[ge+Lt.dr][$e+Lt.dc]=he;let Xe=3;if(console.log(`Fase 3: Grupo inicial garantizado colocado (${Xe} iconos)`),ve.length>1&&V>=6){const de=ve[1];let fe=!1;for(let xe=0;xe<10&&!fe;xe++){const Ne=Ie(2,D-3),Le=Ie(2,D-3);if(Math.abs(Ne-ge)+Math.abs(Le-$e)>=4){J[Ne][Le]=de;const Fe=Ie(0,4);let We=Ie(0,4);for(;Math.abs(Fe-We)===2;)We=Ie(0,4);const Pe=be[Fe];J[Ne+Pe.dr][Le+Pe.dc]=de;const Ue=be[We];J[Ne+Ue.dr][Le+Ue.dc]=de,Xe+=3,fe=!0}}fe&&console.log(`Fase 4: Segundo grupo garantizado colocado (total: ${Xe} iconos)`)}console.log(`Fase 5: Colocando iconos aleatorios adicionales hasta ${V}`);let At=V*5;for(;Xe<V&&At>0;){At--;const de=Ie(0,D),fe=Ie(0,D);if(J[de][fe]===null){let xe=!1,Ne=0;for(;!xe&&Ne<10;){const Le=Ie(0,Z.length),Fe=Z[Le];J[de][fe]=Fe,re(J,de,fe)?J[de][fe]=null:(xe=!0,Xe++),Ne++}xe||(J[de][fe]=null)}}const Dt=ct(J,D,Z);if(console.log(`Fase 6: Verificaci√≥n de movimientos v√°lidos: ${Dt?"OK":"Sin movimientos"}`),!Dt){console.log("ADVERTENCIA: Tablero inicializado sin movimientos v√°lidos. Corrigiendo...");let de=!1;for(let fe=0;fe<D&&!de;fe++)for(let xe=0;xe<D&&!de;xe++)if(J[fe][xe]===null)for(const Ne of be){const Le=fe+Ne.dr,Fe=xe+Ne.dc;if(Le>=0&&Le<D&&Fe>=0&&Fe<D&&J[Le][Fe]!==null){const We=J[Le][Fe];for(const Pe of be)if(Ne.dr!==Pe.dr||Ne.dc!==Pe.dc){const Ue=fe+Pe.dr,at=xe+Pe.dc;if(Ue>=0&&Ue<D&&at>=0&&at<D&&J[Ue][at]===null){J[Ue][at]=We,de=!0,console.log(`Fase 7: Correcci√≥n aplicada, movimiento v√°lido creado en [${fe},${xe}]`);break}}if(de)break}}}let Qe=0;for(let de=0;de<D;de++)for(let fe=0;fe<D;fe++)J[de][fe]!==null&&Qe++;if(j.info(`Tablero inicializado con ${Qe} iconos`,`Objetivo: ${V}, Tama√±o tablero: ${D}x${D}, Nivel: ${g}`),console.log(`Fase 8: Tablero final con ${Qe}/${V} iconos (${(Qe/(D*D)*100).toFixed(1)}% ocupaci√≥n)`),t(Ke(J)),console.log("Fase 9: Tablero actualizado en el estado global"),t(It(Qe)),G==="classic"){const de=Je.CLASSIC.initialScoreTarget*Math.pow(Je.CLASSIC.scoreTargetMultiplier,g-1),fe=Math.max(30,Je.CLASSIC.initialOccupationTarget-g*Je.CLASSIC.occupationDecreasePerLevel);t(vt({score:Math.round(de),occupation:Math.round(fe)}))}else if(G==="timed"){const de=Je.TIMED.initialTimeLimit-(g-1)*Je.TIMED.timeDecreasePerLevel;t(bt(Math.max(30,de)))}const Ft=Vo(g,G,Ao,pn);return t(Ae(Ft)),console.log(`Fase 10: SpawnRate configurado a ${Ft}ms para nivel ${g}`),B.current=!0,console.log("Fase 11: Tablero marcado como inicializado"),(()=>{const{currentDifficulty:de,currentPlayMode:fe}=U.getState().game,xe=U.getState().game.spawnRate;console.log("[VELOCIDAD] Verificando configuraci√≥n de velocidad:"),console.log(`- SpawnRate actual: ${xe}ms`);const Ne=ce.getInitialSpeed(de,fe);console.log(`- Velocidad inicial calculada: ${Ne}ms`),xe!==Ne?(console.log(`[VELOCIDAD] Actualizando velocidad: ${xe}ms ‚Üí ${Ne}ms`),t(Ae(Ne))):console.log(`[VELOCIDAD] Manteniendo velocidad actual: ${xe}ms`)})(),(()=>{const fe=U.getState().game.currentDifficulty,xe=Re.TIME_WINDOWS[fe]||Re.TIME_WINDOWS.normal;console.log(`[COMBO CONFIG] Actualizando ventana de tiempo de combo para dificultad ${fe}: ${xe}ms`),t({type:"game/setComboTimeWindow",payload:xe}),setTimeout(()=>{const Ne=U.getState().game;console.log(`[COMBO CONFIG] Verificaci√≥n: La ventana de tiempo actual es ${Ne.comboTimeWindow}ms`)},0)})(),console.log(`**********************************************************
`),console.log(`FIN DEL FLUJO: TABLERO INICIALIZADO CORRECTAMENTE PARA NIVEL ${g}`),J},[t]),Y={maxSpawningTimeout:0},{addRandomIcon:f,isSpawningRef:N,lastIconAddedTimeRef:T,resetSpawningState:L}=un(ae,k,Y),ce=To(),ne=a.useCallback(()=>{const p=Date.now(),v=p-pe.current,{spawnRate:A,currentDifficulty:w}=U.getState().game;if(v>=3e4){const G=ce.calculateIncreasedSpeed(A,w);if(Math.abs(A-G)>=50){const C=((A-G)/A*100).toFixed(1),x=(A/1e3).toFixed(1),g=(G/1e3).toFixed(1);t(Ae(G)),pe.current=p,k({message:"¬°Aumento de velocidad!",type:"warning",icon:"‚ö°",duration:3e3,value:`${x}s ‚Üí ${g}s (${C}% m√°s r√°pido)`}),console.log(`[VELOCIDAD] Aumento autom√°tico: ${A}ms ‚Üí ${G}ms (${C}% m√°s r√°pido)`)}}},[t,k,ce]),ie=a.useCallback(()=>{pe.current=Date.now(),console.log(`[VELOCIDAD] Temporizador de aumento reiniciado en: ${new Date(pe.current).toLocaleTimeString()}`)},[]),X=a.useCallback(()=>{const p=Ut();console.log(`
[${p}] **********************************************************`),console.log(`[${p}] INICIO DEL FLUJO: DETENER TEMPORIZADORES`),console.log(`[${p}] Estado: ${n}, Temporizadores activos: ${F.current?"S√≠":"No"}`),console.log(`[${p}] **********************************************************`),F.current||j.debug("GameLogic","Los temporizadores ya estaban detenidos"),F.current=!1,I.current&&(clearInterval(I.current),I.current=null,console.log(`[${p}] Fase 1: Temporizador de tiempo de juego detenido`)),z.current&&(clearInterval(z.current),z.current=null,console.log(`[${p}] Fase 2: Temporizador de spawn de iconos detenido`)),console.log(`[${p}] Fase 3: Referencias de temporizadores reiniciadas`),console.log(`[${p}] **********************************************************`),console.log(`
[${p}] FIN DEL FLUJO: TEMPORIZADORES DETENIDOS CORRECTAMENTE`)},[n]),te=a.useCallback((p=!1)=>{const v=Ut(),A=U.getState().game,{status:w,currentPlayMode:G,level:C,spawnRate:x}=A;if(console.log(`
[${v}] **********************************************************`),console.log(`[${v}] INICIO DEL FLUJO: INICIAR TEMPORIZADORES`),console.log(`[${v}] Nivel: ${C}, SpawnRate: ${x}ms, Modo: ${G}`),console.log(`[${v}] Forzar inicio: ${p?"S√≠":"No"}, Temporizadores activos: ${F.current?"S√≠":"No"}`),console.log(`[${v}] Estado actual del juego: ${w}`),console.log(`[${v}] **********************************************************`),F.current&&!p){console.log(`[${v}] Los temporizadores ya est√°n activos.`);return}if(w!=="playing"&&!p){console.log(`[${v}] Fase 1: No se inician temporizadores porque el estado es ${w}`);return}I.current&&(console.log(`[${v}] Deteniendo temporizador de tiempo existente`),clearInterval(I.current),I.current=null),z.current&&(console.log(`[${v}] Deteniendo temporizador de √≠conos existente`),clearInterval(z.current),z.current=null),ie(),console.log("[VELOCIDAD] Temporizador de velocidad iniciado. Pr√≥ximo aumento en 30 segundos."),console.log(`[${v}] Fase 2: Referencias de temporizadores establecidas`),L(),I.current=setInterval(()=>{if(U.getState().game.status==="playing"){if(le.current++,t($o()),G==="timed"){const J=U.getState().game.timeRemaining;if(J>0&&(t(kt()),J===1)){t(je("¬°Se acab√≥ el tiempo! Modo contrarreloj finalizado.")),t(me("gameOver"));return}}G==="survival"&&t(kt()),ne()}},1e3),console.log(`[${v}] Fase 3: Temporizador de tiempo de juego iniciado`);const g=x;setTimeout(()=>{U.getState().game.status==="playing"&&f()},0);const Z=()=>{z.current&&clearInterval(z.current),z.current=setInterval(()=>{if(U.getState().game.status==="playing"){if(P.current!==x){P.current=x,Z();return}f(),j.debug("GameLogic",`Intervalo de spawn activado (${x}ms)`)}},g)};Z(),console.log(`[${v}] Fase 4: Temporizador de spawn de iconos iniciado (cada ${g}ms)`),T.current=0,P.current=g,F.current=!0,console.log(`[${v}] **********************************************************`),console.log(`[${v}] FIN DEL FLUJO: TEMPORIZADORES INICIADOS CORRECTAMENTE`)},[t,k,n,d,f,ie,L,ne]);a.useEffect(()=>()=>{X(),L()},[X,L]),a.useCallback(p=>{if(p.length===0)return;const v=o.map(w=>[...w]);t(Me(p));const A=v.map(w=>[...w]);for(const w of p){const G=A[w.row][w.col];G!==null&&(A[w.row][w.col]=`${G}_removing`)}t(Ke(A)),requestAnimationFrame(()=>{setTimeout(()=>{const w=A.map(ge=>[...ge]);let G=0;for(const ge of p)w[ge.row][ge.col]=null,G++;t(Ke(w));const{comboTimestamp:C,comboTimeWindow:x,comboMultiplier:g,comboCount:Z}=U.getState().game,D=Date.now();console.log(`
[COMBO DEBUG] ===== Inicio de an√°lisis de combo =====`),console.log(`[COMBO DEBUG] Iconos eliminados: ${G}`),console.log(`[COMBO DEBUG] Estado actual: Combo: ${Z}, Multiplicador: ${g.toFixed(1)}x`),console.log(`[COMBO DEBUG] Timestamp actual: ${D}`),console.log(`[COMBO DEBUG] Timestamp √∫ltima eliminaci√≥n: ${C}`),console.log(`[COMBO DEBUG] Ventana de tiempo: ${x}ms`);const J=C===0?0:D-C;console.log(`[COMBO DEBUG] Tiempo transcurrido: ${J}ms`),console.log(`[COMBO DEBUG] ¬øDentro de ventana de tiempo?: ${J<=x?"S√ç":"NO"}`),C===0||Z===0?(console.log("[COMBO DEBUG] Primer combo detectado, iniciando secuencia"),t(Ve())):J<=x?(console.log("[COMBO DEBUG] Tiempo dentro de ventana, incrementando combo"),t(Ve())):(console.log("[COMBO DEBUG] Tiempo fuera de ventana, reiniciando combo"),t(tt()),setTimeout(()=>{console.log("[COMBO DEBUG] Iniciando nuevo combo despu√©s del reset"),t(Ve())},0));const oe=U.getState().game,V=oe.comboMultiplier,Se=G*10*l,ve=Math.floor(Se*V);if(t(Ve(Se)),console.log(`[COMBO DEBUG] Puntos base: ${Se} (${G} iconos √ó 10 √ó nivel ${l})`),console.log(`[COMBO DEBUG] Multiplicador aplicado: ${V.toFixed(1)}x`),console.log(`[COMBO DEBUG] Puntos finales con combo: ${ve}`),t(ze(ve)),h(Se,p[0].row,p[0].col),console.log(`[COMBO DEBUG] Combo actual: ${oe.comboCount}, verificando hitos`),oe.comboCount===10){const ge=Re.MILESTONE_BONUSES[10];t(ze(ge)),console.log(`[COMBO DEBUG] ¬°HITO! Combo x10 alcanzado. +${ge} puntos extra`)}else if(oe.comboCount===20){const ge=Re.MILESTONE_BONUSES[20];t(ze(ge)),console.log(`[COMBO DEBUG] ¬°HITO! Combo x20 alcanzado. +${ge} puntos extra`)}else if(oe.comboCount===30){const ge=Re.MILESTONE_BONUSES[30];t(ze(ge)),console.log(`[COMBO DEBUG] ¬°HITO! Combo x30 alcanzado. +${ge} puntos extra`)}V>1&&(console.log(`[COMBO DEBUG] Mostrar notificaci√≥n de combo: x${oe.comboCount} (${V.toFixed(1)}x)`),V>=5?(se.play("comboLarge"),console.log("[COMBO DEBUG] Reproduciendo sonido: comboLarge")):V>=3?(se.play("comboMedium"),console.log("[COMBO DEBUG] Reproduciendo sonido: comboMedium")):V>=1.5&&(se.play("comboSmall"),console.log("[COMBO DEBUG] Reproduciendo sonido: comboSmall"))),console.log(`[COMBO DEBUG] ===== Fin de an√°lisis de combo =====
`);const he=s-G;if(t(It(he)),d==="timed"){const ge=Math.max(5,G*3);t({type:"game/addTimeBonus",payload:ge}),se.play("timeBonus"),console.log(`Bonus de tiempo a√±adido: +${ge} segundos`)}se.play("removeIcon"),h(Se,p[0].row,p[0].col)},50)})},[o,t,s,d,l]);const ue=a.useCallback((p,v)=>{so(p,v)},[]),Ce=a.useCallback(()=>{if(b<=0||E===!0)return!1;let p=!1,v=[];for(let A=0;A<c&&!p;A++)for(let w=0;w<c&&!p;w++)if(o[A][w]!==null){const G=Ho(o,A,w,c);if(G.hasConvergence){p=!0,v=G.convergingCells;break}}return p&&v.length>0?(t(eo()),t(Me(v)),se.play("hint"),K.current&&clearTimeout(K.current),K.current=setTimeout(()=>{t(Me([])),K.current=null},2e3),t(to()),!0):!1},[o,c,b,E,t]),Te=a.useCallback(()=>(X(),setTimeout(()=>{M(),t(xt()),te()},100),!0),[t,X,M,te,l]),ye=a.useCallback(()=>{t(ut(l+1)),X(),M(),t(xt()),t(me("playing"))},[t,l,M,X]);a.useEffect(()=>{if(n!=="playing"||!o||o.length===0||s===0)return;const p=setTimeout(()=>{U.getState().game.status==="playing"&&ao(o,c,r)},100);return()=>clearTimeout(p)},[o,n,c,ae,t,s]);const Ee=a.useCallback(p=>{console.log(`
**********************************************************`),console.log("INICIO DEL FLUJO: CAMBIO DE CONFIGURACI√ìN DEL JUEGO"),console.log(`Cambiando a dificultad: ${p.difficulty}, modo: ${p.mode}`),console.log("**********************************************************"),X(),B.current=!1,t(Ro(p.difficulty)),t(Oo(p.mode)),setTimeout(()=>{const{level:A,status:w}=U.getState().game,G=Tt(A);t(Ze(G));const C=Bt();t(dt(C));const x=zt(p.difficulty);if(x){const D=ce.getInitialSpeed(p.difficulty,d);console.log(`Aplicando configuraci√≥n de dificultad ${p.difficulty}:`),console.log(`- SpawnRate inicial: ${D}ms`),console.log(`- √çconos iniciales: ${x.initialIconCount}`),console.log(`- Penalizaci√≥n: ${x.penaltyIcons} √≠conos`),console.log(`- Nivel m√°ximo: ${x.maxLevel}`),t(Ae(D))}const g=Do(p.difficulty,p.mode);if(p.mode==="classic"){const D=Math.round(g.initialScoreTarget*Math.pow(g.scoreTargetMultiplier||1.5,A-1)),J=it[p.difficulty]||it.normal,oe=Math.round(D*J.scoreRequirement),V=Math.max(30,g.initialOccupationTarget-A*(g.occupationDecreasePerLevel||0));console.log(`Configurando objetivos para nivel ${A}:`),console.log(`- Puntuaci√≥n objetivo: ${oe} puntos`),console.log(`- Ocupaci√≥n objetivo: ${Math.round(V)}%`),t(vt({score:oe,occupation:Math.round(V)}))}else if(p.mode==="timed"){let D=g.initialTimeLimit-(A-1)*(g.timeDecreasePerLevel||10);const J=it[p.difficulty]||it.normal;D=Math.round(D*J.timeRequirement),console.log(`Configurando tiempo l√≠mite para nivel ${A}: ${D} segundos`),t(bt(Math.max(30,D)))}const Z=Re.TIME_WINDOWS[p.difficulty]||Re.TIME_WINDOWS.normal;console.log(`Configurando ventana de tiempo para combos: ${Z}ms`),t({type:"game/setComboTimeWindow",payload:Z}),M(C,!0),setTimeout(()=>{const D=U.getState().game;console.log("Verificaci√≥n de configuraci√≥n aplicada:"),console.log(`- Dificultad: ${D.currentDifficulty}`),console.log(`- Modo: ${D.currentPlayMode}`),console.log(`- SpawnRate: ${D.spawnRate}ms`),console.log(`- Ventana de combo: ${D.comboTimeWindow}ms`)},50),w==="playing"&&te(!0)},50),console.log("**********************************************************"),console.log("FIN DEL FLUJO: CONFIGURACI√ìN DEL JUEGO ACTUALIZADA")},[t,X,M,te,k]);a.useCallback((p,v)=>Ee({difficulty:p,mode:v}),[Ee]);const Be=()=>{if(n!=="playing"||s===0)return!1;const p=ae();return tn(l,d,y,s,c,O,$,le.current,p)},we=a.useCallback(()=>{j.info(`Configurando tablero para nivel ${l}`,`Tama√±o: ${c}, Modo: ${d}`);const p=Bt(),v=ce.calculateLevelSpeed(l+1,d,u),A=Tt(l+1);if(t(dt(p)),t(Ae(v)),t(Ze(A)),d==="classic"){const w=Ge.classic.baseScore,G=Ge.classic.scoreMultiplier,C=Math.floor(w*Math.pow(G,l)),x=Ge.classic.baseOccupation,g=Ge.classic.occupationDecrease,Z=Math.max(20,x-l*g);t(vt({score:C,occupation:Z}))}else if(d==="timed"){const w=Ge.timed.baseTime,G=Ge.timed.timeDecreasePerLevel,C=Math.max(30,w-l*G);t(bt(C))}t(xt()),j.debug("Configuraci√≥n de nuevo nivel aplicada",{nivel:l+1,tama√±oTablero:p,velocidad:v,iconos:A.length})},[d,l,t,k,u,ce]),R=a.useCallback(()=>{const{level:p,currentPlayMode:v,spawnRate:A,iconCount:w}=U.getState().game;console.log(`
**********************************************************`),console.log("INICIO DEL FLUJO: REINICIAR SISTEMAS PARA NUEVO NIVEL"),console.log(`Nivel actual: ${p}, Modo: ${v}`),console.log(`SpawnRate: ${A}ms, Iconos en tablero: ${w}`),console.log("**********************************************************"),X(),console.log("Fase 1: Temporizadores detenidos"),Q.current=!1,N.current=!1,H.current=!1,console.log("Fase 2: Referencias de estado reiniciadas"),I.current&&(clearInterval(I.current),I.current=null),z.current&&(clearInterval(z.current),z.current=null),console.log("Fase 3: Intervalos residuales limpiados");const{level:G,spawnRate:C}=U.getState().game;return console.log(`Fase 4: Estado actual obtenido: nivel=${G}, spawnRate=${C}ms`),t(Ae(C)),console.log(`Fase 5: SpawnRate actualizado a ${C}ms`),ie(),console.log("Fase 6: Contador de incremento de velocidad reiniciado"),v==="survival"&&console.log(`Fase 7: Manteniendo tiempo de supervivencia (modo ${v})`),t(Me([])),console.log("Fase 8: Celdas resaltadas limpiadas"),console.log(`**********************************************************
`),console.log("FIN DEL FLUJO: SISTEMAS REINICIADOS CORRECTAMENTE"),!0},[t,X]),h=a.useCallback((p,v,A)=>{const{comboCount:w,comboMultiplier:G,lastComboPoints:C}=U.getState().game;w>=3||k({message:"¬°Puntos!",type:"success",icon:"üí∞",duration:1e3,value:`+${p}`})},[k]),W=a.useCallback((p,v,A)=>{if(!ct(p,v,A)){let G=0;for(let g=0;g<v;g++)for(let Z=0;Z<v;Z++)p[g][Z]!==null&&G++;const C=v*v,x=G/C*100;if(G===0){t(je("¬°VICTORIA PERFECTA! Has limpiado completamente el tablero.")),t(me("levelCompleted")),se.play("perfectClear");return}if(G<=2){t(je(`¬°Nivel completado! Solo quedan ${G} iconos sin posibilidad de convergencia.`)),t(me("levelCompleted")),se.play("levelComplete");const{level:g}=U.getState().game;t(ut(g+1));return}if(x>=100){const{currentPlayMode:g,currentDifficulty:Z,spawnRate:D}=U.getState().game,J=(D/1e3).toFixed(1),oe=`El tablero est√° completamente lleno sin movimientos posibles. Modo: ${g}, Dificultad: ${Z}, Velocidad: ${J}s/icono.`;t(je(oe)),t(me("gameOver")),se.play("gameOver");return}}},[t]);return{board:o,boardSize:c,status:n,iconCount:s,level:l,score:y,highlightedCells:m,initializeBoard:M,adjustBoardSize:ue,stopTimers:X,startTimers:te,registerCellRef:q,showHint:Ce,resetCurrentLevel:Te,advanceToNextLevel:ye,resetSystemsForNewLevel:R,findConvergingIcons:a.useCallback((p,v)=>qo(o,p,v,c),[o,c]),changeGameConfig:Ee,checkLevelCompleted:Be,configureBoardForNewLevel:we,checkGameState:W}},mt=Zt("hintUtils");function fn(t,o){for(let s=0;s<o;s++)for(let n=0;n<o;n++)if(t[s][n]===null){const i=co(t,s,n,o);if(i.length>=2)return mt.debug("Encontrada posici√≥n para pista",{row:s,col:n,iconos:i}),{row:s,col:n,icons:i}}return mt.debug("No se encontr√≥ posici√≥n para pista"),null}function co(t,o,s,n){if(t[o][s]!==null)return mt.debug("findConvergingIcons: la celda no est√° vac√≠a",{row:o,col:s}),[];const i=[{dr:-1,dc:0},{dr:0,dc:1},{dr:1,dc:0},{dr:0,dc:-1}],c={};for(const{dr:d,dc:u}of i){let y=o+d,l=s+u;for(;y>=0&&y<n&&l>=0&&l<n;){if(t[y][l]!==null){const m=t[y][l];c[m]||(c[m]=[]),c[m].push({row:y,col:l,icon:m});break}y+=d,l+=u}}const r=[];for(const d in c)c[d].length>=2&&r.push(...c[d]);return r.length>=2?(mt.debug("Convergencias encontradas",{grupos:Object.keys(c).filter(d=>c[d].length>=2).length,totalIconos:r.length}),r):[]}function gn(t){return t?t.icons.map(({row:o,col:s})=>({row:o,col:s})):[]}function hn(t,o){return t>0&&!o}const Vt=(t,o)=>{if(!t)return;t.classList.add("error"),se.play("invalidMove");const s=setTimeout(()=>{t.classList.remove("error")},500);o(s)},_t=t=>{const o=document.querySelector(".game-board-grid");if(!o)return;o.classList.add("shake");const s=setTimeout(()=>{o.classList.remove("shake")},500);t(s)},vn=(t,o,s)=>{const{currentDifficulty:n}=U.getState().game,i=oo.calculatePenaltyRate(t,n);if(Math.abs(t-i)>=50){const c=((t-i)/t*100).toFixed(1);(t/1e3).toFixed(1),(i/1e3).toFixed(1),o(Ae(i)),j.info("Game",`Penalizaci√≥n de velocidad aplicada: ${t}ms ‚Üí ${i}ms (${c}% m√°s r√°pido)`)}return i},bn=(t,o,s,n,i,c,r)=>{try{se.play("invalidMove");const d=Math.min(4,Math.max(1,Math.floor(t/2)));if(d<=0||!o||!n.length)return 0;j.info("PenaltyManager",`Aplicando penalizaci√≥n: a√±adiendo ${d} iconos`);const u=[];for(let m=0;m<s;m++)for(let b=0;b<s;b++)o[m]&&o[m][b]===null&&u.push({row:m,col:b});if(u.length===0)return 0;for(let m=u.length-1;m>0;m--){const b=Math.floor(Math.random()*(m+1));[u[m],u[b]]=[u[b],u[m]]}const y=Math.min(d,u.length);let l=0;for(let m=0;m<y;m++){const b=u[m],E=n[Math.floor(Math.random()*n.length)];i(Fo({row:b.row,col:b.col,icon:E,isPenalty:!0})),l++,setTimeout(()=>{const O=c(b.row,b.col);if(O){O.classList.add("penalty-icon");const $=setTimeout(()=>{O.classList.remove("penalty-icon"),O.classList.add("penalty-fade-out");const k=setTimeout(()=>{O.classList.remove("penalty-fade-out")},500);r(k),j.info("PenaltyManager",`Animaci√≥n de penalizaci√≥n completada: [${b.row},${b.col}]`)},2e3);r($)}},50*m)}return l}catch(d){const u=d instanceof Error?d.message:String(d);return j.error("PenaltyManager",`Error al aplicar penalizaci√≥n: ${u}`),0}},xn=()=>{const t=ke(),{board:o,status:s,boardSize:n,availableIcons:i,highlightedCells:c,hintsRemaining:r,hintCooldown:d,score:u,spawnRate:y,iconCount:l,comboCount:m,comboMultiplier:b,comboTimestamp:E,comboTimeWindow:O,level:$,lastComboPoints:k}=De(R=>R.game),{addNotification:I}=Qt(),z=a.useRef({}),Q=a.useRef(null),H=a.useRef(null),K=a.useRef([]),[S,F]=a.useState(!1),[B,P]=a.useState(1),[le,pe]=a.useState(!1),q=a.useRef(!1),ae=a.useRef(null),re=a.useCallback(()=>{j.info("Deteniendo todos los temporizadores"," ["+s+"]"),Q.current&&(clearInterval(Q.current),Q.current=null),H.current&&(clearTimeout(H.current),H.current=null),K.current.forEach(R=>clearTimeout(R)),K.current=[],pe(!1),F(!1)},[]),M=a.useCallback(R=>{K.current.push(R)},[]),Y=a.useCallback((R,h)=>z.current[`${R}-${h}`]||null,[]),f=a.useCallback((R,h,W)=>{const{comboCount:p,comboMultiplier:v,lastComboPoints:A}=U.getState().game,w=p>=3,G=v.toFixed(1);if(h===void 0||W===void 0){I({message:"¬°Puntos conseguidos!",type:"success",icon:"üèÜ",duration:1500,value:`+${R}`});return}const C=Y(h,W);if(!C)return;const x=document.createElement("div");x.className="points-popup clean-style";let g="#FFFFFF",Z="";w&&(v>=5?(g="#FFD700",Z="combo-legendary-text"):v>=3?(g="#FF00FF",Z="combo-epic-text"):v>=2?(g="#9932CC",Z="combo-rare-text"):v>=1.5?(g="#1E90FF",Z="combo-uncommon-text"):(g="#FFFFFF",Z="combo-basic-text"));const D=document.documentElement.classList.contains("performance-mode");if(w){const oe=document.createElement("div");oe.className=`combo-display ${Z}`;const V=document.createElement("div");V.className="base-points-display";const Se=document.createElement("span");Se.className="base-points-text",Se.textContent=`+${R}`,Se.style.color=g;const ve=document.createElement("span");ve.className="multiplier-text",ve.textContent=` x${G}`,ve.style.color=g,D?(Se.style.animation="fadeInScaleLite 0.15s ease-out forwards",ve.style.animation="fadeInSlideRightLite 0.15s ease-out forwards",ve.style.animationDelay="0.1s"):(Se.style.animation="fadeInScale 0.2s ease-out forwards",ve.style.animation="fadeInSlideRight 0.2s ease-out forwards",ve.style.animationDelay="0.15s"),V.appendChild(Se),V.appendChild(ve),oe.appendChild(V);const he=document.createElement("div");he.className="result-display",he.style.opacity="0";const ge=Math.floor(R*v),$e=document.createElement("span");$e.className="result-text",$e.textContent=`+${ge}`,$e.style.color=g,D?(he.style.animation="resultAppearLite 0.3s ease-out forwards",he.style.animationDelay="0.6s"):(he.style.animation="resultAppear 0.4s ease-out forwards",he.style.animationDelay="0.7s");const be=document.createElement("span");be.className="combo-count",be.textContent=` (${p})`,be.style.color=g,he.appendChild($e),he.appendChild(be),oe.appendChild(he),setTimeout(()=>{V&&(V.style.animation=D?"resultFadeOutLite 0.2s ease-out forwards":"resultFadeOut 0.3s ease-out forwards")},D?550:650),x.appendChild(oe)}else{const oe=document.createElement("span");oe.className="points-value",oe.textContent=`+${R}`,D?oe.style.animation="fadeInScaleLite 0.2s ease-out forwards":oe.style.animation="fadeInScale 0.3s ease-out forwards",x.appendChild(oe)}if(x.style.top="50%",x.style.left="50%",x.style.transform="translate(-50%, -50%)",!D)for(let oe=0;oe<6;oe++){const V=document.createElement("div");V.className="points-particle",V.style.setProperty("--angle",`${oe*60}deg`),x.appendChild(V)}C.appendChild(x),w?v>=5?se.play("comboLarge"):v>=3?se.play("comboMedium"):v>=1.5?se.play("comboSmall"):se.play("points"):se.play("points");const J=setTimeout(()=>{x&&x.parentNode&&x.parentNode.removeChild(x)},1500);M(J),R>100&&I({message:"¬°Puntos conseguidos!",type:"success",icon:"üèÜ",duration:1500,value:`+${R}`})},[Y,M,I]),N=a.useCallback(()=>{I({message:"¬°Tablero limpio!",type:"success",icon:"üéâ",duration:2e3,value:"Bonificaci√≥n"});const R=document.querySelector(".game-board");if(R){const h=document.createElement("div");h.className="points-popup bonus";const W=document.createElement("span");W.className="points-value",W.textContent="100",h.appendChild(W),h.style.top="50%",h.style.left="50%",h.style.transform="translate(-50%, -50%)",R.appendChild(h),se.play("levelComplete");const p=setTimeout(()=>{h&&h.parentNode&&h.parentNode.removeChild(h)},2e3);M(p)}},[I,M]),T=a.useCallback(()=>{if(!o||o.length===0)return!1;for(let R=0;R<n;R++)for(let h=0;h<n;h++)if(o[R][h]===null&&L(R,h,i)>=2)return!0;return!1},[o,n,i]),L=a.useCallback((R,h,W)=>{if(!o)return 0;const p=[{dr:-1,dc:0},{dr:0,dc:1},{dr:1,dc:0},{dr:0,dc:-1}],v={};for(const A of W){let w=0;for(const{dr:G,dc:C}of p){let x=R+G,g=h+C;for(;x>=0&&x<n&&g>=0&&g<n;){if(o[x][g]===A){w++;break}else if(o[x][g]!==null)break;x+=G,g+=C}}w>=2&&(v[A]=w)}return Math.max(0,...Object.values(v))},[o,n]),ce=a.useCallback((R,h)=>o?co(o,R,h,n):[],[o,n]),ne=a.useCallback((R,h,W)=>new Promise(p=>{if(!R.length||!o){p(0);return}const v=o.map(C=>[...C]),A={};for(const C of R)A[C.icon]||(A[C.icon]=[]),A[C.icon].push(C);let w=[];for(const C in A)A[C].length>=2&&(w=[...w,...A[C]]);if(w.length===0){p(0);return}w.forEach(({row:C,col:x})=>{if(v[C][x]){const g=Y(C,x);v[C][x]=v[C][x]+"_removing",g&&g.classList.contains("new-icon")&&(g.classList.remove("new-icon"),console.log(`[CONVERGENCIA] Eliminar protecci√≥n de icono nuevo en [${C},${x}] para permitir eliminaci√≥n`))}}),t(Ke(v)),setTimeout(()=>se.play("convergingFound"),0);const G=setTimeout(()=>{const C=v.map(be=>be.map(Ye=>Ye&&Ye.includes("_removing")?null:Ye)),x=w.length;t(Ke(C)),t(It(l-x));const{comboTimestamp:g,comboTimeWindow:Z,comboMultiplier:D,comboCount:J,status:oe}=U.getState().game,V=Date.now();if(oe!=="playing"){console.log(`[COMBO DEBUG] Juego no est√° en estado 'playing' (${oe}). No se actualizan combos.`),p(x);return}if(console.log(`
[COMBO DEBUG] ===== Inicio de an√°lisis de combo =====`),console.log(`[COMBO DEBUG] Iconos eliminados: ${x}`),console.log(`[COMBO DEBUG] Estado actual: Combo: ${J}, Multiplicador: ${D.toFixed(1)}x`),console.log(`[COMBO DEBUG] Timestamp actual: ${V}`),console.log(`[COMBO DEBUG] Timestamp √∫ltima eliminaci√≥n: ${g}`),console.log(`[COMBO DEBUG] Ventana de tiempo: ${Z}ms`),x===0){console.log("[COMBO DEBUG] No se eliminaron iconos reales, saltando incremento de combo"),p(0);return}const Se=g===0?0:V-g;console.log(`[COMBO DEBUG] Tiempo transcurrido: ${Se}ms`),console.log(`[COMBO DEBUG] ¬øDentro de ventana de tiempo?: ${Se<=Z?"S√ç":"NO"}`),g===0||J===0?(console.log("[COMBO DEBUG] Primer combo detectado, iniciando secuencia"),t(Ve())):Se<=Z?(console.log("[COMBO DEBUG] Tiempo dentro de ventana, incrementando combo"),t(Ve())):(console.log("[COMBO DEBUG] Tiempo fuera de ventana, reiniciando combo"),t(tt()),setTimeout(()=>{console.log("[COMBO DEBUG] Iniciando nuevo combo despu√©s del reset"),t(Ve())},0));const ve=U.getState().game,he=ve.comboMultiplier,ge=x*10*$,$e=Math.floor(ge*he);if(console.log(`[COMBO DEBUG] Puntos base: ${ge} (${x} iconos √ó 10 √ó nivel ${$})`),console.log(`[COMBO DEBUG] Multiplicador aplicado: ${he.toFixed(1)}x`),console.log(`[COMBO DEBUG] Puntos finales con combo: ${$e}`),t(ze($e)),console.log(`[COMBO DEBUG] Combo actual: ${ve.comboCount}, verificando hitos`),ve.comboCount===10){const be=Re.MILESTONE_BONUSES[10];t(ze(be)),console.log(`[COMBO DEBUG] ¬°HITO! Combo x10 alcanzado. +${be} puntos extra`)}else if(ve.comboCount===20){const be=Re.MILESTONE_BONUSES[20];t(ze(be)),console.log(`[COMBO DEBUG] ¬°HITO! Combo x20 alcanzado. +${be} puntos extra`)}else if(ve.comboCount===30){const be=Re.MILESTONE_BONUSES[30];t(ze(be)),console.log(`[COMBO DEBUG] ¬°HITO! Combo x30 alcanzado. +${be} puntos extra`)}he>1&&(console.log(`[COMBO DEBUG] Combo activo: x${ve.comboCount} (${he.toFixed(1)}x)`),he>=5?(se.play("comboLarge"),console.log("[COMBO DEBUG] Reproduciendo sonido: comboLarge")):he>=3?(se.play("comboMedium"),console.log("[COMBO DEBUG] Reproduciendo sonido: comboMedium")):he>=1.5&&(se.play("comboSmall"),console.log("[COMBO DEBUG] Reproduciendo sonido: comboSmall"))),console.log(`[COMBO DEBUG] ===== Fin de an√°lisis de combo =====
`),p(x)},300);M(G)}),[o,t,l,M,Y,$]),ie=a.useCallback(()=>{I({message:"¬°Penalizaci√≥n!",type:"error",icon:"‚ö†Ô∏è",duration:2e3,value:"Velocidad aumentada"}),pe(!0);const R=setTimeout(()=>{pe(!1)},2e3);M(R)},[I,M]),X=a.useCallback(R=>{I({message:"¬°Velocidad aumentada!",type:"warning",icon:"‚ö°",duration:2500,value:`x${R}`,animateValue:!0}),P(R),F(!0);const h=setTimeout(()=>{F(!1)},2e3);M(h)},[I,M]),te=a.useCallback(()=>{t(Me([])),K.current.forEach(clearTimeout),K.current=[],pe(!1),F(!1)},[t]),ue=a.useCallback((R,h)=>{const W=Y(R,h);Vt(W,M),_t(M);const p=vn(y,t);setTimeout(()=>{X(p)},200);const v=U.getState().game.level;bn(v,o,n,i,t,Y,M)},[t,y,o,n,i,Y,M,X]),Ce=a.useCallback(()=>{se.play("speedUp");const R=no,W=R/3,p=Math.max(W,y*.9);t(Ae(p));const v=Number((R/p).toFixed(1));return setTimeout(()=>{X(v)},50),console.log(`Velocidad aumentada a ${v}x (${p}ms)`),v},[y,t,X]),Te=a.useCallback((R,h)=>{var A;const W=`${R}-${h}`;if(q.current||ae.current===W){j.debug("Interacci√≥n","handleCellClick: ignorando clic porque ya se est√° procesando otro o es un multi-clic en la misma celda");return}if(s!=="playing"){j.debug('handleCellClick: ignorando clic porque el juego no est√° en estado "playing"'," ["+s+"]");return}if(!o||!o[R]||o[R][h]!==null){j.debug("handleCellClick: celda no est√° vac√≠a"," ["+R+", "+h+"] "+((A=o==null?void 0:o[R])==null?void 0:A[h]));return}q.current=!0,ae.current=W;const p=setTimeout(()=>{q.current=!1,ae.current=null},500);M(p),c.length>0&&t(Me([])),setTimeout(()=>se.play("click"),0);const v=ce(R,h);v.length>0?ne(v,R,h).then(()=>{f(v.length*10,R,h),Y(R,h),v.length>0&&t(Me(v.map(w=>({row:w.row,col:w.col})))),t(Me([])),setTimeout(()=>{if(o.flat().every(C=>C===null)){N(),t(ze(100)),j.info("¬°Tablero vac√≠o! Completando nivel..."," ["+s+"]");const x=(y/1e3).toFixed(1);t(je(`¬°Incre√≠ble! Has limpiado completamente el tablero eliminando todos los iconos. Velocidad de aparici√≥n: ${x}s por icono.`)),t(me("levelCompleted")),se.play("levelComplete");return}const G=U.getState().game.iconCount;if(T())j.info("CONVERGENCIA","Hay movimientos v√°lidos despu√©s de eliminar. El juego contin√∫a.");else{const C=n*n,x=G/C*100;if(j.info("CONVERGENCIA",`Verificando fin de juego: ${x.toFixed(1)}% de ocupaci√≥n sin movimientos v√°lidos`),x<=30){j.info(`Pocos iconos sin convergencias (${x.toFixed(1)}%). Nivel completado.`," ["+s+"]");const g=(y/1e3).toFixed(1);t(je(`¬°Has eliminado casi todos los iconos! Solo quedan ${G} iconos sin posibilidad de convergencia. Velocidad de aparici√≥n: ${g}s por icono.`)),t(me("levelCompleted")),se.play("levelComplete")}else{j.info(`No hay movimientos v√°lidos (${x.toFixed(1)}%). Game over.`," ["+s+"]");const g=(y/1e3).toFixed(1);t(je(`El tablero tiene ${G} iconos (${x.toFixed(1)}% de ocupaci√≥n) sin movimientos v√°lidos. Velocidad: ${g}s por icono.`)),t(me("gameOver")),se.play("gameOver")}}},200)}):(se.play("invalidMove"),setTimeout(()=>{q.current=!1,ae.current=null},300),ue(R,h))},[s,o,t,ce,Y,ne,T,pe,y,c,M,n,i,Vt,_t,f,ue]),ye=a.useCallback(()=>{if(!hn(r,d)){d?j.info("showHint: pista en cooldown"," ["+s+"]"):r<=0&&j.info("showHint: no quedan pistas"," ["+s+"]");return}const R=fn(o||[],n);if(R){const h=gn(R);j.info("showHint: mostrando pista"," ["+s+`] posici√≥n: ${JSON.stringify(R)}`),t(Me(h)),se.play("hint"),t(eo()),H.current&&clearTimeout(H.current),H.current=setTimeout(()=>{t(to()),H.current=null},5e3)}else j.warn("showHint: no se encontr√≥ una posici√≥n v√°lida para la pista"," ["+s+"]")},[o,n,r,d,s,t]),Ee=a.useCallback((R,h)=>{if(!R||!h)return;const W=R.offsetWidth,p=R.offsetHeight,v=Math.min(W,p)*.9;h.style.width=`${v}px`,h.style.height=`${v}px`;const A=h.querySelector(".game-board-grid");A&&(A.style.gridTemplateColumns=`repeat(${n}, 1fr)`,A.style.gridTemplateRows=`repeat(${n}, 1fr)`)},[n]),Be=a.useCallback((R,h,W)=>{const p=`${R}-${h}`;W?z.current[p]=W:delete z.current[p]},[]),we=a.useCallback(()=>{const h=U.getState().game.currentDifficulty,W=Re.TIME_WINDOWS[h]||Re.TIME_WINDOWS.normal;console.log(`[COMBO CONFIG] Actualizando ventana de tiempo de combo para dificultad ${h}: ${W}ms`),t(zo(W)),setTimeout(()=>{const p=U.getState().game;console.log(`[COMBO CONFIG] Verificaci√≥n: La ventana de tiempo actual es ${p.comboTimeWindow}ms`)},0)},[t]);return a.useEffect(()=>{console.log("[COMBO CONFIG] Inicializando ventana de tiempo de combo"),we()},[we]),{stopTimers:re,addAnimationTimer:M,registerCellRef:Be,getCellElement:Y,hasValidMoves:T,findAdjacentSameIcons:L,findConvergingIcons:ce,removeConvergingIcons:ne,showPenaltyAlertUI:ie,showSpeedAlertUI:X,penalize:ue,increaseSpeed:Ce,handleCellClick:Te,showHint:ye,adjustBoardSize:Ee,showPointsEarned:f,showEmptyBoardBonus:N,cleanupEffects:te,showSpeedAlert:S,speedMultiplier:B,showPenaltyAlert:le,updateComboTimeWindow:we}},Cn=10,lo=(t=30)=>{const[o,s]=a.useState(!1),[n,i]=a.useState(!1),c=a.useRef(!1),r=a.useRef(!1),d=a.useRef(null);a.useEffect(()=>()=>{d.current!==null&&clearTimeout(d.current)},[]);const u=a.useCallback(m=>{if(c.current){n||(j.info("AnimationsLoader","Animaciones ya inicializadas, forzando estado a cargado"),i(!0));return}j.info("AnimationsLoader",`Cargando animaciones en modo: ${m?"lite":"normal"}`);const b=document.head,E=document.getElementById("game-animations-css");E&&E.remove();const O=document.createElement("link");O.id="game-animations-css",O.rel="stylesheet",O.type="text/css";const $=[`./src/components/game/GameBoard/styles/animations${m?"-lite":""}.css`,`/src/components/game/GameBoard/styles/animations${m?"-lite":""}.css`,`${window.location.origin}/src/components/game/GameBoard/styles/animations${m?"-lite":""}.css`,`./animations${m?"-lite":""}.css`,`/animations${m?"-lite":""}.css`];let k=0,I=$.length;const z=()=>{if(k>=I){j.error("AnimationsLoader","No se pudo cargar el archivo CSS de animaciones despu√©s de m√∫ltiples intentos"),i(!0),c.current=!0;return}O.href=$[k],j.info("AnimationsLoader",`Intentando cargar animaciones desde: ${O.href}`),k++};O.onload=()=>{j.info("AnimationsLoader",`Cargado modo de animaciones: ${m?"reducido":"completo"}`),i(!0),c.current=!0,d.current!==null&&(clearTimeout(d.current),d.current=null)},O.onerror=()=>{j.warn("AnimationsLoader",`Error al cargar animaciones desde: ${O.href}, intentando ruta alternativa...`),z()},d.current=window.setTimeout(()=>{n||(j.warn("AnimationsLoader","Timeout al cargar animaciones, marcando como cargado de todos modos"),i(!0),c.current=!0)},2e3),z(),b.appendChild(O),s(m),m?(document.documentElement.classList.add("lite-animations"),t<=Cn?document.documentElement.classList.add("performance-mode-high"):document.documentElement.classList.add("performance-mode")):(document.documentElement.classList.remove("lite-animations"),document.documentElement.classList.remove("performance-mode"),document.documentElement.classList.remove("performance-mode-high"))},[t,n]),y=a.useCallback(m=>{u(m),r.current=!0},[u]),l=a.useCallback(()=>c.current,[]);return{useLiteAnimations:o,isLoaded:n,initializeAnimations:y,isInitialized:l}},yn=()=>{const t=ke(),{board:o,boardSize:s,status:n,highlightedCells:i,currentDifficulty:c,level:r,spawnRate:d}=De(M=>M.game),{handleCellClick:u,registerCellRef:y,showHint:l,showSpeedAlertUI:m}=xn(),b=a.useRef(null),E=a.useRef(new Set),[O,$]=a.useState(!1),[k,I]=a.useState(1),[z,Q]=a.useState(!0),[H,K]=a.useState(!1);a.useRef(!1);const S=a.useCallback((M,Y)=>i.some(f=>f.row===M&&f.col===Y),[i]),F=a.useCallback(M=>M?M.includes("_removing")?{icon:M.replace("_removing",""),isRemoving:!0}:{icon:M,isRemoving:!1}:{icon:null,isRemoving:!1},[]),B=a.useCallback((M,Y)=>{var N;((N=o[M])==null?void 0:N[Y])&&se.play("click"),u(M,Y)},[u,o]),P=a.useMemo(()=>{if(!o||o.length===0||n!=="playing"&&n!=="paused")return[];const M=[],Y=!H||s<=6;for(let f=0;f<s;f++)for(let N=0;N<s;N++){const T=o[f]?o[f][N]:null;if(!T&&!Y){M.push(e.jsx("div",{className:"board-cell empty performance-mode",onClick:()=>B(f,N),"data-row":f,"data-col":N},`cell-${f}-${N}`));continue}const{icon:L,isRemoving:ce}=F(T);let ne="board-cell";S(f,N)&&(ne+=" highlighted"),ce&&(ne+=" removing"),L&&!ce&&(ne+=" has-icon"),L||(ne+=" empty"),H&&(ne+=" performance-mode");const ie=`${f}-${N}`,X=E.current||new Set;L&&!ce&&!X.has(ie)&&L&&(ne+=" new-icon",X.add(ie),setTimeout(()=>{const Ce=document.querySelector(`[data-row="${f}"][data-col="${N}"]`);Ce&&(Ce.classList.remove("new-icon"),console.log(`GameBoard: Eliminada protecci√≥n de icono nuevo en [${f},${N}]`))},H?1500:2e3),E.current=X),M.push(e.jsx("div",{className:ne,onClick:()=>B(f,N),ref:ue=>{y(f,N,ue)},"data-row":f,"data-col":N,children:L&&e.jsx("span",{className:"cell-content",children:L})},`cell-${f}-${N}`))}return M},[o,s,n,F,S,B,y,H]);a.useEffect(()=>{if(b.current){const M=b.current,Y=()=>{M.classList.add("touch-device")};return M.addEventListener("touchstart",Y,{passive:!0}),()=>{M.removeEventListener("touchstart",Y)}}},[]),a.useEffect(()=>(E.current||(E.current=new Set),()=>{E.current&&E.current.clear()}),[]),a.useCallback(M=>{t(dt(M))},[t]),a.useCallback(()=>{l()},[l]);const le=a.useCallback(M=>{const Y=Ct.MEDIUM,f=Math.round(Y/M);I(M),se.play("speedUp"),t(Ae(f)),setTimeout(()=>{m(M)},50),console.log(`Velocidad cambiada a ${M}x (${f}ms)`)},[t,m]);a.useCallback(M=>{const Y=Ct.MEDIUM,f=Number((Y/d).toFixed(1)),N=[.25,.5,.75,1,1.25,1.5,1.75,2,2.5,3,3.5,4];let T=0,L=Math.abs(N[0]-f);for(let ie=1;ie<N.length;ie++){const X=Math.abs(N[ie]-f);X<L&&(L=X,T=ie)}let ce;M==="increase"?ce=Math.min(T+1,N.length-1):ce=Math.max(T-1,0);const ne=N[ce];le(ne)},[d,le]);const[pe,q]=a.useState(!1);a.useCallback(()=>{const M=!pe;if(q(M),M)t(Ae(1e5)),se.play("pause");else{const Y=Ct.MEDIUM,f=Math.round(Y/k);t(Ae(f)),se.play("resume")}console.log(`Generaci√≥n de iconos ${M?"pausada":"reanudada"}`)},[pe,t,k]),a.useCallback(()=>{t(ut(r+1)),n!=="playing"&&t(me("playing")),console.log(`[DEV TOOLS] Avanzando al nivel ${r+1}`)},[t,r,n]),a.useMemo(()=>Number((no/d).toFixed(1)),[d]);const{useLiteAnimations:ae}=lo(15),re=a.useCallback(()=>!o||o.length===0?e.jsx("div",{className:"empty-board-message",children:"Cargando tablero..."}):n!=="playing"&&n!=="paused"?e.jsxs("div",{className:"empty-board-message",children:[n==="startScreen"&&"Selecciona la configuraci√≥n para comenzar",n==="gameOver"&&"Juego terminado",n==="levelCompleted"&&"Nivel completado",n==="idle"&&"Inicializando..."]}):e.jsx("div",{ref:b,className:`game-board-grid grid-${s}`,style:{gridTemplateColumns:`repeat(${s}, 1fr)`,gridTemplateRows:`repeat(${s}, 1fr)`},children:P}),[o,s,P,n]);return e.jsx(ko,{children:e.jsx("div",{className:`game-board-wrapper ${H?"performance-mode":""}`,children:re()})})},Sn=()=>{const{comboCount:t,comboMultiplier:o,comboTimestamp:s,comboTimeWindow:n}=De($=>$.game),[i,c]=a.useState(!1),[r,d]=a.useState(100),u=a.useRef(null),y=typeof document<"u"&&document.documentElement.classList.contains("performance-mode"),l=a.useMemo(()=>!o||o<1.5?{class:"combo-basic",icon:"üîÑ"}:o>=5?{class:"combo-legendary",icon:"‚ú®"}:o>=3?{class:"combo-epic",icon:"üî•"}:o>=2?{class:"combo-rare",icon:"üí´"}:{class:"combo-uncommon",icon:"‚ö°"},[o]),m=a.useMemo(()=>({"--angle":`${Math.floor(r/100*360)}deg`}),[r]),b=$=>$<1?"x1.0":$%1===0||$*10%10===0?`x${Math.floor($)}`:`x${$.toFixed(1)}`;if(a.useEffect(()=>{i&&t&&t>=3&&(o&&o>=5?se.play("comboLarge"):o&&o>=3?se.play("comboMedium"):o&&o>=1.5&&se.play("comboSmall"))},[i,t,o]),a.useEffect(()=>{t&&t>=3&&s>0&&c(!0)},[t,s]),a.useEffect(()=>{const $=t&&t>=3&&s>0;if(c(!!$),u.current&&(clearInterval(u.current),u.current=null),$){d(100);const k=y?100:16;u.current=setInterval(()=>{const z=Date.now()-s,H=Math.max(0,n-z)/n*100;d(H),H<=0&&(c(!1),u.current&&(clearInterval(u.current),u.current=null))},k)}return()=>{u.current&&(clearInterval(u.current),u.current=null)}},[t,s,n,y]),!i)return null;const E=t||0,O=o||1;return e.jsx("div",{className:"combo-indicator",children:e.jsxs("div",{className:`combo-orbital ${l.class} ${y?"performance-mode":""}`,children:[e.jsx("div",{className:"combo-icon",children:l.icon}),e.jsx("div",{className:"combo-timer-ring",children:e.jsx("div",{className:"combo-timer-fill",style:m})}),e.jsx("div",{className:"combo-count",children:E}),e.jsx("div",{className:"combo-multiplier",children:b(O)})]})})},Nn={tutorial:"üöÄ",easy:"üåü",normal:"üåó",hard:"üî•"},jn={classic:"Cl√°sico",timed:"Tiempo",survival:"Superv.",zen:"Zen",tutorial:"Tutorial"},En={tutorial:"Tutorial",easy:"F√°cil",normal:"Normal",hard:"Dif√≠cil"},Mn=()=>{const t=ke(),{score:o,level:s,timer:n,timeRemaining:i,survivalTime:c,currentDifficulty:r,currentPlayMode:d,status:u,spawnRate:y,highScore:l,levelScoreTarget:m,levelOccupationTarget:b,iconCount:E,boardSize:O}=De(te=>te.game),[$,k]=a.useState(!1),[I,z]=a.useState(!1),Q=a.useRef(o),H=a.useRef(s),[K,S]=a.useState(!1),[F,B]=a.useState(!1),[P,le]=a.useState(!0),pe=a.useRef(window.innerWidth<=768);a.useEffect(()=>{const te=()=>{pe.current=window.innerWidth<=768};return window.addEventListener("resize",te),()=>window.removeEventListener("resize",te)},[]),a.useEffect(()=>{if(Q.current!==o&&Q.current>0){k(!0);const te=setTimeout(()=>k(!1),300);return()=>clearTimeout(te)}Q.current=o},[o]),a.useEffect(()=>{if(H.current!==s&&H.current>0){z(!0);const te=setTimeout(()=>z(!1),300);return()=>clearTimeout(te)}H.current=s},[s]);const q=te=>{if(typeof te!="number"||isNaN(te))return"0:00";const ue=Math.floor(te/60),Ce=Math.floor(te%60);return`${ue}:${Ce<10?"0":""}${Ce}`},ae=()=>d==="timed"&&typeof i=="number"?q(i):d==="survival"&&typeof c=="number"?q(c):typeof n=="number"?q(n):"0:00",re=()=>typeof y!="number"||y<=0?"x1.0":`x${oo.getCurrentMultiplier(y,r).toFixed(1)}`,M=()=>jn[d]||"Cl√°sico",Y=a.useCallback(()=>{var te;if(d==="classic"&&m>0)return Math.min(100,Math.round(o/m*100));if(d==="timed"&&i!==void 0&&typeof i=="number"){const ue=(te=Ge.timed)==null?void 0:te.baseTime;return Math.max(0,Math.min(100,i/ue*100))}else if(d==="survival"&&E>0&&O>0){const ue=O*O,Ce=(ue-E)/ue*100;return Math.min(100,Ce)}return 0},[d,o,i,m,E,O]),f=a.useCallback(()=>d==="classic"&&m>0?o>=m:!1,[d,o,m]),N=()=>d==="classic"?"OBJETIVO":d==="timed"?"TIEMPO":"PROGRESO",T=()=>{const te=Nn[r]||"üåó",ue=En[r]||"Normal";return`${te} ${ue}`},L=()=>{u==="playing"?t(me("paused")):u==="paused"&&t(me("playing"))},ce=()=>{t(tt()),t(me("startScreen"))},ne=()=>{B(!F)},ie=()=>{le(!P)},X=()=>{const te=Y();return e.jsxs("div",{className:"hud-value",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:`progress-fill ${f()?"progress-achieved":""}`,style:{width:`${te}%`}})}),e.jsx("div",{className:"progress-text",children:d==="classic"&&m>0?`${o}/${m}`:`${Math.round(te)}%`})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"top-bar",children:[e.jsxs("div",{className:"max-score-container",children:[e.jsx("div",{className:"max-score-label",children:"M√ÅXIMA"}),e.jsx("div",{className:"max-score-value",children:l||0})]}),e.jsxs("div",{className:"control-buttons",children:[e.jsx("button",{className:"control-button pause-button",onClick:L,"aria-label":u==="playing"?"Pausar juego":"Reanudar juego",children:u==="playing"?"‚è∏Ô∏è":"‚ñ∂Ô∏è"}),e.jsx("button",{className:"control-button restart-button",onClick:ce,"aria-label":"Reiniciar juego",children:"üîÑ"}),e.jsx("button",{className:"control-button settings-button",onClick:()=>S(!K),"aria-label":"Configuraci√≥n",children:"‚öôÔ∏è"})]})]}),e.jsxs("div",{className:"game-hud",children:[e.jsxs("div",{className:"hud-item score",children:[e.jsx("div",{className:"hud-label",children:"PUNTUACI√ìN"}),e.jsx("div",{className:`hud-value ${$?"score-change":""}`,children:o||0})]}),e.jsxs("div",{className:"hud-item level",children:[e.jsx("div",{className:"hud-label",children:"NIVEL"}),e.jsx("div",{className:`hud-value ${I?"score-change":""}`,children:s||1})]}),e.jsxs("div",{className:"hud-item time",children:[e.jsx("div",{className:"hud-label",children:"TIEMPO"}),e.jsx("div",{className:"hud-value",children:ae()})]}),e.jsxs("div",{className:"hud-item speed",children:[e.jsx("div",{className:"hud-label",children:"VELOCIDAD"}),e.jsx("div",{className:"hud-value",children:re()})]}),e.jsxs("div",{className:"hud-item mode",children:[e.jsx("div",{className:"hud-label",children:"MODO"}),e.jsx("div",{className:"hud-value",children:M()})]}),e.jsxs("div",{className:"hud-item difficulty",children:[e.jsx("div",{className:"hud-label",children:"DIFICULTAD"}),e.jsx("div",{className:"hud-value",children:T()})]}),e.jsxs("div",{className:"hud-item progress",children:[e.jsx("div",{className:"hud-label",children:N()}),X()]})]}),e.jsx(Sn,{}),K&&e.jsx("div",{className:"config-modal",children:e.jsxs("div",{className:"config-modal-content",children:[e.jsx("h3",{children:"Configuraci√≥n"}),e.jsxs("div",{className:"config-section",children:[e.jsx("h4",{children:"Sonido"}),e.jsxs("div",{className:"config-option",children:[e.jsx("span",{children:"M√∫sica"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",defaultChecked:!0}),e.jsx("span",{className:"toggle-slider"})]})]}),e.jsxs("div",{className:"config-option",children:[e.jsx("span",{children:"Efectos"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",defaultChecked:!0}),e.jsx("span",{className:"toggle-slider"})]})]})]}),e.jsxs("div",{className:"config-section",children:[e.jsx("h4",{children:"Apariencia"}),e.jsxs("div",{className:"config-option",children:[e.jsx("span",{children:"Modo oscuro"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",defaultChecked:!0}),e.jsx("span",{className:"toggle-slider"})]})]})]}),e.jsxs("div",{className:"config-section",children:[e.jsx("h4",{children:"Rendimiento"}),e.jsxs("div",{className:"config-option",children:[e.jsx("span",{children:"Animaciones reducidas"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox"}),e.jsx("span",{className:"toggle-slider"})]})]})]}),e.jsxs("div",{className:"config-section dev-controls-section",children:[e.jsx("h4",{children:"Desarrollador"}),e.jsxs("div",{className:"config-option",children:[e.jsx("span",{children:"Mostrar FPS"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:P,onChange:ie}),e.jsx("span",{className:"toggle-slider"})]})]}),e.jsxs("div",{className:"config-option",children:[e.jsx("span",{children:"Controles Dev"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:F,onChange:ne}),e.jsx("span",{className:"toggle-slider"})]})]})]}),e.jsx("button",{className:"close-modal-btn",onClick:()=>S(!1),children:"Cerrar"})]})})]})},st=()=>{const{isSoundEnabled:t}=nt();return{playSound:a.useCallback(s=>{t&&console.log(`Playing sound: ${s}`)},[t])}},Nt={title:{opacity:0,transform:"translateY(-20px)"},content:{opacity:0,transform:"translateY(20px)"},button:{opacity:0,transform:"scale(0.8)"}},Ht=["ü™ê","üí´","‚ú®","üåü"],wn=({isVisible:t=!1,onRestart:o,onReturnToMenu:s})=>{const{gameState:n}=nt(),{score:i,level:c,comboCount:r,comboMultiplier:d,highScore:u,gameEndReason:y,currentPlayMode:l,currentDifficulty:m,spawnRate:b}=De(f=>f.game),{playSound:E}=st(),O=a.useRef(null),[$,k]=a.useState(Nt),[I,z]=a.useState(!1),[Q,H]=a.useState(!1),[K,S]=a.useState(!1),[F,B]=a.useState([]);a.useEffect(()=>{const f=()=>{const N=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${N}px`)};return f(),window.addEventListener("resize",f),window.addEventListener("orientationchange",f),window.addEventListener("load",f),()=>{window.removeEventListener("resize",f),window.removeEventListener("orientationchange",f),window.removeEventListener("load",f)}},[]),a.useEffect(()=>{if(t&&I){const f=[],N=window.innerWidth<400||window.innerHeight<700,T=N?3:Math.min(5,Math.floor(window.innerWidth/120));for(let L=0;L<T;L++){const ce=Math.random()*100,ne=Math.random()*100,ie=Math.random()*(N?1:1.5)+.8,X=Math.random()*15+20,te=Math.random()*5,ue=Ht[Math.floor(Math.random()*Ht.length)];f.push({icon:ue,style:{position:"absolute",top:`${ce}%`,left:`${ne}%`,fontSize:`${ie}em`,opacity:N?.3:.5,filter:"blur(0.5px)",animation:`float ${X}s ease-in-out ${te}s infinite`,zIndex:1}})}B(f)}},[t,I]),a.useEffect(()=>{let f;const N=[];return t?(z(!0),H(!1),document.body.classList.add("modal-open"),S(i>u),E("gameOver"),N.push(setTimeout(()=>{k(T=>({...T,title:{opacity:1,transform:"translateY(0)"}})),N.push(setTimeout(()=>{k(T=>({...T,content:{opacity:1,transform:"translateY(0)"}})),N.push(setTimeout(()=>{k(T=>({...T,button:{opacity:1,transform:"scale(1)"}}))},150))},150))},100))):(H(!0),f=setTimeout(()=>{z(!1),k(Nt),document.body.classList.remove("modal-open")},300)),()=>{f&&clearTimeout(f),N.forEach(T=>clearTimeout(T)),document.body.classList.remove("modal-open"),H(!1),k(Nt)}},[t,E,i,u]);const P=()=>{o&&(H(!0),E("uiClick"),setTimeout(()=>{z(!1),o()},300))},le=()=>{s&&(H(!0),E("uiClick"),setTimeout(()=>{z(!1),s()},300))},pe=()=>d>=5?"combo-legendary-text":d>=3?"combo-epic-text":d>=2?"combo-rare-text":d>=1.5?"combo-uncommon-text":"combo-basic-text",q=()=>d>=5?"#FFD700":d>=3?"#FF2D55":d>=2?"#8E2DE2":d>=1.5?"#36D1DC":"#FFFFFF",ae=f=>({classic:"Cl√°sico",timed:"Contrarreloj",survival:"Supervivencia",zen:"Zen",tutorial:"Tutorial"})[f]||f,re=f=>({easy:"F√°cil",normal:"Normal",hard:"Dif√≠cil",tutorial:"Tutorial"})[f]||f,M=f=>(f/1e3).toFixed(1)+"s",Y=()=>`game-session-info ${window.innerWidth<=375?"compact-layout":""}`;return!I&&!t?null:e.jsxs("div",{className:`game-modal fullscreen-modal ${I?"visible":""} ${Q?"closing":""}`,children:[F.map((f,N)=>e.jsx("div",{style:f.style,children:f.icon},`floating-icon-${N}`)),e.jsxs("div",{className:"modal-content game-over-content",ref:O,children:[e.jsxs("div",{className:"game-over-header",style:{transition:"all 0.5s ease",...$.title},children:[e.jsx("h1",{children:"¬°MISI√ìN FALLIDA!"}),e.jsx("h2",{children:K?"¬°Nuevo r√©cord gal√°ctico!":"¬°Has perdido esta batalla espacial!"}),e.jsxs("div",{className:Y(),children:[e.jsxs("div",{className:"info-pill",children:[e.jsx("span",{className:"info-label",children:"üéÆ"}),e.jsx("span",{className:"info-value",children:ae(l)})]}),e.jsxs("div",{className:"info-pill",children:[e.jsx("span",{className:"info-label",children:"üöÄ"}),e.jsx("span",{className:"info-value",children:c})]}),e.jsxs("div",{className:"info-pill",children:[e.jsx("span",{className:"info-label",children:"üî•"}),e.jsx("span",{className:"info-value",children:re(m)})]}),e.jsxs("div",{className:"info-pill",children:[e.jsx("span",{className:"info-label",children:"‚ö°"}),e.jsx("span",{className:"info-value",children:M(b)})]})]}),y&&e.jsx("div",{className:"game-end-reason",children:e.jsx("p",{children:y})})]}),e.jsxs("div",{className:"game-over-body",style:{transition:"all 0.5s ease",transitionDelay:"0.15s",...$.content},children:[e.jsxs("div",{className:"main-stats",children:[e.jsxs("div",{className:"record-score-container",children:[e.jsxs("div",{className:"record-badge",children:[e.jsx("div",{className:"record-icon",children:"üëë"}),e.jsx("div",{className:"record-value",children:u})]}),e.jsxs("div",{className:"current-score",children:[e.jsx("div",{className:"score-label",children:"Puntuaci√≥n"}),e.jsx("div",{className:`score-value ${K?"new-high-score":""}`,children:i})]})]}),e.jsxs("div",{className:"compact-stats-grid",children:[e.jsxs("div",{className:"compact-stat-item",children:[e.jsx("div",{className:"compact-stat-icon",children:"üöÄ"}),e.jsx("div",{className:"compact-stat-value",children:c}),e.jsx("div",{className:"compact-stat-label",children:"Nivel"})]}),e.jsxs("div",{className:"compact-stat-item",children:[e.jsx("div",{className:"compact-stat-icon",children:"üî•"}),e.jsx("div",{className:`compact-stat-value ${pe()}`,style:{color:q()},children:r}),e.jsxs("div",{className:"compact-stat-label",children:["Combo ",d>1?`${d.toFixed(1)}x`:""]})]}),e.jsxs("div",{className:"compact-stat-item",children:[e.jsx("div",{className:"compact-stat-icon",children:"‚≠ê"}),e.jsxs("div",{className:"compact-stat-value",children:["+",Math.floor(i*.1)]}),e.jsx("div",{className:"compact-stat-label",children:"EXP"})]})]})]}),e.jsx("div",{className:"game-over-message",children:e.jsx("p",{children:K?"¬°Has establecido un nuevo r√©cord en la galaxia! ¬øPodr√°s superarlo?":"No te rindas, tu aventura espacial contin√∫a. ¬°Mejora y conquista las estrellas!"})})]}),e.jsxs("div",{className:"game-over-buttons",children:[e.jsx("button",{className:"game-button primary-button",onClick:P,style:{transition:"all 0.5s ease",...$.button},children:"Reintentar"}),s&&e.jsx("button",{className:"game-button secondary-button",onClick:le,style:{transition:"all 0.5s ease",...$.button},children:"Men√∫"})]})]})]})},In=({isVisible:t,onClose:o,onContinue:s,onMainMenu:n,gameStats:i={score:0,timeFormatted:"00:00",maxCombo:0,moves:0,averageSpeed:0},levelNumber:c=1,nextLevel:r=2,starsEarned:d=0,rewards:u=[],nextLevelPreview:y})=>{const[l,m]=a.useState(!1),[b,E]=a.useState("results"),O=a.useRef(null),$=a.useRef(null),k=()=>{const S=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${S}px`)};a.useEffect(()=>(k(),window.addEventListener("resize",k),()=>{window.removeEventListener("resize",k)}),[]);const I=()=>{m(!0),setTimeout(()=>{o(),m(!1)},300)};a.useEffect(()=>{t&&$.current&&z()},[t]);const z=()=>{if(!$.current)return;const S=window.innerWidth<500?20:35;for(;$.current.firstChild;)$.current.removeChild($.current.firstChild);const F=["#4CAF50","#FFC107","#2196F3","#E91E63","#FFEB3B","#3F51B5"];for(let B=0;B<S;B++){const P=document.createElement("div");P.className="confetti";const le=F[Math.floor(Math.random()*F.length)],pe=Math.random()*100+"%",q=Math.random()*8+5+"px",ae=Math.random()*3+"s",re=Math.random()*2+3+"s";P.style.left=pe,P.style.width=q,P.style.height=q,P.style.backgroundColor=le,P.style.animationDelay=ae,P.style.animationDuration=re;const M=["square","circle","triangle"],Y=M[Math.floor(Math.random()*M.length)];Y==="circle"?P.style.borderRadius="50%":Y==="triangle"&&(P.style.width="0",P.style.height="0",P.style.backgroundColor="transparent",P.style.borderLeft=q+" solid transparent",P.style.borderRight=q+" solid transparent",P.style.borderBottom=q+" solid "+le),$.current.appendChild(P)}},Q=()=>{const S=["üèÜ","‚≠ê","üéâ","üöÄ","üåü"],F=Math.min(7,window.innerWidth<500?3:5),B=[];for(let P=0;P<F;P++){const le=S[Math.floor(Math.random()*S.length)],pe=Math.random()*2,q=Math.random()*2+2,ae=5+Math.random()*20,re=5+Math.random()*90;B.push(e.jsx("div",{className:"floating-icon",style:{position:"absolute",top:`${ae}%`,left:`${re}%`,fontSize:`${Math.random()*1.2+.8}em`,opacity:.4,filter:"blur(0.5px)",animation:`float ${q}s ease-in-out ${pe}s infinite`,zIndex:0},children:le},P))}return e.jsx(e.Fragment,{children:B})},H=S=>S>=20?"combo-legendary-text":S>=15?"combo-epic-text":S>=10?"combo-rare-text":S>=5?"combo-uncommon-text":"combo-basic-text",K=S=>{switch(S){case"score":return"üèÜ";case"time":return"‚è±Ô∏è";case"combo":return"‚ö°";case"moves":return"üë£";case"speed":return"üöÄ";default:return"üìä"}};return!t&&!l?null:e.jsx("div",{className:`game-modal fullscreen-modal ${t?"visible":""} ${l?"closing":""}`,onClick:I,children:e.jsxs("div",{ref:O,className:`level-complete-content ${t&&!l?"animate-in":""}`,onClick:S=>S.stopPropagation(),children:[e.jsx("div",{className:"level-complete-background"}),e.jsx("div",{ref:$,className:"confetti-container"}),Q(),e.jsxs("div",{className:"level-header",children:[e.jsxs("div",{className:"level-transition",children:[e.jsxs("span",{className:"previous-level",children:["N",c]}),e.jsx("span",{className:"level-arrow",children:"‚Üí"}),e.jsxs("span",{className:"next-level pulse-animation",children:["N",r]})]}),e.jsx("div",{className:"stars-container",children:[1,2,3].map(S=>e.jsx("div",{className:`level-star ${S<=d?"earned":""}`,style:{"--delay":`${(S-1)*.2}s`},children:"‚≠ê"},S))})]}),e.jsxs("div",{className:"modal-tabs",children:[e.jsx("button",{className:`tab-button ${b==="results"?"active":""}`,onClick:()=>E("results"),children:"Resultados"}),e.jsx("button",{className:`tab-button ${b==="preview"?"active":""}`,onClick:()=>E("preview"),children:"Siguiente nivel"})]}),e.jsxs("div",{className:"modal-sections",children:[b==="results"&&e.jsxs("div",{className:"results-section",children:[e.jsxs("div",{className:"victory-banner",children:[e.jsx("div",{className:"victory-icon",children:"üèÜ"}),e.jsx("h2",{className:"victory-title",children:"¬°NIVEL COMPLETADO!"})]}),e.jsxs("div",{className:"main-stats",children:[e.jsxs("div",{className:"stat-card score",children:[e.jsx("div",{className:"stat-icon-badge",children:K("score")}),e.jsx("div",{className:"stat-value",children:(i==null?void 0:i.score)||0}),e.jsx("div",{className:"stat-label",children:"PUNTOS"})]}),e.jsxs("div",{className:"stat-card time",children:[e.jsx("div",{className:"stat-icon-badge",children:K("time")}),e.jsx("div",{className:"stat-value",children:(i==null?void 0:i.timeFormatted)||"00:00"}),e.jsx("div",{className:"stat-label",children:"TIEMPO"})]}),e.jsxs("div",{className:"stat-card combo",children:[e.jsx("div",{className:"stat-icon-badge",children:K("combo")}),e.jsxs("div",{className:`stat-value ${H((i==null?void 0:i.maxCombo)||0)}`,children:[(i==null?void 0:i.maxCombo)||0,"x"]}),e.jsx("div",{className:"stat-label",children:"COMBO"})]})]}),e.jsxs("div",{className:"detailed-stats compact",children:[e.jsxs("div",{className:"stat-row",children:[e.jsx("span",{className:"stat-icon",children:K("moves")}),e.jsx("span",{className:"stat-label",children:"MOVIMIENTOS"}),e.jsx("span",{className:"stat-value",children:(i==null?void 0:i.moves)||0})]}),e.jsxs("div",{className:"stat-row",children:[e.jsx("span",{className:"stat-icon",children:K("speed")}),e.jsx("span",{className:"stat-label",children:"VELOCIDAD"}),e.jsxs("span",{className:"stat-value",children:[((i==null?void 0:i.averageSpeed)||0).toFixed(1),"/s"]})]})]}),e.jsxs("div",{className:"rewards-section",children:[e.jsx("h3",{className:"section-title",children:"Recompensas"}),e.jsx("div",{className:"rewards-grid adaptive",children:(u||[]).map((S,F)=>e.jsxs("div",{className:`reward-card ${S.rarity}`,children:[e.jsx("div",{className:"reward-icon",children:S.icon}),e.jsxs("div",{className:"reward-amount",children:["+",S.amount]}),e.jsx("div",{className:"reward-name",children:S.name})]},F))})]})]}),b==="preview"&&y&&e.jsxs("div",{className:"preview-section compact",children:[e.jsxs("h3",{className:"section-title",children:["Nivel ",y.level]}),e.jsxs("div",{className:"difficulty-indicator",children:[e.jsx("span",{children:"Dificultad:"}),e.jsx("div",{className:"difficulty-bars",children:[1,2,3,4,5].map(S=>e.jsx("div",{className:`difficulty-bar ${S<=y.difficulty?"active":""}`},S))})]}),y.newIcons.length>0&&e.jsxs("div",{className:"new-icons-preview compact",children:[e.jsx("div",{className:"preview-subtitle",children:"Nuevos iconos:"}),e.jsx("div",{className:"icons-grid compact",children:y.newIcons.map((S,F)=>e.jsx("div",{className:"new-icon-card",children:S},F))})]}),e.jsxs("div",{className:"level-objectives compact",children:[e.jsx("div",{className:"preview-subtitle",children:"Objetivos:"}),e.jsx("div",{className:"objectives-list",children:y.objectives.map((S,F)=>e.jsxs("div",{className:"objective-item",children:[e.jsx("div",{className:"objective-icon",children:S.icon}),e.jsx("div",{className:"objective-desc",children:S.description}),e.jsx("div",{className:"objective-target",children:S.target})]},F))})]})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"continue-button pulse-animation",onClick:s,children:"Siguiente nivel"}),e.jsx("button",{className:"menu-button",onClick:n,children:"Men√∫"})]})]})]})})},jt={title:{opacity:0,transform:"translateY(-20px)"},options:{opacity:0,transform:"translateY(20px)"},button:{opacity:0,transform:"scale(0.8)"}},Tn=({isVisible:t=!0,onPlay:o,onOptions:s,onCredits:n})=>{a.useRef(null);const{playSound:i}=st(),{isSoundEnabled:c,setIsSoundEnabled:r,isMusicEnabled:d,setIsMusicEnabled:u}=nt(),[y,l]=a.useState(jt),[m,b]=a.useState(!1),[E,O]=a.useState(!1),[$,k]=a.useState("main");a.useEffect(()=>{let q;const ae=[];return t?(b(!0),O(!1),document.body.classList.add("modal-open"),ae.push(setTimeout(()=>{l(re=>({...re,title:{opacity:1,transform:"translateY(0)"}})),ae.push(setTimeout(()=>{l(re=>({...re,options:{opacity:1,transform:"translateY(0)"}})),ae.push(setTimeout(()=>{l(re=>({...re,button:{opacity:1,transform:"scale(1)"}}))},200))},200))},100))):(O(!0),q=setTimeout(()=>{b(!1),l(jt),document.body.classList.remove("modal-open")},300)),()=>{q&&clearTimeout(q),ae.forEach(re=>clearTimeout(re)),document.body.classList.remove("modal-open"),O(!1),l(jt),console.log("StartGameModal desmontado y recursos liberados")}},[t,i]),a.useEffect(()=>{const q=()=>{const ae=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${ae}px`)};return q(),window.addEventListener("resize",q),window.addEventListener("orientationchange",q),window.addEventListener("load",q),window.addEventListener("touchstart",q),window.addEventListener("touchend",q),()=>{window.removeEventListener("resize",q),window.removeEventListener("orientationchange",q),window.removeEventListener("load",q),window.removeEventListener("touchstart",q),window.removeEventListener("touchend",q)}},[]);const I=q=>{i("uiSelect"),k(q)},z=()=>{const q=[];for(let re=0;re<15;re++){const M=Math.random()*3+1,Y=Math.random()*100,f=Math.random()*100,N=Math.random()*15+10,T=Math.random()*10;q.push(e.jsx("div",{className:"floating-star",style:{width:`${M}px`,height:`${M}px`,top:`${Y}%`,left:`${f}%`,animationDuration:`${N}s`,animationDelay:`${T}s`}},re))}return q},Q=()=>{i("uiSelect"),o&&o()},H=()=>{i("uiSelect"),I("options"),s&&s()},K=()=>{i("uiSelect"),I("credits"),n&&n()},S=()=>{i("uiSelect"),r(!c),localStorage.setItem("soundEnabled",String(!c))},F=()=>{i("uiSelect"),u(!d),localStorage.setItem("musicEnabled",String(!d))},B=()=>e.jsxs("div",{className:"main-screen",children:[e.jsxs("div",{className:"logo-container",style:{transition:"all 0.6s ease",...y.title},children:[e.jsx("h1",{className:"logo-text",children:"Convergencia"}),e.jsx("div",{className:"logo-pulse"})]}),e.jsxs("div",{className:"main-buttons",style:{transition:"all 0.5s ease",transitionDelay:"0.3s",...y.options},children:[e.jsx("button",{className:"main-button play-button",onClick:Q,children:"JUGAR"}),e.jsx("button",{className:"main-button options-button",onClick:H,children:"OPCIONES"}),e.jsx("button",{className:"main-button credits-button",onClick:K,children:"CR√âDITOS"})]})]}),P=()=>e.jsxs("div",{className:"options-screen",children:[e.jsxs("div",{className:"screen-header",children:[e.jsx("h2",{className:"screen-title",children:"Opciones"}),e.jsx("button",{className:"back-button",onClick:()=>I("main"),children:"‚¨ÖÔ∏è Volver"})]}),e.jsxs("div",{className:"settings-content",children:[e.jsxs("div",{className:"settings-option",children:[e.jsx("span",{className:"setting-label",children:"M√∫sica"}),e.jsx("button",{className:`setting-toggle ${d?"active":""}`,onClick:F,children:d?"ON":"OFF"})]}),e.jsxs("div",{className:"settings-option",children:[e.jsx("span",{className:"setting-label",children:"Sonido"}),e.jsx("button",{className:`setting-toggle ${c?"active":""}`,onClick:S,children:c?"ON":"OFF"})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{className:"settings-section-title",children:"Informaci√≥n del Juego"}),e.jsx("div",{className:"settings-info",children:e.jsx("p",{children:"Convergencia es un juego de rompecabezas donde debes combinar iconos del mismo tipo para ganar puntos. Experimenta diferentes modos de juego y dificultades para desafiar tus habilidades."})})]})]})]}),le=()=>e.jsxs("div",{className:"credits-screen",children:[e.jsxs("div",{className:"screen-header",children:[e.jsx("h2",{className:"screen-title",children:"Cr√©ditos"}),e.jsx("button",{className:"back-button",onClick:()=>I("main"),children:"‚¨ÖÔ∏è Volver"})]}),e.jsxs("div",{className:"credits-content",children:[e.jsx("h3",{className:"credits-title",children:"Convergencia"}),e.jsx("p",{className:"credits-subtitle",children:"Dise√±ado y desarrollado por:"}),e.jsx("p",{className:"credits-name",children:"Equipo de Desarrollo"}),e.jsx("h4",{className:"credits-section",children:"Programaci√≥n"}),e.jsx("p",{className:"credits-name",children:"Desarrollador Principal"}),e.jsx("h4",{className:"credits-section",children:"Dise√±o Gr√°fico"}),e.jsx("p",{className:"credits-name",children:"Dise√±ador de UI/UX"}),e.jsx("h4",{className:"credits-section",children:"M√∫sica y Sonido"}),e.jsx("p",{className:"credits-name",children:"Compositor"}),e.jsx("h4",{className:"credits-section",children:"Agradecimientos Especiales"}),e.jsx("p",{className:"credits-text",children:"A todos los que hicieron posible este juego"}),e.jsxs("div",{className:"version-info",children:[e.jsx("p",{children:"Versi√≥n 1.0.0"}),e.jsx("p",{children:"¬© 2023 Todos los derechos reservados"})]})]})]}),pe=()=>{switch($){case"options":return P();case"credits":return le();default:return B()}};return m?e.jsx("div",{className:`start-game ${E?"closing":""}`,children:e.jsxs("div",{className:"start-game-body",children:[z(),pe()]})}):null},ro=()=>{const[t,o]=a.useState(()=>{const n=localStorage.getItem("darkMode");return n!==null?n==="true":window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches});return a.useEffect(()=>{t?document.documentElement.classList.add("dark-mode"):document.documentElement.classList.remove("dark-mode"),localStorage.setItem("darkMode",String(t))},[t]),{darkMode:t,toggleDarkMode:()=>{o(n=>!n)}}};var uo={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},qt=_e.createContext&&_e.createContext(uo),$n=["attr","size","title"];function Rn(t,o){if(t==null)return{};var s=On(t,o),n,i;if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(i=0;i<c.length;i++)n=c[i],!(o.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function On(t,o){if(t==null)return{};var s={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(o.indexOf(n)>=0)continue;s[n]=t[n]}return s}function pt(){return pt=Object.assign?Object.assign.bind():function(t){for(var o=1;o<arguments.length;o++){var s=arguments[o];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},pt.apply(this,arguments)}function Yt(t,o){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);o&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),s.push.apply(s,n)}return s}function ft(t){for(var o=1;o<arguments.length;o++){var s=arguments[o]!=null?arguments[o]:{};o%2?Yt(Object(s),!0).forEach(function(n){Ln(t,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Yt(Object(s)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(s,n))})}return t}function Ln(t,o,s){return o=An(o),o in t?Object.defineProperty(t,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[o]=s,t}function An(t){var o=Dn(t,"string");return typeof o=="symbol"?o:o+""}function Dn(t,o){if(typeof t!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var n=s.call(t,o);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(t)}function mo(t){return t&&t.map((o,s)=>_e.createElement(o.tag,ft({key:s},o.attr),mo(o.child)))}function Oe(t){return o=>_e.createElement(Fn,pt({attr:ft({},t.attr)},o),mo(t.child))}function Fn(t){var o=s=>{var{attr:n,size:i,title:c}=t,r=Rn(t,$n),d=i||s.size||"1em",u;return s.className&&(u=s.className),t.className&&(u=(u?u+" ":"")+t.className),_e.createElement("svg",pt({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,n,r,{className:u,style:ft(ft({color:t.color||s.color},s.style),t.style),height:d,width:d,xmlns:"http://www.w3.org/2000/svg"}),c&&_e.createElement("title",null,c),t.children)};return qt!==void 0?_e.createElement(qt.Consumer,null,s=>o(s)):o(uo)}function po(t){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M255.9.2h-64v64h64zM0 64.17v64h64v-64zM128 .2H64v64h64zm64 255.9v64h64v-64zM0 192.12v64h64v-64zM383.85.2h-64v64h64zm128 0h-64v64h64zM128 256.1H64v64h64zM511.8 448v-64h-64v64zm0-128v-64h-64v64zM383.85 512h64v-64h-64zm128-319.88v-64h-64v64zM128 512h64v-64h-64zM0 512h64v-64H0zm255.9 0h64v-64h-64zM0 320.07v64h64v-64zm319.88-191.92v-64h-64v64zm-64 128h64v-64h-64zm-64 128v64h64v-64zm128-64h64v-64h-64zm0-127.95h64v-64h-64zm0 191.93v64h64v-64zM64 384.05v64h64v-64zm128-255.9v-64h-64v64zm191.92 255.9h64v-64h-64zm-128-191.93v-64h-64v64zm128-127.95v64h64v-64zm-128 255.9v64h64v-64zm-64-127.95H128v64h64zm191.92 64h64v-64h-64zM128 128.15H64v64h64zm0 191.92v64h64v-64z"},child:[]}]})(t)}function fo(t){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"},child:[]}]})(t)}function go(t){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M467.14 44.84c-62.55-62.48-161.67-64.78-252.28 25.73-78.61 78.52-60.98 60.92-85.75 85.66-60.46 60.39-70.39 150.83-63.64 211.17l178.44-178.25c6.26-6.25 16.4-6.25 22.65 0s6.25 16.38 0 22.63L7.04 471.03c-9.38 9.37-9.38 24.57 0 33.94 9.38 9.37 24.6 9.37 33.98 0l66.1-66.03C159.42 454.65 279 457.11 353.95 384h-98.19l147.57-49.14c49.99-49.93 36.38-36.18 46.31-46.86h-97.78l131.54-43.8c45.44-74.46 34.31-148.84-16.26-199.36z"},child:[]}]})(t)}function ho(t){return Oe({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M216 23.86c0-23.8-30.65-32.77-44.15-13.04C48 191.85 224 200 224 288c0 35.63-29.11 64.46-64.85 63.99-35.17-.45-63.15-29.77-63.15-64.94v-85.51c0-21.7-26.47-32.23-41.43-16.5C27.8 213.16 0 261.33 0 320c0 105.87 86.13 192 192 192s192-86.13 192-192c0-170.29-168-193-168-296.14z"},child:[]}]})(t)}function vo(t){return Oe({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M622.34 153.2L343.4 67.5c-15.2-4.67-31.6-4.67-46.79 0L17.66 153.2c-23.54 7.23-23.54 38.36 0 45.59l48.63 14.94c-10.67 13.19-17.23 29.28-17.88 46.9C38.78 266.15 32 276.11 32 288c0 10.78 5.68 19.85 13.86 25.65L20.33 428.53C18.11 438.52 25.71 448 35.94 448h56.11c10.24 0 17.84-9.48 15.62-19.47L82.14 313.65C90.32 307.85 96 298.78 96 288c0-11.57-6.47-21.25-15.66-26.87.76-15.02 8.44-28.3 20.69-36.72L296.6 284.5c9.06 2.78 26.44 6.25 46.79 0l278.95-85.7c23.55-7.24 23.55-38.36 0-45.6zM352.79 315.09c-28.53 8.76-52.84 3.92-65.59 0l-145.02-44.55L128 384c0 35.35 85.96 64 192 64s192-28.65 192-64l-14.18-113.47-145.03 44.56z"},child:[]}]})(t)}function bo(t){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M320.2 243.8l-49.7 99.4c-6 12.1-23.4 11.7-28.9-.6l-56.9-126.3-30 71.7H60.6l182.5 186.5c7.1 7.3 18.6 7.3 25.7 0L451.4 288H342.3l-22.1-44.2zM473.7 73.9l-2.4-2.5c-51.5-52.6-135.8-52.6-187.4 0L256 100l-27.9-28.5c-51.5-52.7-135.9-52.7-187.4 0l-2.4 2.4C-10.4 123.7-12.5 203 31 256h102.4l35.9-86.2c5.4-12.9 23.6-13.2 29.4-.4l58.2 129.3 49-97.9c5.9-11.8 22.7-11.8 28.6 0l27.6 55.2H481c43.5-53 41.4-132.3-7.3-182.1z"},child:[]}]})(t)}function zn(t){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"},child:[]}]})(t)}function xo(t){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 0C114.6 0 0 100.3 0 224c0 70.1 36.9 132.6 94.5 173.7 9.6 6.9 15.2 18.1 13.5 29.9l-9.4 66.2c-1.4 9.6 6 18.2 15.7 18.2H192v-56c0-4.4 3.6-8 8-8h16c4.4 0 8 3.6 8 8v56h64v-56c0-4.4 3.6-8 8-8h16c4.4 0 8 3.6 8 8v56h77.7c9.7 0 17.1-8.6 15.7-18.2l-9.4-66.2c-1.7-11.7 3.8-23 13.5-29.9C475.1 356.6 512 294.1 512 224 512 100.3 397.4 0 256 0zm-96 320c-35.3 0-64-28.7-64-64s28.7-64 64-64 64 28.7 64 64-28.7 64-64 64zm192 0c-35.3 0-64-28.7-64-64s28.7-64 64-64 64 28.7 64 64-28.7 64-64 64z"},child:[]}]})(t)}function Co(t){return Oe({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"},child:[]}]})(t)}function yo(t){return Oe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 304c0 114.9-93.1 208-208 208S16 418.9 16 304c0-104 76.3-190.2 176-205.5V64h-28c-6.6 0-12-5.4-12-12V12c0-6.6 5.4-12 12-12h120c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-28v34.5c37.5 5.8 71.7 21.6 99.7 44.6l27.5-27.5c4.7-4.7 12.3-4.7 17 0l28.3 28.3c4.7 4.7 4.7 12.3 0 17l-29.4 29.4-.6.6C419.7 223.3 432 262.2 432 304zm-176 36V188.5c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12V340c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12z"},child:[]}]})(t)}function kn(t){return Oe({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(t)}function So(t){return Oe({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111.03 8 0 119.03 0 256s111.03 248 248 248 248-111.03 248-248S384.97 8 248 8zm0 376c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32zm0-128c-53.02 0-96 42.98-96 96s42.98 96 96 96c-106.04 0-192-85.96-192-192S141.96 64 248 64c53.02 0 96 42.98 96 96s-42.98 96-96 96zm0-128c-17.67 0-32 14.33-32 32s14.33 32 32 32 32-14.33 32-32-14.33-32-32-32z"},child:[]}]})(t)}_.CLASSIC+"",_.TIME_ATTACK+"",_.SURVIVAL+"",_.ZEN+"",_.TUTORIAL+"";ee.VERY_EASY+"",ee.EASY+"",ee.MEDIUM+"",ee.HARD+"",ee.VERY_HARD+"";const Bn={[_.CLASSIC]:"Juega a tu ritmo y completa todos los niveles.",[_.TIME_ATTACK]:"Acumula puntos antes que se acabe el tiempo.",[_.SURVIVAL]:"Sobrevive el mayor tiempo posible con dificultad creciente.",[_.ZEN]:"Modo relajado sin presi√≥n de tiempo ni objetivos espec√≠ficos.",[_.TUTORIAL]:"Aprende los conceptos b√°sicos del juego paso a paso."};ee.VERY_EASY+"",ee.EASY+"",ee.MEDIUM+"",ee.HARD+"",ee.VERY_HARD+"";const Et={title:{opacity:0,transform:"translateY(-20px)"},options:{opacity:0,transform:"translateY(20px)"},button:{opacity:0,transform:"scale(0.8)"}},Pn={[_.CLASSIC]:"Cl√°sico",[_.TIME_ATTACK]:"Contrarreloj",[_.SURVIVAL]:"Supervivencia",[_.ZEN]:"Zen",[_.TUTORIAL]:"Tutorial"},rt=t=>t!==null&&t===_.TUTORIAL,Un=(t,o)=>{if(!t)return"üëà Selecciona un modo de juego para comenzar";if(rt(t))return"Aprende los conceptos b√°sicos del juego paso a paso. El tutorial te guiar√° con instrucciones simples para dominar las mec√°nicas.";if(t===_.ZEN)return"Modo relajado sin presi√≥n. Juega a tu ritmo, sin l√≠mites de tiempo ni objetivos espec√≠ficos. Perfecto para practicar y disfrutar.";if(!o)return"üëà Selecciona una dificultad para este modo";let s="";switch(t){case _.CLASSIC:s="Modo tradicional donde debes alcanzar objetivos espec√≠ficos para avanzar de nivel.";break;case _.TIME_ATTACK:s="Contrarreloj: acumula la mayor cantidad de puntos antes de que se acabe el tiempo.";break;case _.SURVIVAL:s="Sobrevive el mayor tiempo posible con dificultad creciente.";break;default:s=Bn[t]}let n="";switch(o){case ee.VERY_EASY:n="Nivel muy accesible, ideal para principiantes.";break;case ee.EASY:n="Dificultad baja, buen punto de partida.";break;case ee.MEDIUM:n="Dificultad equilibrada, recomendada para la mayor√≠a de jugadores.";break;case ee.HARD:n="Desafiante, para jugadores experimentados.";break;case ee.VERY_HARD:n="Extremadamente dif√≠cil, solo para expertos.";break}return`${s} ${n}`},et=({mode:t})=>{const o=()=>{switch(t){case _.TUTORIAL:return e.jsx(vo,{className:"mode-icon tutorial-icon"});case _.CLASSIC:return e.jsx(po,{className:"mode-icon classic-icon"});case _.TIME_ATTACK:return e.jsx(yo,{className:"mode-icon timed-icon"});case _.SURVIVAL:return e.jsx(bo,{className:"mode-icon survival-icon"});case _.ZEN:return e.jsx(So,{className:"mode-icon zen-icon"});default:return null}};return e.jsx("div",{className:"mode-icon-container",children:o()})},Gn=({difficulty:t})=>{const o=()=>{switch(t){case ee.VERY_EASY:return e.jsx(go,{className:"difficulty-icon very-easy-icon"});case ee.EASY:return e.jsx(Co,{className:"difficulty-icon easy-icon"});case ee.MEDIUM:return e.jsx(fo,{className:"difficulty-icon medium-icon"});case ee.HARD:return e.jsx(ho,{className:"difficulty-icon hard-icon"});case ee.VERY_HARD:return e.jsx(xo,{className:"difficulty-icon very-hard-icon"});default:return null}};return e.jsx("div",{className:"difficulty-icon-container",children:o()})},Mt=({difficulty:t,selected:o,onClick:s})=>(ee.VERY_EASY+"",ee.EASY+"",ee.MEDIUM+"",ee.HARD+"",ee.VERY_HARD+"",e.jsxs("div",{className:`difficulty-option ${t.toLowerCase().replace("_","-")} ${o?"active":""}`,onClick:s,children:[e.jsx(Gn,{difficulty:t}),e.jsx("div",{className:"difficulty-shine-effect"})]})),Wt=({children:t,title:o,content:s,position:n="bottom"})=>{const[i,c]=a.useState(!1),r=a.useRef(null);return a.useEffect(()=>{const d=u=>{r.current&&!r.current.contains(u.target)&&c(!1)};return i&&document.addEventListener("mousedown",d),()=>{document.removeEventListener("mousedown",d)}},[i]),e.jsxs("div",{className:"tooltip-container",ref:r,children:[e.jsx("div",{className:"info-icon-container",onClick:()=>c(!i),children:t||e.jsx(zn,{className:"info-icon"})}),i&&e.jsxs("div",{className:`tooltip tooltip-${n}`,children:[e.jsxs("div",{className:"tooltip-header",children:[e.jsx("span",{className:"tooltip-title",children:o}),e.jsx("button",{className:"tooltip-close-btn",onClick:()=>c(!1),children:e.jsx(kn,{})})]}),e.jsx("div",{className:"tooltip-content",children:s})]})]})},Vn=()=>e.jsxs("div",{className:"tooltip-modes",children:[e.jsxs("div",{className:"tooltip-mode-item",children:[e.jsxs("span",{className:"tooltip-mode-name",children:[e.jsx(vo,{className:"tooltip-icon"})," Tutorial"]}),"Aprende los controles b√°sicos y mec√°nicas del juego paso a paso en un entorno seguro."]}),e.jsxs("div",{className:"tooltip-mode-item",children:[e.jsxs("span",{className:"tooltip-mode-name",children:[e.jsx(po,{className:"tooltip-icon"})," Cl√°sico"]}),"Completa niveles con objetivos espec√≠ficos. El modo tradicional para disfrutar del juego."]}),e.jsxs("div",{className:"tooltip-mode-item",children:[e.jsxs("span",{className:"tooltip-mode-name",children:[e.jsx(yo,{className:"tooltip-icon"})," Contrarreloj"]}),"Consigue la mayor puntuaci√≥n posible antes de que se acabe el tiempo. ¬°Cada segundo cuenta!"]}),e.jsxs("div",{className:"tooltip-mode-item",children:[e.jsxs("span",{className:"tooltip-mode-name",children:[e.jsx(bo,{className:"tooltip-icon"})," Supervivencia"]}),"Sobrevive el mayor tiempo posible mientras la dificultad aumenta gradualmente. El verdadero desaf√≠o."]}),e.jsxs("div",{className:"tooltip-mode-item",children:[e.jsxs("span",{className:"tooltip-mode-name",children:[e.jsx(So,{className:"tooltip-icon"})," Zen"]}),"Juega sin presi√≥n, sin l√≠mites de tiempo ni objetivos espec√≠ficos. Ideal para relajarse."]})]}),_n=()=>e.jsxs("div",{className:"tooltip-difficulties",children:[e.jsxs("div",{className:"tooltip-difficulty-item",children:[e.jsxs("span",{className:"tooltip-difficulty-name",children:[e.jsx(go,{className:"tooltip-icon"})," Muy F√°cil"]}),"Ritmo lento con pocas piezas en pantalla. Ideal para principiantes y para aprender el juego."]}),e.jsxs("div",{className:"tooltip-difficulty-item",children:[e.jsxs("span",{className:"tooltip-difficulty-name",children:[e.jsx(Co,{className:"tooltip-icon"})," F√°cil"]}),"Un desaf√≠o ligero con movimientos predecibles. Perfecto para jugadores novatos."]}),e.jsxs("div",{className:"tooltip-difficulty-item",children:[e.jsxs("span",{className:"tooltip-difficulty-name",children:[e.jsx(fo,{className:"tooltip-icon"})," Normal"]}),"Dificultad equilibrada para la mayor√≠a de jugadores. El ritmo est√°ndar del juego."]}),e.jsxs("div",{className:"tooltip-difficulty-item",children:[e.jsxs("span",{className:"tooltip-difficulty-name",children:[e.jsx(ho,{className:"tooltip-icon"})," Dif√≠cil"]}),"Ritmo acelerado con m√°s piezas y menos tiempo. Para jugadores experimentados."]}),e.jsxs("div",{className:"tooltip-difficulty-item",children:[e.jsxs("span",{className:"tooltip-difficulty-name",children:[e.jsx(xo,{className:"tooltip-icon"})," Muy Dif√≠cil"]}),"Un verdadero reto incluso para expertos. Requiere reflejos r√°pidos y estrategia avanzada."]})]}),Hn=({isVisible:t=!0,onStart:o})=>{const s=a.useRef(null),{playSound:n}=st();ro(),ke();const{gameMode:i,setGameMode:c,gameDifficulty:r,setGameDifficulty:d,isSoundEnabled:u,setIsSoundEnabled:y,isMusicEnabled:l,setIsMusicEnabled:m}=nt(),{highScore:b}=De(C=>C.game),E=!1,[O,$]=a.useState(()=>(localStorage.setItem("tutorialCompleted","true"),localStorage.getItem("tutorialCompleted")==="true")),[k,I]=a.useState(!0),[z,Q]=a.useState(!0),[H,K]=a.useState(!1),[S,F]=a.useState(null),[B,P]=a.useState(r||null),[le,pe]=a.useState([]),[q,ae]=a.useState(!1),[re,M]=a.useState([]);a.useEffect(()=>{(()=>{const x=[];for(let Z=0;Z<6;Z++){const D=Math.random()*2.5+1,J=Math.random()*100,oe=Math.random()*20+20,V=Math.random()*15;x.push(e.jsx("div",{className:"floating-star",style:{width:`${D}px`,height:`${D}px`,left:`${J}%`,opacity:0,animation:`floatStar ${oe}s linear ${V}s infinite`,backgroundColor:"#FFD700",boxShadow:"0 0 4px 1px rgba(255, 215, 0, 0.6)"}},Z))}M(x)})()},[]);const{changeGameConfig:Y}=io(),[f,N]=a.useState(Et),[T,L]=a.useState(!1),[ce,ne]=a.useState(!1),[ie,X]=a.useState("main"),[te,ue]=a.useState(E),[Ce,Te]=a.useState(E);a.useEffect(()=>{const C=()=>{const g=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${g}px`)};C(),window.addEventListener("resize",C),window.addEventListener("orientationchange",C);const x=document.querySelector(".game-selection-container");if(x){const g=Z=>{Z.stopPropagation()};return x.addEventListener("touchstart",g,{passive:!0}),x.addEventListener("touchmove",g,{passive:!0}),()=>{window.removeEventListener("resize",C),window.removeEventListener("orientationchange",C),x.removeEventListener("touchstart",g),x.removeEventListener("touchmove",g)}}return()=>{window.removeEventListener("resize",C),window.removeEventListener("orientationchange",C)}},[]),a.useEffect(()=>{S===_.TUTORIAL||S===_.ZEN||S&&B?ue(!0):ue(!1)},[S,B]),a.useEffect(()=>{let C;const x=[];return t?(L(!0),ne(!1),document.body.classList.add("modal-open"),X("play"),x.push(setTimeout(()=>{N(g=>({...g,title:{opacity:1,transform:"translateY(0)"}})),x.push(setTimeout(()=>{N(g=>({...g,options:{opacity:1,transform:"translateY(0)"}})),x.push(setTimeout(()=>{N(g=>({...g,button:{opacity:1,transform:"scale(1)"}}))},200))},200))},100))):(ne(!0),C=setTimeout(()=>{L(!1),N(Et),document.body.classList.remove("modal-open"),X("main")},300)),()=>{C&&clearTimeout(C),x.forEach(g=>clearTimeout(g)),document.body.classList.remove("modal-open"),ne(!1),N(Et),console.log("ModeSelectionModal desmontado y recursos liberados")}},[t,ie,E,O]);const ye=C=>{n("uiSelect"),X(C)},Ee=C=>{if(s.current&&!s.current.contains(C.target)&&!H){n("uiClose");const x=s.current;x.style.transform="scale(0.98)",setTimeout(()=>{x&&(x.style.transform="scale(1)")},150)}};a.useEffect(()=>(t?document.addEventListener("mousedown",Ee):document.removeEventListener("mousedown",Ee),()=>{document.removeEventListener("mousedown",Ee)}),[t,H]);const Be=()=>{if(!te||!S)return;n("uiSelect");const C=g=>{switch(g){case ee.VERY_EASY:case ee.EASY:return"easy";case ee.MEDIUM:return"normal";case ee.HARD:case ee.VERY_HARD:return"hard";default:return"normal"}},x=g=>{switch(g){case _.CLASSIC:return"classic";case _.TIME_ATTACK:return"timed";case _.SURVIVAL:return"survival";case _.ZEN:return"zen";case _.TUTORIAL:return"tutorial";default:return"classic"}};rt(S)?(console.log("Iniciando tutorial"),c(_.TUTORIAL),P(ee.EASY),Y({difficulty:"tutorial",mode:"tutorial"}),console.log("Modo de juego cambiado a tutorial - GameMode:",_.TUTORIAL),localStorage.setItem("tutorialCompleted","true"),$(!0)):S===_.ZEN?(console.log("Iniciando modo Zen"),c(_.ZEN),P(ee.EASY),Y({difficulty:"easy",mode:"zen"})):(console.log(`Iniciando modo ${S} con dificultad ${B}`),c(S),Y({difficulty:B?C(B):"easy",mode:x(S)})),ne(!0),setTimeout(()=>{o&&o();const g=document.querySelector(".game-page");g&&g.classList.add("modal-active")},500)},we=C=>{n("uiSelect"),F(C),rt(C)&&P(ee.EASY),ue(C!==null&&(rt(C)||C===_.ZEN||B!==null))},R=C=>{q||(P(C),n("uiTap"))},h=()=>{n("uiTap"),y(!u)},W=()=>{n("uiTap"),m(!l)},p=()=>e.jsxs("div",{className:"main-screen",children:[e.jsxs("div",{className:"logo-container",style:{transition:"all 0.6s ease",...f.title},children:[e.jsx("h1",{className:"logo-text",children:"Convergencia"}),e.jsx("div",{className:"logo-pulse"})]}),e.jsxs("div",{className:"main-buttons",style:{transition:"all 0.5s ease",transitionDelay:"0.3s",...f.options},children:[e.jsx("button",{className:"main-button play-button",onClick:()=>ye("play"),children:"JUGAR"}),e.jsx("button",{className:"main-button options-button",onClick:()=>ye("options"),children:"OPCIONES"}),e.jsx("button",{className:"main-button credits-button",onClick:()=>ye("credits"),children:"CR√âDITOS"})]})]}),v=()=>{const C=!O,x=E,g=S?Pn[S]:"",Z=S?Un(S,B):"";return e.jsxs("div",{className:"play-screen",children:[re,e.jsxs("div",{className:"game-header",children:[e.jsx("button",{className:"back-button",onClick:()=>ye("main"),children:"üè†"}),e.jsx("h2",{className:"header-title",children:"Selecciona el modo de juego"}),e.jsx("div",{className:"header-spacer"})]}),e.jsxs("div",{className:"game-selection-container",children:[E,e.jsxs("div",{className:"modes-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{className:"section-title",children:"Modo de juego"}),e.jsx(Wt,{title:"Modos de Juego",content:e.jsx(Vn,{})})]}),e.jsxs("div",{className:"modes-grid",children:[C&&e.jsxs("div",{className:`game-option tutorial ${S===_.TUTORIAL?"active":""}`,onClick:()=>we(_.TUTORIAL),children:[e.jsx("div",{className:"game-option-image",children:e.jsx(et,{mode:_.TUTORIAL})}),e.jsx("div",{className:"game-option-title",children:"Tutorial"}),e.jsx("span",{className:"recommended-badge",children:"Recomendado"}),e.jsx("div",{className:"mode-shine-effect"})]}),e.jsxs("div",{className:`game-option classic ${S===_.CLASSIC?"active":""} `,onClick:()=>we(_.CLASSIC),children:[e.jsx("div",{className:"game-option-image",children:e.jsx(et,{mode:_.CLASSIC})}),e.jsx("div",{className:"game-option-title",children:"Cl√°sico"}),x,e.jsx("div",{className:"mode-shine-effect"})]}),e.jsxs("div",{className:`game-option timed ${S===_.TIME_ATTACK?"active":""} `,onClick:()=>we(_.TIME_ATTACK),children:[e.jsx("div",{className:"game-option-image",children:e.jsx(et,{mode:_.TIME_ATTACK})}),e.jsx("div",{className:"game-option-title",children:"Contrarreloj"}),x,e.jsx("div",{className:"mode-shine-effect"})]}),e.jsxs("div",{className:`game-option survival ${S===_.SURVIVAL?"active":""} `,onClick:()=>we(_.SURVIVAL),children:[e.jsx("div",{className:"game-option-image",children:e.jsx(et,{mode:_.SURVIVAL})}),e.jsx("div",{className:"game-option-title",children:"Supervivencia"}),x,e.jsx("div",{className:"mode-shine-effect"})]}),e.jsxs("div",{className:`game-option zen ${S===_.ZEN?"active":""} `,onClick:()=>we(_.ZEN),children:[e.jsx("div",{className:"game-option-image",children:e.jsx(et,{mode:_.ZEN})}),e.jsx("div",{className:"game-option-title",children:"Zen"}),x,e.jsx("div",{className:"mode-shine-effect"})]})]})]}),e.jsxs("div",{className:"difficulty-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{className:"section-title",children:"Dificultad"}),e.jsx(Wt,{title:"Niveles de Dificultad",content:e.jsx(_n,{})})]}),e.jsxs("div",{className:"difficulty-options",children:[e.jsx(Mt,{difficulty:ee.EASY,selected:B===ee.EASY,onClick:()=>R(ee.EASY)}),e.jsx(Mt,{difficulty:ee.MEDIUM,selected:B===ee.MEDIUM,onClick:()=>R(ee.MEDIUM)}),e.jsx(Mt,{difficulty:ee.HARD,selected:B===ee.HARD,onClick:()=>R(ee.HARD)})]})]}),S&&e.jsx("div",{className:"description-section",children:e.jsxs("div",{className:"unified-description-container",children:[e.jsx("h3",{className:"mode-title",children:g?`Modo ${g}`:"Selecciona un modo"}),e.jsx("p",{children:Z})]})})]}),e.jsx("div",{className:"fixed-start-button-container",children:e.jsx("button",{className:`start-button ${S&&B?"active":"disabled"}`,onClick:Be,disabled:!S||!B,children:"¬°EMPEZAR!"})})]})},A=()=>e.jsxs("div",{className:"options-screen",children:[e.jsxs("div",{className:"screen-header",children:[e.jsx("h2",{children:"Opciones"}),e.jsx("button",{className:"back-button",onClick:()=>ye("main"),children:"‚¨ÖÔ∏è Volver"})]}),e.jsxs("div",{className:"settings-content",children:[e.jsxs("div",{className:"settings-option",children:[e.jsx("span",{children:"M√∫sica"}),e.jsx("button",{className:`setting-toggle ${l?"active":""}`,onClick:W,children:l?"ON":"OFF"})]}),e.jsxs("div",{className:"settings-option",children:[e.jsx("span",{children:"Sonido"}),e.jsx("button",{className:`setting-toggle ${u?"active":""}`,onClick:h,children:u?"ON":"OFF"})]}),e.jsxs("div",{className:"settings-option",children:[e.jsx("span",{children:"Notificaciones"}),e.jsx("div",{className:"setting-checkbox",children:"‚úì"})]})]})]}),w=()=>e.jsxs("div",{className:"credits-screen",children:[e.jsxs("div",{className:"screen-header",children:[e.jsx("h2",{children:"Cr√©ditos"}),e.jsx("button",{className:"back-button",onClick:()=>ye("main"),children:"‚¨ÖÔ∏è Volver"})]}),e.jsxs("div",{className:"credits-content",children:[e.jsx("h3",{children:"Convergencia"}),e.jsx("p",{children:"Dise√±ado y desarrollado por:"}),e.jsx("p",{className:"credits-name",children:"Equipo de Desarrollo"}),e.jsx("h4",{children:"Programaci√≥n"}),e.jsx("p",{className:"credits-name",children:"Programador Principal"}),e.jsx("h4",{children:"Dise√±o Gr√°fico"}),e.jsx("p",{className:"credits-name",children:"Artista Principal"}),e.jsx("h4",{children:"M√∫sica y Sonido"}),e.jsx("p",{className:"credits-name",children:"Compositor"}),e.jsx("h4",{children:"Agradecimientos Especiales"}),e.jsx("p",{children:"A todos los que hicieron posible este juego"}),e.jsxs("div",{className:"version-info",children:[e.jsx("p",{children:"Versi√≥n 1.0.0"}),e.jsx("p",{children:"¬© 2023 Todos los derechos reservados"})]})]})]});if(!T&&!t)return null;const G=()=>{switch(ie){case"play":return v();case"options":return A();case"credits":return w();default:return p()}};return e.jsx("div",{className:`game-modal-start start-game ${T?"visible":""} ${ce?"closing":""}`,children:e.jsx("div",{className:"modal-content",ref:s,children:e.jsx("div",{className:`start-game-body ${ie}`,children:G()})})})};var No=(t=>(t.WELCOME="welcome",t.BASIC_MECHANICS="basic_mechanics",t.CONVERGENCE="convergence",t.COMBOS="combos",t.PENALTIES="penalties",t.COMPLETION="completion",t))(No||{});const qn=({onComplete:t})=>{const o=ke(),[s,n]=a.useState("welcome"),[i,c]=a.useState(!1),[r,d]=a.useState(!0),[u,y]=a.useState(!1),[l,m]=a.useState(!1),[b,E]=a.useState(!1),[O,$]=a.useState(!1),k=a.useRef(null),{board:I,score:z,iconCount:Q,status:H,comboCount:K,currentPlayMode:S}=De(f=>f.game),F=a.useRef(z),B=a.useRef(Q),P=a.useRef(K),le=()=>{y(!0),localStorage.setItem("tutorialCompleted","true")},pe=()=>{y(!1),t()},q=()=>{console.log("Tutorial: Ocultando temporalmente para acci√≥n"),m(!0),E(!0)},ae={welcome:{title:"¬°Bienvenido al Tutorial!",content:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"¬°Hola! Vamos a aprender juntos c√≥mo jugar a Convergence."}),e.jsx("p",{children:"En este tutorial, te ense√±ar√© las mec√°nicas b√°sicas del juego para que puedas empezar a jugar r√°pidamente."}),e.jsx("button",{className:"tutorial-button",onClick:()=>Y(),children:"Empezar"})]})},basic_mechanics:{title:"Mec√°nicas B√°sicas",content:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["El objetivo del juego es ",e.jsx("strong",{children:"eliminar iconos"})," del tablero creando ",e.jsx("strong",{children:"convergencias"}),"."]}),e.jsx("p",{children:"Una convergencia ocurre cuando 3 o m√°s iconos del mismo tipo se alinean en l√≠nea recta (horizontal, vertical o diagonal)."}),e.jsx("p",{children:"Observa el tablero y busca grupos de iconos iguales que est√©n alineados."}),e.jsx("button",{className:"tutorial-button",onClick:()=>Y(),children:"Siguiente"})]})},convergence:{title:"¬°Crea tu primera convergencia!",content:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Ahora es tu turno: ",e.jsx("strong",{children:"encuentra 3 o m√°s iconos iguales"})," que est√©n alineados y haz clic en ellos para eliminarlos."]}),e.jsx("p",{children:"Te he se√±alado un posible grupo. ¬°Prueba a hacer clic!"}),e.jsx("p",{className:"tutorial-note",children:"Debes completar esta acci√≥n para continuar."}),!l&&e.jsx("button",{className:"tutorial-button",onClick:q,children:"Entendido"})]}),waitForAction:!0,actionType:"convergence",highlightCells:re(I)},combos:{title:"¬°Sistema de Combos!",content:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"¬°Excelente! Has creado tu primera convergencia."}),e.jsxs("p",{children:["Un ",e.jsx("strong",{children:"combo"})," ocurre cuando eliminas ",e.jsx("strong",{children:"m√∫ltiples convergencias"})," en un corto periodo de tiempo."]}),e.jsx("p",{children:"Para hacer un combo, necesitas:"}),e.jsxs("ol",{children:[e.jsx("li",{children:"Eliminar una primera convergencia (que ya has hecho)"}),e.jsxs("li",{children:["Encontrar y eliminar ",e.jsx("strong",{children:"otra convergencia diferente"})," antes de que se agote el tiempo"]})]}),e.jsxs("p",{children:["Los combos multiplican tus puntos: ",e.jsx("span",{className:"combo-basic-text",children:"x1.5"}),", ",e.jsx("span",{className:"combo-uncommon-text",children:"x2.0"}),", ",e.jsx("span",{className:"combo-rare-text",children:"x3.0"})," y hasta ",e.jsx("span",{className:"combo-legendary-text",children:"x5.0"}),"."]}),e.jsxs("p",{children:["Ver√°s una ",e.jsx("strong",{children:"barra de tiempo"})," en la parte superior cuando se active un combo. ¬°Elimina otro grupo antes de que se agote!"]}),e.jsx("p",{className:"tutorial-note",children:"Debes eliminar una segunda convergencia para continuar."}),!l&&e.jsx("button",{className:"tutorial-button",onClick:q,children:"Entendido"})]}),waitForAction:!0,actionType:"combo"},penalties:{title:"Cuidado con las Penalizaciones",content:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Ten cuidado: si el tablero se llena demasiado, recibir√°s ",e.jsx("strong",{children:"penalizaciones"}),"."]}),e.jsx("p",{children:"Estas penalizaciones a√±aden m√°s iconos al tablero y dificultan el juego."}),e.jsx("p",{children:"Intenta mantener el tablero lo m√°s despejado posible."}),e.jsx("button",{className:"tutorial-button",onClick:()=>Y(),children:"Entendido"})]})},completion:{title:"¬°Tutorial Completado!",content:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"¬°Felicidades! Has completado el tutorial b√°sico de Convergence."}),e.jsx("p",{children:"Ahora conoces las mec√°nicas fundamentales del juego:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Crear convergencias alineando 3 o m√°s iconos iguales"}),e.jsx("li",{children:"Realizar combos para multiplicar tus puntos"}),e.jsx("li",{children:"Evitar penalizaciones manteniendo el tablero despejado"})]}),e.jsx("button",{className:"tutorial-button-primary",onClick:le,children:"¬°Estoy listo para jugar!"})]})}};function re(f){const N=[{rowStep:1,colStep:0},{rowStep:0,colStep:1},{rowStep:1,colStep:1},{rowStep:1,colStep:-1}],T=f.length;for(let ie=0;ie<T;ie++)for(let X=0;X<T;X++){const te=f[ie][X];if(te)for(const ue of N){const Ce=[];let Te=ie,ye=X;for(let Ee=0;Ee<5&&!(Te<0||Te>=T||ye<0||ye>=T||f[Te][ye]!==te);Ee++)Ce.push({row:Te,col:ye}),Te+=ue.rowStep,ye+=ue.colStep;if(Ce.length>=3)return console.log(`Convergencia encontrada: ${Ce.length} iconos ${te}`),Ce}}console.log("No se encontraron convergencias existentes, buscando oportunidades para crear una");const L=M(f);if(L.length>0)return console.log("Se encontr√≥ una oportunidad para crear convergencia"),L;console.log("No se encontraron convergencias potenciales, seleccionando iconos aleatorios");const ce=[];for(let ie=0;ie<T;ie++)for(let X=0;X<T;X++)f[ie][X]&&ce.push({row:ie,col:X});const ne=ce.slice(0,Math.min(3,ce.length));return console.log(`Seleccionados ${ne.length} iconos aleatorios para destacar`),ne}function M(f){const N=f.length;for(let T=0;T<N;T++)for(let L=0;L<N;L++){if(L<N-2&&f[T][L]&&f[T][L]===f[T][L+1])return[{row:T,col:L},{row:T,col:L+1}];if(T<N-2&&f[T][L]&&f[T][L]===f[T+1][L])return[{row:T,col:L},{row:T+1,col:L}];if(T<N-2&&L<N-2&&f[T][L]&&f[T][L]===f[T+1][L+1])return[{row:T,col:L},{row:T+1,col:L+1}];if(T>1&&L<N-2&&f[T][L]&&f[T][L]===f[T-1][L+1])return[{row:T,col:L},{row:T-1,col:L+1}]}return[]}const Y=()=>{const f=Object.values(No),N=f.indexOf(s);console.log(`Tutorial: Avanzando al paso ${N+1} de ${f.length}`),N<f.length-1?(n(f[N+1]),c(!1),m(!1),E(!1)):(console.log("Tutorial: Finalizando tutorial"),le())};return a.useEffect(()=>{const f=ae[s];if(f.waitForAction&&b)switch(f.actionType){case"convergence":z>F.current&&(console.log("Convergencia detectada: puntuaci√≥n aumentada"),c(!0),m(!1),E(!1));break;case"combo":K>=2?(console.log(`Combo real detectado: ${K} convergencias consecutivas`),c(!0),m(!1),E(!1),$(!1)):z>F.current&&K<2&&(console.log("Se detect√≥ una convergencia, pero no un combo. El combo requiere m√∫ltiples convergencias."),$(!0),m(!1),F.current=z);break}f.actionType==="combo"&&z>F.current&&K<2||(F.current=z),B.current=Q,P.current=K},[z,Q,K,s,ae,b]),a.useEffect(()=>{if(i){const f=setTimeout(()=>{Y()},1500);return()=>clearTimeout(f)}},[i]),a.useEffect(()=>{const f=ae[s].highlightCells;if(f&&f.length>0){const N=document.querySelectorAll(".game-cell"),T=I.length;N.forEach(L=>{L.classList.remove("tutorial-highlight-pulse"),document.querySelectorAll(".cell-click-indicator").forEach(ne=>ne.remove())}),f.forEach(({row:L,col:ce})=>{const ne=L*T+ce;if(N[ne]&&(N[ne].classList.add("tutorial-highlight-pulse"),ae[s].waitForAction)){const ie=document.createElement("div");ie.className="cell-click-indicator",ie.textContent="¬°Clic aqu√≠!",N[ne].appendChild(ie)}}),o(Me(f))}else o(Me([]));return()=>{document.querySelectorAll(".game-cell").forEach(L=>{L.classList.remove("tutorial-highlight-pulse")}),document.querySelectorAll(".cell-click-indicator").forEach(L=>L.remove()),o(Me([]))}},[s,o,I,l]),a.useEffect(()=>{S!=="tutorial"&&H==="playing"&&console.warn("GameTutorial: No estamos en modo tutorial pero el componente est√° activo")},[S,H]),a.useEffect(()=>{if(O){const f=setTimeout(()=>{$(!1)},5e3);return()=>clearTimeout(f)}},[O]),a.useEffect(()=>(console.log("GameTutorial: Componente montado y visible"),()=>{console.log("GameTutorial: Componente desmontado")}),[]),e.jsxs(e.Fragment,{children:[r&&!l&&e.jsx("div",{className:`tutorial-overlay ${ae[s].waitForAction?"interactive":""}`,ref:k,children:e.jsxs("div",{className:"tutorial-card",children:[e.jsx("h2",{className:"tutorial-title",children:ae[s].title}),e.jsx("div",{className:"tutorial-content",children:ae[s].content}),O&&s==="combos"&&e.jsxs("div",{className:"tutorial-help-message",children:[e.jsxs("p",{children:["¬°Bien! Has eliminado una convergencia, pero un combo requiere eliminar ",e.jsx("strong",{children:"varias convergencias seguidas"}),"."]}),e.jsxs("p",{children:["Busca y elimina ",e.jsx("strong",{children:"otro grupo de iconos"})," antes de que se agote el tiempo."]})]}),i&&ae[s].waitForAction&&e.jsx("div",{className:"tutorial-success-message",children:"¬°Perfecto! Avanzando al siguiente paso..."})]})}),l&&e.jsxs("div",{className:"tutorial-mini-button",onClick:()=>m(!1),children:[e.jsx("span",{className:"tutorial-mini-icon",children:"‚ùì"}),e.jsx("span",{children:"Mostrar Tutorial"})]}),u&&e.jsx("div",{className:"tutorial-completion-modal",children:e.jsxs("div",{className:"tutorial-completion-content",children:[e.jsx("h2",{children:"¬°Felicidades!"}),e.jsx("p",{children:"Has completado el tutorial b√°sico de Convergence."}),e.jsx("p",{children:"Ahora tienes los conocimientos necesarios para jugar a todos los modos de juego."}),e.jsx("p",{children:"¬°Divi√©rtete jugando y mejorando tus habilidades!"}),e.jsx("button",{className:"tutorial-completion-button",onClick:pe,children:"¬°Vamos a jugar!"})]})})]})},Yn=({performanceThreshold:t=30})=>{const[o,s]=a.useState(null),n=a.useRef({frames:0,lastTime:performance.now(),samples:[]});a.useEffect(()=>{let c,r;const d=()=>{n.current.frames++,c=requestAnimationFrame(d)};return c=requestAnimationFrame(d),r=setInterval(()=>{const u=performance.now(),y=u-n.current.lastTime;if(y<200)return;const l=Math.round(n.current.frames*1e3/y);s(l),n.current.samples.push(l),n.current.samples.length>5&&n.current.samples.shift(),n.current.frames=0,n.current.lastTime=u},1e3),()=>{cancelAnimationFrame(c),clearInterval(r)}},[]);const i=()=>o?o>=t?"var(--color-success)":o>=t/2?"var(--color-warning)":"var(--color-danger)":"var(--color-text-secondary)";return e.jsx("div",{className:"fps-counter",children:e.jsx("span",{style:{color:i()},children:o?`${o} FPS`:"Calculando..."})})},wt={title:{opacity:0,transform:"translateY(-20px)"},content:{opacity:0,transform:"translateY(20px)"},buttons:{opacity:0,transform:"scale(0.8)"}},Wn=({isVisible:t=!1,onResume:o,onRestart:s,onExit:n,onSettings:i})=>{const{level:c,score:r,highScore:d,currentPlayMode:u,currentDifficulty:y}=De(B=>B.game),{playSound:l}=st(),m=a.useRef(null),[b,E]=a.useState(wt),[O,$]=a.useState(!1),[k,I]=a.useState(!1);a.useEffect(()=>{const B=()=>{const P=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${P}px`)};return B(),window.addEventListener("resize",B),window.addEventListener("orientationchange",B),window.addEventListener("load",B),()=>{window.removeEventListener("resize",B),window.removeEventListener("orientationchange",B),window.removeEventListener("load",B)}},[]),a.useEffect(()=>{let B;const P=[];return t?($(!0),I(!1),document.body.classList.add("modal-open"),l("uiOpen"),P.push(setTimeout(()=>{E(le=>({...le,title:{opacity:1,transform:"translateY(0)"}})),P.push(setTimeout(()=>{E(le=>({...le,content:{opacity:1,transform:"translateY(0)"}})),P.push(setTimeout(()=>{E(le=>({...le,buttons:{opacity:1,transform:"scale(1)"}}))},200))},200))},100))):(I(!0),B=setTimeout(()=>{$(!1),E(wt),document.body.classList.remove("modal-open")},300)),()=>{B&&clearTimeout(B),P.forEach(le=>clearTimeout(le)),document.body.classList.remove("modal-open"),I(!1),E(wt),console.log("PauseModal desmontado y recursos liberados")}},[t,l]);const z=()=>{o&&(I(!0),l("uiClick"),setTimeout(()=>{$(!1),o()},300))},Q=()=>{s&&(I(!0),l("uiClick"),setTimeout(()=>{$(!1),s()},300))},H=()=>{n&&(I(!0),l("uiClick"),setTimeout(()=>{$(!1),n()},300))},K=()=>{i&&(l("uiClick"),i())},S=()=>{switch(u){case"classic":return"Cl√°sico";case"timed":return"Contrarreloj";case"survival":return"Supervivencia";case"zen":return"Zen";default:return"Cl√°sico"}},F=()=>{switch(y){case"easy":return"F√°cil";case"normal":return"Normal";case"hard":return"Dif√≠cil";case"tutorial":return"Tutorial";default:return"Normal"}};return!O&&!t?null:e.jsx("div",{className:`game-modal fullscreen-modal ${O?"visible":""} ${k?"closing":""}`,children:e.jsxs("div",{className:"modal-content pause-content",ref:m,children:[e.jsxs("div",{className:"pause-header",style:{transition:"all 0.6s ease",...b.title},children:[e.jsx("h1",{children:"Juego en Pausa"}),e.jsx("h2",{children:"¬°T√≥mate un descanso!"})]}),e.jsx("div",{className:"pause-body",style:{transition:"all 0.5s ease",transitionDelay:"0.2s",...b.content},children:e.jsxs("div",{className:"game-status-info",children:[e.jsxs("div",{className:"info-row",children:[e.jsx("div",{className:"info-label",children:"Nivel"}),e.jsx("div",{className:"info-value",children:c})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("div",{className:"info-label",children:"Puntuaci√≥n"}),e.jsx("div",{className:"info-value",children:r})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("div",{className:"info-label",children:"R√©cord"}),e.jsx("div",{className:"info-value",children:d})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("div",{className:"info-label",children:"Modo"}),e.jsx("div",{className:"info-value",children:S()})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("div",{className:"info-label",children:"Dificultad"}),e.jsx("div",{className:"info-value",children:F()})]})]})}),e.jsxs("div",{className:"pause-buttons",style:{transition:"all 0.4s ease",transitionDelay:"0.4s",...b.buttons},children:[e.jsx("button",{className:"pause-button resume-button",onClick:z,children:"‚ñ∂Ô∏è Reanudar"}),e.jsxs("div",{className:"secondary-buttons",children:[e.jsx("button",{className:"pause-button secondary restart-button",onClick:Q,children:"üîÑ Reiniciar"}),e.jsx("button",{className:"pause-button secondary settings-button",onClick:K,children:"‚öôÔ∏è Ajustes"}),e.jsx("button",{className:"pause-button secondary exit-button",onClick:H,children:"üè† Salir"})]})]})]})})};let gt;try{gt=require("./BASE_MODE_CONFIG").BASE_MODE_CONFIG}catch{gt={classic:{baseSpawnRate:2e3,spawnRateDecrement:100,minSpawnRate:500,scoreMultiplier:1},timed:{baseSpawnRate:1500,spawnRateDecrement:150,minSpawnRate:400,scoreMultiplier:1.2},survival:{baseSpawnRate:1800,spawnRateDecrement:120,minSpawnRate:450,scoreMultiplier:.8},zen:{baseSpawnRate:2500,spawnRateDecrement:50,minSpawnRate:600,scoreMultiplier:.5}},j.warn("LevelSystem","No se pudo importar BASE_MODE_CONFIG, usando valores por defecto")}function Jn(){try{j.info("LevelSystem","Migrando configuraci√≥n existente al nuevo sistema de niveles");const t={};for(let s=1;s<=10;s++)t[s]=Tt(s);const o=Bo;if(ot&&ot.length>0){j.info("LevelSystem","El sistema de niveles ya est√° inicializado");return}j.info("LevelSystem","Migraci√≥n completada correctamente")}catch(t){j.error("LevelSystem",`Error al migrar configuraci√≥n: ${t}`)}}function Zn(){try{return j.info("LevelSystem","Inicializando sistema de niveles"),Jn(),j.info("LevelSystem","Sistema de niveles inicializado correctamente"),{predefinedLevels:ot?ot.length:0,difficulties:$t?Object.keys($t):["easy","normal","hard","tutorial"],modes:gt?Object.keys(gt):["classic","timed","survival","zen"]}}catch(t){return j.error("LevelSystem",`Error al inicializar sistema de niveles: ${t}`),{predefinedLevels:0,difficulties:["easy","normal","hard","tutorial"],modes:["classic","timed","survival","zen"]}}}const Jt=25,Kn=1500,Xn=({stage:t,error:o,onInitComplete:s})=>{const n=ke(),[i,c]=a.useState("not_started"),[r,d]=a.useState(null),[u,y]=a.useState(!1),l=t||i,m=o||r,b=a.useRef({isRunning:!1,frameCount:0,startTime:0,samples:[],hasDecided:!1,useLiteMode:!1}),E=lo(Jt),O=a.useRef(!1),$=a.useCallback(Q=>{Q?(document.documentElement.classList.add("lite-animations"),document.documentElement.classList.add("performance-mode"),j.info("LoadingScreen","Modo de animaciones ligeras activado por FPS bajos")):(document.documentElement.classList.remove("lite-animations"),document.documentElement.classList.remove("performance-mode"),j.info("LoadingScreen","Modo de animaciones completas activado por buenos FPS")),b.current.useLiteMode=Q,E.initializeAnimations(Q)},[E]),k=a.useCallback(()=>{if(b.current.isRunning||b.current.hasDecided)return;b.current.isRunning=!0,b.current.startTime=performance.now(),b.current.frameCount=0,b.current.samples=[],j.info("LoadingScreen","Iniciando detecci√≥n de FPS inicial...");let Q=null;const H=()=>{b.current.frameCount++,Q=requestAnimationFrame(H)};Q=requestAnimationFrame(H);const K=setTimeout(()=>{const F=performance.now()-b.current.startTime;Q!==null&&(cancelAnimationFrame(Q),Q=null);const B=Math.round(b.current.frameCount*1e3/F);j.info("LoadingScreen",`FPS medido: ${B} (${b.current.frameCount} frames en ${F.toFixed(0)}ms)`);const P=B<=Jt;$(P),b.current.hasDecided=!0,b.current.isRunning=!1,y(!0),j.info("LoadingScreen",`Detecci√≥n de FPS completada: ${B} FPS, modo ${P?"ligero":"normal"}`)},300);return()=>{clearTimeout(K),Q!==null&&cancelAnimationFrame(Q)}},[$]);a.useEffect(()=>{if(t||O.current)return;O.current=!0;const Q=(S=!1)=>{S&&!b.current.hasDecided&&(j.warn("LoadingScreen","Usando modo de animaciones por defecto debido a timeout en FPS"),$(!1),b.current.hasDecided=!0,y(!0)),c("assets_loading"),j.info("LoadingScreen","üéµ Cargando recursos de audio y assets");try{j.info("LoadingScreen","Recursos de audio cargados")}catch(F){j.warn("LoadingScreen",`Error al cargar recursos de audio: ${F}`)}if(!E.isInitialized()){const F=b.current.useLiteMode;j.info("LoadingScreen",`Inicializando animaciones en modo: ${F?"lite":"normal"}`),E.initializeAnimations(F)}setTimeout(()=>{H()},200)},H=()=>{c("complete"),j.info("LoadingScreen","‚úÖ Inicializaci√≥n del juego completada exitosamente"),n(me("startScreen")),setTimeout(()=>{s(u,b.current.useLiteMode)},200)};return(async()=>{try{j.info("LoadingScreen","üöÄ Iniciando secuencia de inicializaci√≥n del juego"),c("system_init"),j.info("LoadingScreen","üìã Inicializando sistema de niveles"),Zn(),c("fps_detection"),j.info("LoadingScreen","üìä Comenzando detecci√≥n de FPS"),k();const S=setTimeout(()=>{u||(j.warn("LoadingScreen","Tiempo de espera para detecci√≥n de FPS agotado"),Q(!0))},Kn),F=setInterval(()=>{u&&(clearInterval(F),clearTimeout(S),Q())},100)}catch(S){const F=`Error durante la inicializaci√≥n: ${S}`;j.error("LoadingScreen",F),d(F),b.current.hasDecided||($(!1),b.current.hasDecided=!0),c("complete"),setTimeout(()=>{s(u,b.current.useLiteMode)},500)}})(),()=>{j.info("LoadingScreen","Componente de carga desmontado durante inicializaci√≥n")}},[n,k,u,t,s,$,E]);let I="Cargando...",z=0;switch(l){case"not_started":I="Preparando el juego...",z=0;break;case"system_init":I="Inicializando sistemas...",z=25;break;case"fps_detection":I="Analizando rendimiento...",z=50;break;case"assets_loading":I="Cargando recursos...",z=75;break;case"complete":I="Iniciando juego...",z=100;break}return e.jsx("div",{className:"game-loading-screen",children:e.jsxs("div",{className:"loading-content",children:[e.jsx("h2",{children:"Convergencia"}),e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{className:"loading-message",children:I}),e.jsx("div",{className:"loading-progress-container",children:e.jsx("div",{className:"loading-progress-bar",style:{width:`${z}%`}})}),m&&e.jsxs("div",{className:"loading-error",children:["Error: ",m]})]})})},os=()=>{const t=ke();Po();const o=a.useRef(null),{playSound:s}=st(),{status:n,level:i,boardSize:c,currentPlayMode:r,currentDifficulty:d,score:u,highScore:y,darkMode:l,timer:m,spawnRate:b}=De(h=>h.game),[E,O]=a.useState(!1),[$,k]=a.useState(!1),[I,z]=a.useState(!1),{gameMode:Q,setGameMode:H,gameDifficulty:K,setGameDifficulty:S,isSoundEnabled:F,setIsSoundEnabled:B,isMusicEnabled:P,setIsMusicEnabled:le,gameState:pe}=nt(),[q,ae]=a.useState(l),[re,M]=a.useState(!0),[Y,f]=a.useState(!1),N=a.useRef(!1),T=a.useRef(!1),{stopTimers:L,startTimers:ce,initializeBoard:ne}=io();a.useRef({isRunning:!1,frameCount:0,startTime:0,samples:[],hasDecided:!1});const{toggleDarkMode:ie}=ro(),X=a.useCallback(h=>{h?(document.documentElement.classList.add("lite-animations"),document.documentElement.classList.add("performance-mode"),j.info("GamePage","Modo de animaciones ligeras activado por FPS bajos")):(document.documentElement.classList.remove("lite-animations"),document.documentElement.classList.remove("performance-mode"),j.info("GamePage","Modo de animaciones completas activado"))},[]);a.useEffect(()=>{const h=()=>{const W=window.innerWidth<=768;f(W)};return h(),window.addEventListener("resize",h),()=>{window.removeEventListener("resize",h)}},[]),a.useEffect(()=>{n==="idle"&&I&&t(me("startScreen"))},[I,t,n]),a.useEffect(()=>{M(n==="startScreen"||n==="paused"||n==="gameOver"||n==="levelCompleted")},[n]),a.useEffect(()=>{const h=()=>{const W=document.getElementById("game-board");if(W&&T.current){const p=W.parentElement;p&&so(p,W)}};return h(),window.addEventListener("resize",h),()=>{window.removeEventListener("resize",h)}},[c,Y]),a.useEffect(()=>{ae(l)},[l]),a.useEffect(()=>{const h=document.createElement("meta");h.name="viewport",h.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no",document.head.appendChild(h);const W=p=>{p.touches.length>1&&p.preventDefault()};return document.addEventListener("touchmove",W,{passive:!1}),()=>{document.removeEventListener("touchmove",W),document.head.removeChild(h)}},[]),a.useEffect(()=>{const h=o.current;if(!h)return;const W=p=>{let v=p.target;for(;v&&v!==h;){if(v.classList.contains("scrollable"))return;v=v.parentElement}p.preventDefault()};return h.addEventListener("touchmove",W,{passive:!1}),()=>{h.removeEventListener("touchmove",W)}},[]);const te=()=>{O(!1),t(me("playing"))},ue=()=>{n==="playing"?(t(me("paused")),L()):n==="paused"&&t(me("playing"))},Ce=()=>{try{T.current=!1,L(),t(yt()),t(tt());const h=St(1);t(Ze(h.icons||[])),t(me("playing")),t(Me([])),console.log("Fase 4: Inicializando tablero para el nuevo juego"),ne(c,!0,1),console.log("Fase 5: Iniciando temporizadores para el nuevo juego"),setTimeout(()=>{ce(!0),console.log("Temporizadores iniciados correctamente")},100),console.log("**********************************************************"),console.log("FIN DEL FLUJO: REINICIO DE PARTIDA COMPLETADO"),console.log(`**********************************************************
`),N.current=!1}catch(h){N.current=!1,j.error("GamePage","Error al reiniciar el juego",h),console.error("Error al reiniciar el juego:",h)}},Te=()=>{try{t(yt()),t(tt()),setTimeout(()=>{try{j.info("GamePage",`Configurando tablero para nivel ${i}`);const h=St(i);t(Ze(h.icons||[])),ne(h.size,!0,i),t(me("playing")),setTimeout(()=>{U.getState().game.status==="playing"&&(j.info("GamePage","Iniciando temporizadores para el juego"),ce())},100),N.current=!1,T.current=!0,j.info("GamePage","FIN DEL FLUJO: JUEGO INICIADO CORRECTAMENTE")}catch(h){j.error("GamePage","Error durante la inicializaci√≥n del juego",h),N.current=!1}},100)}catch(h){j.error("GamePage","Error al iniciar el juego",h),N.current=!1}},ye=()=>{L(),t(yt()),N.current=!1,T.current=!1,t(me("startScreen")),k(!1),j.info("GamePage","Volviendo a la pantalla de inicio")},Ee=()=>{if(N.current){console.warn("Ya hay una inicializaci√≥n en progreso, ignorando paso a siguiente nivel");return}N.current=!0,console.log(`
**********************************************************`),console.log("INICIO DEL FLUJO: AVANZAR AL SIGUIENTE NIVEL"),console.log(`Avanzando del nivel ${i} al nivel ${i+1}`),console.log("**********************************************************");try{L();const h=i+1;t(ut(h));const W=St(h);t(Ze(W.icons||[])),t(me("playing")),t(Me([])),console.log("Fase 4: Inicializando tablero para el nuevo nivel"),ne(c,!0,h),console.log("Fase 5: Iniciando temporizadores para el nuevo nivel"),setTimeout(()=>{ce(!0),console.log("Temporizadores iniciados correctamente")},100),F&&s("levelUp"),console.log("**********************************************************"),console.log("FIN DEL FLUJO: AVANCE AL SIGUIENTE NIVEL COMPLETADO"),console.log(`**********************************************************
`),N.current=!1}catch(h){N.current=!1,j.error("GamePage","Error al avanzar al siguiente nivel",h),console.error("Error al avanzar al siguiente nivel:",h)}},Be=()=>{t(Uo(!l)),ie()},we=()=>{n==="playing"&&t(me("paused"))},R=n==="playing";return a.useEffect(()=>{r==="tutorial"&&n==="playing"&&(console.log("Modo tutorial detectado - Activando componente de tutorial"),O(!0))},[r,n]),e.jsxs("div",{className:"game-page",ref:o,children:[e.jsx(Yn,{performanceThreshold:10}),e.jsxs("div",{className:"game-container",children:[!I&&e.jsx(Xn,{onInitComplete:(h,W)=>{j.info("GamePage","Inicializaci√≥n completa detectada: "+h+", Modo Lite: "+W),setTimeout(()=>{z(!0),X(W),n==="idle"&&t(me("startScreen"))},500)}}),I&&e.jsxs(e.Fragment,{children:[R&&e.jsxs("div",{className:"game-board-section",children:[e.jsx(Mn,{}),e.jsx("div",{className:"game-board-container",children:e.jsx("div",{id:"game-board",children:e.jsx(yn,{})})})]}),E&&n==="playing"&&e.jsx(qn,{onComplete:te}),n==="startScreen"&&!$&&e.jsx(Tn,{isVisible:!0,onPlay:()=>k(!0),onOptions:Be,onCredits:()=>{}}),n==="startScreen"&&$&&e.jsx(Hn,{isVisible:!0,onStart:()=>{k(!1),Te()}}),n==="gameOver"&&e.jsx(wn,{isVisible:!0,onRestart:Ce,onReturnToMenu:ye}),n==="levelCompleted"&&e.jsx(In,{isVisible:!0,onContinue:Ee,onMainMenu:ye,onClose:()=>U.dispatch(me("playing")),gameStats:{score:u,timeFormatted:"00:30",maxCombo:5,moves:20,averageSpeed:.5},levelNumber:i,nextLevel:i+1,starsEarned:3,rewards:[{type:"coins",amount:100,name:"Monedas",icon:"ü™ô",rarity:"common"},{type:"gems",amount:20,name:"Gemas",icon:"üíé",rarity:"uncommon"},{type:"xp",amount:50,name:"Experiencia",icon:"‚≠ê",rarity:"common"}]}),n==="paused"&&e.jsx(Wn,{isVisible:!0,onResume:ue,onRestart:Ce,onExit:ye,onSettings:we})]})]})]})};export{os as default};
