import{c as Zt,s as U,g as Kt,I as Xt,a as dt,b as Ze,i as jo,B as Eo,d as wo,M as Mo,l as N,e as je,f as Io,h as fe,r as s,k as Ke,m as ke,u as De,n as Qt,o as Ft,p as It,q as vt,t as bt,v as Ae,w as To,x as $o,y as zt,z as Ie,A as Ve,C as nt,D as Pe,E as Le,F as eo,G as to,H as xt,J as ut,K as Lo,N as Ro,O as Pt,P as kt,Q as Je,R as Oo,S as Ao,T as Do,U as it,V as Ge,W as oo,X as Fo,Y as zo,Z as no,j as e,_ as Po,$ as Ct,a0 as Xe,a1 as _e,a2 as q,a3 as oe,a4 as ko,a5 as Bo,a6 as Uo,a7 as Go,a8 as yt}from"./index-Bb3xbmDn.js";const $t=(t,o,a)=>t>=0&&t<a&&o>=0&&o<a,Te=(t,o)=>(t=Math.ceil(t),o=Math.floor(o),Math.floor(Math.random()*(o-t))+t),Vo=t=>{for(let o=t.length-1;o>0;o--){const a=Math.floor(Math.random()*(o+1));[t[o],t[a]]=[t[a],t[o]]}return t},_o=(t,o,a,n=300)=>{const l=(o.toUpperCase()==="CLASSIC"?a.CLASSIC:o.toUpperCase()==="TIMED"?a.TIMED:a.SURVIVAL).initialSpawnRate;let r=0;return t<=2?r=0:t<=4?r=.15:r=.25,Math.round(Math.max(n,l*(1-r)))},ct=(t,o,a)=>{if(!t||!Array.isArray(t)||t.length===0||!a||a.length===0||o<=0)return!1;for(let n=0;n<o;n++)for(let c=0;c<o;c++)if(!(!t[n]||t[n][c]!==null)&&Ho(t,n,c,o,a))return!0;return!1},Ho=(t,o,a,n,c)=>{if(!t||!c||c.length===0||n<=0)return!1;const l=[{dr:-1,dc:0},{dr:0,dc:1},{dr:1,dc:0},{dr:0,dc:-1}];for(const r of c){let d=0;for(const{dr:u,dc:j}of l){let i=o+u,m=a+j;for(;$t(i,m,n)&&!(!t[i]||t[i][m]===void 0);){if(t[i][m]!==null){if(t[i][m]===r&&(d++,d>=2))return!0;break}i+=u,m+=j}}}return!1},qo=(t,o,a,n)=>{if(!t[o][a]||typeof t[o][a]!="string")return{hasConvergence:!1,convergingCells:[]};const c=t[o][a];if(c.includes("_removing"))return{hasConvergence:!1,convergingCells:[]};const l=[{dr:-1,dc:0},{dr:0,dc:1},{dr:1,dc:0},{dr:0,dc:-1}],r=[{row:o,col:a}],d={};for(const{dr:j,dc:i}of l){const m=`${j},${i}`;d[m]=[];let h=o+j,w=a+i;for(;$t(h,w,n);){if(t[h][w]===c){const O={row:h,col:w};d[m].push(O),r.push(O);break}else if(t[h][w]!==null)break;h+=j,w+=i}}const u=r.length>=3;return{hasConvergence:u,convergingCells:u?r:[]}},Yo=(t,o,a,n)=>{if(t[o][a]!==null)return[];const c={},l=[{dr:-1,dc:0},{dr:1,dc:0},{dr:0,dc:-1},{dr:0,dc:1}];for(const{dr:d,dc:u}of l){let j=o+d,i=a+u;for(;$t(j,i,n);){const m=t[j][i];if(m!==null){if(m.includes("_removing"))break;c[m]||(c[m]=[]),c[m].push({row:j,col:i});break}j+=d,i+=u}}const r=[];for(const d in c)c[d].length>=2&&r.push(...c[d]);return r};var Wo={};function Jo(){const t={};let o=null,a=localStorage.getItem("soundEnabled")!=="false",n=localStorage.getItem("musicEnabled")!=="false",c=parseFloat(localStorage.getItem("soundVolume")||"0.5"),l=parseFloat(localStorage.getItem("musicVolume")||"0.3");function r(i,m){try{const h=new Audio;h.src=m,h.preload="auto",h.onerror=()=>{console.warn(`Error al cargar el sonido: ${i} (${m}). Usando sonido alternativo.`),h.src=d(i)},t[i]=h}catch(h){console.error(`Error al inicializar el sonido: ${i}`,h),t[i]=new Audio}}function d(i){const m=Wo.PUBLIC_URL||"";return{click:`${m}/public/assets/audio/pops/click.wav`,invalidMove:`${m}/public/assets/audio/negatives/error.wav`,success:`${m}/public/assets/audio/positives/bleep.wav`,levelComplete:`${m}/public/assets/audio/level-completed.wav`,gameOver:`${m}/public/assets/audio/negatives/gameover.wav`,startLevel:`${m}/public/assets/audio/pops/start.wav`,hint:`${m}/public/assets/audio/pops/hint.wav`,newIcon:`${m}/public/assets/audio/pops/pop-up.wav`,removeIcon:`${m}/public/assets/audio/pops/bubble-pop.wav`,timeBonus:`${m}/public/assets/audio/positives/time-bonus.wav`,buttonClick:`${m}/public/assets/audio/pops/click.wav`,comboSmall:`${m}/public/assets/audio/positives/bleep.wav`,comboMedium:`${m}/public/assets/audio/positives/bleep.wav`,comboLarge:`${m}/public/assets/audio/positives/bleep.wav`}[i]||`${m}/public/assets/audio/pops/click.wav`}function u(i){try{o=new Audio,o.src=i,o.loop=!0,o.volume=l,o.preload="auto",o.onerror=()=>{console.warn(`Error al cargar la m√∫sica: ${i}. Usando m√∫sica alternativa.`),o&&(o.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}}catch(m){console.error("Error al inicializar la m√∫sica",m),o=null}}try{r("success","/assets/audio/positives/bleep.wav"),r("error","/assets/audio/negatives/error.wav"),r("levelComplete","/assets/audio/level-completed.wav"),r("gameOver","/assets/audio/negatives/gameover.wav"),r("click","/assets/audio/pops/click.wav"),r("newIcon","/assets/audio/pops/pop-up.wav"),r("removeIcon","/assets/audio/pops/bubble-pop.wav"),r("hint","/assets/audio/pops/hint.wav"),r("speedUp","/assets/audio/speed-up.mp3"),r("penalty","/assets/audio/error.mp3"),r("emptyBoard","/assets/audio/positives/cartoon-sparkle.wav"),r("levelTransition","/assets/audio/positives/cartoon-sparkle.wav"),r("convergingFound","/assets/audio/positives/bell-up.wav"),r("start","/assets/audio/positives/bleep.wav"),r("pause","/assets/audio/pops/pause.wav"),r("resume","/assets/audio/pops/resume.wav"),r("invalid","/assets/audio/negatives/error.wav"),r("invalidMove","/assets/audio/negatives/error.wav"),r("timeBonus","/assets/audio/positives/time-bonus.wav"),u("/assets/audio/level-music-2.mp3")}catch(i){console.error("Error al cargar recursos de audio",i)}function j(){r("click","/sounds/ui/click.mp3"),r("start","/sounds/ui/start.mp3"),r("pause","/sounds/ui/pause.mp3"),r("resume","/sounds/ui/resume.mp3"),r("points","/sounds/game/points.mp3"),r("gameOver","/sounds/game/game_over.mp3"),r("levelComplete","/sounds/game/level_complete.mp3"),r("startLevel","/sounds/game/start_level.mp3"),r("removeIcon","/sounds/game/remove_icon.mp3"),r("newIcon","/sounds/game/new_icon.mp3"),r("invalidMove","/sounds/game/invalid_move.mp3"),r("hint","/sounds/game/hint.mp3"),r("timeBonus","/sounds/game/time_bonus.mp3"),r("speedUp","/sounds/game/speed_up.mp3"),r("convergingFound","/sounds/game/converging_found.mp3"),r("comboSmall","/sounds/game/combo_small.mp3"),r("comboMedium","/sounds/game/combo_medium.mp3"),r("comboLarge","/sounds/game/combo_large.mp3"),u("/sounds/music/game_music.mp3")}return{sounds:t,music:o,enabled:a,musicEnabled:n,volume:c,musicVolume:l,play(i){if(a)try{t[i]||(console.warn(`Sonido no encontrado: ${i}, creando uno temporal`),r(i,d(i)));const m=t[i].cloneNode();m.volume=c,m.play().catch(h=>{console.warn(`Error reproduciendo sonido ${i}:`,h)})}catch(m){console.error(`Error al reproducir sonido: ${i}`,m)}},startMusic(){if(!(!n||!o))try{o.volume=l,o.currentTime=0,o.play().catch(i=>{console.warn("Error reproduciendo m√∫sica:",i)})}catch(i){console.error("Error al iniciar m√∫sica:",i)}},stopMusic(){try{o&&(o.pause(),o.currentTime=0)}catch(i){console.error("Error al detener m√∫sica:",i)}},pauseMusic(){try{o&&o.pause()}catch(i){console.error("Error al pausar m√∫sica:",i)}},resumeMusic(){if(!(!n||!o))try{o.play().catch(i=>console.warn("Error al reanudar m√∫sica:",i))}catch(i){console.error("Error al reanudar m√∫sica:",i)}},toggleSound(){return a=!a,localStorage.setItem("soundEnabled",a.toString()),a},toggleMusic(){return n=!n,localStorage.setItem("musicEnabled",n.toString()),n&&o?o.play().catch(i=>console.warn("Error al activar m√∫sica:",i)):o&&o.pause(),n},setVolume(i){c=Math.max(0,Math.min(1,i)),localStorage.setItem("soundVolume",c.toString())},setMusicVolume(i){l=Math.max(0,Math.min(1,i)),localStorage.setItem("musicVolume",l.toString()),o&&(o.volume=l)},loadAll(){console.log("Cargando todos los sonidos del juego..."),j()}}}const ie=Jo(),qe=Zt("boardUtils"),Zo=Xt.getInstance(),lt={icons:["üçé","üçá","üçä","üçì"],minCellSize:30,maxCellSize:80,cellMargin:8};function Ko(t){const o=Math.max(Eo,Math.min(wo,t));return qe.info(`Cambiando tama√±o del tablero a ${o}x${o}`),U.dispatch(dt(o)),o}function Xo(t){return(!t||t.length===0)&&(qe.warn("Intento de establecer un array vac√≠o de iconos, usando iconos por defecto"),t=lt.icons||[]),qe.info(`Estableciendo ${t.length} iconos disponibles`),U.dispatch(Ze(t)),t}function Qo(t){const{currentDifficulty:o,currentPlayMode:a,level:n}=U.getState().game,l=Zo.getIconsForLevel(n,o,a,t).map(r=>r.display);return qe.debug(`Seleccionados ${l.length} iconos aleatorios`),l}function St(t){const{spawnRate:o,currentDifficulty:a,currentPlayMode:n}=U.getState().game,c=Kt(),l=jo(t),r=Qo(l);return Ko(c),Xo(r),qe.info(`Tablero configurado para nivel ${t}`,{tama√±o:c,velocidad:`mantenida (${o}ms)`,iconos:r.length,dificultad:a,modo:n}),{size:c,spawnRate:o,icons:r}}function so(t,o,a){if(!t||!o){qe.warn("No se pueden ajustar los visuales del tablero: elementos no encontrados");return}const{boardSize:n}=U.getState().game,{minCellSize:c=lt.minCellSize,maxCellSize:l=lt.maxCellSize,cellMargin:r=lt.cellMargin}={},d=t.clientWidth,u=t.clientHeight,j=Math.min(d,u)-20,i=j-n*r*2,m=Math.floor(i/n),h=Math.max(c||30,Math.min(l||80,m)),w=h*n+r*2*n;o.style.width=`${w}px`,o.style.height=`${w}px`,document.documentElement.style.setProperty("--cell-size",`${h}px`),document.documentElement.style.setProperty("--board-size",`${n}`),document.documentElement.style.setProperty("--cell-gap",`${r}px`),o.style.position="relative",o.style.margin="auto",qe.debug("Tablero ajustado visualmente",{containerSize:{width:d,height:u},boardSize:w,cellSize:h,cellMargin:r,availableSize:j})}const Tt={easy:{spawnRate:1.3,scoreRequirement:.7,timeRequirement:.8},normal:{spawnRate:1,scoreRequirement:1,timeRequirement:1},hard:{spawnRate:.7,scoreRequirement:1.3,timeRequirement:1.2},tutorial:{spawnRate:2,scoreRequirement:.5,timeRequirement:.5}},st=[{id:1,boardSize:5,icons:["üå∂Ô∏è","üçå","üçä","ü•ë"],spawnRate:2e3,speedMultiplier:1,penaltyIcons:1,requirements:{classic:[{type:"score",value:1500,description:"Alcanza 1500 puntos"},{type:"occupation",value:5,description:"Mant√©n ocupaci√≥n menor al 5%"}],timed:[{type:"time",value:30,description:"Sobrevive 30 segundos"}],survival:[{type:"time",value:120,description:"Sobrevive 2 minutos"}],zen:[{type:"time",value:0,description:"Juega sin presi√≥n"}]},rewards:{classic:[{type:"points",value:500,description:"Bonus de nivel"}],zen:[{type:"points",value:100,description:"Bonus de zen"}]}},{id:2,boardSize:6,icons:["üçé","üçá","üçä","üçì","üçâ"],spawnRate:1800,speedMultiplier:1.1,penaltyIcons:2,requirements:{classic:[{type:"score",value:2e3,description:"Alcanza 2000 puntos"},{type:"occupation",value:15,description:"Mant√©n ocupaci√≥n menor al 15%"}],timed:[{type:"time",value:45,description:"Sobrevive 45 segundos"}],survival:[{type:"time",value:180,description:"Sobrevive 3 minutos"}],zen:[{type:"time",value:0,description:"Juega sin presi√≥n"}]},rewards:{classic:[{type:"points",value:750,description:"Bonus de nivel"}],zen:[{type:"points",value:150,description:"Bonus de zen"}]}},{id:3,boardSize:7,icons:["üçé","üçá","üçä","üçì","üçâ","üçå"],spawnRate:1600,speedMultiplier:1.2,penaltyIcons:3,requirements:{classic:[{type:"score",value:3e3,description:"Alcanza 3000 puntos"},{type:"occupation",value:15,description:"Mant√©n ocupaci√≥n menor al 15%"}],timed:[{type:"time",value:60,description:"Sobrevive 1 minuto"}],survival:[{type:"time",value:240,description:"Sobrevive 4 minutos"}],zen:[{type:"time",value:0,description:"Juega sin presi√≥n"}]},rewards:{classic:[{type:"points",value:1e3,description:"Bonus de nivel"}],zen:[{type:"points",value:200,description:"Bonus de zen"}]},specialFeatures:{specialIcons:{type:"specialIcon",enabled:!0,config:{probability:.05,types:["bomb","star"]}}}},{id:4,boardSize:8,icons:["üçé","üçá","üçä","üçì","üçâ","üçå","üçã"],spawnRate:1400,speedMultiplier:1.3,penaltyIcons:3,requirements:{classic:[{type:"score",value:4e3,description:"Alcanza 4000 puntos"},{type:"occupation",value:15,description:"Mant√©n ocupaci√≥n menor al 15%"}],timed:[{type:"time",value:75,description:"Sobrevive 1 minuto y 15 segundos"}],survival:[{type:"time",value:300,description:"Sobrevive 5 minutos"}],zen:[{type:"time",value:0,description:"Juega sin presi√≥n"}]},rewards:{classic:[{type:"points",value:1500,description:"Bonus de nivel"},{type:"hint",value:1,description:"Pista adicional"}],zen:[{type:"points",value:300,description:"Bonus de zen"},{type:"hint",value:1,description:"Pista adicional"}]},specialFeatures:{specialIcons:{type:"specialIcon",enabled:!0,config:{probability:.07,types:["bomb","star","rainbow"]}},bonusItems:{type:"bonus",enabled:!0,config:{probability:.03,types:["points","time"]}}}},{id:5,boardSize:9,icons:["üçé","üçá","üçä","üçì","üçâ","üçå","üçã","üçç"],spawnRate:1200,speedMultiplier:1.4,penaltyIcons:4,requirements:{classic:[{type:"score",value:5e3,description:"Alcanza 5000 puntos"},{type:"occupation",value:15,description:"Mant√©n ocupaci√≥n menor al 15%"}],timed:[{type:"time",value:90,description:"Sobrevive 1 minuto y 30 segundos"}],survival:[{type:"time",value:360,description:"Sobrevive 6 minutos"}],zen:[{type:"time",value:0,description:"Juega sin presi√≥n"}]},rewards:{classic:[{type:"points",value:2e3,description:"Bonus de nivel"},{type:"hint",value:2,description:"Pistas adicionales"}],zen:[{type:"points",value:400,description:"Bonus de zen"},{type:"hint",value:1,description:"Pista adicional"}]},specialFeatures:{specialIcons:{type:"specialIcon",enabled:!0,config:{probability:.08,types:["bomb","star","rainbow","clock"]}},bonusItems:{type:"bonus",enabled:!0,config:{probability:.05,types:["points","time","hint"]}},powerUps:{type:"powerup",enabled:!0,config:{probability:.03,types:["slowdown","clear"]}}}}];function en(t){const n=4+Math.min(6,Math.floor((t-1)/2)),c={id:t,boardSize:Math.min(12,5+Math.floor(t/2)),icons:Array.from({length:n},(r,d)=>{const u=["üçé","üçá","üçä","üçì","üçâ","üçå","üçã","üçç","üçë","üçí"];return u[d%u.length]}),spawnRate:Math.max(500,2e3-t*100),speedMultiplier:1+t*.1,penaltyIcons:Math.min(5,1+Math.floor(t/2)),requirements:{classic:[{type:"score",value:1500*t,description:`Alcanza ${1500*t} puntos`},{type:"occupation",value:5,description:"Mant√©n ocupaci√≥n menor al 5%"}],timed:[{type:"time",value:30+t*15,description:`Sobrevive ${30+t*15} segundos`}],survival:[{type:"time",value:120+t*60,description:`Sobrevive ${(120+t*60)/60} minutos`}],zen:[{type:"time",value:0,description:"Juega sin presi√≥n"}]},rewards:{classic:[{type:"points",value:500*t,description:"Bonus de nivel"}],zen:[{type:"points",value:100*t,description:"Bonus de zen"}]}},l={};return t>=3&&(l.specialIcons={type:"specialIcon",enabled:!0,config:{probability:.7+t*.01,types:["bomb","star"]}},t>=4&&l.specialIcons.config.types.push("rainbow"),t>=5&&l.specialIcons.config.types.push("clock")),t>=4&&(l.bonusItems={type:"bonus",enabled:!0,config:{probability:.03+t*.005,types:["points","time"]}},t>=5&&l.bonusItems.config.types.push("hint")),t>=5&&(l.powerUps={type:"powerup",enabled:!0,config:{probability:.03+(t-5)*.005,types:["slowdown","clear"]}},t>=7&&l.powerUps.config.types.push("freeze"),t>=9&&l.powerUps.config.types.push("double")),t>=6&&(l.obstacles={type:"obstacle",enabled:!0,config:{probability:.02+(t-6)*.003,types:["stone"]}},t>=8&&l.obstacles.config.types.push("ice"),t>=10&&l.obstacles.config.types.push("lock")),Object.keys(l).length>0&&(c.specialFeatures=l),c}function tn(t,o,a){const c=st.find(u=>u.id===t)||en(t),l=Tt[a],r=JSON.parse(JSON.stringify(c));r.spawnRate=Math.round(r.spawnRate*l.spawnRate),(!r.requirements[o]||r.requirements[o].length===0)&&(o==="zen"?r.requirements.zen=[{type:"time",value:0,description:"Juega sin presi√≥n"}]:o==="tutorial"?r.requirements.tutorial=[{type:"score",value:100,description:"Completa el tutorial"}]:r.requirements.classic?r.requirements[o]=[...r.requirements.classic]:r.requirements[o]=[{type:"score",value:1e3*t,description:`Alcanza ${1e3*t} puntos`}]);const d=r.requirements[o];return d&&d.forEach(u=>{u.type==="score"?(u.value=Math.round(u.value*l.scoreRequirement),u.description=`Alcanza ${u.value} puntos`):u.type==="time"&&o!=="zen"&&o!=="tutorial"&&(u.value=Math.round(u.value*l.timeRequirement),u.description=`Sobrevive ${u.value>=60?`${Math.floor(u.value/60)} minuto${u.value>=120?"s":""}`:""}${u.value%60>0?(u.value>=60?" y ":"")+`${u.value%60} segundo${u.value%60!==1?"s":""}`:""}`)}),r}Xt.getInstance();function on(t,o,a,n,c,l,r,d,u){if(o==="zen"||!c||c<=0)return!1;try{const j=tn(t,o,"normal");if(!j||!j.requirements)return!1;const m=d!==void 0&&d>=Mo,h=c*c,w=n/h*100;if(u===!1){if(N.info("LevelAdapter",`No hay movimientos v√°lidos. Ocupaci√≥n: ${w.toFixed(1)}%, Iconos: ${n}`),n<=2)return N.info("LevelAdapter",`Solo quedan ${n} iconos sin movimientos v√°lidos. Nivel completado.`),U.dispatch(je(`¬°Casi has limpiado el tablero! Solo quedan ${n} iconos sin posibilidad de movimientos.`)),!0;if(w<=30)return N.info("LevelAdapter",`Pocos iconos sin movimientos (${w.toFixed(1)}%). Nivel completado.`),U.dispatch(je(`¬°Has despejado gran parte del tablero! Solo queda un ${w.toFixed(1)}% de ocupaci√≥n sin movimientos disponibles.`)),!0;N.info("LevelAdapter",`No hay movimientos pero los iconos son muchos (${w.toFixed(1)}%). Continuando juego.`)}if(o==="classic"){const O=j.requirements.classic;if(!O||!Array.isArray(O))return!1;const F=O.find(G=>G.type==="score");if(F&&a>=F.value){N.info("LevelAdapter",`Nivel completado por puntuaci√≥n: ${a}/${F.value}`);const G=(U.getState().game.spawnRate/1e3).toFixed(1);return U.dispatch(je(`¬°Has alcanzado la puntuaci√≥n objetivo de ${F.value} puntos! Velocidad de aparici√≥n: ${G}s por icono.`)),!0}if(m){const G=O.find($=>$.type==="occupation");if(G&&w<=G.value){N.info("LevelAdapter",`Nivel completado por ocupaci√≥n: ${w.toFixed(1)}%/${G.value}%`);const $=(U.getState().game.spawnRate/1e3).toFixed(1);return U.dispatch(je(`¬°Has despejado el tablero por debajo del ${G.value}% de ocupaci√≥n requerido! Ocupaci√≥n actual: ${w.toFixed(1)}%. Velocidad de aparici√≥n: ${$}s por icono.`)),!0}}return u===!1&&n===0?(N.info("LevelAdapter","Tablero completamente vac√≠o. Nivel completado."),U.dispatch(je("¬°Has limpiado completamente el tablero! Impresionante.")),!0):!1}else if(o==="timed"){if(l!==void 0&&l<=0)return U.dispatch(je(`¬°Se ha agotado el tiempo! Has conseguido ${a} puntos en el tiempo l√≠mite.`)),!0}else if(o==="survival"){if(N.info("LevelAdapter",`Verificaci√≥n de nivel en modo supervivencia. Nivel: ${t}, Iconos: ${n}, ¬øSin movimientos?: ${!u}`),n<=0){N.info("LevelAdapter","Tablero completamente vac√≠o en modo supervivencia. Nivel completado.");const O=(U.getState().game.spawnRate/1e3).toFixed(1);return U.dispatch(je(`¬°Incre√≠ble! Has limpiado completamente el tablero eliminando todos los iconos. Velocidad de aparici√≥n: ${O}s por icono.`)),!0}if(!u&&n<=2){N.info("LevelAdapter",`No hay movimientos y quedan muy pocos iconos (${n}). Nivel supervivencia completado.`);const O=(U.getState().game.spawnRate/1e3).toFixed(1);return U.dispatch(je(`¬°Excelente estrategia! Quedan solo ${n} iconos sin posibilidad de movimientos. Velocidad de aparici√≥n: ${O}s por icono.`)),!0}return!1}return!1}catch(j){return N.error("LevelAdapter","Error verificando completado de nivel:",j),!1}}const Bt=5e3,nn=2,ao=(t,o,a)=>{const n=ct(t,o,a),{iconCount:c,occupationPercentage:l}=sn(t,o),r=U.getState().game,{currentPlayMode:d,currentDifficulty:u,spawnRate:j}=r;return N.info("Game",`Evaluaci√≥n de fin de nivel: Modo ${d}, ${c} iconos (${l.toFixed(1)}%)`),c===0?(an(),!1):n?!0:c<=nn?(cn(c),!1):l>=100?(ln(d,u,j),!1):(N.info("Game",`No hay movimientos v√°lidos pero quedan ${c} iconos. El juego contin√∫a.`),!0)},sn=(t,o)=>{let a=0;for(let l=0;l<o;l++)for(let r=0;r<o;r++)t[l][r]!==null&&a++;const n=o*o,c=a/n*100;return{iconCount:a,occupationPercentage:c}},an=()=>{N.info("Game","¬°VICTORIA PERFECTA! Tablero completamente vac√≠o"),He(Io(Bt)),He(je(`¬°VICTORIA PERFECTA! Has limpiado completamente el tablero. ¬°Bonus de ${Bt} puntos!`)),He(fe("levelCompleted")),ie.play("perfectClear")},cn=t=>{N.info("Game",`Victoria normal: ${t} iconos restantes sin movimientos posibles`),He(je(`¬°Nivel completado! Solo quedan ${t} iconos sin posibilidad de convergencia.`)),He(fe("levelCompleted")),ie.play("levelComplete")},ln=(t,o,a)=>{N.info("Game","Game Over: Tablero completamente lleno sin movimientos posibles");const n=(a/1e3).toFixed(1),c=`El tablero est√° completamente lleno sin movimientos posibles. Modo: ${t}, Dificultad: ${o}, Velocidad: ${n}s/icono.`;He(je(c)),He(fe("gameOver")),ie.play("gameOver")},He=U.dispatch,rn=()=>performance.now(),dn=t=>{const o=new Date,a=o.getHours().toString().padStart(2,"0"),n=o.getMinutes().toString().padStart(2,"0"),c=o.getSeconds().toString().padStart(2,"0"),l=o.getMilliseconds().toString().padStart(3,"0");return`${a}:${n}:${c}.${l}`},Ut=()=>dn(rn()),un={minIntervalPercentage:.25,minAbsoluteInterval:25,maxSpawningTimeout:250,maxIcons:100,maxAttempts:10,maxIconsPerRow:3,maxIconsPerColumn:3,maxConsecutiveIcons:2},mn=(t,o,a=un)=>{const n=s.useRef(!1),c=s.useRef(0),l=s.useRef(null),r=s.useCallback(()=>{n.current=!1,c.current=0,l.current&&(clearTimeout(l.current),l.current=null),N.debug("IconSpawner","Estado de spawning reiniciado")},[]),d=s.useCallback(()=>{l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{n.current&&(N.warn("IconSpawner",`Forzando reinicio de isSpawning despu√©s de ${a.maxSpawningTimeout}ms para prevenir bloqueo`),n.current=!1,l.current=null)},a.maxSpawningTimeout)},[a.maxSpawningTimeout]),u=s.useCallback(()=>{const j=Date.now(),i=new Date(j).toLocaleTimeString("es-ES",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3});console.log(`
**********************************************************`),console.log(`[${i}] INICIO DEL FLUJO: A√ëADIR ICONO ALEATORIO`);const m=U.getState().game,{board:h,boardSize:w,availableIcons:O,level:F,currentPlayMode:G}=m;if(console.log(`[${i}] Nivel: ${F}, Modo: ${G}`),console.log(`[${i}] Contador de iconos actual: ${Gt(h)}`),console.log(`[${i}] Iconos disponibles: ${O.join(", ")}`),console.log(`[${i}] Velocidad configurada: ${m.spawnRate}ms`),console.log("**********************************************************"),console.log(`[${i}] Fase 1: Marcando estado de spawning como activo`),n.current=!0,d(),m.status!=="playing"||!h||!O.length){console.log("Fase 2: Estado o tablero inv√°lidos - Cancelando spawn"),n.current=!1;return}console.log("Fase 2: Estado y tablero verificados (v√°lidos)");const $=t();if(console.log(`[${i}] Verificaci√≥n de movimientos v√°lidos: ${$?"S√ç":"NO"}`),!$&&(console.log(`[${i}] No hay movimientos v√°lidos disponibles`),!ao(h,w,O))){console.log(`[${i}] El juego ha terminado seg√∫n checkGameEndCondition`),n.current=!1;return}console.log(`[${i}] Fase 4: Buscando celdas vac√≠as para colocar nuevo icono`);const k=pn(h);if(console.log(`Celdas vac√≠as encontradas: ${k.length}`),k.length===0){console.log("Fase 5: No hay celdas vac√≠as disponibles - Tablero lleno"),console.log("Fase 6: Tablero completamente lleno - Game Over");const ae=(U.getState().game.spawnRate/1e3).toFixed(1),re=U.getState().game.currentDifficulty;U.dispatch(je(`El tablero est√° completamente lleno. No hay espacio para m√°s iconos. Dificultad: ${re}, Velocidad: ${ae}s/icono.`)),U.dispatch(fe("gameOver")),console.log(`**********************************************************
`),n.current=!1;return}console.log("Fase 5: Seleccionando celda aleatoria y colocando icono");const te=Math.floor(Math.random()*k.length),{row:D,col:_}=k[te],V=O[Math.floor(Math.random()*O.length)],ee=h.map(ae=>[...ae]);ee[D][_]=V,U.dispatch(Ke(ee));const P=Gt(ee);console.log(`Icono ${V} colocado en [${D},${_}]. Total de iconos: ${P}`),console.log(`**********************************************************
`),n.current=!1,c.current=j},[t,d,o,a.maxSpawningTimeout]);return s.useEffect(()=>()=>{l.current&&clearTimeout(l.current)},[]),{addRandomIcon:u,isSpawningRef:n,lastIconAddedTimeRef:c,resetSpawningState:r}},Gt=t=>{let o=0;for(let a=0;a<t.length;a++)for(let n=0;n<t[a].length;n++)t[a][n]!==null&&o++;return o},pn=t=>{const o=[];for(let a=0;a<t.length;a++)for(let n=0;n<t[a].length;n++)t[a][n]===null&&o.push({row:a,col:n});return o},fn=Oo,io=()=>{const t=ke(),{board:o,iconCount:a,status:n,spawnRate:c,boardSize:l,availableIcons:r,currentPlayMode:d,currentDifficulty:u,score:j,level:i,highlightedCells:m,hintsRemaining:h,hintCooldown:w,timeRemaining:O,survivalTime:F}=De(p=>p.game),{addNotification:G}=Qt(),$=s.useRef(null),k=s.useRef(null),te=s.useRef(!1),D=s.useRef(!1),_=s.useRef(null),V=s.useRef({}),ee=s.useRef(!1),P=s.useRef(!1),ae=s.useRef(null),re=s.useRef(0),me=s.useRef(0),J=s.useCallback((p,b,A)=>{const T=`${p}-${b}`;A?V.current[T]=A:delete V.current[T]},[]),ce=s.useCallback(()=>{const p=U.getState().game,{board:b,boardSize:A,availableIcons:T}=p;return ct(b,A,T)},[]),de=(p,b,A)=>{if(p[b][A]!==null)return console.log(`[CONVERGENCE] La celda [${b},${A}] no est√° vac√≠a, saltando verificaci√≥n`),!1;const T={};[{dr:-1,dc:0,name:"arriba"},{dr:1,dc:0,name:"abajo"},{dr:0,dc:-1,name:"izquierda"},{dr:0,dc:1,name:"derecha"}].forEach(({dr:g,dc:Q,name:z})=>{let X=b+g,se=A+Q;for(;X>=0&&X<l&&se>=0&&se<l;){const H=p[X][se];if(H!==null&&!H.includes("_removing")){T[H]||(T[H]={count:0,positions:[]}),T[H].count++,T[H].positions.push({row:X,col:se});break}X+=g,se+=Q}});let y=!1,x=[];for(const g in T)T[g].count>=2&&(y=!0,x.push({icon:g,count:T[g].count,positions:T[g].positions}));return y&&(console.log(`[CONVERGENCE] Convergencia posible en celda [${b},${A}]:`),x.forEach(g=>{console.log(`[CONVERGENCE] - Icono ${g.icon}: ${g.count} ocurrencias en posiciones: ${JSON.stringify(g.positions)}`)})),y},E=s.useCallback((p=l,b=!1,A)=>{const{currentDifficulty:T,currentPlayMode:B,level:y,boardSize:x}=U.getState().game,g=A!==void 0?A:y;console.log(`
**********************************************************`),console.log("INICIO DEL FLUJO: INICIALIZAR TABLERO"),console.log(`Tama√±o: ${p}, Nivel: ${g}, Modo: ${B}`),console.log(`Estado: ${n}, Dificultad: ${T}`);const Q=U.getState().game.availableIcons;if(console.log(`Iconos para nivel ${g}: ${Q.join(", ").substring(0,100)}${Q.length>10?"...":""}`),console.log("**********************************************************"),g<=0||!b&&P.current&&x===p)return console.log("ADVERTENCIA: Tablero ya inicializado o condiciones no v√°lidas para inicializaci√≥n"),o;P.current=!1;const z=p||Kt(),X=Array(z).fill(null).map(()=>Array(z).fill(null)),se=Ft(T);let H;if(se&&se.initialIconCount!==void 0)H=se.initialIconCount,console.log(`Usando initialIconCount de dificultad ${T}: ${H} iconos`);else{const ue=Math.floor(z*z*.33);H=Math.max(12,ue),console.log(`Calculando iconos iniciales: ${H} (33% del tablero)`)}if(g>=2){const ue=1+(g-1)*.1;H=Math.min(Math.floor(H*ue),Math.floor(z*z*.5)),console.log(`Nivel ${g}: Ajustando iconos iniciales a ${H} (incremento nivel ${ue.toFixed(1)}x)`)}console.log(`Fase 1: Calculados ${H} iconos iniciales para nivel ${g}`);const Se=Math.floor(z*z*.5);H>Se&&(console.log(`Limitando iconos: ${H} > ${Se} (50% del tablero)`),H=Se),N.info(`Inicializando tablero con ${H} iconos iniciales`,`Modo: ${B}, Dificultad: ${T}, Nivel: ${g}`);const xe=Vo([...Q]),ve=xe[0];console.log("Fase 2: Colocando iconos iniciales garantizados");const ge=Te(2,z-3),$e=Te(2,z-3);X[ge][$e]=ve;const Ce=[{dr:-1,dc:0},{dr:0,dc:1},{dr:1,dc:0},{dr:0,dc:-1}],Ye=Te(0,4);let ht=Te(0,4);for(;Math.abs(Ye-ht)===2;)ht=Te(0,4);const Lt=Ce[Ye];X[ge+Lt.dr][$e+Lt.dc]=ve;const Rt=Ce[ht];X[ge+Rt.dr][$e+Rt.dc]=ve;let et=3;if(console.log(`Fase 3: Grupo inicial garantizado colocado (${et} iconos)`),xe.length>1&&H>=6){const ue=xe[1];let pe=!1;for(let ye=0;ye<10&&!pe;ye++){const Ne=Te(2,z-3),Oe=Te(2,z-3);if(Math.abs(Ne-ge)+Math.abs(Oe-$e)>=4){X[Ne][Oe]=ue;const ze=Te(0,4);let We=Te(0,4);for(;Math.abs(ze-We)===2;)We=Te(0,4);const Be=Ce[ze];X[Ne+Be.dr][Oe+Be.dc]=ue;const Ue=Ce[We];X[Ne+Ue.dr][Oe+Ue.dc]=ue,et+=3,pe=!0}}pe&&console.log(`Fase 4: Segundo grupo garantizado colocado (total: ${et} iconos)`)}console.log(`Fase 5: Colocando iconos aleatorios adicionales hasta ${H}`);let Ot=H*5;for(;et<H&&Ot>0;){Ot--;const ue=Te(0,z),pe=Te(0,z);if(X[ue][pe]===null){let ye=!1,Ne=0;for(;!ye&&Ne<10;){const Oe=Te(0,Q.length),ze=Q[Oe];X[ue][pe]=ze,de(X,ue,pe)?X[ue][pe]=null:(ye=!0,et++),Ne++}ye||(X[ue][pe]=null)}}const At=ct(X,z,Q);if(console.log(`Fase 6: Verificaci√≥n de movimientos v√°lidos: ${At?"OK":"Sin movimientos"}`),!At){console.log("ADVERTENCIA: Tablero inicializado sin movimientos v√°lidos. Corrigiendo...");let ue=!1;for(let pe=0;pe<z&&!ue;pe++)for(let ye=0;ye<z&&!ue;ye++)if(X[pe][ye]===null)for(const Ne of Ce){const Oe=pe+Ne.dr,ze=ye+Ne.dc;if(Oe>=0&&Oe<z&&ze>=0&&ze<z&&X[Oe][ze]!==null){const We=X[Oe][ze];for(const Be of Ce)if(Ne.dr!==Be.dr||Ne.dc!==Be.dc){const Ue=pe+Be.dr,at=ye+Be.dc;if(Ue>=0&&Ue<z&&at>=0&&at<z&&X[Ue][at]===null){X[Ue][at]=We,ue=!0,console.log(`Fase 7: Correcci√≥n aplicada, movimiento v√°lido creado en [${pe},${ye}]`);break}}if(ue)break}}}let tt=0;for(let ue=0;ue<z;ue++)for(let pe=0;pe<z;pe++)X[ue][pe]!==null&&tt++;if(N.info(`Tablero inicializado con ${tt} iconos`,`Objetivo: ${H}, Tama√±o tablero: ${z}x${z}, Nivel: ${g}`),console.log(`Fase 8: Tablero final con ${tt}/${H} iconos (${(tt/(z*z)*100).toFixed(1)}% ocupaci√≥n)`),t(Ke(X)),console.log("Fase 9: Tablero actualizado en el estado global"),t(It(tt)),B==="classic"){const ue=Je.CLASSIC.initialScoreTarget*Math.pow(Je.CLASSIC.scoreTargetMultiplier,g-1),pe=Math.max(30,Je.CLASSIC.initialOccupationTarget-g*Je.CLASSIC.occupationDecreasePerLevel);t(vt({score:Math.round(ue),occupation:Math.round(pe)}))}else if(B==="timed"){const ue=Je.TIMED.initialTimeLimit-(g-1)*Je.TIMED.timeDecreasePerLevel;t(bt(Math.max(30,ue)))}const Dt=_o(g,B,Ao,fn);return t(Ae(Dt)),console.log(`Fase 10: SpawnRate configurado a ${Dt}ms para nivel ${g}`),P.current=!0,console.log("Fase 11: Tablero marcado como inicializado"),(()=>{const{currentDifficulty:ue,currentPlayMode:pe}=U.getState().game,ye=U.getState().game.spawnRate;console.log("[VELOCIDAD] Verificando configuraci√≥n de velocidad:"),console.log(`- SpawnRate actual: ${ye}ms`);const Ne=le.getInitialSpeed(ue,pe);console.log(`- Velocidad inicial calculada: ${Ne}ms`),ye!==Ne?(console.log(`[VELOCIDAD] Actualizando velocidad: ${ye}ms ‚Üí ${Ne}ms`),t(Ae(Ne))):console.log(`[VELOCIDAD] Manteniendo velocidad actual: ${ye}ms`)})(),(()=>{const pe=U.getState().game.currentDifficulty,ye=Le.TIME_WINDOWS[pe]||Le.TIME_WINDOWS.normal;console.log(`[COMBO CONFIG] Actualizando ventana de tiempo de combo para dificultad ${pe}: ${ye}ms`),t({type:"game/setComboTimeWindow",payload:ye}),setTimeout(()=>{const Ne=U.getState().game;console.log(`[COMBO CONFIG] Verificaci√≥n: La ventana de tiempo actual es ${Ne.comboTimeWindow}ms`)},0)})(),console.log(`**********************************************************
`),console.log(`FIN DEL FLUJO: TABLERO INICIALIZADO CORRECTAMENTE PARA NIVEL ${g}`),X},[t]),Y={maxSpawningTimeout:0},{addRandomIcon:f,isSpawningRef:S,lastIconAddedTimeRef:I,resetSpawningState:L}=mn(ce,G,Y),le=To(),ne=s.useCallback(()=>{const p=Date.now(),b=p-me.current,{spawnRate:A,currentDifficulty:T}=U.getState().game;if(b>=3e4){const B=le.calculateIncreasedSpeed(A,T);if(Math.abs(A-B)>=50){const y=((A-B)/A*100).toFixed(1),x=(A/1e3).toFixed(1),g=(B/1e3).toFixed(1);t(Ae(B)),me.current=p,G({message:"¬°Aumento de velocidad!",type:"warning",icon:"‚ö°",duration:3e3,value:`${x}s ‚Üí ${g}s (${y}% m√°s r√°pido)`}),console.log(`[VELOCIDAD] Aumento autom√°tico: ${A}ms ‚Üí ${B}ms (${y}% m√°s r√°pido)`)}}},[t,G,le]),M=s.useCallback(()=>{me.current=Date.now(),console.log(`[VELOCIDAD] Temporizador de aumento reiniciado en: ${new Date(me.current).toLocaleTimeString()}`)},[]),C=s.useCallback(()=>{const p=Ut();console.log(`
[${p}] **********************************************************`),console.log(`[${p}] INICIO DEL FLUJO: DETENER TEMPORIZADORES`),console.log(`[${p}] Estado: ${n}, Temporizadores activos: ${ee.current?"S√≠":"No"}`),console.log(`[${p}] **********************************************************`),ee.current||N.debug("GameLogic","Los temporizadores ya estaban detenidos"),ee.current=!1,$.current&&(clearInterval($.current),$.current=null,console.log(`[${p}] Fase 1: Temporizador de tiempo de juego detenido`)),k.current&&(clearInterval(k.current),k.current=null,console.log(`[${p}] Fase 2: Temporizador de spawn de iconos detenido`)),console.log(`[${p}] Fase 3: Referencias de temporizadores reiniciadas`),console.log(`[${p}] **********************************************************`),console.log(`
[${p}] FIN DEL FLUJO: TEMPORIZADORES DETENIDOS CORRECTAMENTE`)},[n]),W=s.useCallback((p=!1)=>{const b=Ut(),A=U.getState().game,{status:T,currentPlayMode:B,level:y,spawnRate:x}=A;if(console.log(`
[${b}] **********************************************************`),console.log(`[${b}] INICIO DEL FLUJO: INICIAR TEMPORIZADORES`),console.log(`[${b}] Nivel: ${y}, SpawnRate: ${x}ms, Modo: ${B}`),console.log(`[${b}] Forzar inicio: ${p?"S√≠":"No"}, Temporizadores activos: ${ee.current?"S√≠":"No"}`),console.log(`[${b}] Estado actual del juego: ${T}`),console.log(`[${b}] **********************************************************`),ee.current&&!p){console.log(`[${b}] Los temporizadores ya est√°n activos.`);return}if(T!=="playing"&&!p){console.log(`[${b}] Fase 1: No se inician temporizadores porque el estado es ${T}`);return}$.current&&(console.log(`[${b}] Deteniendo temporizador de tiempo existente`),clearInterval($.current),$.current=null),k.current&&(console.log(`[${b}] Deteniendo temporizador de √≠conos existente`),clearInterval(k.current),k.current=null),M(),console.log("[VELOCIDAD] Temporizador de velocidad iniciado. Pr√≥ximo aumento en 30 segundos."),console.log(`[${b}] Fase 2: Referencias de temporizadores establecidas`),L(),$.current=setInterval(()=>{if(U.getState().game.status==="playing"){if(re.current++,t($o()),B==="timed"){const X=U.getState().game.timeRemaining;if(X>0&&(t(zt()),X===1)){t(je("¬°Se acab√≥ el tiempo! Modo contrarreloj finalizado.")),t(fe("gameOver"));return}}B==="survival"&&t(zt()),ne()}},1e3),console.log(`[${b}] Fase 3: Temporizador de tiempo de juego iniciado`);const g=x;setTimeout(()=>{U.getState().game.status==="playing"&&f()},0);const Q=()=>{k.current&&clearInterval(k.current),k.current=setInterval(()=>{if(U.getState().game.status==="playing"){if(ae.current!==x){ae.current=x,Q();return}f(),N.debug("GameLogic",`Intervalo de spawn activado (${x}ms)`)}},g)};Q(),console.log(`[${b}] Fase 4: Temporizador de spawn de iconos iniciado (cada ${g}ms)`),I.current=0,ae.current=g,ee.current=!0,console.log(`[${b}] **********************************************************`),console.log(`[${b}] FIN DEL FLUJO: TEMPORIZADORES INICIADOS CORRECTAMENTE`)},[t,G,n,d,f,M,L,ne]);s.useEffect(()=>()=>{C(),L()},[C,L]),s.useCallback(p=>{if(p.length===0)return;const b=o.map(T=>[...T]);t(Ie(p));const A=b.map(T=>[...T]);for(const T of p){const B=A[T.row][T.col];B!==null&&(A[T.row][T.col]=`${B}_removing`)}t(Ke(A)),requestAnimationFrame(()=>{setTimeout(()=>{const T=A.map(ge=>[...ge]);let B=0;for(const ge of p)T[ge.row][ge.col]=null,B++;t(Ke(T));const{comboTimestamp:y,comboTimeWindow:x,comboMultiplier:g,comboCount:Q}=U.getState().game,z=Date.now();console.log(`
[COMBO DEBUG] ===== Inicio de an√°lisis de combo =====`),console.log(`[COMBO DEBUG] Iconos eliminados: ${B}`),console.log(`[COMBO DEBUG] Estado actual: Combo: ${Q}, Multiplicador: ${g.toFixed(1)}x`),console.log(`[COMBO DEBUG] Timestamp actual: ${z}`),console.log(`[COMBO DEBUG] Timestamp √∫ltima eliminaci√≥n: ${y}`),console.log(`[COMBO DEBUG] Ventana de tiempo: ${x}ms`);const X=y===0?0:z-y;console.log(`[COMBO DEBUG] Tiempo transcurrido: ${X}ms`),console.log(`[COMBO DEBUG] ¬øDentro de ventana de tiempo?: ${X<=x?"S√ç":"NO"}`),y===0||Q===0?(console.log("[COMBO DEBUG] Primer combo detectado, iniciando secuencia"),t(Ve())):X<=x?(console.log("[COMBO DEBUG] Tiempo dentro de ventana, incrementando combo"),t(Ve())):(console.log("[COMBO DEBUG] Tiempo fuera de ventana, reiniciando combo"),t(nt()),setTimeout(()=>{console.log("[COMBO DEBUG] Iniciando nuevo combo despu√©s del reset"),t(Ve())},0));const se=U.getState().game,H=se.comboMultiplier,Se=B*10*i,xe=Math.floor(Se*H);if(t(Ve(Se)),console.log(`[COMBO DEBUG] Puntos base: ${Se} (${B} iconos √ó 10 √ó nivel ${i})`),console.log(`[COMBO DEBUG] Multiplicador aplicado: ${H.toFixed(1)}x`),console.log(`[COMBO DEBUG] Puntos finales con combo: ${xe}`),t(Pe(xe)),v(Se,p[0].row,p[0].col),console.log(`[COMBO DEBUG] Combo actual: ${se.comboCount}, verificando hitos`),se.comboCount===10){const ge=Le.MILESTONE_BONUSES[10];t(Pe(ge)),console.log(`[COMBO DEBUG] ¬°HITO! Combo x10 alcanzado. +${ge} puntos extra`)}else if(se.comboCount===20){const ge=Le.MILESTONE_BONUSES[20];t(Pe(ge)),console.log(`[COMBO DEBUG] ¬°HITO! Combo x20 alcanzado. +${ge} puntos extra`)}else if(se.comboCount===30){const ge=Le.MILESTONE_BONUSES[30];t(Pe(ge)),console.log(`[COMBO DEBUG] ¬°HITO! Combo x30 alcanzado. +${ge} puntos extra`)}H>1&&(console.log(`[COMBO DEBUG] Mostrar notificaci√≥n de combo: x${se.comboCount} (${H.toFixed(1)}x)`),H>=5?(ie.play("comboLarge"),console.log("[COMBO DEBUG] Reproduciendo sonido: comboLarge")):H>=3?(ie.play("comboMedium"),console.log("[COMBO DEBUG] Reproduciendo sonido: comboMedium")):H>=1.5&&(ie.play("comboSmall"),console.log("[COMBO DEBUG] Reproduciendo sonido: comboSmall"))),console.log(`[COMBO DEBUG] ===== Fin de an√°lisis de combo =====
`);const ve=a-B;if(t(It(ve)),d==="timed"){const ge=Math.max(5,B*3);t({type:"game/addTimeBonus",payload:ge}),ie.play("timeBonus"),console.log(`Bonus de tiempo a√±adido: +${ge} segundos`)}ie.play("removeIcon"),v(Se,p[0].row,p[0].col)},50)})},[o,t,a,d,i]);const Z=s.useCallback((p,b)=>{so(p,b)},[]),be=s.useCallback(()=>{if(h<=0||w===!0)return!1;let p=!1,b=[];for(let A=0;A<l&&!p;A++)for(let T=0;T<l&&!p;T++)if(o[A][T]!==null){const B=qo(o,A,T,l);if(B.hasConvergence){p=!0,b=B.convergingCells;break}}return p&&b.length>0?(t(eo()),t(Ie(b)),ie.play("hint"),_.current&&clearTimeout(_.current),_.current=setTimeout(()=>{t(Ie([])),_.current=null},2e3),t(to()),!0):!1},[o,l,h,w,t]),Me=s.useCallback(()=>(C(),setTimeout(()=>{E(),t(xt()),W()},100),!0),[t,C,E,W,i]),he=s.useCallback(()=>{t(ut(i+1)),C(),E(),t(xt()),t(fe("playing"))},[t,i,E,C]);s.useEffect(()=>{if(n!=="playing"||!o||o.length===0||a===0)return;const p=setTimeout(()=>{U.getState().game.status==="playing"&&ao(o,l,r)},100);return()=>clearTimeout(p)},[o,n,l,ce,t,a]);const Ee=s.useCallback(p=>{console.log(`
**********************************************************`),console.log("INICIO DEL FLUJO: CAMBIO DE CONFIGURACI√ìN DEL JUEGO"),console.log(`Cambiando a dificultad: ${p.difficulty}, modo: ${p.mode}`),console.log("**********************************************************"),C(),P.current=!1,t(Lo(p.difficulty)),t(Ro(p.mode)),setTimeout(()=>{const{level:A,status:T}=U.getState().game,B=Pt(A);t(Ze(B));const y=kt();t(dt(y));const x=Ft(p.difficulty);if(x){const z=le.getInitialSpeed(p.difficulty,d);console.log(`Aplicando configuraci√≥n de dificultad ${p.difficulty}:`),console.log(`- SpawnRate inicial: ${z}ms`),console.log(`- √çconos iniciales: ${x.initialIconCount}`),console.log(`- Penalizaci√≥n: ${x.penaltyIcons} √≠conos`),console.log(`- Nivel m√°ximo: ${x.maxLevel}`),t(Ae(z))}const g=Do(p.difficulty,p.mode);if(p.mode==="classic"){const z=Math.round(g.initialScoreTarget*Math.pow(g.scoreTargetMultiplier||1.5,A-1)),X=it[p.difficulty]||it.normal,se=Math.round(z*X.scoreRequirement),H=Math.max(30,g.initialOccupationTarget-A*(g.occupationDecreasePerLevel||0));console.log(`Configurando objetivos para nivel ${A}:`),console.log(`- Puntuaci√≥n objetivo: ${se} puntos`),console.log(`- Ocupaci√≥n objetivo: ${Math.round(H)}%`),t(vt({score:se,occupation:Math.round(H)}))}else if(p.mode==="timed"){let z=g.initialTimeLimit-(A-1)*(g.timeDecreasePerLevel||10);const X=it[p.difficulty]||it.normal;z=Math.round(z*X.timeRequirement),console.log(`Configurando tiempo l√≠mite para nivel ${A}: ${z} segundos`),t(bt(Math.max(30,z)))}const Q=Le.TIME_WINDOWS[p.difficulty]||Le.TIME_WINDOWS.normal;console.log(`Configurando ventana de tiempo para combos: ${Q}ms`),t({type:"game/setComboTimeWindow",payload:Q}),E(y,!0),setTimeout(()=>{const z=U.getState().game;console.log("Verificaci√≥n de configuraci√≥n aplicada:"),console.log(`- Dificultad: ${z.currentDifficulty}`),console.log(`- Modo: ${z.currentPlayMode}`),console.log(`- SpawnRate: ${z.spawnRate}ms`),console.log(`- Ventana de combo: ${z.comboTimeWindow}ms`)},50),T==="playing"&&W(!0)},50),console.log("**********************************************************"),console.log("FIN DEL FLUJO: CONFIGURACI√ìN DEL JUEGO ACTUALIZADA")},[t,C,E,W,G]);s.useCallback((p,b)=>Ee({difficulty:p,mode:b}),[Ee]);const Fe=()=>{if(n!=="playing"||a===0)return!1;const p=ce();return on(i,d,j,a,l,O,F,re.current,p)},we=s.useCallback(()=>{N.info(`Configurando tablero para nivel ${i}`,`Tama√±o: ${l}, Modo: ${d}`);const p=kt(),b=le.calculateLevelSpeed(i+1,d,u),A=Pt(i+1);if(t(dt(p)),t(Ae(b)),t(Ze(A)),d==="classic"){const T=Ge.classic.baseScore,B=Ge.classic.scoreMultiplier,y=Math.floor(T*Math.pow(B,i)),x=Ge.classic.baseOccupation,g=Ge.classic.occupationDecrease,Q=Math.max(20,x-i*g);t(vt({score:y,occupation:Q}))}else if(d==="timed"){const T=Ge.timed.baseTime,B=Ge.timed.timeDecreasePerLevel,y=Math.max(30,T-i*B);t(bt(y))}t(xt()),N.debug("Configuraci√≥n de nuevo nivel aplicada",{nivel:i+1,tama√±oTablero:p,velocidad:b,iconos:A.length})},[d,i,t,G,u,le]),R=s.useCallback(()=>{const{level:p,currentPlayMode:b,spawnRate:A,iconCount:T}=U.getState().game;console.log(`
**********************************************************`),console.log("INICIO DEL FLUJO: REINICIAR SISTEMAS PARA NUEVO NIVEL"),console.log(`Nivel actual: ${p}, Modo: ${b}`),console.log(`SpawnRate: ${A}ms, Iconos en tablero: ${T}`),console.log("**********************************************************"),C(),console.log("Fase 1: Temporizadores detenidos"),te.current=!1,S.current=!1,D.current=!1,console.log("Fase 2: Referencias de estado reiniciadas"),$.current&&(clearInterval($.current),$.current=null),k.current&&(clearInterval(k.current),k.current=null),console.log("Fase 3: Intervalos residuales limpiados");const{level:B,spawnRate:y}=U.getState().game;return console.log(`Fase 4: Estado actual obtenido: nivel=${B}, spawnRate=${y}ms`),t(Ae(y)),console.log(`Fase 5: SpawnRate actualizado a ${y}ms`),M(),console.log("Fase 6: Contador de incremento de velocidad reiniciado"),b==="survival"&&console.log(`Fase 7: Manteniendo tiempo de supervivencia (modo ${b})`),t(Ie([])),console.log("Fase 8: Celdas resaltadas limpiadas"),console.log(`**********************************************************
`),console.log("FIN DEL FLUJO: SISTEMAS REINICIADOS CORRECTAMENTE"),!0},[t,C]),v=s.useCallback((p,b,A)=>{const{comboCount:T,comboMultiplier:B,lastComboPoints:y}=U.getState().game;T>=3||G({message:"¬°Puntos!",type:"success",icon:"üí∞",duration:1e3,value:`+${p}`})},[G]),K=s.useCallback((p,b,A)=>{if(!ct(p,b,A)){let B=0;for(let g=0;g<b;g++)for(let Q=0;Q<b;Q++)p[g][Q]!==null&&B++;const y=b*b,x=B/y*100;if(B===0){t(je("¬°VICTORIA PERFECTA! Has limpiado completamente el tablero.")),t(fe("levelCompleted")),ie.play("perfectClear");return}if(B<=2){t(je(`¬°Nivel completado! Solo quedan ${B} iconos sin posibilidad de convergencia.`)),t(fe("levelCompleted")),ie.play("levelComplete");const{level:g}=U.getState().game;t(ut(g+1));return}if(x>=100){const{currentPlayMode:g,currentDifficulty:Q,spawnRate:z}=U.getState().game,X=(z/1e3).toFixed(1),se=`El tablero est√° completamente lleno sin movimientos posibles. Modo: ${g}, Dificultad: ${Q}, Velocidad: ${X}s/icono.`;t(je(se)),t(fe("gameOver")),ie.play("gameOver");return}}},[t]);return{board:o,boardSize:l,status:n,iconCount:a,level:i,score:j,highlightedCells:m,initializeBoard:E,adjustBoardSize:Z,stopTimers:C,startTimers:W,registerCellRef:J,showHint:be,resetCurrentLevel:Me,advanceToNextLevel:he,resetSystemsForNewLevel:R,findConvergingIcons:s.useCallback((p,b)=>Yo(o,p,b,l),[o,l]),changeGameConfig:Ee,checkLevelCompleted:Fe,configureBoardForNewLevel:we,checkGameState:K}},mt=Zt("hintUtils");function gn(t,o){for(let a=0;a<o;a++)for(let n=0;n<o;n++)if(t[a][n]===null){const c=co(t,a,n,o);if(c.length>=2)return mt.debug("Encontrada posici√≥n para pista",{row:a,col:n,iconos:c}),{row:a,col:n,icons:c}}return mt.debug("No se encontr√≥ posici√≥n para pista"),null}function co(t,o,a,n){if(t[o][a]!==null)return mt.debug("findConvergingIcons: la celda no est√° vac√≠a",{row:o,col:a}),[];const c=[{dr:-1,dc:0},{dr:0,dc:1},{dr:1,dc:0},{dr:0,dc:-1}],l={};for(const{dr:d,dc:u}of c){let j=o+d,i=a+u;for(;j>=0&&j<n&&i>=0&&i<n;){if(t[j][i]!==null){const m=t[j][i];l[m]||(l[m]=[]),l[m].push({row:j,col:i,icon:m});break}j+=d,i+=u}}const r=[];for(const d in l)l[d].length>=2&&r.push(...l[d]);return r.length>=2?(mt.debug("Convergencias encontradas",{grupos:Object.keys(l).filter(d=>l[d].length>=2).length,totalIconos:r.length}),r):[]}function hn(t){return t?t.icons.map(({row:o,col:a})=>({row:o,col:a})):[]}function vn(t,o){return t>0&&!o}const Vt=(t,o)=>{if(!t)return;t.classList.add("error"),ie.play("invalidMove");const a=setTimeout(()=>{t.classList.remove("error")},500);o(a)},_t=t=>{const o=document.querySelector(".game-board-grid");if(!o)return;o.classList.add("shake");const a=setTimeout(()=>{o.classList.remove("shake")},500);t(a)},bn=(t,o,a)=>{const{currentDifficulty:n}=U.getState().game,c=oo.calculatePenaltyRate(t,n);if(Math.abs(t-c)>=50){const l=((t-c)/t*100).toFixed(1);(t/1e3).toFixed(1),(c/1e3).toFixed(1),o(Ae(c)),N.info("Game",`Penalizaci√≥n de velocidad aplicada: ${t}ms ‚Üí ${c}ms (${l}% m√°s r√°pido)`)}return c},xn=(t,o,a,n,c,l,r)=>{try{ie.play("invalidMove");const d=Math.min(4,Math.max(1,Math.floor(t/2)));if(d<=0||!o||!n.length)return 0;N.info("PenaltyManager",`Aplicando penalizaci√≥n: a√±adiendo ${d} iconos`);const u=[];for(let m=0;m<a;m++)for(let h=0;h<a;h++)o[m]&&o[m][h]===null&&u.push({row:m,col:h});if(u.length===0)return 0;for(let m=u.length-1;m>0;m--){const h=Math.floor(Math.random()*(m+1));[u[m],u[h]]=[u[h],u[m]]}const j=Math.min(d,u.length);let i=0;for(let m=0;m<j;m++){const h=u[m],w=n[Math.floor(Math.random()*n.length)];c(Fo({row:h.row,col:h.col,icon:w,isPenalty:!0})),i++,setTimeout(()=>{const O=l(h.row,h.col);if(O){O.classList.add("penalty-icon");const F=setTimeout(()=>{O.classList.remove("penalty-icon"),O.classList.add("penalty-fade-out");const G=setTimeout(()=>{O.classList.remove("penalty-fade-out")},500);r(G),N.info("PenaltyManager",`Animaci√≥n de penalizaci√≥n completada: [${h.row},${h.col}]`)},2e3);r(F)}},50*m)}return i}catch(d){const u=d instanceof Error?d.message:String(d);return N.error("PenaltyManager",`Error al aplicar penalizaci√≥n: ${u}`),0}},Cn=()=>{const t=ke(),{board:o,status:a,boardSize:n,availableIcons:c,highlightedCells:l,hintsRemaining:r,hintCooldown:d,score:u,spawnRate:j,iconCount:i,comboCount:m,comboMultiplier:h,comboTimestamp:w,comboTimeWindow:O,level:F,lastComboPoints:G}=De(R=>R.game),{addNotification:$}=Qt(),k=s.useRef({}),te=s.useRef(null),D=s.useRef(null),_=s.useRef([]),[V,ee]=s.useState(!1),[P,ae]=s.useState(1),[re,me]=s.useState(!1),J=s.useRef(!1),ce=s.useRef(null),de=s.useCallback(()=>{N.info("Deteniendo todos los temporizadores"," ["+a+"]"),te.current&&(clearInterval(te.current),te.current=null),D.current&&(clearTimeout(D.current),D.current=null),_.current.forEach(R=>clearTimeout(R)),_.current=[],me(!1),ee(!1)},[]),E=s.useCallback(R=>{_.current.push(R)},[]),Y=s.useCallback((R,v)=>k.current[`${R}-${v}`]||null,[]),f=s.useCallback((R,v,K)=>{const{comboCount:p,comboMultiplier:b,lastComboPoints:A}=U.getState().game,T=p>=3,B=b.toFixed(1);if(v===void 0||K===void 0){$({message:"¬°Puntos conseguidos!",type:"success",icon:"üèÜ",duration:1500,value:`+${R}`});return}const y=Y(v,K);if(!y)return;const x=document.createElement("div");x.className="points-popup clean-style";let g="#FFFFFF",Q="";T&&(b>=5?(g="#FFD700",Q="combo-legendary-text"):b>=3?(g="#FF00FF",Q="combo-epic-text"):b>=2?(g="#9932CC",Q="combo-rare-text"):b>=1.5?(g="#1E90FF",Q="combo-uncommon-text"):(g="#FFFFFF",Q="combo-basic-text"));const z=document.documentElement.classList.contains("performance-mode");if(T){const se=document.createElement("div");se.className=`combo-display ${Q}`;const H=document.createElement("div");H.className="base-points-display";const Se=document.createElement("span");Se.className="base-points-text",Se.textContent=`+${R}`,Se.style.color=g;const xe=document.createElement("span");xe.className="multiplier-text",xe.textContent=` x${B}`,xe.style.color=g,z?(Se.style.animation="fadeInScaleLite 0.15s ease-out forwards",xe.style.animation="fadeInSlideRightLite 0.15s ease-out forwards",xe.style.animationDelay="0.1s"):(Se.style.animation="fadeInScale 0.2s ease-out forwards",xe.style.animation="fadeInSlideRight 0.2s ease-out forwards",xe.style.animationDelay="0.15s"),H.appendChild(Se),H.appendChild(xe),se.appendChild(H);const ve=document.createElement("div");ve.className="result-display",ve.style.opacity="0";const ge=Math.floor(R*b),$e=document.createElement("span");$e.className="result-text",$e.textContent=`+${ge}`,$e.style.color=g,z?(ve.style.animation="resultAppearLite 0.3s ease-out forwards",ve.style.animationDelay="0.6s"):(ve.style.animation="resultAppear 0.4s ease-out forwards",ve.style.animationDelay="0.7s");const Ce=document.createElement("span");Ce.className="combo-count",Ce.textContent=` (${p})`,Ce.style.color=g,ve.appendChild($e),ve.appendChild(Ce),se.appendChild(ve),setTimeout(()=>{H&&(H.style.animation=z?"resultFadeOutLite 0.2s ease-out forwards":"resultFadeOut 0.3s ease-out forwards")},z?550:650),x.appendChild(se)}else{const se=document.createElement("span");se.className="points-value",se.textContent=`+${R}`,z?se.style.animation="fadeInScaleLite 0.2s ease-out forwards":se.style.animation="fadeInScale 0.3s ease-out forwards",x.appendChild(se)}if(x.style.top="50%",x.style.left="50%",x.style.transform="translate(-50%, -50%)",!z)for(let se=0;se<6;se++){const H=document.createElement("div");H.className="points-particle",H.style.setProperty("--angle",`${se*60}deg`),x.appendChild(H)}y.appendChild(x),T?b>=5?ie.play("comboLarge"):b>=3?ie.play("comboMedium"):b>=1.5?ie.play("comboSmall"):ie.play("points"):ie.play("points");const X=setTimeout(()=>{x&&x.parentNode&&x.parentNode.removeChild(x)},1500);E(X),R>100&&$({message:"¬°Puntos conseguidos!",type:"success",icon:"üèÜ",duration:1500,value:`+${R}`})},[Y,E,$]),S=s.useCallback(()=>{$({message:"¬°Tablero limpio!",type:"success",icon:"üéâ",duration:2e3,value:"Bonificaci√≥n"});const R=document.querySelector(".game-board");if(R){const v=document.createElement("div");v.className="points-popup bonus";const K=document.createElement("span");K.className="points-value",K.textContent="100",v.appendChild(K),v.style.top="50%",v.style.left="50%",v.style.transform="translate(-50%, -50%)",R.appendChild(v),ie.play("levelComplete");const p=setTimeout(()=>{v&&v.parentNode&&v.parentNode.removeChild(v)},2e3);E(p)}},[$,E]),I=s.useCallback(()=>{if(!o||o.length===0)return!1;for(let R=0;R<n;R++)for(let v=0;v<n;v++)if(o[R][v]===null&&L(R,v,c)>=2)return!0;return!1},[o,n,c]),L=s.useCallback((R,v,K)=>{if(!o)return 0;const p=[{dr:-1,dc:0},{dr:0,dc:1},{dr:1,dc:0},{dr:0,dc:-1}],b={};for(const A of K){let T=0;for(const{dr:B,dc:y}of p){let x=R+B,g=v+y;for(;x>=0&&x<n&&g>=0&&g<n;){if(o[x][g]===A){T++;break}else if(o[x][g]!==null)break;x+=B,g+=y}}T>=2&&(b[A]=T)}return Math.max(0,...Object.values(b))},[o,n]),le=s.useCallback((R,v)=>o?co(o,R,v,n):[],[o,n]),ne=s.useCallback((R,v,K)=>new Promise(p=>{if(!R.length||!o){p(0);return}const b=o.map(y=>[...y]),A={};for(const y of R)A[y.icon]||(A[y.icon]=[]),A[y.icon].push(y);let T=[];for(const y in A)A[y].length>=2&&(T=[...T,...A[y]]);if(T.length===0){p(0);return}T.forEach(({row:y,col:x})=>{if(b[y][x]){const g=Y(y,x);b[y][x]=b[y][x]+"_removing",g&&g.classList.contains("new-icon")&&(g.classList.remove("new-icon"),console.log(`[CONVERGENCIA] Eliminar protecci√≥n de icono nuevo en [${y},${x}] para permitir eliminaci√≥n`))}}),t(Ke(b)),setTimeout(()=>ie.play("convergingFound"),0);const B=setTimeout(()=>{const y=b.map(Ce=>Ce.map(Ye=>Ye&&Ye.includes("_removing")?null:Ye)),x=T.length;t(Ke(y)),t(It(i-x));const{comboTimestamp:g,comboTimeWindow:Q,comboMultiplier:z,comboCount:X,status:se}=U.getState().game,H=Date.now();if(se!=="playing"){console.log(`[COMBO DEBUG] Juego no est√° en estado 'playing' (${se}). No se actualizan combos.`),p(x);return}if(console.log(`
[COMBO DEBUG] ===== Inicio de an√°lisis de combo =====`),console.log(`[COMBO DEBUG] Iconos eliminados: ${x}`),console.log(`[COMBO DEBUG] Estado actual: Combo: ${X}, Multiplicador: ${z.toFixed(1)}x`),console.log(`[COMBO DEBUG] Timestamp actual: ${H}`),console.log(`[COMBO DEBUG] Timestamp √∫ltima eliminaci√≥n: ${g}`),console.log(`[COMBO DEBUG] Ventana de tiempo: ${Q}ms`),x===0){console.log("[COMBO DEBUG] No se eliminaron iconos reales, saltando incremento de combo"),p(0);return}const Se=g===0?0:H-g;console.log(`[COMBO DEBUG] Tiempo transcurrido: ${Se}ms`),console.log(`[COMBO DEBUG] ¬øDentro de ventana de tiempo?: ${Se<=Q?"S√ç":"NO"}`),g===0||X===0?(console.log("[COMBO DEBUG] Primer combo detectado, iniciando secuencia"),t(Ve())):Se<=Q?(console.log("[COMBO DEBUG] Tiempo dentro de ventana, incrementando combo"),t(Ve())):(console.log("[COMBO DEBUG] Tiempo fuera de ventana, reiniciando combo"),t(nt()),setTimeout(()=>{console.log("[COMBO DEBUG] Iniciando nuevo combo despu√©s del reset"),t(Ve())},0));const xe=U.getState().game,ve=xe.comboMultiplier,ge=x*10*F,$e=Math.floor(ge*ve);if(console.log(`[COMBO DEBUG] Puntos base: ${ge} (${x} iconos √ó 10 √ó nivel ${F})`),console.log(`[COMBO DEBUG] Multiplicador aplicado: ${ve.toFixed(1)}x`),console.log(`[COMBO DEBUG] Puntos finales con combo: ${$e}`),t(Pe($e)),console.log(`[COMBO DEBUG] Combo actual: ${xe.comboCount}, verificando hitos`),xe.comboCount===10){const Ce=Le.MILESTONE_BONUSES[10];t(Pe(Ce)),console.log(`[COMBO DEBUG] ¬°HITO! Combo x10 alcanzado. +${Ce} puntos extra`)}else if(xe.comboCount===20){const Ce=Le.MILESTONE_BONUSES[20];t(Pe(Ce)),console.log(`[COMBO DEBUG] ¬°HITO! Combo x20 alcanzado. +${Ce} puntos extra`)}else if(xe.comboCount===30){const Ce=Le.MILESTONE_BONUSES[30];t(Pe(Ce)),console.log(`[COMBO DEBUG] ¬°HITO! Combo x30 alcanzado. +${Ce} puntos extra`)}ve>1&&(console.log(`[COMBO DEBUG] Combo activo: x${xe.comboCount} (${ve.toFixed(1)}x)`),ve>=5?(ie.play("comboLarge"),console.log("[COMBO DEBUG] Reproduciendo sonido: comboLarge")):ve>=3?(ie.play("comboMedium"),console.log("[COMBO DEBUG] Reproduciendo sonido: comboMedium")):ve>=1.5&&(ie.play("comboSmall"),console.log("[COMBO DEBUG] Reproduciendo sonido: comboSmall"))),console.log(`[COMBO DEBUG] ===== Fin de an√°lisis de combo =====
`),p(x)},300);E(B)}),[o,t,i,E,Y,F]),M=s.useCallback(()=>{$({message:"¬°Penalizaci√≥n!",type:"error",icon:"‚ö†Ô∏è",duration:2e3,value:"Velocidad aumentada"}),me(!0);const R=setTimeout(()=>{me(!1)},2e3);E(R)},[$,E]),C=s.useCallback(R=>{$({message:"¬°Velocidad aumentada!",type:"warning",icon:"‚ö°",duration:2500,value:`x${R}`,animateValue:!0}),ae(R),ee(!0);const v=setTimeout(()=>{ee(!1)},2e3);E(v)},[$,E]),W=s.useCallback(()=>{t(Ie([])),_.current.forEach(clearTimeout),_.current=[],me(!1),ee(!1)},[t]),Z=s.useCallback((R,v)=>{const K=Y(R,v);Vt(K,E),_t(E);const p=bn(j,t);setTimeout(()=>{C(p)},200);const b=U.getState().game.level;xn(b,o,n,c,t,Y,E)},[t,j,o,n,c,Y,E,C]),be=s.useCallback(()=>{ie.play("speedUp");const R=no,K=R/3,p=Math.max(K,j*.9);t(Ae(p));const b=Number((R/p).toFixed(1));return setTimeout(()=>{C(b)},50),console.log(`Velocidad aumentada a ${b}x (${p}ms)`),b},[j,t,C]),Me=s.useCallback((R,v)=>{var A;const K=`${R}-${v}`;if(J.current||ce.current===K){N.debug("Interacci√≥n","handleCellClick: ignorando clic porque ya se est√° procesando otro o es un multi-clic en la misma celda");return}if(a!=="playing"){N.debug('handleCellClick: ignorando clic porque el juego no est√° en estado "playing"'," ["+a+"]");return}if(!o||!o[R]||o[R][v]!==null){N.debug("handleCellClick: celda no est√° vac√≠a"," ["+R+", "+v+"] "+((A=o==null?void 0:o[R])==null?void 0:A[v]));return}J.current=!0,ce.current=K;const p=setTimeout(()=>{J.current=!1,ce.current=null},500);E(p),l.length>0&&t(Ie([])),setTimeout(()=>ie.play("click"),0);const b=le(R,v);b.length>0?ne(b,R,v).then(()=>{f(b.length*10,R,v),Y(R,v),b.length>0&&t(Ie(b.map(T=>({row:T.row,col:T.col})))),t(Ie([])),setTimeout(()=>{if(o.flat().every(y=>y===null)){S(),t(Pe(100)),N.info("¬°Tablero vac√≠o! Completando nivel..."," ["+a+"]");const x=(j/1e3).toFixed(1);t(je(`¬°Incre√≠ble! Has limpiado completamente el tablero eliminando todos los iconos. Velocidad de aparici√≥n: ${x}s por icono.`)),t(fe("levelCompleted")),ie.play("levelComplete");return}const B=U.getState().game.iconCount;if(I())N.info("CONVERGENCIA","Hay movimientos v√°lidos despu√©s de eliminar. El juego contin√∫a.");else{const y=n*n,x=B/y*100;if(N.info("CONVERGENCIA",`Verificando fin de juego: ${x.toFixed(1)}% de ocupaci√≥n sin movimientos v√°lidos`),x<=30){N.info(`Pocos iconos sin convergencias (${x.toFixed(1)}%). Nivel completado.`," ["+a+"]");const g=(j/1e3).toFixed(1);t(je(`¬°Has eliminado casi todos los iconos! Solo quedan ${B} iconos sin posibilidad de convergencia. Velocidad de aparici√≥n: ${g}s por icono.`)),t(fe("levelCompleted")),ie.play("levelComplete")}else{N.info(`No hay movimientos v√°lidos (${x.toFixed(1)}%). Game over.`," ["+a+"]");const g=(j/1e3).toFixed(1);t(je(`El tablero tiene ${B} iconos (${x.toFixed(1)}% de ocupaci√≥n) sin movimientos v√°lidos. Velocidad: ${g}s por icono.`)),t(fe("gameOver")),ie.play("gameOver")}}},200)}):(ie.play("invalidMove"),setTimeout(()=>{J.current=!1,ce.current=null},300),Z(R,v))},[a,o,t,le,Y,ne,I,me,j,l,E,n,c,Vt,_t,f,Z]),he=s.useCallback(()=>{if(!vn(r,d)){d?N.info("showHint: pista en cooldown"," ["+a+"]"):r<=0&&N.info("showHint: no quedan pistas"," ["+a+"]");return}const R=gn(o||[],n);if(R){const v=hn(R);N.info("showHint: mostrando pista"," ["+a+`] posici√≥n: ${JSON.stringify(R)}`),t(Ie(v)),ie.play("hint"),t(eo()),D.current&&clearTimeout(D.current),D.current=setTimeout(()=>{t(to()),D.current=null},5e3)}else N.warn("showHint: no se encontr√≥ una posici√≥n v√°lida para la pista"," ["+a+"]")},[o,n,r,d,a,t]),Ee=s.useCallback((R,v)=>{if(!R||!v)return;const K=R.offsetWidth,p=R.offsetHeight,b=Math.min(K,p)*.9;v.style.width=`${b}px`,v.style.height=`${b}px`;const A=v.querySelector(".game-board-grid");A&&(A.style.gridTemplateColumns=`repeat(${n}, 1fr)`,A.style.gridTemplateRows=`repeat(${n}, 1fr)`)},[n]),Fe=s.useCallback((R,v,K)=>{const p=`${R}-${v}`;K?k.current[p]=K:delete k.current[p]},[]),we=s.useCallback(()=>{const v=U.getState().game.currentDifficulty,K=Le.TIME_WINDOWS[v]||Le.TIME_WINDOWS.normal;console.log(`[COMBO CONFIG] Actualizando ventana de tiempo de combo para dificultad ${v}: ${K}ms`),t(zo(K)),setTimeout(()=>{const p=U.getState().game;console.log(`[COMBO CONFIG] Verificaci√≥n: La ventana de tiempo actual es ${p.comboTimeWindow}ms`)},0)},[t]);return s.useEffect(()=>{console.log("[COMBO CONFIG] Inicializando ventana de tiempo de combo"),we()},[we]),{stopTimers:de,addAnimationTimer:E,registerCellRef:Fe,getCellElement:Y,hasValidMoves:I,findAdjacentSameIcons:L,findConvergingIcons:le,removeConvergingIcons:ne,showPenaltyAlertUI:M,showSpeedAlertUI:C,penalize:Z,increaseSpeed:be,handleCellClick:Me,showHint:he,adjustBoardSize:Ee,showPointsEarned:f,showEmptyBoardBonus:S,cleanupEffects:W,showSpeedAlert:V,speedMultiplier:P,showPenaltyAlert:re,updateComboTimeWindow:we}},yn=10,lo=(t=30)=>{const[o,a]=s.useState(!1),[n,c]=s.useState(!1),l=s.useRef(!1),r=s.useRef(!1),d=s.useRef(null);s.useEffect(()=>()=>{d.current!==null&&clearTimeout(d.current)},[]);const u=s.useCallback(m=>{if(l.current){n||(N.info("AnimationsLoader","Animaciones ya inicializadas, forzando estado a cargado"),c(!0));return}N.info("AnimationsLoader",`Cargando animaciones en modo: ${m?"lite":"normal"}`);const h=document.head,w=document.getElementById("game-animations-css");w&&w.remove();const O=document.createElement("link");O.id="game-animations-css",O.rel="stylesheet",O.type="text/css";const F=[`./src/components/game/GameBoard/styles/animations${m?"-lite":""}.css`,`/src/components/game/GameBoard/styles/animations${m?"-lite":""}.css`,`${window.location.origin}/src/components/game/GameBoard/styles/animations${m?"-lite":""}.css`,`./animations${m?"-lite":""}.css`,`/animations${m?"-lite":""}.css`];let G=0,$=F.length;const k=()=>{if(G>=$){N.error("AnimationsLoader","No se pudo cargar el archivo CSS de animaciones despu√©s de m√∫ltiples intentos"),c(!0),l.current=!0;return}O.href=F[G],N.info("AnimationsLoader",`Intentando cargar animaciones desde: ${O.href}`),G++};O.onload=()=>{N.info("AnimationsLoader",`Cargado modo de animaciones: ${m?"reducido":"completo"}`),c(!0),l.current=!0,d.current!==null&&(clearTimeout(d.current),d.current=null)},O.onerror=()=>{N.warn("AnimationsLoader",`Error al cargar animaciones desde: ${O.href}, intentando ruta alternativa...`),k()},d.current=window.setTimeout(()=>{n||(N.warn("AnimationsLoader","Timeout al cargar animaciones, marcando como cargado de todos modos"),c(!0),l.current=!0)},2e3),k(),h.appendChild(O),a(m),m?(document.documentElement.classList.add("lite-animations"),t<=yn?document.documentElement.classList.add("performance-mode-high"):document.documentElement.classList.add("performance-mode")):(document.documentElement.classList.remove("lite-animations"),document.documentElement.classList.remove("performance-mode"),document.documentElement.classList.remove("performance-mode-high"))},[t,n]),j=s.useCallback(m=>{u(m),r.current=!0},[u]),i=s.useCallback(()=>l.current,[]);return{useLiteAnimations:o,isLoaded:n,initializeAnimations:j,isInitialized:i}},Sn=()=>{const t=ke(),{board:o,boardSize:a,status:n,highlightedCells:c,currentDifficulty:l,level:r,spawnRate:d}=De(E=>E.game),{handleCellClick:u,registerCellRef:j,showHint:i,showSpeedAlertUI:m}=Cn(),h=s.useRef(null),w=s.useRef(new Set),[O,F]=s.useState(!1),[G,$]=s.useState(1),[k,te]=s.useState(!0),[D,_]=s.useState(!1);s.useRef(!1);const V=s.useCallback((E,Y)=>c.some(f=>f.row===E&&f.col===Y),[c]),ee=s.useCallback(E=>E?E.includes("_removing")?{icon:E.replace("_removing",""),isRemoving:!0}:{icon:E,isRemoving:!1}:{icon:null,isRemoving:!1},[]),P=s.useCallback((E,Y)=>{var S;((S=o[E])==null?void 0:S[Y])&&ie.play("click"),u(E,Y)},[u,o]),ae=s.useMemo(()=>{if(!o||o.length===0||n!=="playing"&&n!=="paused")return[];const E=[],Y=!D||a<=6;for(let f=0;f<a;f++)for(let S=0;S<a;S++){const I=o[f]?o[f][S]:null;if(!I&&!Y){E.push(e.jsx("div",{className:"board-cell empty performance-mode",onClick:()=>P(f,S),"data-row":f,"data-col":S},`cell-${f}-${S}`));continue}const{icon:L,isRemoving:le}=ee(I);let ne="board-cell";V(f,S)&&(ne+=" highlighted"),le&&(ne+=" removing"),L&&!le&&(ne+=" has-icon"),L||(ne+=" empty"),D&&(ne+=" performance-mode");const M=`${f}-${S}`,C=w.current||new Set;L&&!le&&!C.has(M)&&L&&(ne+=" new-icon",C.add(M),setTimeout(()=>{const be=document.querySelector(`[data-row="${f}"][data-col="${S}"]`);be&&(be.classList.remove("new-icon"),console.log(`GameBoard: Eliminada protecci√≥n de icono nuevo en [${f},${S}]`))},D?1500:2e3),w.current=C),E.push(e.jsx("div",{className:ne,onClick:()=>P(f,S),ref:Z=>{j(f,S,Z)},"data-row":f,"data-col":S,children:L&&e.jsx("span",{className:"cell-content",children:L})},`cell-${f}-${S}`))}return E},[o,a,n,ee,V,P,j,D]);s.useEffect(()=>{if(h.current){const E=h.current,Y=()=>{E.classList.add("touch-device")};return E.addEventListener("touchstart",Y,{passive:!0}),()=>{E.removeEventListener("touchstart",Y)}}},[]),s.useEffect(()=>(w.current||(w.current=new Set),()=>{w.current&&w.current.clear()}),[]),s.useCallback(E=>{t(dt(E))},[t]),s.useCallback(()=>{i()},[i]);const re=s.useCallback(E=>{const Y=Ct.MEDIUM,f=Math.round(Y/E);$(E),ie.play("speedUp"),t(Ae(f)),setTimeout(()=>{m(E)},50),console.log(`Velocidad cambiada a ${E}x (${f}ms)`)},[t,m]);s.useCallback(E=>{const Y=Ct.MEDIUM,f=Number((Y/d).toFixed(1)),S=[.25,.5,.75,1,1.25,1.5,1.75,2,2.5,3,3.5,4];let I=0,L=Math.abs(S[0]-f);for(let M=1;M<S.length;M++){const C=Math.abs(S[M]-f);C<L&&(L=C,I=M)}let le;E==="increase"?le=Math.min(I+1,S.length-1):le=Math.max(I-1,0);const ne=S[le];re(ne)},[d,re]);const[me,J]=s.useState(!1);s.useCallback(()=>{const E=!me;if(J(E),E)t(Ae(1e5)),ie.play("pause");else{const Y=Ct.MEDIUM,f=Math.round(Y/G);t(Ae(f)),ie.play("resume")}console.log(`Generaci√≥n de iconos ${E?"pausada":"reanudada"}`)},[me,t,G]),s.useCallback(()=>{t(ut(r+1)),n!=="playing"&&t(fe("playing")),console.log(`[DEV TOOLS] Avanzando al nivel ${r+1}`)},[t,r,n]),s.useMemo(()=>Number((no/d).toFixed(1)),[d]);const{useLiteAnimations:ce}=lo(15),de=s.useCallback(()=>!o||o.length===0?e.jsx("div",{className:"empty-board-message",children:"Cargando tablero..."}):n!=="playing"&&n!=="paused"?e.jsxs("div",{className:"empty-board-message",children:[n==="startScreen"&&"Selecciona la configuraci√≥n para comenzar",n==="gameOver"&&"Juego terminado",n==="levelCompleted"&&"Nivel completado",n==="idle"&&"Inicializando..."]}):e.jsx("div",{ref:h,className:`game-board-grid grid-${a}`,style:{gridTemplateColumns:`repeat(${a}, 1fr)`,gridTemplateRows:`repeat(${a}, 1fr)`},children:ae}),[o,a,ae,n]);return e.jsx(Po,{children:e.jsx("div",{className:`game-board-wrapper ${D?"performance-mode":""}`,children:de()})})},Nn=()=>{const{comboCount:t,comboMultiplier:o,comboTimestamp:a,comboTimeWindow:n}=De(F=>F.game),[c,l]=s.useState(!1),[r,d]=s.useState(100),u=s.useRef(null),j=typeof document<"u"&&document.documentElement.classList.contains("performance-mode"),i=s.useMemo(()=>!o||o<1.5?{class:"combo-basic",icon:"üîÑ"}:o>=5?{class:"combo-legendary",icon:"‚ú®"}:o>=3?{class:"combo-epic",icon:"üî•"}:o>=2?{class:"combo-rare",icon:"üí´"}:{class:"combo-uncommon",icon:"‚ö°"},[o]),m=s.useMemo(()=>({"--angle":`${Math.floor(r/100*360)}deg`}),[r]),h=F=>F<1?"x1.0":F%1===0||F*10%10===0?`x${Math.floor(F)}`:`x${F.toFixed(1)}`;if(s.useEffect(()=>{c&&t&&t>=3&&(o&&o>=5?ie.play("comboLarge"):o&&o>=3?ie.play("comboMedium"):o&&o>=1.5&&ie.play("comboSmall"))},[c,t,o]),s.useEffect(()=>{t&&t>=3&&a>0&&l(!0)},[t,a]),s.useEffect(()=>{const F=t&&t>=3&&a>0;if(l(!!F),u.current&&(clearInterval(u.current),u.current=null),F){d(100);const G=j?100:16;u.current=setInterval(()=>{const k=Date.now()-a,D=Math.max(0,n-k)/n*100;d(D),D<=0&&(l(!1),u.current&&(clearInterval(u.current),u.current=null))},G)}return()=>{u.current&&(clearInterval(u.current),u.current=null)}},[t,a,n,j]),!c)return null;const w=t||0,O=o||1;return e.jsx("div",{className:"combo-indicator",children:e.jsxs("div",{className:`combo-orbital ${i.class} ${j?"performance-mode":""}`,children:[e.jsx("div",{className:"combo-icon",children:i.icon}),e.jsx("div",{className:"combo-timer-ring",children:e.jsx("div",{className:"combo-timer-fill",style:m})}),e.jsx("div",{className:"combo-count",children:w}),e.jsx("div",{className:"combo-multiplier",children:h(O)})]})})},jn={tutorial:"üöÄ",easy:"üåü",normal:"üåó",hard:"üî•"},En={classic:"Cl√°sico",timed:"Tiempo",survival:"Superv.",zen:"Zen",tutorial:"Tutorial"},wn={tutorial:"Tutorial",easy:"F√°cil",normal:"Normal",hard:"Dif√≠cil"},Mn=()=>{const t=ke(),{score:o,level:a,timer:n,timeRemaining:c,survivalTime:l,currentDifficulty:r,currentPlayMode:d,status:u,spawnRate:j,highScore:i,levelScoreTarget:m,levelOccupationTarget:h,iconCount:w,boardSize:O}=De(W=>W.game),[F,G]=s.useState(!1),[$,k]=s.useState(!1),te=s.useRef(o),D=s.useRef(a),[_,V]=s.useState(!1),[ee,P]=s.useState(!1),[ae,re]=s.useState(!0),me=s.useRef(window.innerWidth<=768);s.useEffect(()=>{const W=()=>{me.current=window.innerWidth<=768};return window.addEventListener("resize",W),()=>window.removeEventListener("resize",W)},[]),s.useEffect(()=>{if(te.current!==o&&te.current>0){G(!0);const W=setTimeout(()=>G(!1),300);return()=>clearTimeout(W)}te.current=o},[o]),s.useEffect(()=>{if(D.current!==a&&D.current>0){k(!0);const W=setTimeout(()=>k(!1),300);return()=>clearTimeout(W)}D.current=a},[a]);const J=W=>{if(typeof W!="number"||isNaN(W))return"0:00";const Z=Math.floor(W/60),be=Math.floor(W%60);return`${Z}:${be<10?"0":""}${be}`},ce=()=>d==="timed"&&typeof c=="number"?J(c):d==="survival"&&typeof l=="number"?J(l):typeof n=="number"?J(n):"0:00",de=()=>typeof j!="number"||j<=0?"x1.0":`x${oo.getCurrentMultiplier(j,r).toFixed(1)}`,E=()=>En[d]||"Cl√°sico",Y=s.useCallback(()=>{var W;if(d==="classic"&&m>0)return Math.min(100,Math.round(o/m*100));if(d==="timed"&&c!==void 0&&typeof c=="number"){const Z=(W=Ge.timed)==null?void 0:W.baseTime;return Math.max(0,Math.min(100,c/Z*100))}else if(d==="survival"&&w>0&&O>0){const Z=O*O,be=(Z-w)/Z*100;return Math.min(100,be)}return 0},[d,o,c,m,w,O]),f=s.useCallback(()=>d==="classic"&&m>0?o>=m:!1,[d,o,m]),S=()=>d==="classic"?"OBJETIVO":d==="timed"?"TIEMPO":"PROGRESO",I=()=>{const W=jn[r]||"üåó",Z=wn[r]||"Normal";return`${W} ${Z}`},L=()=>{u==="playing"?t(fe("paused")):u==="paused"&&t(fe("playing"))},le=()=>{t(nt()),t(fe("startScreen"))},ne=()=>{P(!ee)},M=()=>{re(!ae)},C=()=>{const W=Y();return e.jsxs("div",{className:"hud-value",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:`progress-fill ${f()?"progress-achieved":""}`,style:{width:`${W}%`}})}),e.jsx("div",{className:"progress-text",children:d==="classic"&&m>0?`${o}/${m}`:`${Math.round(W)}%`})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"top-bar",children:[e.jsxs("div",{className:"max-score-container",children:[e.jsx("div",{className:"max-score-label",children:"M√ÅXIMA"}),e.jsx("div",{className:"max-score-value",children:i||0})]}),e.jsxs("div",{className:"control-buttons",children:[e.jsx("button",{className:"control-button pause-button",onClick:L,"aria-label":u==="playing"?"Pausar juego":"Reanudar juego",children:u==="playing"?"‚è∏Ô∏è":"‚ñ∂Ô∏è"}),e.jsx("button",{className:"control-button restart-button",onClick:le,"aria-label":"Reiniciar juego",children:"üîÑ"}),e.jsx("button",{className:"control-button settings-button",onClick:()=>V(!_),"aria-label":"Configuraci√≥n",children:"‚öôÔ∏è"})]})]}),e.jsxs("div",{className:"game-hud",children:[e.jsxs("div",{className:"hud-item score",children:[e.jsx("div",{className:"hud-label",children:"PUNTUACI√ìN"}),e.jsx("div",{className:`hud-value ${F?"score-change":""}`,children:o||0})]}),e.jsxs("div",{className:"hud-item level",children:[e.jsx("div",{className:"hud-label",children:"NIVEL"}),e.jsx("div",{className:`hud-value ${$?"score-change":""}`,children:a||1})]}),e.jsxs("div",{className:"hud-item time",children:[e.jsx("div",{className:"hud-label",children:"TIEMPO"}),e.jsx("div",{className:"hud-value",children:ce()})]}),e.jsxs("div",{className:"hud-item speed",children:[e.jsx("div",{className:"hud-label",children:"VELOCIDAD"}),e.jsx("div",{className:"hud-value",children:de()})]}),e.jsxs("div",{className:"hud-item mode",children:[e.jsx("div",{className:"hud-label",children:"MODO"}),e.jsx("div",{className:"hud-value",children:E()})]}),e.jsxs("div",{className:"hud-item difficulty",children:[e.jsx("div",{className:"hud-label",children:"DIFICULTAD"}),e.jsx("div",{className:"hud-value",children:I()})]}),e.jsxs("div",{className:"hud-item progress",children:[e.jsx("div",{className:"hud-label",children:S()}),C()]})]}),e.jsx(Nn,{}),_&&e.jsx("div",{className:"config-modal",children:e.jsxs("div",{className:"config-modal-content",children:[e.jsx("h3",{children:"Configuraci√≥n"}),e.jsxs("div",{className:"config-section",children:[e.jsx("h4",{children:"Sonido"}),e.jsxs("div",{className:"config-option",children:[e.jsx("span",{children:"M√∫sica"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",defaultChecked:!0}),e.jsx("span",{className:"toggle-slider"})]})]}),e.jsxs("div",{className:"config-option",children:[e.jsx("span",{children:"Efectos"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",defaultChecked:!0}),e.jsx("span",{className:"toggle-slider"})]})]})]}),e.jsxs("div",{className:"config-section",children:[e.jsx("h4",{children:"Apariencia"}),e.jsxs("div",{className:"config-option",children:[e.jsx("span",{children:"Modo oscuro"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",defaultChecked:!0}),e.jsx("span",{className:"toggle-slider"})]})]})]}),e.jsxs("div",{className:"config-section",children:[e.jsx("h4",{children:"Rendimiento"}),e.jsxs("div",{className:"config-option",children:[e.jsx("span",{children:"Animaciones reducidas"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox"}),e.jsx("span",{className:"toggle-slider"})]})]})]}),e.jsxs("div",{className:"config-section dev-controls-section",children:[e.jsx("h4",{children:"Desarrollador"}),e.jsxs("div",{className:"config-option",children:[e.jsx("span",{children:"Mostrar FPS"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:ae,onChange:M}),e.jsx("span",{className:"toggle-slider"})]})]}),e.jsxs("div",{className:"config-option",children:[e.jsx("span",{children:"Controles Dev"}),e.jsxs("label",{className:"toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:ee,onChange:ne}),e.jsx("span",{className:"toggle-slider"})]})]})]}),e.jsx("button",{className:"close-modal-btn",onClick:()=>V(!1),children:"Cerrar"})]})})]})},Qe=()=>{const{isSoundEnabled:t}=Xe();return{playSound:s.useCallback(a=>{t&&console.log(`Playing sound: ${a}`)},[t])}},Nt={title:{opacity:0,transform:"translateY(-20px)"},content:{opacity:0,transform:"translateY(20px)"},button:{opacity:0,transform:"scale(0.8)"}},Ht=["ü™ê","üí´","‚ú®","üåü"],In=({isVisible:t=!1,onRestart:o,onReturnToMenu:a})=>{const{gameState:n}=Xe(),{score:c,level:l,comboCount:r,comboMultiplier:d,highScore:u,gameEndReason:j,currentPlayMode:i,currentDifficulty:m,spawnRate:h}=De(f=>f.game),{playSound:w}=Qe(),O=s.useRef(null),[F,G]=s.useState(Nt),[$,k]=s.useState(!1),[te,D]=s.useState(!1),[_,V]=s.useState(!1),[ee,P]=s.useState([]);s.useEffect(()=>{const f=()=>{const S=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${S}px`)};return f(),window.addEventListener("resize",f),window.addEventListener("orientationchange",f),window.addEventListener("load",f),()=>{window.removeEventListener("resize",f),window.removeEventListener("orientationchange",f),window.removeEventListener("load",f)}},[]),s.useEffect(()=>{if(t&&$){const f=[],S=window.innerWidth<400||window.innerHeight<700,I=S?3:Math.min(5,Math.floor(window.innerWidth/120));for(let L=0;L<I;L++){const le=Math.random()*100,ne=Math.random()*100,M=Math.random()*(S?1:1.5)+.8,C=Math.random()*15+20,W=Math.random()*5,Z=Ht[Math.floor(Math.random()*Ht.length)];f.push({icon:Z,style:{position:"absolute",top:`${le}%`,left:`${ne}%`,fontSize:`${M}em`,opacity:S?.3:.5,filter:"blur(0.5px)",animation:`float ${C}s ease-in-out ${W}s infinite`,zIndex:1}})}P(f)}},[t,$]),s.useEffect(()=>{let f;const S=[];return t?(k(!0),D(!1),document.body.classList.add("modal-open"),V(c>u),w("gameOver"),S.push(setTimeout(()=>{G(I=>({...I,title:{opacity:1,transform:"translateY(0)"}})),S.push(setTimeout(()=>{G(I=>({...I,content:{opacity:1,transform:"translateY(0)"}})),S.push(setTimeout(()=>{G(I=>({...I,button:{opacity:1,transform:"scale(1)"}}))},150))},150))},100))):(D(!0),f=setTimeout(()=>{k(!1),G(Nt),document.body.classList.remove("modal-open")},300)),()=>{f&&clearTimeout(f),S.forEach(I=>clearTimeout(I)),document.body.classList.remove("modal-open"),D(!1),G(Nt)}},[t,w,c,u]);const ae=()=>{o&&(D(!0),w("uiClick"),setTimeout(()=>{k(!1),o()},300))},re=()=>{a&&(D(!0),w("uiClick"),setTimeout(()=>{k(!1),a()},300))},me=()=>d>=5?"combo-legendary-text":d>=3?"combo-epic-text":d>=2?"combo-rare-text":d>=1.5?"combo-uncommon-text":"combo-basic-text",J=()=>d>=5?"#FFD700":d>=3?"#FF2D55":d>=2?"#8E2DE2":d>=1.5?"#36D1DC":"#FFFFFF",ce=f=>({classic:"Cl√°sico",timed:"Contrarreloj",survival:"Supervivencia",zen:"Zen",tutorial:"Tutorial"})[f]||f,de=f=>({easy:"F√°cil",normal:"Normal",hard:"Dif√≠cil",tutorial:"Tutorial"})[f]||f,E=f=>(f/1e3).toFixed(1)+"s",Y=()=>`game-session-info ${window.innerWidth<=375?"compact-layout":""}`;return!$&&!t?null:e.jsxs("div",{className:`game-modal fullscreen-modal ${$?"visible":""} ${te?"closing":""}`,children:[ee.map((f,S)=>e.jsx("div",{style:f.style,children:f.icon},`floating-icon-${S}`)),e.jsxs("div",{className:"modal-content game-over-content",ref:O,children:[e.jsxs("div",{className:"game-over-header",style:{transition:"all 0.5s ease",...F.title},children:[e.jsx("h1",{children:"¬°MISI√ìN FALLIDA!"}),e.jsx("h2",{children:_?"¬°Nuevo r√©cord gal√°ctico!":"¬°Has perdido esta batalla espacial!"}),e.jsxs("div",{className:Y(),children:[e.jsxs("div",{className:"info-pill",children:[e.jsx("span",{className:"info-label",children:"üéÆ"}),e.jsx("span",{className:"info-value",children:ce(i)})]}),e.jsxs("div",{className:"info-pill",children:[e.jsx("span",{className:"info-label",children:"üöÄ"}),e.jsx("span",{className:"info-value",children:l})]}),e.jsxs("div",{className:"info-pill",children:[e.jsx("span",{className:"info-label",children:"üî•"}),e.jsx("span",{className:"info-value",children:de(m)})]}),e.jsxs("div",{className:"info-pill",children:[e.jsx("span",{className:"info-label",children:"‚ö°"}),e.jsx("span",{className:"info-value",children:E(h)})]})]}),j&&e.jsx("div",{className:"game-end-reason",children:e.jsx("p",{children:j})})]}),e.jsxs("div",{className:"game-over-body",style:{transition:"all 0.5s ease",transitionDelay:"0.15s",...F.content},children:[e.jsxs("div",{className:"main-stats",children:[e.jsxs("div",{className:"record-score-container",children:[e.jsxs("div",{className:"record-badge",children:[e.jsx("div",{className:"record-icon",children:"üëë"}),e.jsx("div",{className:"record-value",children:u})]}),e.jsxs("div",{className:"current-score",children:[e.jsx("div",{className:"score-label",children:"Puntuaci√≥n"}),e.jsx("div",{className:`score-value ${_?"new-high-score":""}`,children:c})]})]}),e.jsxs("div",{className:"compact-stats-grid",children:[e.jsxs("div",{className:"compact-stat-item",children:[e.jsx("div",{className:"compact-stat-icon",children:"üöÄ"}),e.jsx("div",{className:"compact-stat-value",children:l}),e.jsx("div",{className:"compact-stat-label",children:"Nivel"})]}),e.jsxs("div",{className:"compact-stat-item",children:[e.jsx("div",{className:"compact-stat-icon",children:"üî•"}),e.jsx("div",{className:`compact-stat-value ${me()}`,style:{color:J()},children:r}),e.jsxs("div",{className:"compact-stat-label",children:["Combo ",d>1?`${d.toFixed(1)}x`:""]})]}),e.jsxs("div",{className:"compact-stat-item",children:[e.jsx("div",{className:"compact-stat-icon",children:"‚≠ê"}),e.jsxs("div",{className:"compact-stat-value",children:["+",Math.floor(c*.1)]}),e.jsx("div",{className:"compact-stat-label",children:"EXP"})]})]})]}),e.jsx("div",{className:"game-over-message",children:e.jsx("p",{children:_?"¬°Has establecido un nuevo r√©cord en la galaxia! ¬øPodr√°s superarlo?":"No te rindas, tu aventura espacial contin√∫a. ¬°Mejora y conquista las estrellas!"})})]}),e.jsxs("div",{className:"game-over-buttons",children:[e.jsx("button",{className:"game-button primary-button",onClick:ae,style:{transition:"all 0.5s ease",...F.button},children:"Reintentar"}),a&&e.jsx("button",{className:"game-button secondary-button",onClick:re,style:{transition:"all 0.5s ease",...F.button},children:"Men√∫"})]})]})]})},Tn=({isVisible:t=!1,onContinue:o,onReturnToMenu:a,stars:n=3,rewards:c=[{type:"monedas",amount:150,rarity:"common"},{type:"gemas",amount:5,rarity:"rare"},{type:"vidas",amount:1,rarity:"epic"}]})=>{const{gameState:l}=Xe(),{score:r,level:d,comboCount:u,comboMultiplier:j,gameEndReason:i,currentPlayMode:m,currentDifficulty:h,spawnRate:w,iconCount:O}=De(M=>M.game),{playSound:F}=Qe(),G=s.useRef(null),$=s.useRef(null),[k,te]=s.useState(!1),[D,_]=s.useState(!1),[V,ee]=s.useState(!1),P=()=>{const M=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${M}px`)};s.useEffect(()=>(P(),window.addEventListener("resize",P),window.addEventListener("orientationchange",P),window.addEventListener("load",P),()=>{window.removeEventListener("resize",P),window.removeEventListener("orientationchange",P),window.removeEventListener("load",P)}),[]),s.useEffect(()=>{if(t){te(!0),_(!1),ae();const M=setTimeout(()=>{ee(!0)},600);return()=>clearTimeout(M)}else{_(!0),ee(!1);const M=setTimeout(()=>{te(!1)},500);return()=>clearTimeout(M)}},[t,F]);const ae=()=>{if(!$.current)return;const M=$.current;M.innerHTML="";const C=["#FFD700","#FF5722","#3F51B5","#4CAF50","#9C27B0"];for(let W=0;W<50;W++){const Z=document.createElement("div");Z.className="confetti";const be=Math.random()*100;Z.style.left=`${be}%`;const Me=Math.random()*3;Z.style.animationDelay=`${Me}s`;const he=C[Math.floor(Math.random()*C.length)];Z.style.backgroundColor=he;const Ee=["square","circle","triangle"],Fe=Ee[Math.floor(Math.random()*Ee.length)];Fe==="circle"?Z.style.borderRadius="50%":Fe==="triangle"&&(Z.style.width="0",Z.style.height="0",Z.style.backgroundColor="transparent",Z.style.borderLeft="5px solid transparent",Z.style.borderRight="5px solid transparent",Z.style.borderBottom=`10px solid ${he}`);const we=Math.random()*8+5;Z.style.width=`${we}px`,Z.style.height=`${we}px`,M.appendChild(Z)}},re=()=>{_(!0),setTimeout(()=>{o&&o()},300)},me=()=>{_(!0),setTimeout(()=>{a&&a()},300)},J=()=>i!=null&&i.includes("limpiado completamente el tablero")?"‚ú®üèÜ‚ú®":i!=null&&i.match(/Solo quedan (\d+) iconos/)?"üéØ":i!=null&&i.match(/tiene (\d+) iconos/)?"üìä":i!=null&&i.includes("ocupaci√≥n")?"üìâ":"üéâ",ce=()=>{var M,C,W;return i!=null&&i.includes("limpiado completamente el tablero")?"¬°Tablero Vac√≠o!":i!=null&&i.match(/Solo quedan (\d+) iconos/)?`Casi Perfecto - ${((M=i.match(/Solo quedan (\d+) iconos/))==null?void 0:M[1])||"0"} iconos restantes`:i!=null&&i.match(/tiene (\d+) iconos/)?`Nivel Completado - ${((C=i.match(/tiene (\d+) iconos/))==null?void 0:C[1])||"0"} iconos restantes`:i!=null&&i.includes("ocupaci√≥n")?`Tablero Despejado - ${((W=i.match(/(\d+\.\d+)% de ocupaci√≥n/))==null?void 0:W[1])||"0"}% ocupaci√≥n`:"¬°Nivel Completado!"},de=()=>u>=30?"combo-legendary-text":u>=20?"combo-epic-text":u>=10?"combo-rare-text":u>=5?"combo-uncommon-text":"combo-basic-text",E=M=>{switch(M){case"classic":return"Cl√°sico";case"timed":return"Contrarreloj";case"survival":return"Supervivencia";case"zen":return"Zen";case"tutorial":return"Tutorial";default:return M}},Y=M=>{switch(M){case"easy":return"F√°cil";case"normal":return"Normal";case"hard":return"Dif√≠cil";case"very_easy":return"Muy F√°cil";case"very_hard":return"Muy Dif√≠cil";default:return M}},f=M=>`${(M/1e3).toFixed(1)}s/icon`,S=()=>{var M;return i!=null&&i.includes("ocupaci√≥n")&&((M=i.match(/(\d+\.\d+)% de ocupaci√≥n/))==null?void 0:M[1])||null},I=()=>{var M,C;return i!=null&&i.match(/Solo quedan (\d+) iconos/)?((M=i.match(/Solo quedan (\d+) iconos/))==null?void 0:M[1])||null:i!=null&&i.match(/tiene (\d+) iconos/)&&((C=i.match(/tiene (\d+) iconos/))==null?void 0:C[1])||null},L=M=>{const C=M.toLowerCase();return C.includes("moned")||C.includes("coin")||C==="oro"||C==="gold"?"ü™ô":C.includes("gema")||C.includes("gem")||C.includes("diam")?"üíé":C.includes("vida")||C.includes("life")||C.includes("heart")?"‚ù§Ô∏è":C.includes("energ")?"‚ö°":C.includes("poder")||C.includes("power")?"‚ú®":C.includes("llave")||C.includes("key")?"üîë":C.includes("cofre")||C.includes("chest")||C.includes("tesoro")?"üéÅ":C.includes("trofeo")||C.includes("trophy")?"üèÜ":C.includes("ticket")||C.includes("entra")?"üé´":C.includes("boost")?"üöÄ":C.includes("scroll")||C.includes("pergam")?"üìú":C.includes("potion")||C.includes("poci√≥n")?"üß™":C.includes("skin")||C.includes("apar")?"üëï":"üéÆ"},ne=!c||c.length===0?[]:typeof c[0]!="string"&&"type"in c[0]?c:c.map(M=>({type:M,amount:Math.floor(Math.random()*5)+1,rarity:["common","uncommon","rare","epic","legendary"][Math.floor(Math.random()*5)]}));return k?e.jsxs("div",{className:`game-modal fullscreen-modal ${t?"visible":""} ${D?"closing":""}`,children:[e.jsx("div",{className:"level-complete-background"}),e.jsx("div",{className:"confetti-container",ref:$}),e.jsxs("div",{className:"modal-content level-complete-content",ref:G,children:[e.jsxs("div",{className:"level-header",children:[e.jsx("h1",{children:"¬°Nivel Completado!"}),e.jsx("div",{className:"stars-container",children:[...Array(3)].map((M,C)=>e.jsx("svg",{className:`level-star ${C<n?"earned":""}`,style:{"--delay":`${C*.1}s`},viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"})},C))})]}),e.jsxs("div",{className:"results-container",children:[e.jsxs("div",{className:"victory-banner",children:[e.jsx("div",{className:"victory-icon",children:J()}),e.jsxs("div",{className:"victory-content",children:[e.jsx("div",{className:"victory-title",children:ce()}),S()&&e.jsxs("div",{className:"victory-metric",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${100-parseFloat(S()||"0")}%`}})}),e.jsxs("span",{children:[S(),"% ocupaci√≥n"]})]}),I()&&e.jsxs("div",{className:"victory-metric",children:[e.jsx("span",{className:"remaining-icons",children:I()}),e.jsx("span",{children:"iconos restantes"})]})]})]}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-icon mode-icon",children:"üéÆ"}),e.jsxs("div",{className:"stat-data",children:[e.jsx("div",{className:"stat-label",children:"Modo"}),e.jsx("div",{className:"stat-value",children:E(m)})]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-icon level-icon",children:"üèÜ"}),e.jsxs("div",{className:"stat-data",children:[e.jsx("div",{className:"stat-label",children:"Nivel"}),e.jsx("div",{className:"stat-value level-value",children:d})]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-icon difficulty-icon",children:"üî•"}),e.jsxs("div",{className:"stat-data",children:[e.jsx("div",{className:"stat-label",children:"Dificultad"}),e.jsx("div",{className:"stat-value",children:Y(h)})]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-icon speed-icon",children:"‚ö°"}),e.jsxs("div",{className:"stat-data",children:[e.jsx("div",{className:"stat-label",children:"Velocidad"}),e.jsx("div",{className:"stat-value",children:f(w)})]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-icon score-icon",children:"üéØ"}),e.jsxs("div",{className:"stat-data",children:[e.jsx("div",{className:"stat-label",children:"Puntuaci√≥n"}),e.jsx("div",{className:"stat-value score-value",children:r})]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-icon combo-icon",children:"üîÑ"}),e.jsxs("div",{className:"stat-data",children:[e.jsx("div",{className:"stat-label",children:"Combo"}),e.jsxs("div",{className:`stat-value combo-value ${de()}`,children:[j.toFixed(1),"x"]})]})]})]}),ne.length>0&&e.jsxs("div",{className:`rewards-section ${V?"visible":""}`,children:[e.jsxs("div",{className:"rewards-header",children:[e.jsx("div",{className:"rewards-title",children:"Recompensas"}),e.jsx("div",{className:"rewards-shine"})]}),e.jsx("div",{className:"rewards-container",children:ne.map((M,C)=>e.jsxs("div",{className:`reward-item ${M.rarity||"common"}`,style:{"--delay":`${C*.15+.3}s`},children:[e.jsx("div",{className:"reward-icon",children:L(M.type)}),e.jsxs("div",{className:"reward-details",children:[e.jsxs("div",{className:"reward-amount",children:["+",M.amount]}),e.jsx("div",{className:"reward-type",children:M.type})]}),e.jsx("div",{className:"reward-glow"})]},`reward-${C}`))})]})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"continue-button",onClick:re,children:"Continuar"}),e.jsx("button",{className:"menu-button",onClick:me,children:"Men√∫ Principal"})]})]})]}):null},jt={title:{opacity:0,transform:"translateY(-20px)"},options:{opacity:0,transform:"translateY(20px)"},button:{opacity:0,transform:"scale(0.8)"}},$n=({isVisible:t=!0,onPlay:o,onOptions:a,onCredits:n})=>{s.useRef(null);const{playSound:c}=Qe(),{isSoundEnabled:l,setIsSoundEnabled:r,isMusicEnabled:d,setIsMusicEnabled:u}=Xe(),[j,i]=s.useState(jt),[m,h]=s.useState(!1),[w,O]=s.useState(!1),[F,G]=s.useState("main");s.useEffect(()=>{let J;const ce=[];return t?(h(!0),O(!1),document.body.classList.add("modal-open"),ce.push(setTimeout(()=>{i(de=>({...de,title:{opacity:1,transform:"translateY(0)"}})),ce.push(setTimeout(()=>{i(de=>({...de,options:{opacity:1,transform:"translateY(0)"}})),ce.push(setTimeout(()=>{i(de=>({...de,button:{opacity:1,transform:"scale(1)"}}))},200))},200))},100))):(O(!0),J=setTimeout(()=>{h(!1),i(jt),document.body.classList.remove("modal-open")},300)),()=>{J&&clearTimeout(J),ce.forEach(de=>clearTimeout(de)),document.body.classList.remove("modal-open"),O(!1),i(jt),console.log("StartGameModal desmontado y recursos liberados")}},[t,c]),s.useEffect(()=>{const J=()=>{const ce=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${ce}px`)};return J(),window.addEventListener("resize",J),window.addEventListener("orientationchange",J),window.addEventListener("load",J),window.addEventListener("touchstart",J),window.addEventListener("touchend",J),()=>{window.removeEventListener("resize",J),window.removeEventListener("orientationchange",J),window.removeEventListener("load",J),window.removeEventListener("touchstart",J),window.removeEventListener("touchend",J)}},[]);const $=J=>{c("uiSelect"),G(J)},k=()=>{const J=[];for(let de=0;de<15;de++){const E=Math.random()*3+1,Y=Math.random()*100,f=Math.random()*100,S=Math.random()*15+10,I=Math.random()*10;J.push(e.jsx("div",{className:"floating-star",style:{width:`${E}px`,height:`${E}px`,top:`${Y}%`,left:`${f}%`,animationDuration:`${S}s`,animationDelay:`${I}s`}},de))}return J},te=()=>{c("uiSelect"),o&&o()},D=()=>{c("uiSelect"),$("options"),a&&a()},_=()=>{c("uiSelect"),$("credits"),n&&n()},V=()=>{c("uiSelect"),r(!l),localStorage.setItem("soundEnabled",String(!l))},ee=()=>{c("uiSelect"),u(!d),localStorage.setItem("musicEnabled",String(!d))},P=()=>e.jsxs("div",{className:"main-screen",children:[e.jsxs("div",{className:"logo-container",style:{transition:"all 0.6s ease",...j.title},children:[e.jsx("h1",{className:"logo-text",children:"Convergencia"}),e.jsx("div",{className:"logo-pulse"})]}),e.jsxs("div",{className:"main-buttons",style:{transition:"all 0.5s ease",transitionDelay:"0.3s",...j.options},children:[e.jsx("button",{className:"main-button play-button",onClick:te,children:"JUGAR"}),e.jsx("button",{className:"main-button options-button",onClick:D,children:"OPCIONES"}),e.jsx("button",{className:"main-button credits-button",onClick:_,children:"CR√âDITOS"})]})]}),ae=()=>e.jsxs("div",{className:"options-screen",children:[e.jsxs("div",{className:"screen-header",children:[e.jsx("h2",{className:"screen-title",children:"Opciones"}),e.jsx("button",{className:"back-button",onClick:()=>$("main"),children:"‚¨ÖÔ∏è Volver"})]}),e.jsxs("div",{className:"settings-content",children:[e.jsxs("div",{className:"settings-option",children:[e.jsx("span",{className:"setting-label",children:"M√∫sica"}),e.jsx("button",{className:`setting-toggle ${d?"active":""}`,onClick:ee,children:d?"ON":"OFF"})]}),e.jsxs("div",{className:"settings-option",children:[e.jsx("span",{className:"setting-label",children:"Sonido"}),e.jsx("button",{className:`setting-toggle ${l?"active":""}`,onClick:V,children:l?"ON":"OFF"})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{className:"settings-section-title",children:"Informaci√≥n del Juego"}),e.jsx("div",{className:"settings-info",children:e.jsx("p",{children:"Convergencia es un juego de rompecabezas donde debes combinar iconos del mismo tipo para ganar puntos. Experimenta diferentes modos de juego y dificultades para desafiar tus habilidades."})})]})]})]}),re=()=>e.jsxs("div",{className:"credits-screen",children:[e.jsxs("div",{className:"screen-header",children:[e.jsx("h2",{className:"screen-title",children:"Cr√©ditos"}),e.jsx("button",{className:"back-button",onClick:()=>$("main"),children:"‚¨ÖÔ∏è Volver"})]}),e.jsxs("div",{className:"credits-content",children:[e.jsx("h3",{className:"credits-title",children:"Convergencia"}),e.jsx("p",{className:"credits-subtitle",children:"Dise√±ado y desarrollado por:"}),e.jsx("p",{className:"credits-name",children:"Equipo de Desarrollo"}),e.jsx("h4",{className:"credits-section",children:"Programaci√≥n"}),e.jsx("p",{className:"credits-name",children:"Desarrollador Principal"}),e.jsx("h4",{className:"credits-section",children:"Dise√±o Gr√°fico"}),e.jsx("p",{className:"credits-name",children:"Dise√±ador de UI/UX"}),e.jsx("h4",{className:"credits-section",children:"M√∫sica y Sonido"}),e.jsx("p",{className:"credits-name",children:"Compositor"}),e.jsx("h4",{className:"credits-section",children:"Agradecimientos Especiales"}),e.jsx("p",{className:"credits-text",children:"A todos los que hicieron posible este juego"}),e.jsxs("div",{className:"version-info",children:[e.jsx("p",{children:"Versi√≥n 1.0.0"}),e.jsx("p",{children:"¬© 2023 Todos los derechos reservados"})]})]})]}),me=()=>{switch(F){case"options":return ae();case"credits":return re();default:return P()}};return m?e.jsx("div",{className:`start-game ${w?"closing":""}`,children:e.jsxs("div",{className:"start-game-body",children:[k(),me()]})}):null},ro=()=>{const[t,o]=s.useState(()=>{const n=localStorage.getItem("darkMode");return n!==null?n==="true":window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches});return s.useEffect(()=>{t?document.documentElement.classList.add("dark-mode"):document.documentElement.classList.remove("dark-mode"),localStorage.setItem("darkMode",String(t))},[t]),{darkMode:t,toggleDarkMode:()=>{o(n=>!n)}}};var uo={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},qt=_e.createContext&&_e.createContext(uo),Ln=["attr","size","title"];function Rn(t,o){if(t==null)return{};var a=On(t,o),n,c;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(c=0;c<l.length;c++)n=l[c],!(o.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(a[n]=t[n])}return a}function On(t,o){if(t==null)return{};var a={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(o.indexOf(n)>=0)continue;a[n]=t[n]}return a}function pt(){return pt=Object.assign?Object.assign.bind():function(t){for(var o=1;o<arguments.length;o++){var a=arguments[o];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t},pt.apply(this,arguments)}function Yt(t,o){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);o&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),a.push.apply(a,n)}return a}function ft(t){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?Yt(Object(a),!0).forEach(function(n){An(t,n,a[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Yt(Object(a)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(a,n))})}return t}function An(t,o,a){return o=Dn(o),o in t?Object.defineProperty(t,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[o]=a,t}function Dn(t){var o=Fn(t,"string");return typeof o=="symbol"?o:o+""}function Fn(t,o){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var n=a.call(t,o);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(t)}function mo(t){return t&&t.map((o,a)=>_e.createElement(o.tag,ft({key:a},o.attr),mo(o.child)))}function Re(t){return o=>_e.createElement(zn,pt({attr:ft({},t.attr)},o),mo(t.child))}function zn(t){var o=a=>{var{attr:n,size:c,title:l}=t,r=Rn(t,Ln),d=c||a.size||"1em",u;return a.className&&(u=a.className),t.className&&(u=(u?u+" ":"")+t.className),_e.createElement("svg",pt({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},a.attr,n,r,{className:u,style:ft(ft({color:t.color||a.color},a.style),t.style),height:d,width:d,xmlns:"http://www.w3.org/2000/svg"}),l&&_e.createElement("title",null,l),t.children)};return qt!==void 0?_e.createElement(qt.Consumer,null,a=>o(a)):o(uo)}function po(t){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M255.9.2h-64v64h64zM0 64.17v64h64v-64zM128 .2H64v64h64zm64 255.9v64h64v-64zM0 192.12v64h64v-64zM383.85.2h-64v64h64zm128 0h-64v64h64zM128 256.1H64v64h64zM511.8 448v-64h-64v64zm0-128v-64h-64v64zM383.85 512h64v-64h-64zm128-319.88v-64h-64v64zM128 512h64v-64h-64zM0 512h64v-64H0zm255.9 0h64v-64h-64zM0 320.07v64h64v-64zm319.88-191.92v-64h-64v64zm-64 128h64v-64h-64zm-64 128v64h64v-64zm128-64h64v-64h-64zm0-127.95h64v-64h-64zm0 191.93v64h64v-64zM64 384.05v64h64v-64zm128-255.9v-64h-64v64zm191.92 255.9h64v-64h-64zm-128-191.93v-64h-64v64zm128-127.95v64h64v-64zm-128 255.9v64h64v-64zm-64-127.95H128v64h64zm191.92 64h64v-64h-64zM128 128.15H64v64h64zm0 191.92v64h64v-64z"},child:[]}]})(t)}function fo(t){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"},child:[]}]})(t)}function go(t){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M467.14 44.84c-62.55-62.48-161.67-64.78-252.28 25.73-78.61 78.52-60.98 60.92-85.75 85.66-60.46 60.39-70.39 150.83-63.64 211.17l178.44-178.25c6.26-6.25 16.4-6.25 22.65 0s6.25 16.38 0 22.63L7.04 471.03c-9.38 9.37-9.38 24.57 0 33.94 9.38 9.37 24.6 9.37 33.98 0l66.1-66.03C159.42 454.65 279 457.11 353.95 384h-98.19l147.57-49.14c49.99-49.93 36.38-36.18 46.31-46.86h-97.78l131.54-43.8c45.44-74.46 34.31-148.84-16.26-199.36z"},child:[]}]})(t)}function ho(t){return Re({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M216 23.86c0-23.8-30.65-32.77-44.15-13.04C48 191.85 224 200 224 288c0 35.63-29.11 64.46-64.85 63.99-35.17-.45-63.15-29.77-63.15-64.94v-85.51c0-21.7-26.47-32.23-41.43-16.5C27.8 213.16 0 261.33 0 320c0 105.87 86.13 192 192 192s192-86.13 192-192c0-170.29-168-193-168-296.14z"},child:[]}]})(t)}function vo(t){return Re({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M622.34 153.2L343.4 67.5c-15.2-4.67-31.6-4.67-46.79 0L17.66 153.2c-23.54 7.23-23.54 38.36 0 45.59l48.63 14.94c-10.67 13.19-17.23 29.28-17.88 46.9C38.78 266.15 32 276.11 32 288c0 10.78 5.68 19.85 13.86 25.65L20.33 428.53C18.11 438.52 25.71 448 35.94 448h56.11c10.24 0 17.84-9.48 15.62-19.47L82.14 313.65C90.32 307.85 96 298.78 96 288c0-11.57-6.47-21.25-15.66-26.87.76-15.02 8.44-28.3 20.69-36.72L296.6 284.5c9.06 2.78 26.44 6.25 46.79 0l278.95-85.7c23.55-7.24 23.55-38.36 0-45.6zM352.79 315.09c-28.53 8.76-52.84 3.92-65.59 0l-145.02-44.55L128 384c0 35.35 85.96 64 192 64s192-28.65 192-64l-14.18-113.47-145.03 44.56z"},child:[]}]})(t)}function bo(t){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M320.2 243.8l-49.7 99.4c-6 12.1-23.4 11.7-28.9-.6l-56.9-126.3-30 71.7H60.6l182.5 186.5c7.1 7.3 18.6 7.3 25.7 0L451.4 288H342.3l-22.1-44.2zM473.7 73.9l-2.4-2.5c-51.5-52.6-135.8-52.6-187.4 0L256 100l-27.9-28.5c-51.5-52.7-135.9-52.7-187.4 0l-2.4 2.4C-10.4 123.7-12.5 203 31 256h102.4l35.9-86.2c5.4-12.9 23.6-13.2 29.4-.4l58.2 129.3 49-97.9c5.9-11.8 22.7-11.8 28.6 0l27.6 55.2H481c43.5-53 41.4-132.3-7.3-182.1z"},child:[]}]})(t)}function Pn(t){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"},child:[]}]})(t)}function xo(t){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 0C114.6 0 0 100.3 0 224c0 70.1 36.9 132.6 94.5 173.7 9.6 6.9 15.2 18.1 13.5 29.9l-9.4 66.2c-1.4 9.6 6 18.2 15.7 18.2H192v-56c0-4.4 3.6-8 8-8h16c4.4 0 8 3.6 8 8v56h64v-56c0-4.4 3.6-8 8-8h16c4.4 0 8 3.6 8 8v56h77.7c9.7 0 17.1-8.6 15.7-18.2l-9.4-66.2c-1.7-11.7 3.8-23 13.5-29.9C475.1 356.6 512 294.1 512 224 512 100.3 397.4 0 256 0zm-96 320c-35.3 0-64-28.7-64-64s28.7-64 64-64 64 28.7 64 64-28.7 64-64 64zm192 0c-35.3 0-64-28.7-64-64s28.7-64 64-64 64 28.7 64 64-28.7 64-64 64z"},child:[]}]})(t)}function Co(t){return Re({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"},child:[]}]})(t)}function yo(t){return Re({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 304c0 114.9-93.1 208-208 208S16 418.9 16 304c0-104 76.3-190.2 176-205.5V64h-28c-6.6 0-12-5.4-12-12V12c0-6.6 5.4-12 12-12h120c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-28v34.5c37.5 5.8 71.7 21.6 99.7 44.6l27.5-27.5c4.7-4.7 12.3-4.7 17 0l28.3 28.3c4.7 4.7 4.7 12.3 0 17l-29.4 29.4-.6.6C419.7 223.3 432 262.2 432 304zm-176 36V188.5c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12V340c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12z"},child:[]}]})(t)}function kn(t){return Re({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(t)}function So(t){return Re({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111.03 8 0 119.03 0 256s111.03 248 248 248 248-111.03 248-248S384.97 8 248 8zm0 376c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32zm0-128c-53.02 0-96 42.98-96 96s42.98 96 96 96c-106.04 0-192-85.96-192-192S141.96 64 248 64c53.02 0 96 42.98 96 96s-42.98 96-96 96zm0-128c-17.67 0-32 14.33-32 32s14.33 32 32 32 32-14.33 32-32-14.33-32-32-32z"},child:[]}]})(t)}q.CLASSIC+"",q.TIME_ATTACK+"",q.SURVIVAL+"",q.ZEN+"",q.TUTORIAL+"";oe.VERY_EASY+"",oe.EASY+"",oe.MEDIUM+"",oe.HARD+"",oe.VERY_HARD+"";const Bn={[q.CLASSIC]:"Juega a tu ritmo y completa todos los niveles.",[q.TIME_ATTACK]:"Acumula puntos antes que se acabe el tiempo.",[q.SURVIVAL]:"Sobrevive el mayor tiempo posible con dificultad creciente.",[q.ZEN]:"Modo relajado sin presi√≥n de tiempo ni objetivos espec√≠ficos.",[q.TUTORIAL]:"Aprende los conceptos b√°sicos del juego paso a paso."};oe.VERY_EASY+"",oe.EASY+"",oe.MEDIUM+"",oe.HARD+"",oe.VERY_HARD+"";const Et={title:{opacity:0,transform:"translateY(-20px)"},options:{opacity:0,transform:"translateY(20px)"},button:{opacity:0,transform:"scale(0.8)"}},Un={[q.CLASSIC]:"Cl√°sico",[q.TIME_ATTACK]:"Contrarreloj",[q.SURVIVAL]:"Supervivencia",[q.ZEN]:"Zen",[q.TUTORIAL]:"Tutorial"},rt=t=>t!==null&&t===q.TUTORIAL,Gn=(t,o)=>{if(!t)return"üëà Selecciona un modo de juego para comenzar";if(rt(t))return"Aprende los conceptos b√°sicos del juego paso a paso. El tutorial te guiar√° con instrucciones simples para dominar las mec√°nicas.";if(t===q.ZEN)return"Modo relajado sin presi√≥n. Juega a tu ritmo, sin l√≠mites de tiempo ni objetivos espec√≠ficos. Perfecto para practicar y disfrutar.";if(!o)return"üëà Selecciona una dificultad para este modo";let a="";switch(t){case q.CLASSIC:a="Modo tradicional donde debes alcanzar objetivos espec√≠ficos para avanzar de nivel.";break;case q.TIME_ATTACK:a="Contrarreloj: acumula la mayor cantidad de puntos antes de que se acabe el tiempo.";break;case q.SURVIVAL:a="Sobrevive el mayor tiempo posible con dificultad creciente.";break;default:a=Bn[t]}let n="";switch(o){case oe.VERY_EASY:n="Nivel muy accesible, ideal para principiantes.";break;case oe.EASY:n="Dificultad baja, buen punto de partida.";break;case oe.MEDIUM:n="Dificultad equilibrada, recomendada para la mayor√≠a de jugadores.";break;case oe.HARD:n="Desafiante, para jugadores experimentados.";break;case oe.VERY_HARD:n="Extremadamente dif√≠cil, solo para expertos.";break}return`${a} ${n}`},ot=({mode:t})=>{const o=()=>{switch(t){case q.TUTORIAL:return e.jsx(vo,{className:"mode-icon tutorial-icon"});case q.CLASSIC:return e.jsx(po,{className:"mode-icon classic-icon"});case q.TIME_ATTACK:return e.jsx(yo,{className:"mode-icon timed-icon"});case q.SURVIVAL:return e.jsx(bo,{className:"mode-icon survival-icon"});case q.ZEN:return e.jsx(So,{className:"mode-icon zen-icon"});default:return null}};return e.jsx("div",{className:"mode-icon-container",children:o()})},Vn=({difficulty:t})=>{const o=()=>{switch(t){case oe.VERY_EASY:return e.jsx(go,{className:"difficulty-icon very-easy-icon"});case oe.EASY:return e.jsx(Co,{className:"difficulty-icon easy-icon"});case oe.MEDIUM:return e.jsx(fo,{className:"difficulty-icon medium-icon"});case oe.HARD:return e.jsx(ho,{className:"difficulty-icon hard-icon"});case oe.VERY_HARD:return e.jsx(xo,{className:"difficulty-icon very-hard-icon"});default:return null}};return e.jsx("div",{className:"difficulty-icon-container",children:o()})},wt=({difficulty:t,selected:o,onClick:a})=>(oe.VERY_EASY+"",oe.EASY+"",oe.MEDIUM+"",oe.HARD+"",oe.VERY_HARD+"",e.jsxs("div",{className:`difficulty-option ${t.toLowerCase().replace("_","-")} ${o?"active":""}`,onClick:a,children:[e.jsx(Vn,{difficulty:t}),e.jsx("div",{className:"difficulty-shine-effect"})]})),Wt=({children:t,title:o,content:a,position:n="bottom"})=>{const[c,l]=s.useState(!1),r=s.useRef(null);return s.useEffect(()=>{const d=u=>{r.current&&!r.current.contains(u.target)&&l(!1)};return c&&document.addEventListener("mousedown",d),()=>{document.removeEventListener("mousedown",d)}},[c]),e.jsxs("div",{className:"tooltip-container",ref:r,children:[e.jsx("div",{className:"info-icon-container",onClick:()=>l(!c),children:t||e.jsx(Pn,{className:"info-icon"})}),c&&e.jsxs("div",{className:`tooltip tooltip-${n}`,children:[e.jsxs("div",{className:"tooltip-header",children:[e.jsx("span",{className:"tooltip-title",children:o}),e.jsx("button",{className:"tooltip-close-btn",onClick:()=>l(!1),children:e.jsx(kn,{})})]}),e.jsx("div",{className:"tooltip-content",children:a})]})]})},_n=()=>e.jsxs("div",{className:"tooltip-modes",children:[e.jsxs("div",{className:"tooltip-mode-item",children:[e.jsxs("span",{className:"tooltip-mode-name",children:[e.jsx(vo,{className:"tooltip-icon"})," Tutorial"]}),"Aprende los controles b√°sicos y mec√°nicas del juego paso a paso en un entorno seguro."]}),e.jsxs("div",{className:"tooltip-mode-item",children:[e.jsxs("span",{className:"tooltip-mode-name",children:[e.jsx(po,{className:"tooltip-icon"})," Cl√°sico"]}),"Completa niveles con objetivos espec√≠ficos. El modo tradicional para disfrutar del juego."]}),e.jsxs("div",{className:"tooltip-mode-item",children:[e.jsxs("span",{className:"tooltip-mode-name",children:[e.jsx(yo,{className:"tooltip-icon"})," Contrarreloj"]}),"Consigue la mayor puntuaci√≥n posible antes de que se acabe el tiempo. ¬°Cada segundo cuenta!"]}),e.jsxs("div",{className:"tooltip-mode-item",children:[e.jsxs("span",{className:"tooltip-mode-name",children:[e.jsx(bo,{className:"tooltip-icon"})," Supervivencia"]}),"Sobrevive el mayor tiempo posible mientras la dificultad aumenta gradualmente. El verdadero desaf√≠o."]}),e.jsxs("div",{className:"tooltip-mode-item",children:[e.jsxs("span",{className:"tooltip-mode-name",children:[e.jsx(So,{className:"tooltip-icon"})," Zen"]}),"Juega sin presi√≥n, sin l√≠mites de tiempo ni objetivos espec√≠ficos. Ideal para relajarse."]})]}),Hn=()=>e.jsxs("div",{className:"tooltip-difficulties",children:[e.jsxs("div",{className:"tooltip-difficulty-item",children:[e.jsxs("span",{className:"tooltip-difficulty-name",children:[e.jsx(go,{className:"tooltip-icon"})," Muy F√°cil"]}),"Ritmo lento con pocas piezas en pantalla. Ideal para principiantes y para aprender el juego."]}),e.jsxs("div",{className:"tooltip-difficulty-item",children:[e.jsxs("span",{className:"tooltip-difficulty-name",children:[e.jsx(Co,{className:"tooltip-icon"})," F√°cil"]}),"Un desaf√≠o ligero con movimientos predecibles. Perfecto para jugadores novatos."]}),e.jsxs("div",{className:"tooltip-difficulty-item",children:[e.jsxs("span",{className:"tooltip-difficulty-name",children:[e.jsx(fo,{className:"tooltip-icon"})," Normal"]}),"Dificultad equilibrada para la mayor√≠a de jugadores. El ritmo est√°ndar del juego."]}),e.jsxs("div",{className:"tooltip-difficulty-item",children:[e.jsxs("span",{className:"tooltip-difficulty-name",children:[e.jsx(ho,{className:"tooltip-icon"})," Dif√≠cil"]}),"Ritmo acelerado con m√°s piezas y menos tiempo. Para jugadores experimentados."]}),e.jsxs("div",{className:"tooltip-difficulty-item",children:[e.jsxs("span",{className:"tooltip-difficulty-name",children:[e.jsx(xo,{className:"tooltip-icon"})," Muy Dif√≠cil"]}),"Un verdadero reto incluso para expertos. Requiere reflejos r√°pidos y estrategia avanzada."]})]}),qn=({isVisible:t=!0,onStart:o})=>{const a=s.useRef(null),{playSound:n}=Qe();ro(),ke();const{gameMode:c,setGameMode:l,gameDifficulty:r,setGameDifficulty:d,isSoundEnabled:u,setIsSoundEnabled:j,isMusicEnabled:i,setIsMusicEnabled:m}=Xe(),{highScore:h}=De(y=>y.game),w=!1,[O,F]=s.useState(()=>(localStorage.setItem("tutorialCompleted","true"),localStorage.getItem("tutorialCompleted")==="true")),[G,$]=s.useState(!0),[k,te]=s.useState(!0),[D,_]=s.useState(!1),[V,ee]=s.useState(null),[P,ae]=s.useState(r||null),[re,me]=s.useState([]),[J,ce]=s.useState(!1),[de,E]=s.useState([]);s.useEffect(()=>{(()=>{const x=[];for(let Q=0;Q<6;Q++){const z=Math.random()*2.5+1,X=Math.random()*100,se=Math.random()*20+20,H=Math.random()*15;x.push(e.jsx("div",{className:"floating-star",style:{width:`${z}px`,height:`${z}px`,left:`${X}%`,opacity:0,animation:`floatStar ${se}s linear ${H}s infinite`,backgroundColor:"#FFD700",boxShadow:"0 0 4px 1px rgba(255, 215, 0, 0.6)"}},Q))}E(x)})()},[]);const{changeGameConfig:Y}=io(),[f,S]=s.useState(Et),[I,L]=s.useState(!1),[le,ne]=s.useState(!1),[M,C]=s.useState("main"),[W,Z]=s.useState(w),[be,Me]=s.useState(w);s.useEffect(()=>{const y=()=>{const g=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${g}px`)};y(),window.addEventListener("resize",y),window.addEventListener("orientationchange",y);const x=document.querySelector(".game-selection-container");if(x){const g=Q=>{Q.stopPropagation()};return x.addEventListener("touchstart",g,{passive:!0}),x.addEventListener("touchmove",g,{passive:!0}),()=>{window.removeEventListener("resize",y),window.removeEventListener("orientationchange",y),x.removeEventListener("touchstart",g),x.removeEventListener("touchmove",g)}}return()=>{window.removeEventListener("resize",y),window.removeEventListener("orientationchange",y)}},[]),s.useEffect(()=>{V===q.TUTORIAL||V===q.ZEN||V&&P?Z(!0):Z(!1)},[V,P]),s.useEffect(()=>{let y;const x=[];return t?(L(!0),ne(!1),document.body.classList.add("modal-open"),C("play"),x.push(setTimeout(()=>{S(g=>({...g,title:{opacity:1,transform:"translateY(0)"}})),x.push(setTimeout(()=>{S(g=>({...g,options:{opacity:1,transform:"translateY(0)"}})),x.push(setTimeout(()=>{S(g=>({...g,button:{opacity:1,transform:"scale(1)"}}))},200))},200))},100))):(ne(!0),y=setTimeout(()=>{L(!1),S(Et),document.body.classList.remove("modal-open"),C("main")},300)),()=>{y&&clearTimeout(y),x.forEach(g=>clearTimeout(g)),document.body.classList.remove("modal-open"),ne(!1),S(Et),console.log("ModeSelectionModal desmontado y recursos liberados")}},[t,M,w,O]);const he=y=>{n("uiSelect"),C(y)},Ee=y=>{if(a.current&&!a.current.contains(y.target)&&!D){n("uiClose");const x=a.current;x.style.transform="scale(0.98)",setTimeout(()=>{x&&(x.style.transform="scale(1)")},150)}};s.useEffect(()=>(t?document.addEventListener("mousedown",Ee):document.removeEventListener("mousedown",Ee),()=>{document.removeEventListener("mousedown",Ee)}),[t,D]);const Fe=()=>{if(!W||!V)return;n("uiSelect");const y=g=>{switch(g){case oe.VERY_EASY:case oe.EASY:return"easy";case oe.MEDIUM:return"normal";case oe.HARD:case oe.VERY_HARD:return"hard";default:return"normal"}},x=g=>{switch(g){case q.CLASSIC:return"classic";case q.TIME_ATTACK:return"timed";case q.SURVIVAL:return"survival";case q.ZEN:return"zen";case q.TUTORIAL:return"tutorial";default:return"classic"}};rt(V)?(console.log("Iniciando tutorial"),l(q.TUTORIAL),ae(oe.EASY),Y({difficulty:"tutorial",mode:"tutorial"}),console.log("Modo de juego cambiado a tutorial - GameMode:",q.TUTORIAL),localStorage.setItem("tutorialCompleted","true"),F(!0)):V===q.ZEN?(console.log("Iniciando modo Zen"),l(q.ZEN),ae(oe.EASY),Y({difficulty:"easy",mode:"zen"})):(console.log(`Iniciando modo ${V} con dificultad ${P}`),l(V),Y({difficulty:P?y(P):"easy",mode:x(V)})),ne(!0),setTimeout(()=>{o&&o();const g=document.querySelector(".game-page");g&&g.classList.add("modal-active")},500)},we=y=>{n("uiSelect"),ee(y),rt(y)&&ae(oe.EASY),Z(y!==null&&(rt(y)||y===q.ZEN||P!==null))},R=y=>{J||(ae(y),n("uiTap"))},v=()=>{n("uiTap"),j(!u)},K=()=>{n("uiTap"),m(!i)},p=()=>e.jsxs("div",{className:"main-screen",children:[e.jsxs("div",{className:"logo-container",style:{transition:"all 0.6s ease",...f.title},children:[e.jsx("h1",{className:"logo-text",children:"Convergencia"}),e.jsx("div",{className:"logo-pulse"})]}),e.jsxs("div",{className:"main-buttons",style:{transition:"all 0.5s ease",transitionDelay:"0.3s",...f.options},children:[e.jsx("button",{className:"main-button play-button",onClick:()=>he("play"),children:"JUGAR"}),e.jsx("button",{className:"main-button options-button",onClick:()=>he("options"),children:"OPCIONES"}),e.jsx("button",{className:"main-button credits-button",onClick:()=>he("credits"),children:"CR√âDITOS"})]})]}),b=()=>{const y=!O,x=w,g=V?Un[V]:"",Q=V?Gn(V,P):"";return e.jsxs("div",{className:"play-screen",children:[de,e.jsxs("div",{className:"game-header",children:[e.jsx("button",{className:"back-button",onClick:()=>he("main"),children:"üè†"}),e.jsx("h2",{className:"header-title",children:"Selecciona el modo de juego"}),e.jsx("div",{className:"header-spacer"})]}),e.jsxs("div",{className:"game-selection-container",children:[w,e.jsxs("div",{className:"modes-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{className:"section-title",children:"Modo de juego"}),e.jsx(Wt,{title:"Modos de Juego",content:e.jsx(_n,{})})]}),e.jsxs("div",{className:"modes-grid",children:[y&&e.jsxs("div",{className:`game-option tutorial ${V===q.TUTORIAL?"active":""}`,onClick:()=>we(q.TUTORIAL),children:[e.jsx("div",{className:"game-option-image",children:e.jsx(ot,{mode:q.TUTORIAL})}),e.jsx("div",{className:"game-option-title",children:"Tutorial"}),e.jsx("span",{className:"recommended-badge",children:"Recomendado"}),e.jsx("div",{className:"mode-shine-effect"})]}),e.jsxs("div",{className:`game-option classic ${V===q.CLASSIC?"active":""} `,onClick:()=>we(q.CLASSIC),children:[e.jsx("div",{className:"game-option-image",children:e.jsx(ot,{mode:q.CLASSIC})}),e.jsx("div",{className:"game-option-title",children:"Cl√°sico"}),x,e.jsx("div",{className:"mode-shine-effect"})]}),e.jsxs("div",{className:`game-option timed ${V===q.TIME_ATTACK?"active":""} `,onClick:()=>we(q.TIME_ATTACK),children:[e.jsx("div",{className:"game-option-image",children:e.jsx(ot,{mode:q.TIME_ATTACK})}),e.jsx("div",{className:"game-option-title",children:"Contrarreloj"}),x,e.jsx("div",{className:"mode-shine-effect"})]}),e.jsxs("div",{className:`game-option survival ${V===q.SURVIVAL?"active":""} `,onClick:()=>we(q.SURVIVAL),children:[e.jsx("div",{className:"game-option-image",children:e.jsx(ot,{mode:q.SURVIVAL})}),e.jsx("div",{className:"game-option-title",children:"Supervivencia"}),x,e.jsx("div",{className:"mode-shine-effect"})]}),e.jsxs("div",{className:`game-option zen ${V===q.ZEN?"active":""} `,onClick:()=>we(q.ZEN),children:[e.jsx("div",{className:"game-option-image",children:e.jsx(ot,{mode:q.ZEN})}),e.jsx("div",{className:"game-option-title",children:"Zen"}),x,e.jsx("div",{className:"mode-shine-effect"})]})]})]}),e.jsxs("div",{className:"difficulty-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{className:"section-title",children:"Dificultad"}),e.jsx(Wt,{title:"Niveles de Dificultad",content:e.jsx(Hn,{})})]}),e.jsxs("div",{className:"difficulty-options",children:[e.jsx(wt,{difficulty:oe.EASY,selected:P===oe.EASY,onClick:()=>R(oe.EASY)}),e.jsx(wt,{difficulty:oe.MEDIUM,selected:P===oe.MEDIUM,onClick:()=>R(oe.MEDIUM)}),e.jsx(wt,{difficulty:oe.HARD,selected:P===oe.HARD,onClick:()=>R(oe.HARD)})]})]}),V&&e.jsx("div",{className:"description-section",children:e.jsxs("div",{className:"unified-description-container",children:[e.jsx("h3",{className:"mode-title",children:g?`Modo ${g}`:"Selecciona un modo"}),e.jsx("p",{children:Q})]})})]}),e.jsx("div",{className:"fixed-start-button-container",children:e.jsx("button",{className:`start-button ${V&&P?"active":"disabled"}`,onClick:Fe,disabled:!V||!P,children:"¬°EMPEZAR!"})})]})},A=()=>e.jsxs("div",{className:"options-screen",children:[e.jsxs("div",{className:"screen-header",children:[e.jsx("h2",{children:"Opciones"}),e.jsx("button",{className:"back-button",onClick:()=>he("main"),children:"‚¨ÖÔ∏è Volver"})]}),e.jsxs("div",{className:"settings-content",children:[e.jsxs("div",{className:"settings-option",children:[e.jsx("span",{children:"M√∫sica"}),e.jsx("button",{className:`setting-toggle ${i?"active":""}`,onClick:K,children:i?"ON":"OFF"})]}),e.jsxs("div",{className:"settings-option",children:[e.jsx("span",{children:"Sonido"}),e.jsx("button",{className:`setting-toggle ${u?"active":""}`,onClick:v,children:u?"ON":"OFF"})]}),e.jsxs("div",{className:"settings-option",children:[e.jsx("span",{children:"Notificaciones"}),e.jsx("div",{className:"setting-checkbox",children:"‚úì"})]})]})]}),T=()=>e.jsxs("div",{className:"credits-screen",children:[e.jsxs("div",{className:"screen-header",children:[e.jsx("h2",{children:"Cr√©ditos"}),e.jsx("button",{className:"back-button",onClick:()=>he("main"),children:"‚¨ÖÔ∏è Volver"})]}),e.jsxs("div",{className:"credits-content",children:[e.jsx("h3",{children:"Convergencia"}),e.jsx("p",{children:"Dise√±ado y desarrollado por:"}),e.jsx("p",{className:"credits-name",children:"Equipo de Desarrollo"}),e.jsx("h4",{children:"Programaci√≥n"}),e.jsx("p",{className:"credits-name",children:"Programador Principal"}),e.jsx("h4",{children:"Dise√±o Gr√°fico"}),e.jsx("p",{className:"credits-name",children:"Artista Principal"}),e.jsx("h4",{children:"M√∫sica y Sonido"}),e.jsx("p",{className:"credits-name",children:"Compositor"}),e.jsx("h4",{children:"Agradecimientos Especiales"}),e.jsx("p",{children:"A todos los que hicieron posible este juego"}),e.jsxs("div",{className:"version-info",children:[e.jsx("p",{children:"Versi√≥n 1.0.0"}),e.jsx("p",{children:"¬© 2023 Todos los derechos reservados"})]})]})]});if(!I&&!t)return null;const B=()=>{switch(M){case"play":return b();case"options":return A();case"credits":return T();default:return p()}};return e.jsx("div",{className:`game-modal-start start-game ${I?"visible":""} ${le?"closing":""}`,children:e.jsx("div",{className:"modal-content",ref:a,children:e.jsx("div",{className:`start-game-body ${M}`,children:B()})})})};var No=(t=>(t.WELCOME="welcome",t.BASIC_MECHANICS="basic_mechanics",t.CONVERGENCE="convergence",t.COMBOS="combos",t.PENALTIES="penalties",t.COMPLETION="completion",t))(No||{});const Yn=({onComplete:t})=>{const o=ke(),[a,n]=s.useState("welcome"),[c,l]=s.useState(!1),[r,d]=s.useState(!0),[u,j]=s.useState(!1),[i,m]=s.useState(!1),[h,w]=s.useState(!1),[O,F]=s.useState(!1),G=s.useRef(null),{board:$,score:k,iconCount:te,status:D,comboCount:_,currentPlayMode:V}=De(f=>f.game),ee=s.useRef(k),P=s.useRef(te),ae=s.useRef(_),re=()=>{j(!0),localStorage.setItem("tutorialCompleted","true")},me=()=>{j(!1),t()},J=()=>{console.log("Tutorial: Ocultando temporalmente para acci√≥n"),m(!0),w(!0)},ce={welcome:{title:"¬°Bienvenido al Tutorial!",content:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"¬°Hola! Vamos a aprender juntos c√≥mo jugar a Convergence."}),e.jsx("p",{children:"En este tutorial, te ense√±ar√© las mec√°nicas b√°sicas del juego para que puedas empezar a jugar r√°pidamente."}),e.jsx("button",{className:"tutorial-button",onClick:()=>Y(),children:"Empezar"})]})},basic_mechanics:{title:"Mec√°nicas B√°sicas",content:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["El objetivo del juego es ",e.jsx("strong",{children:"eliminar iconos"})," del tablero creando ",e.jsx("strong",{children:"convergencias"}),"."]}),e.jsx("p",{children:"Una convergencia ocurre cuando 3 o m√°s iconos del mismo tipo se alinean en l√≠nea recta (horizontal, vertical o diagonal)."}),e.jsx("p",{children:"Observa el tablero y busca grupos de iconos iguales que est√©n alineados."}),e.jsx("button",{className:"tutorial-button",onClick:()=>Y(),children:"Siguiente"})]})},convergence:{title:"¬°Crea tu primera convergencia!",content:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Ahora es tu turno: ",e.jsx("strong",{children:"encuentra 3 o m√°s iconos iguales"})," que est√©n alineados y haz clic en ellos para eliminarlos."]}),e.jsx("p",{children:"Te he se√±alado un posible grupo. ¬°Prueba a hacer clic!"}),e.jsx("p",{className:"tutorial-note",children:"Debes completar esta acci√≥n para continuar."}),!i&&e.jsx("button",{className:"tutorial-button",onClick:J,children:"Entendido"})]}),waitForAction:!0,actionType:"convergence",highlightCells:de($)},combos:{title:"¬°Sistema de Combos!",content:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"¬°Excelente! Has creado tu primera convergencia."}),e.jsxs("p",{children:["Un ",e.jsx("strong",{children:"combo"})," ocurre cuando eliminas ",e.jsx("strong",{children:"m√∫ltiples convergencias"})," en un corto periodo de tiempo."]}),e.jsx("p",{children:"Para hacer un combo, necesitas:"}),e.jsxs("ol",{children:[e.jsx("li",{children:"Eliminar una primera convergencia (que ya has hecho)"}),e.jsxs("li",{children:["Encontrar y eliminar ",e.jsx("strong",{children:"otra convergencia diferente"})," antes de que se agote el tiempo"]})]}),e.jsxs("p",{children:["Los combos multiplican tus puntos: ",e.jsx("span",{className:"combo-basic-text",children:"x1.5"}),", ",e.jsx("span",{className:"combo-uncommon-text",children:"x2.0"}),", ",e.jsx("span",{className:"combo-rare-text",children:"x3.0"})," y hasta ",e.jsx("span",{className:"combo-legendary-text",children:"x5.0"}),"."]}),e.jsxs("p",{children:["Ver√°s una ",e.jsx("strong",{children:"barra de tiempo"})," en la parte superior cuando se active un combo. ¬°Elimina otro grupo antes de que se agote!"]}),e.jsx("p",{className:"tutorial-note",children:"Debes eliminar una segunda convergencia para continuar."}),!i&&e.jsx("button",{className:"tutorial-button",onClick:J,children:"Entendido"})]}),waitForAction:!0,actionType:"combo"},penalties:{title:"Cuidado con las Penalizaciones",content:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Ten cuidado: si el tablero se llena demasiado, recibir√°s ",e.jsx("strong",{children:"penalizaciones"}),"."]}),e.jsx("p",{children:"Estas penalizaciones a√±aden m√°s iconos al tablero y dificultan el juego."}),e.jsx("p",{children:"Intenta mantener el tablero lo m√°s despejado posible."}),e.jsx("button",{className:"tutorial-button",onClick:()=>Y(),children:"Entendido"})]})},completion:{title:"¬°Tutorial Completado!",content:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"¬°Felicidades! Has completado el tutorial b√°sico de Convergence."}),e.jsx("p",{children:"Ahora conoces las mec√°nicas fundamentales del juego:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Crear convergencias alineando 3 o m√°s iconos iguales"}),e.jsx("li",{children:"Realizar combos para multiplicar tus puntos"}),e.jsx("li",{children:"Evitar penalizaciones manteniendo el tablero despejado"})]}),e.jsx("button",{className:"tutorial-button-primary",onClick:re,children:"¬°Estoy listo para jugar!"})]})}};function de(f){const S=[{rowStep:1,colStep:0},{rowStep:0,colStep:1},{rowStep:1,colStep:1},{rowStep:1,colStep:-1}],I=f.length;for(let M=0;M<I;M++)for(let C=0;C<I;C++){const W=f[M][C];if(W)for(const Z of S){const be=[];let Me=M,he=C;for(let Ee=0;Ee<5&&!(Me<0||Me>=I||he<0||he>=I||f[Me][he]!==W);Ee++)be.push({row:Me,col:he}),Me+=Z.rowStep,he+=Z.colStep;if(be.length>=3)return console.log(`Convergencia encontrada: ${be.length} iconos ${W}`),be}}console.log("No se encontraron convergencias existentes, buscando oportunidades para crear una");const L=E(f);if(L.length>0)return console.log("Se encontr√≥ una oportunidad para crear convergencia"),L;console.log("No se encontraron convergencias potenciales, seleccionando iconos aleatorios");const le=[];for(let M=0;M<I;M++)for(let C=0;C<I;C++)f[M][C]&&le.push({row:M,col:C});const ne=le.slice(0,Math.min(3,le.length));return console.log(`Seleccionados ${ne.length} iconos aleatorios para destacar`),ne}function E(f){const S=f.length;for(let I=0;I<S;I++)for(let L=0;L<S;L++){if(L<S-2&&f[I][L]&&f[I][L]===f[I][L+1])return[{row:I,col:L},{row:I,col:L+1}];if(I<S-2&&f[I][L]&&f[I][L]===f[I+1][L])return[{row:I,col:L},{row:I+1,col:L}];if(I<S-2&&L<S-2&&f[I][L]&&f[I][L]===f[I+1][L+1])return[{row:I,col:L},{row:I+1,col:L+1}];if(I>1&&L<S-2&&f[I][L]&&f[I][L]===f[I-1][L+1])return[{row:I,col:L},{row:I-1,col:L+1}]}return[]}const Y=()=>{const f=Object.values(No),S=f.indexOf(a);console.log(`Tutorial: Avanzando al paso ${S+1} de ${f.length}`),S<f.length-1?(n(f[S+1]),l(!1),m(!1),w(!1)):(console.log("Tutorial: Finalizando tutorial"),re())};return s.useEffect(()=>{const f=ce[a];if(f.waitForAction&&h)switch(f.actionType){case"convergence":k>ee.current&&(console.log("Convergencia detectada: puntuaci√≥n aumentada"),l(!0),m(!1),w(!1));break;case"combo":_>=2?(console.log(`Combo real detectado: ${_} convergencias consecutivas`),l(!0),m(!1),w(!1),F(!1)):k>ee.current&&_<2&&(console.log("Se detect√≥ una convergencia, pero no un combo. El combo requiere m√∫ltiples convergencias."),F(!0),m(!1),ee.current=k);break}f.actionType==="combo"&&k>ee.current&&_<2||(ee.current=k),P.current=te,ae.current=_},[k,te,_,a,ce,h]),s.useEffect(()=>{if(c){const f=setTimeout(()=>{Y()},1500);return()=>clearTimeout(f)}},[c]),s.useEffect(()=>{const f=ce[a].highlightCells;if(f&&f.length>0){const S=document.querySelectorAll(".game-cell"),I=$.length;S.forEach(L=>{L.classList.remove("tutorial-highlight-pulse"),document.querySelectorAll(".cell-click-indicator").forEach(ne=>ne.remove())}),f.forEach(({row:L,col:le})=>{const ne=L*I+le;if(S[ne]&&(S[ne].classList.add("tutorial-highlight-pulse"),ce[a].waitForAction)){const M=document.createElement("div");M.className="cell-click-indicator",M.textContent="¬°Clic aqu√≠!",S[ne].appendChild(M)}}),o(Ie(f))}else o(Ie([]));return()=>{document.querySelectorAll(".game-cell").forEach(L=>{L.classList.remove("tutorial-highlight-pulse")}),document.querySelectorAll(".cell-click-indicator").forEach(L=>L.remove()),o(Ie([]))}},[a,o,$,i]),s.useEffect(()=>{V!=="tutorial"&&D==="playing"&&console.warn("GameTutorial: No estamos en modo tutorial pero el componente est√° activo")},[V,D]),s.useEffect(()=>{if(O){const f=setTimeout(()=>{F(!1)},5e3);return()=>clearTimeout(f)}},[O]),s.useEffect(()=>(console.log("GameTutorial: Componente montado y visible"),()=>{console.log("GameTutorial: Componente desmontado")}),[]),e.jsxs(e.Fragment,{children:[r&&!i&&e.jsx("div",{className:`tutorial-overlay ${ce[a].waitForAction?"interactive":""}`,ref:G,children:e.jsxs("div",{className:"tutorial-card",children:[e.jsx("h2",{className:"tutorial-title",children:ce[a].title}),e.jsx("div",{className:"tutorial-content",children:ce[a].content}),O&&a==="combos"&&e.jsxs("div",{className:"tutorial-help-message",children:[e.jsxs("p",{children:["¬°Bien! Has eliminado una convergencia, pero un combo requiere eliminar ",e.jsx("strong",{children:"varias convergencias seguidas"}),"."]}),e.jsxs("p",{children:["Busca y elimina ",e.jsx("strong",{children:"otro grupo de iconos"})," antes de que se agote el tiempo."]})]}),c&&ce[a].waitForAction&&e.jsx("div",{className:"tutorial-success-message",children:"¬°Perfecto! Avanzando al siguiente paso..."})]})}),i&&e.jsxs("div",{className:"tutorial-mini-button",onClick:()=>m(!1),children:[e.jsx("span",{className:"tutorial-mini-icon",children:"‚ùì"}),e.jsx("span",{children:"Mostrar Tutorial"})]}),u&&e.jsx("div",{className:"tutorial-completion-modal",children:e.jsxs("div",{className:"tutorial-completion-content",children:[e.jsx("h2",{children:"¬°Felicidades!"}),e.jsx("p",{children:"Has completado el tutorial b√°sico de Convergence."}),e.jsx("p",{children:"Ahora tienes los conocimientos necesarios para jugar a todos los modos de juego."}),e.jsx("p",{children:"¬°Divi√©rtete jugando y mejorando tus habilidades!"}),e.jsx("button",{className:"tutorial-completion-button",onClick:me,children:"¬°Vamos a jugar!"})]})})]})},Wn=({performanceThreshold:t=30})=>{const[o,a]=s.useState(null),n=s.useRef({frames:0,lastTime:performance.now(),samples:[]});s.useEffect(()=>{let l,r;const d=()=>{n.current.frames++,l=requestAnimationFrame(d)};return l=requestAnimationFrame(d),r=setInterval(()=>{const u=performance.now(),j=u-n.current.lastTime;if(j<200)return;const i=Math.round(n.current.frames*1e3/j);a(i),n.current.samples.push(i),n.current.samples.length>5&&n.current.samples.shift(),n.current.frames=0,n.current.lastTime=u},1e3),()=>{cancelAnimationFrame(l),clearInterval(r)}},[]);const c=()=>o?o>=t?"var(--color-success)":o>=t/2?"var(--color-warning)":"var(--color-danger)":"var(--color-text-secondary)";return e.jsx("div",{className:"fps-counter",children:e.jsx("span",{style:{color:c()},children:o?`${o} FPS`:"Calculando..."})})},Mt={title:{opacity:0,transform:"translateY(-20px)"},content:{opacity:0,transform:"translateY(20px)"},buttons:{opacity:0,transform:"scale(0.8)"}},Jn=({isVisible:t=!1,onResume:o,onRestart:a,onExit:n,onSettings:c})=>{const{level:l,score:r,highScore:d,currentPlayMode:u,currentDifficulty:j}=De(P=>P.game),{playSound:i}=Qe(),m=s.useRef(null),[h,w]=s.useState(Mt),[O,F]=s.useState(!1),[G,$]=s.useState(!1);s.useEffect(()=>{const P=()=>{const ae=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${ae}px`)};return P(),window.addEventListener("resize",P),window.addEventListener("orientationchange",P),window.addEventListener("load",P),()=>{window.removeEventListener("resize",P),window.removeEventListener("orientationchange",P),window.removeEventListener("load",P)}},[]),s.useEffect(()=>{let P;const ae=[];return t?(F(!0),$(!1),document.body.classList.add("modal-open"),i("uiOpen"),ae.push(setTimeout(()=>{w(re=>({...re,title:{opacity:1,transform:"translateY(0)"}})),ae.push(setTimeout(()=>{w(re=>({...re,content:{opacity:1,transform:"translateY(0)"}})),ae.push(setTimeout(()=>{w(re=>({...re,buttons:{opacity:1,transform:"scale(1)"}}))},200))},200))},100))):($(!0),P=setTimeout(()=>{F(!1),w(Mt),document.body.classList.remove("modal-open")},300)),()=>{P&&clearTimeout(P),ae.forEach(re=>clearTimeout(re)),document.body.classList.remove("modal-open"),$(!1),w(Mt),console.log("PauseModal desmontado y recursos liberados")}},[t,i]);const k=()=>{o&&($(!0),i("uiClick"),setTimeout(()=>{F(!1),o()},300))},te=()=>{a&&($(!0),i("uiClick"),setTimeout(()=>{F(!1),a()},300))},D=()=>{n&&($(!0),i("uiClick"),setTimeout(()=>{F(!1),n()},300))},_=()=>{c&&(i("uiClick"),c())},V=()=>{switch(u){case"classic":return"Cl√°sico";case"timed":return"Contrarreloj";case"survival":return"Supervivencia";case"zen":return"Zen";default:return"Cl√°sico"}},ee=()=>{switch(j){case"easy":return"F√°cil";case"normal":return"Normal";case"hard":return"Dif√≠cil";case"tutorial":return"Tutorial";default:return"Normal"}};return!O&&!t?null:e.jsx("div",{className:`game-modal fullscreen-modal ${O?"visible":""} ${G?"closing":""}`,children:e.jsxs("div",{className:"modal-content pause-content",ref:m,children:[e.jsxs("div",{className:"pause-header",style:{transition:"all 0.6s ease",...h.title},children:[e.jsx("h1",{children:"Juego en Pausa"}),e.jsx("h2",{children:"¬°T√≥mate un descanso!"})]}),e.jsx("div",{className:"pause-body",style:{transition:"all 0.5s ease",transitionDelay:"0.2s",...h.content},children:e.jsxs("div",{className:"game-status-info",children:[e.jsxs("div",{className:"info-row",children:[e.jsx("div",{className:"info-label",children:"Nivel"}),e.jsx("div",{className:"info-value",children:l})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("div",{className:"info-label",children:"Puntuaci√≥n"}),e.jsx("div",{className:"info-value",children:r})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("div",{className:"info-label",children:"R√©cord"}),e.jsx("div",{className:"info-value",children:d})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("div",{className:"info-label",children:"Modo"}),e.jsx("div",{className:"info-value",children:V()})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("div",{className:"info-label",children:"Dificultad"}),e.jsx("div",{className:"info-value",children:ee()})]})]})}),e.jsxs("div",{className:"pause-buttons",style:{transition:"all 0.4s ease",transitionDelay:"0.4s",...h.buttons},children:[e.jsx("button",{className:"pause-button resume-button",onClick:k,children:"‚ñ∂Ô∏è Reanudar"}),e.jsxs("div",{className:"secondary-buttons",children:[e.jsx("button",{className:"pause-button secondary restart-button",onClick:te,children:"üîÑ Reiniciar"}),e.jsx("button",{className:"pause-button secondary settings-button",onClick:_,children:"‚öôÔ∏è Ajustes"}),e.jsx("button",{className:"pause-button secondary exit-button",onClick:D,children:"üè† Salir"})]})]})]})})};let gt;try{gt=require("./BASE_MODE_CONFIG").BASE_MODE_CONFIG}catch{gt={classic:{baseSpawnRate:2e3,spawnRateDecrement:100,minSpawnRate:500,scoreMultiplier:1},timed:{baseSpawnRate:1500,spawnRateDecrement:150,minSpawnRate:400,scoreMultiplier:1.2},survival:{baseSpawnRate:1800,spawnRateDecrement:120,minSpawnRate:450,scoreMultiplier:.8},zen:{baseSpawnRate:2500,spawnRateDecrement:50,minSpawnRate:600,scoreMultiplier:.5}},N.warn("LevelSystem","No se pudo importar BASE_MODE_CONFIG, usando valores por defecto")}function Zn(){try{N.info("LevelSystem","Migrando configuraci√≥n existente al nuevo sistema de niveles");const t=ko.icons,o=Bo;if(st&&st.length>0){N.info("LevelSystem","El sistema de niveles ya est√° inicializado");return}N.info("LevelSystem","Migraci√≥n completada correctamente")}catch(t){N.error("LevelSystem",`Error al migrar configuraci√≥n: ${t}`)}}function Kn(){try{return N.info("LevelSystem","Inicializando sistema de niveles"),Zn(),N.info("LevelSystem","Sistema de niveles inicializado correctamente"),{predefinedLevels:st?st.length:0,difficulties:Tt?Object.keys(Tt):["easy","normal","hard","tutorial"],modes:gt?Object.keys(gt):["classic","timed","survival","zen"]}}catch(t){return N.error("LevelSystem",`Error al inicializar sistema de niveles: ${t}`),{predefinedLevels:0,difficulties:["easy","normal","hard","tutorial"],modes:["classic","timed","survival","zen"]}}}const Jt=25,Xn=({stage:t,error:o,onInitComplete:a})=>{const n=ke(),[c,l]=s.useState("not_started"),[r,d]=s.useState(null),[u,j]=s.useState(!1),i=t||c,m=o||r,h=s.useRef({isRunning:!1,frameCount:0,startTime:0,samples:[],hasDecided:!1,useLiteMode:!1}),w=lo(Jt),O=s.useRef(!1),F=s.useCallback(te=>{te?(document.documentElement.classList.add("lite-animations"),document.documentElement.classList.add("performance-mode"),N.info("LoadingScreen","Modo de animaciones ligeras activado por FPS bajos"),h.current.useLiteMode=!0):(document.documentElement.classList.remove("lite-animations"),document.documentElement.classList.remove("performance-mode"),N.info("LoadingScreen","Modo de animaciones completas activado por buenos FPS"),h.current.useLiteMode=!1),w.initializeAnimations(te)},[w]),G=s.useCallback(()=>{if(h.current.isRunning||h.current.hasDecided)return;h.current.isRunning=!0,h.current.startTime=performance.now(),h.current.frameCount=0,h.current.samples=[],N.info("LoadingScreen","Iniciando detecci√≥n de FPS inicial...");let te=null,D=null;const _=()=>{h.current.frameCount++,te=requestAnimationFrame(_)};te=requestAnimationFrame(_),D=window.setInterval(()=>{const ee=performance.now(),P=ee-h.current.startTime;if(P<200)return;const ae=Math.round(h.current.frameCount*1e3/P);if(N.info("LoadingScreen",`FPS medido: ${ae} (${h.current.frameCount} frames en ${P.toFixed(0)}ms)`),h.current.samples.push(ae),h.current.samples.length>5&&h.current.samples.shift(),h.current.frameCount=0,h.current.startTime=ee,h.current.samples.length>=2&&!h.current.hasDecided){const re=[...h.current.samples].sort((de,E)=>de-E),me=re.length>3?re.slice(1,-1):re,J=me.reduce((de,E)=>de+E,0)/me.length;N.info("LoadingScreen",`Promedio FPS: ${J.toFixed(1)}, muestras: ${h.current.samples.join(", ")}`);const ce=J<=Jt;F(ce),h.current.hasDecided=!0,j(!0),te!==null&&(cancelAnimationFrame(te),te=null),D!==null&&(clearInterval(D),D=null),h.current.isRunning=!1}},500);const V=setTimeout(()=>{h.current.hasDecided||(N.warn("LoadingScreen","Tiempo de detecci√≥n de FPS agotado, usando animaciones normales por defecto"),F(!1),h.current.hasDecided=!0,j(!0),te!==null&&cancelAnimationFrame(te),D!==null&&clearInterval(D),h.current.isRunning=!1)},3e3);return()=>{clearTimeout(V),te!==null&&cancelAnimationFrame(te),D!==null&&clearInterval(D)}},[F]);s.useEffect(()=>t||O.current?void 0:(O.current=!0,(async()=>{try{N.info("LoadingScreen","üöÄ Iniciando secuencia de inicializaci√≥n del juego"),l("system_init"),N.info("LoadingScreen","üìã Inicializando sistema de niveles"),Kn(),await new Promise(D=>setTimeout(D,300)),l("fps_detection"),N.info("LoadingScreen","üìä Comenzando detecci√≥n de FPS"),h.current.hasDecided?(N.info("LoadingScreen","Omitiendo detecci√≥n de FPS, ya se complet√≥ anteriormente"),j(!0)):(G(),await new Promise(_=>{const V=setInterval(()=>{u&&(clearInterval(V),_())},100);setTimeout(()=>{clearInterval(V),u||(N.warn("LoadingScreen","Tiempo de espera para detecci√≥n de FPS agotado"),h.current.hasDecided||(h.current.hasDecided=!0,F(!1)),j(!0),_())},3500)})),l("assets_loading"),N.info("LoadingScreen","üéµ Cargando recursos de audio y assets");try{N.info("LoadingScreen","Recursos de audio cargados")}catch(D){N.warn("LoadingScreen",`Error al cargar recursos de audio: ${D}`)}if(w.isLoaded)N.info("LoadingScreen","Animaciones ya cargadas, omitiendo espera");else{if(N.info("LoadingScreen","Esperando que se carguen las animaciones..."),!w.isInitialized()){const _=h.current.useLiteMode;N.info("LoadingScreen",`Inicializando animaciones en modo: ${_?"lite":"normal"}`),w.initializeAnimations(_)}await new Promise(_=>{const V=setInterval(()=>{w.isLoaded&&(clearInterval(V),_())},100);setTimeout(()=>{clearInterval(V),N.warn("LoadingScreen","Tiempo de espera para carga de animaciones agotado"),_()},2500)})}await new Promise(D=>setTimeout(D,300)),l("complete"),N.info("LoadingScreen","‚úÖ Inicializaci√≥n del juego completada exitosamente"),n(fe("startScreen")),setTimeout(()=>{a(u,h.current.useLiteMode)},300)}catch(D){const _=`Error durante la inicializaci√≥n: ${D}`;N.error("LoadingScreen",_),d(_),l("complete"),setTimeout(()=>{a(u,h.current.useLiteMode)},1e3)}})(),()=>{N.info("LoadingScreen","Componente de carga desmontado durante inicializaci√≥n")}),[n,G,u,t,a,w.isLoaded]);let $="Cargando...",k=0;switch(i){case"not_started":$="Preparando el juego...",k=0;break;case"system_init":$="Inicializando sistemas...",k=25;break;case"fps_detection":$="Analizando rendimiento...",k=50;break;case"assets_loading":$="Cargando recursos...",k=75;break;case"complete":$="Iniciando juego...",k=100;break}return e.jsx("div",{className:"game-loading-screen",children:e.jsxs("div",{className:"loading-content",children:[e.jsx("h2",{children:"Convergencia"}),e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{className:"loading-message",children:$}),e.jsx("div",{className:"loading-progress-container",children:e.jsx("div",{className:"loading-progress-bar",style:{width:`${k}%`}})}),m&&e.jsxs("div",{className:"loading-error",children:["Error: ",m]})]})})},os=()=>{const t=ke();Uo();const o=s.useRef(null),{playSound:a}=Qe(),{status:n,level:c,boardSize:l,currentPlayMode:r,currentDifficulty:d,score:u,highScore:j,darkMode:i,timer:m,spawnRate:h}=De(v=>v.game),[w,O]=s.useState(!1),[F,G]=s.useState(!1),[$,k]=s.useState(!1),{gameMode:te,setGameMode:D,gameDifficulty:_,setGameDifficulty:V,isSoundEnabled:ee,setIsSoundEnabled:P,isMusicEnabled:ae,setIsMusicEnabled:re,gameState:me}=Xe(),[J,ce]=s.useState(i),[de,E]=s.useState(!0),[Y,f]=s.useState(!1),S=s.useRef(!1),I=s.useRef(!1),{stopTimers:L,startTimers:le,initializeBoard:ne}=io();s.useRef({isRunning:!1,frameCount:0,startTime:0,samples:[],hasDecided:!1});const{toggleDarkMode:M}=ro(),C=s.useCallback(v=>{v?(document.documentElement.classList.add("lite-animations"),document.documentElement.classList.add("performance-mode"),N.info("GamePage","Modo de animaciones ligeras activado por FPS bajos")):(document.documentElement.classList.remove("lite-animations"),document.documentElement.classList.remove("performance-mode"),N.info("GamePage","Modo de animaciones completas activado"))},[]);s.useEffect(()=>{const v=()=>{const K=window.innerWidth<=768;f(K)};return v(),window.addEventListener("resize",v),()=>{window.removeEventListener("resize",v)}},[]),s.useEffect(()=>{n==="idle"&&$&&t(fe("startScreen"))},[$,t,n]),s.useEffect(()=>{E(n==="startScreen"||n==="paused"||n==="gameOver"||n==="levelCompleted")},[n]),s.useEffect(()=>{const v=()=>{const K=document.getElementById("game-board");if(K&&I.current){const p=K.parentElement;p&&so(p,K)}};return v(),window.addEventListener("resize",v),()=>{window.removeEventListener("resize",v)}},[l,Y]),s.useEffect(()=>{ce(i)},[i]),s.useEffect(()=>{const v=document.createElement("meta");v.name="viewport",v.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no",document.head.appendChild(v);const K=p=>{p.touches.length>1&&p.preventDefault()};return document.addEventListener("touchmove",K,{passive:!1}),()=>{document.removeEventListener("touchmove",K),document.head.removeChild(v)}},[]),s.useEffect(()=>{const v=o.current;if(!v)return;const K=p=>{let b=p.target;for(;b&&b!==v;){if(b.classList.contains("scrollable"))return;b=b.parentElement}p.preventDefault()};return v.addEventListener("touchmove",K,{passive:!1}),()=>{v.removeEventListener("touchmove",K)}},[]);const W=()=>{O(!1),t(fe("playing"))},Z=()=>{n==="playing"?(t(fe("paused")),L()):n==="paused"&&t(fe("playing"))},be=()=>{try{I.current=!1,L(),t(yt()),t(nt());const v=St(1);t(Ze(v.icons||[])),t(fe("playing")),t(Ie([])),console.log("Fase 4: Inicializando tablero para el nuevo juego"),ne(l,!0,1),console.log("Fase 5: Iniciando temporizadores para el nuevo juego"),setTimeout(()=>{le(!0),console.log("Temporizadores iniciados correctamente")},100),console.log("**********************************************************"),console.log("FIN DEL FLUJO: REINICIO DE PARTIDA COMPLETADO"),console.log(`**********************************************************
`),S.current=!1}catch(v){S.current=!1,N.error("GamePage","Error al reiniciar el juego",v),console.error("Error al reiniciar el juego:",v)}},Me=()=>{try{t(yt()),t(nt()),setTimeout(()=>{try{N.info("GamePage",`Configurando tablero para nivel ${c}`);const v=St(c);t(Ze(v.icons||[])),ne(v.size,!0,c),t(fe("playing")),setTimeout(()=>{U.getState().game.status==="playing"&&(N.info("GamePage","Iniciando temporizadores para el juego"),le())},100),S.current=!1,I.current=!0,N.info("GamePage","FIN DEL FLUJO: JUEGO INICIADO CORRECTAMENTE")}catch(v){N.error("GamePage","Error durante la inicializaci√≥n del juego",v),S.current=!1}},100)}catch(v){N.error("GamePage","Error al iniciar el juego",v),S.current=!1}},he=()=>{L(),t(yt()),S.current=!1,I.current=!1,t(fe("startScreen")),G(!1),N.info("GamePage","Volviendo a la pantalla de inicio")},Ee=()=>{if(S.current){console.warn("Ya hay una inicializaci√≥n en progreso, ignorando paso a siguiente nivel");return}S.current=!0,console.log(`
**********************************************************`),console.log("INICIO DEL FLUJO: AVANZAR AL SIGUIENTE NIVEL"),console.log(`Avanzando del nivel ${c} al nivel ${c+1}`),console.log("**********************************************************");try{L();const v=c+1;t(ut(v));const K=St(v);t(Ze(K.icons||[])),t(fe("playing")),t(Ie([])),console.log("Fase 4: Inicializando tablero para el nuevo nivel"),ne(l,!0,v),console.log("Fase 5: Iniciando temporizadores para el nuevo nivel"),setTimeout(()=>{le(!0),console.log("Temporizadores iniciados correctamente")},100),ee&&a("levelUp"),console.log("**********************************************************"),console.log("FIN DEL FLUJO: AVANCE AL SIGUIENTE NIVEL COMPLETADO"),console.log(`**********************************************************
`),S.current=!1}catch(v){S.current=!1,N.error("GamePage","Error al avanzar al siguiente nivel",v),console.error("Error al avanzar al siguiente nivel:",v)}},Fe=()=>{t(Go(!i)),M()},we=()=>{n==="playing"&&t(fe("paused"))},R=n==="playing";return s.useEffect(()=>{r==="tutorial"&&n==="playing"&&(console.log("Modo tutorial detectado - Activando componente de tutorial"),O(!0))},[r,n]),e.jsxs("div",{className:"game-page",ref:o,children:[e.jsx(Wn,{performanceThreshold:10}),e.jsxs("div",{className:"game-container",children:[!$&&e.jsx(Xn,{onInitComplete:(v,K)=>{N.info("GamePage","Inicializaci√≥n completa detectada: "+v+", Modo Lite: "+K),setTimeout(()=>{k(!0),C(K),n==="idle"&&t(fe("startScreen"))},500)}}),$&&e.jsxs(e.Fragment,{children:[R&&e.jsxs("div",{className:"game-board-section",children:[e.jsx(Mn,{}),e.jsx("div",{className:"game-board-container",children:e.jsx("div",{id:"game-board",children:e.jsx(Sn,{})})})]}),w&&n==="playing"&&e.jsx(Yn,{onComplete:W}),n==="startScreen"&&!F&&e.jsx($n,{isVisible:!0,onPlay:()=>G(!0),onOptions:Fe,onCredits:()=>{}}),n==="startScreen"&&F&&e.jsx(qn,{isVisible:!0,onStart:()=>{G(!1),Me()}}),n==="gameOver"&&e.jsx(In,{isVisible:!0,onRestart:be,onReturnToMenu:he}),n==="levelCompleted"&&e.jsx(Tn,{isVisible:!0,onContinue:Ee,onReturnToMenu:he,stars:3,rewards:["monedas","gemas","vidas"]}),n==="paused"&&e.jsx(Jn,{isVisible:!0,onResume:Z,onRestart:be,onExit:he,onSettings:we})]})]})]})};export{os as default};
